<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>PSY 703</title>
  <meta name="description" content="PSY 703: Data Science for Psychologists: A Modernized Exploratory and Graphical Data Analysis with R" />
  <meta name="generator" content="bookdown #bookdown:version# and GitBook 2.6.7" />

  <meta property="og:title" content="PSY 703" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://github.com/R-Computing-Lab/DataScience4Psych" />
  <meta property="og:image" content="https://github.com/R-Computing-Lab/DataScience4Psychassets/logo.png" />
  <meta property="og:description" content="PSY 703: Data Science for Psychologists: A Modernized Exploratory and Graphical Data Analysis with R" />
  <meta name="github-repo" content="R-Computing-Lab/DataScience4Psych" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="PSY 703" />
  <meta name="twitter:site" content="@smasongarrison" />
  <meta name="twitter:description" content="PSY 703: Data Science for Psychologists: A Modernized Exploratory and Graphical Data Analysis with R" />
  <meta name="twitter:image" content="https://github.com/R-Computing-Lab/DataScience4Psychassets/logo.png" />

<meta name="author" content="S. Mason Garrison" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="assets/favicon.ico" type="image/x-icon" />
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>
<link href="libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.5.2/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.16/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet" />
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
<link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet" />
<script src="libs/selectize-0.12.0/selectize.min.js"></script>
<link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>
<html>
  
  <head>
  <script src="anchor-links.js"></script>
  
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-68219208-1"></script>
  <script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-68219208-1');
  </script>

  </head>

</html>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="assets/style.css" type="text/css" />
</head>

<body>



<!--bookdown:title:start-->
<div id="header">
<h1 class="title">PSY 703</h1>
<h2 class="subtitle"><em>Data Science for Psychologists: A Modernized Exploratory and Graphical Data Analysis with R</em></h2>
<p class="author"><em>S. Mason Garrison</em></p>
</div>
<!--bookdown:title:end-->

<!--bookdown:toc:start-->
  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">
<!--bookdown:toc2:start-->
<ul>
<li><a href="#welcome-to-psy-703">Welcome to PSY 703</a><ul>
<li><a href="#course-introduction">Course Introduction</a></li>
<li><a href="#broad-topics">Broad Topics</a></li>
<li><a href="#materials">Materials</a><ul>
<li><a href="#hardware">Hardware</a></li>
<li><a href="#required-texts">Required Texts</a></li>
<li><a href="#software">Software</a></li>
</ul></li>
<li><a href="#course-modality"><span class="toc-section-number">0.1</span> Course Modality</a></li>
<li><a href="#attribution">Attribution</a><ul>
<li><a href="#stat-545">STAT 545</a></li>
<li><a href="#psy-8751">PSY 8751</a></li>
<li><a href="#stat-470670">Stat 470/670</a></li>
</ul></li>
<li><a href="#colophon">Colophon</a></li>
<li><a href="#license">License</a></li>
</ul></li>
<li><a href="#part-get-your-r-act-together">(PART) Get your R act together</a></li>
<li><a href="#install"><span class="toc-section-number">1</span> Install R and RStudio</a><ul>
<li><a href="#r-and-rstudio"><span class="toc-section-number">1.1</span> R and RStudio</a></li>
<li><a href="#testing-testing"><span class="toc-section-number">1.2</span> Testing testing</a></li>
<li><a href="#add-on-packages"><span class="toc-section-number">1.3</span> Add-on packages</a></li>
<li><a href="#further-resources"><span class="toc-section-number">1.4</span> Further resources</a></li>
</ul></li>
<li><a href="#r-basics"><span class="toc-section-number">2</span> R basics and workflows</a><ul>
<li><a href="#basics-of-working-with-r-at-the-command-line-and-rstudio-goodies"><span class="toc-section-number">2.1</span> Basics of working with R at the command line and RStudio goodies</a></li>
<li><a href="#workspace-and-working-directory"><span class="toc-section-number">2.2</span> Workspace and working directory</a><ul>
<li><a href="#workspace-.rdata"><span class="toc-section-number">2.2.1</span> Workspace, <code>.RData</code></a></li>
<li><a href="#working-directory"><span class="toc-section-number">2.2.2</span> Working directory</a></li>
</ul></li>
<li><a href="#rprojs"><span class="toc-section-number">2.3</span> RStudio projects</a></li>
<li><a href="#stuff"><span class="toc-section-number">2.4</span> Stuff</a></li>
</ul></li>
<li><a href="#part-version-control-and-r-markdown">(PART) Version control and R Markdown</a></li>
<li><a href="#overview">Overview</a></li>
<li><a href="#version-control"><span class="toc-section-number">3</span> Git, GitHub, and RStudio</a></li>
<li><a href="#r-markdown"><span class="toc-section-number">4</span> R Markdown</a></li>
<li><a href="#part-data-analysis-1">(PART) Data analysis 1</a></li>
<li><a href="#basic-data-care"><span class="toc-section-number">5</span> Basic care and feeding of data in R</a><ul>
<li><a href="#buckle-your-seatbelt"><span class="toc-section-number">5.1</span> Buckle your seatbelt</a></li>
<li><a href="#data-frames-are-awesome"><span class="toc-section-number">5.2</span> Data frames are awesome</a></li>
<li><a href="#get-the-gapminder-data"><span class="toc-section-number">5.3</span> Get the Gapminder data</a></li>
<li><a href="#meet-the-gapminder-data-frame-or-tibble"><span class="toc-section-number">5.4</span> Meet the <code>gapminder</code> data frame or “tibble”</a></li>
<li><a href="#look-at-the-variables-inside-a-data-frame"><span class="toc-section-number">5.5</span> Look at the variables inside a data frame</a></li>
<li><a href="#recap"><span class="toc-section-number">5.6</span> Recap</a></li>
</ul></li>
<li><a href="#dplyr-intro"><span class="toc-section-number">6</span> Introduction to dplyr</a><ul>
<li><a href="#intro"><span class="toc-section-number">6.1</span> Intro</a><ul>
<li><a href="#load-dplyr-and-gapminder"><span class="toc-section-number">6.1.1</span> Load dplyr and gapminder</a></li>
<li><a href="#say-hello-to-the-gapminder-tibble"><span class="toc-section-number">6.1.2</span> Say hello to the <code>gapminder</code> tibble</a></li>
</ul></li>
<li><a href="#think-before-you-create-excerpts-of-your-data"><span class="toc-section-number">6.2</span> Think before you create excerpts of your data …</a></li>
<li><a href="#use-filter-to-subset-data-row-wise"><span class="toc-section-number">6.3</span> Use <code>filter()</code> to subset data row-wise</a></li>
<li><a href="#meet-the-new-pipe-operator"><span class="toc-section-number">6.4</span> Meet the new pipe operator</a></li>
<li><a href="#use-select-to-subset-the-data-on-variables-or-columns."><span class="toc-section-number">6.5</span> Use <code>select()</code> to subset the data on variables or columns.</a></li>
<li><a href="#revel-in-the-convenience"><span class="toc-section-number">6.6</span> Revel in the convenience</a></li>
<li><a href="#pure-predictable-pipeable"><span class="toc-section-number">6.7</span> Pure, predictable, pipeable</a></li>
<li><a href="#resources"><span class="toc-section-number">6.8</span> Resources</a></li>
</ul></li>
<li><a href="#dplyr-single"><span class="toc-section-number">7</span> Single table dplyr functions</a><ul>
<li><a href="#where-were-we"><span class="toc-section-number">7.1</span> Where were we?</a></li>
<li><a href="#load-dplyr-and-gapminder-1"><span class="toc-section-number">7.2</span> Load dplyr and gapminder</a></li>
<li><a href="#create-a-copy-of-gapminder"><span class="toc-section-number">7.3</span> Create a copy of <code>gapminder</code></a></li>
<li><a href="#use-mutate-to-add-new-variables"><span class="toc-section-number">7.4</span> Use <code>mutate()</code> to add new variables</a></li>
<li><a href="#use-arrange-to-row-order-data-in-a-principled-way"><span class="toc-section-number">7.5</span> Use <code>arrange()</code> to row-order data in a principled way</a></li>
<li><a href="#use-rename-to-rename-variables"><span class="toc-section-number">7.6</span> Use <code>rename()</code> to rename variables</a></li>
<li><a href="#select-can-rename-and-reposition-variables"><span class="toc-section-number">7.7</span> <code>select()</code> can rename and reposition variables</a></li>
<li><a href="#group_by-is-a-mighty-weapon"><span class="toc-section-number">7.8</span> <code>group_by()</code> is a mighty weapon</a><ul>
<li><a href="#counting-things-up"><span class="toc-section-number">7.8.1</span> Counting things up</a></li>
<li><a href="#general-summarization"><span class="toc-section-number">7.8.2</span> General summarization</a></li>
</ul></li>
<li><a href="#grouped-mutate"><span class="toc-section-number">7.9</span> Grouped mutate</a><ul>
<li><a href="#computing-with-group-wise-summaries"><span class="toc-section-number">7.9.1</span> Computing with group-wise summaries</a></li>
<li><a href="#window-functions"><span class="toc-section-number">7.9.2</span> Window functions</a></li>
</ul></li>
<li><a href="#grand-finale"><span class="toc-section-number">7.10</span> Grand Finale</a></li>
<li><a href="#resources-1"><span class="toc-section-number">7.11</span> Resources</a></li>
</ul></li>
<li><a href="#tidy-data"><span class="toc-section-number">8</span> Tidy data</a></li>
<li><a href="#import-export"><span class="toc-section-number">9</span> Writing and reading files</a><ul>
<li><a href="#file-io-overview"><span class="toc-section-number">9.1</span> File I/O overview</a><ul>
<li><a href="#data-import-mindset"><span class="toc-section-number">9.1.1</span> Data import mindset</a></li>
<li><a href="#data-export-mindset"><span class="toc-section-number">9.1.2</span> Data export mindset</a></li>
</ul></li>
<li><a href="#load-the-tidyverse"><span class="toc-section-number">9.2</span> Load the tidyverse</a></li>
<li><a href="#locate-the-gapminder-data"><span class="toc-section-number">9.3</span> Locate the Gapminder data</a></li>
<li><a href="#bring-rectangular-data-in"><span class="toc-section-number">9.4</span> Bring rectangular data in</a><ul>
<li><a href="#bring-rectangular-data-in-summary"><span class="toc-section-number">9.4.1</span> Bring rectangular data in – summary</a></li>
</ul></li>
<li><a href="#compute-something-worthy-of-export"><span class="toc-section-number">9.5</span> Compute something worthy of export</a></li>
<li><a href="#write-rectangular-data-out"><span class="toc-section-number">9.6</span> Write rectangular data out</a></li>
<li><a href="#invertibility"><span class="toc-section-number">9.7</span> Invertibility</a></li>
<li><a href="#reordering-the-levels-of-the-country-factor"><span class="toc-section-number">9.8</span> Reordering the levels of the country factor</a></li>
<li><a href="#saverds-and-readrds"><span class="toc-section-number">9.9</span> <code>saveRDS()</code> and <code>readRDS()</code></a></li>
<li><a href="#retaining-factor-levels-upon-re-import"><span class="toc-section-number">9.10</span> Retaining factor levels upon re-import</a></li>
<li><a href="#dput-and-dget"><span class="toc-section-number">9.11</span> <code>dput()</code> and <code>dget()</code></a></li>
<li><a href="#other-types-of-objects-to-use-dput-or-saverds-on"><span class="toc-section-number">9.12</span> Other types of objects to use <code>dput()</code> or <code>saveRDS()</code> on</a></li>
<li><a href="#clean-up"><span class="toc-section-number">9.13</span> Clean up</a></li>
<li><a href="#pitfalls-of-delimited-files"><span class="toc-section-number">9.14</span> Pitfalls of delimited files</a></li>
<li><a href="#resources-2"><span class="toc-section-number">9.15</span> Resources</a></li>
</ul></li>
<li><a href="#part-data-analysis-2">(PART) Data analysis 2</a></li>
<li><a href="#factors-boss"><span class="toc-section-number">10</span> Be the boss of your factors</a><ul>
<li><a href="#factors-where-they-fit-in"><span class="toc-section-number">10.1</span> Factors: where they fit in</a></li>
<li><a href="#the-forcats-package"><span class="toc-section-number">10.2</span> The forcats package</a></li>
<li><a href="#load-forcats-and-gapminder"><span class="toc-section-number">10.3</span> Load forcats and gapminder</a></li>
<li><a href="#factor-inspection"><span class="toc-section-number">10.4</span> Factor inspection</a></li>
<li><a href="#dropping-unused-levels"><span class="toc-section-number">10.5</span> Dropping unused levels</a></li>
<li><a href="#reorder-factors"><span class="toc-section-number">10.6</span> Change order of the levels, principled</a></li>
<li><a href="#change-order-of-the-levels-because-i-said-so"><span class="toc-section-number">10.7</span> Change order of the levels, “because I said so”</a></li>
<li><a href="#recode-the-levels"><span class="toc-section-number">10.8</span> Recode the levels</a></li>
<li><a href="#grow-a-factor"><span class="toc-section-number">10.9</span> Grow a factor</a></li>
</ul></li>
<li><a href="#character-vectors"><span class="toc-section-number">11</span> Character vectors</a><ul>
<li><a href="#character-vectors-where-they-fit-in"><span class="toc-section-number">11.1</span> Character vectors: where they fit in</a></li>
<li><a href="#resources-3"><span class="toc-section-number">11.2</span> Resources</a><ul>
<li><a href="#manipulating-character-vectors"><span class="toc-section-number">11.2.1</span> Manipulating character vectors</a></li>
<li><a href="#regular-expressions-resources"><span class="toc-section-number">11.2.2</span> Regular expressions resources</a></li>
<li><a href="#character-encoding-resources"><span class="toc-section-number">11.2.3</span> Character encoding resources</a></li>
<li><a href="#character-vectors-that-live-in-a-data-frame"><span class="toc-section-number">11.2.4</span> Character vectors that live in a data frame</a></li>
</ul></li>
<li><a href="#load-the-tidyverse-which-includes-stringr"><span class="toc-section-number">11.3</span> Load the tidyverse, which includes stringr</a></li>
<li><a href="#regex-free-string-manipulation-with-stringr-and-tidyr"><span class="toc-section-number">11.4</span> Regex-free string manipulation with stringr and tidyr</a><ul>
<li><a href="#detect-or-filter-on-a-target-string"><span class="toc-section-number">11.4.1</span> Detect or filter on a target string</a></li>
<li><a href="#string-splitting-by-delimiter"><span class="toc-section-number">11.4.2</span> String splitting by delimiter</a></li>
<li><a href="#substring-extraction-and-replacement-by-position"><span class="toc-section-number">11.4.3</span> Substring extraction (and replacement) by position</a></li>
<li><a href="#collapse-a-vector"><span class="toc-section-number">11.4.4</span> Collapse a vector</a></li>
<li><a href="#catenate-vectors"><span class="toc-section-number">11.4.5</span> Create a character vector by catenating multiple vectors</a></li>
<li><a href="#substring-replacement"><span class="toc-section-number">11.4.6</span> Substring replacement</a></li>
</ul></li>
<li><a href="#regular-expressions-with-stringr"><span class="toc-section-number">11.5</span> Regular expressions with stringr</a><ul>
<li><a href="#load-gapminder"><span class="toc-section-number">11.5.1</span> Load gapminder</a></li>
<li><a href="#characters-with-special-meaning"><span class="toc-section-number">11.5.2</span> Characters with special meaning</a></li>
<li><a href="#character-classes"><span class="toc-section-number">11.5.3</span> Character classes</a></li>
<li><a href="#quantifiers"><span class="toc-section-number">11.5.4</span> Quantifiers</a></li>
<li><a href="#escaping"><span class="toc-section-number">11.5.5</span> Escaping</a></li>
<li><a href="#groups-and-backreferences"><span class="toc-section-number">11.5.6</span> Groups and backreferences</a></li>
</ul></li>
</ul></li>
<li><a href="#character-encoding"><span class="toc-section-number">12</span> Character encoding</a><ul>
<li><a href="#resources-4"><span class="toc-section-number">12.1</span> Resources</a></li>
<li><a href="#translating-two-blog-posts-from-ruby-to-r"><span class="toc-section-number">12.2</span> Translating two blog posts from Ruby to R</a></li>
<li><a href="#what-is-an-encoding"><span class="toc-section-number">12.3</span> What is an encoding?</a></li>
<li><a href="#a-three-step-process-for-fixing-encoding-bugs"><span class="toc-section-number">12.4</span> A three-step process for fixing encoding bugs</a><ul>
<li><a href="#discover-which-encoding-your-string-is-actually-in."><span class="toc-section-number">12.4.1</span> Discover which encoding your string is actually in.</a></li>
<li><a href="#decide-which-encoding-you-want-the-string-to-be"><span class="toc-section-number">12.4.2</span> Decide which encoding you want the string to be</a></li>
<li><a href="#re-encode-your-string"><span class="toc-section-number">12.4.3</span> Re-encode your string</a></li>
</ul></li>
<li><a href="#how-to-get-from-theyâre-to-theyre"><span class="toc-section-number">12.5</span> How to Get From Theyâ€™re to They’re</a><ul>
<li><a href="#multi-byte-characters"><span class="toc-section-number">12.5.1</span> Multi-byte characters</a></li>
<li><a href="#encoding-repair"><span class="toc-section-number">12.5.2</span> Encoding repair</a></li>
</ul></li>
</ul></li>
<li><a href="#date-time"><span class="toc-section-number">13</span> Dates and times</a><ul>
<li><a href="#date-time-vectors-where-they-fit-in"><span class="toc-section-number">13.1</span> Date-time vectors: where they fit in</a></li>
<li><a href="#resources-5"><span class="toc-section-number">13.2</span> Resources</a></li>
<li><a href="#load-the-tidyverse-and-lubridate"><span class="toc-section-number">13.3</span> Load the tidyverse and lubridate</a></li>
<li><a href="#get-your-hands-on-some-dates-or-date-times"><span class="toc-section-number">13.4</span> Get your hands on some dates or date-times</a></li>
<li><a href="#get-date-or-date-time-from-character"><span class="toc-section-number">13.5</span> Get date or date-time from character</a></li>
<li><a href="#build-date-or-date-time-from-parts"><span class="toc-section-number">13.6</span> Build date or date-time from parts</a></li>
<li><a href="#get-parts-from-date-or-date-time"><span class="toc-section-number">13.7</span> Get parts from date or date-time</a></li>
<li><a href="#arithmetic-with-date-or-date-time"><span class="toc-section-number">13.8</span> Arithmetic with date or date-time</a></li>
<li><a href="#get-character-from-date-or-date-time"><span class="toc-section-number">13.9</span> Get character from date or date-time</a></li>
</ul></li>
<li><a href="#part-data-analysis-3">(PART) Data analysis 3</a></li>
<li><a href="#multiple-tibbles"><span class="toc-section-number">14</span> When one tibble is not enough</a><ul>
<li><a href="#typology-of-data-combination-tasks"><span class="toc-section-number">14.1</span> Typology of data combination tasks</a></li>
<li><a href="#bind"><span class="toc-section-number">14.2</span> Bind</a><ul>
<li><a href="#row-binding"><span class="toc-section-number">14.2.1</span> Row binding</a></li>
<li><a href="#column-binding"><span class="toc-section-number">14.2.2</span> Column binding</a></li>
</ul></li>
<li><a href="#joins-in-dplyr"><span class="toc-section-number">14.3</span> Joins in dplyr</a></li>
<li><a href="#table-lookup"><span class="toc-section-number">14.4</span> Table Lookup</a></li>
</ul></li>
<li><a href="#join-cheatsheet"><span class="toc-section-number">15</span> Join two tables</a><ul>
<li><a href="#why-the-cheatsheet"><span class="toc-section-number">15.1</span> Why the cheatsheet</a></li>
<li><a href="#the-data"><span class="toc-section-number">15.2</span> The data</a></li>
<li><a href="#inner_joinsuperheroes-publishers"><span class="toc-section-number">15.3</span> <code>inner_join(superheroes, publishers)</code></a></li>
<li><a href="#semi_joinsuperheroes-publishers"><span class="toc-section-number">15.4</span> <code>semi_join(superheroes, publishers)</code></a></li>
<li><a href="#left_joinsuperheroes-publishers"><span class="toc-section-number">15.5</span> <code>left_join(superheroes, publishers)</code></a></li>
<li><a href="#anti_joinsuperheroes-publishers"><span class="toc-section-number">15.6</span> <code>anti_join(superheroes, publishers)</code></a></li>
<li><a href="#inner_joinpublishers-superheroes"><span class="toc-section-number">15.7</span> <code>inner_join(publishers, superheroes)</code></a></li>
<li><a href="#semi_joinpublishers-superheroes"><span class="toc-section-number">15.8</span> <code>semi_join(publishers, superheroes)</code></a></li>
<li><a href="#left_joinpublishers-superheroes"><span class="toc-section-number">15.9</span> <code>left_join(publishers, superheroes)</code></a></li>
<li><a href="#anti_joinpublishers-superheroes"><span class="toc-section-number">15.10</span> <code>anti_join(publishers, superheroes)</code></a></li>
<li><a href="#full_joinsuperheroes-publishers"><span class="toc-section-number">15.11</span> <code>full_join(superheroes, publishers)</code></a></li>
</ul></li>
<li><a href="#lookup"><span class="toc-section-number">16</span> Table lookup</a><ul>
<li><a href="#load-gapminder-and-the-tidyverse"><span class="toc-section-number">16.1</span> Load gapminder and the tidyverse</a></li>
<li><a href="#create-mini-gapminder"><span class="toc-section-number">16.2</span> Create mini Gapminder</a></li>
<li><a href="#dorky-national-food-example."><span class="toc-section-number">16.3</span> Dorky national food example.</a></li>
<li><a href="#lookup-national-food"><span class="toc-section-number">16.4</span> Lookup national food</a></li>
<li><a href="#worlds-laziest-table-lookup"><span class="toc-section-number">16.5</span> World’s laziest table lookup</a></li>
</ul></li>
<li><a href="#part-r-as-a-programming-language">(PART) R as a programming language</a></li>
<li><a href="#r-objects"><span class="toc-section-number">17</span> R objects and indexing</a><ul>
<li><a href="#vectors-are-everywhere"><span class="toc-section-number">17.1</span> Vectors are everywhere</a></li>
<li><a href="#indexing-a-vector"><span class="toc-section-number">17.2</span> Indexing a vector</a></li>
<li><a href="#lists-hold-just-about-anything"><span class="toc-section-number">17.3</span> lists hold just about anything</a></li>
<li><a href="#creating-a-data.frame-explicitly"><span class="toc-section-number">17.4</span> Creating a data.frame explicitly</a></li>
<li><a href="#indexing-arrays-e.g.-matrices"><span class="toc-section-number">17.5</span> Indexing arrays, e.g. matrices</a></li>
<li><a href="#creating-arrays-e.g.-matrices"><span class="toc-section-number">17.6</span> Creating arrays, e.g. matrices</a></li>
<li><a href="#putting-it-all-togetherimplications-for-data.frames"><span class="toc-section-number">17.7</span> Putting it all together…implications for data.frames</a></li>
<li><a href="#table-of-atomic-r-object-flavors"><span class="toc-section-number">17.8</span> Table of atomic R object flavors</a></li>
</ul></li>
<li><a href="#functions-part1"><span class="toc-section-number">18</span> Write your own R functions, part 1</a><ul>
<li><a href="#what-and-why"><span class="toc-section-number">18.1</span> What and why?</a></li>
<li><a href="#load-the-gapminder-data"><span class="toc-section-number">18.2</span> Load the Gapminder data</a></li>
<li><a href="#max---min"><span class="toc-section-number">18.3</span> Max - min</a></li>
<li><a href="#get-something-that-works"><span class="toc-section-number">18.4</span> Get something that works</a><ul>
<li><a href="#skateboard-perfectly-formed-rear-view-mirror"><span class="toc-section-number">18.4.1</span> Skateboard &gt;&gt; perfectly formed rear-view mirror</a></li>
</ul></li>
<li><a href="#turn-the-working-interactive-code-into-a-function"><span class="toc-section-number">18.5</span> Turn the working interactive code into a function</a></li>
<li><a href="#test-your-function"><span class="toc-section-number">18.6</span> Test your function</a><ul>
<li><a href="#test-on-new-inputs"><span class="toc-section-number">18.6.1</span> Test on new inputs</a></li>
<li><a href="#test-on-real-data-but-different-real-data"><span class="toc-section-number">18.6.2</span> Test on real data but <em>different</em> real data</a></li>
<li><a href="#test-on-weird-stuff"><span class="toc-section-number">18.6.3</span> Test on weird stuff</a></li>
<li><a href="#i-will-scare-you-now"><span class="toc-section-number">18.6.4</span> I will scare you now</a></li>
</ul></li>
<li><a href="#check-the-validity-of-arguments"><span class="toc-section-number">18.7</span> Check the validity of arguments</a><ul>
<li><a href="#stop-if-not"><span class="toc-section-number">18.7.1</span> stop if not</a></li>
<li><a href="#if-then-stop"><span class="toc-section-number">18.7.2</span> if then stop</a></li>
<li><a href="#sidebar-non-programming-uses-for-assertions"><span class="toc-section-number">18.7.3</span> Sidebar: non-programming uses for assertions</a></li>
</ul></li>
<li><a href="#wrap-up-and-whats-next"><span class="toc-section-number">18.8</span> Wrap-up and what’s next?</a></li>
<li><a href="#resources-6"><span class="toc-section-number">18.9</span> Resources</a></li>
</ul></li>
<li><a href="#functions-part2"><span class="toc-section-number">19</span> Write your own R functions, part 2</a><ul>
<li><a href="#where-were-we-where-are-we-going"><span class="toc-section-number">19.1</span> Where were we? Where are we going?</a></li>
<li><a href="#load-the-gapminder-data-1"><span class="toc-section-number">19.2</span> Load the Gapminder data</a></li>
<li><a href="#restore-our-max-minus-min-function"><span class="toc-section-number">19.3</span> Restore our max minus min function</a></li>
<li><a href="#generalize-our-function-to-other-quantiles"><span class="toc-section-number">19.4</span> Generalize our function to other quantiles</a></li>
<li><a href="#get-something-that-works-again"><span class="toc-section-number">19.5</span> Get something that works, again</a></li>
<li><a href="#turn-the-working-interactive-code-into-a-function-again"><span class="toc-section-number">19.6</span> Turn the working interactive code into a function, again</a></li>
<li><a href="#argument-names-freedom-and-conventions"><span class="toc-section-number">19.7</span> Argument names: freedom and conventions</a></li>
<li><a href="#what-a-function-returns"><span class="toc-section-number">19.8</span> What a function returns</a></li>
<li><a href="#default-values-freedom-to-not-specify-the-arguments"><span class="toc-section-number">19.9</span> Default values: freedom to NOT specify the arguments</a></li>
<li><a href="#check-the-validity-of-arguments-again"><span class="toc-section-number">19.10</span> Check the validity of arguments, again</a></li>
<li><a href="#wrap-up-and-whats-next-1"><span class="toc-section-number">19.11</span> Wrap-up and what’s next?</a></li>
<li><a href="#resources-7"><span class="toc-section-number">19.12</span> Resources</a></li>
</ul></li>
<li><a href="#functions-part3"><span class="toc-section-number">20</span> Write your own R functions, part 3</a><ul>
<li><a href="#where-were-we-where-are-we-going-1"><span class="toc-section-number">20.1</span> Where were we? Where are we going?</a></li>
<li><a href="#load-the-gapminder-data-2"><span class="toc-section-number">20.2</span> Load the Gapminder data</a></li>
<li><a href="#restore-our-max-minus-min-function-1"><span class="toc-section-number">20.3</span> Restore our max minus min function</a></li>
<li><a href="#be-proactive-about-nas"><span class="toc-section-number">20.4</span> Be proactive about <code>NA</code>s</a></li>
<li><a href="#the-useful-but-mysterious-...-argument"><span class="toc-section-number">20.5</span> The useful but mysterious <code>...</code> argument</a></li>
<li><a href="#use-testthat-for-formal-unit-tests"><span class="toc-section-number">20.6</span> Use testthat for formal unit tests</a></li>
<li><a href="#resources-8"><span class="toc-section-number">20.7</span> Resources</a></li>
</ul></li>
<li><a href="#functions-practicum"><span class="toc-section-number">21</span> Function-writing practicum</a><ul>
<li><a href="#overview-1"><span class="toc-section-number">21.1</span> Overview</a></li>
<li><a href="#load-the-gapminder-data-3"><span class="toc-section-number">21.2</span> Load the Gapminder data</a></li>
<li><a href="#get-data-to-practice-with"><span class="toc-section-number">21.3</span> Get data to practice with</a></li>
<li><a href="#get-some-code-that-works"><span class="toc-section-number">21.4</span> Get some code that works</a><ul>
<li><a href="#sidebar-regression-stuff"><span class="toc-section-number">21.4.1</span> Sidebar: regression stuff</a></li>
</ul></li>
<li><a href="#turn-working-code-into-a-function"><span class="toc-section-number">21.5</span> Turn working code into a function</a></li>
<li><a href="#test-on-other-data-and-in-a-clean-workspace"><span class="toc-section-number">21.6</span> Test on other data and in a clean workspace</a></li>
<li><a href="#are-we-there-yet"><span class="toc-section-number">21.7</span> Are we there yet?</a></li>
</ul></li>
<li><a href="#part-all-the-graph-things">(PART) All the graph things</a></li>
<li><a href="#graphics-overview">Overview</a></li>
<li><a href="#graphics-slides"><span class="toc-section-number">22</span> R graphics landscape</a></li>
<li><a href="#ggplot2-tutorial"><span class="toc-section-number">23</span> ggplot2 tutorial</a></li>
<li><a href="#effective-graphs"><span class="toc-section-number">24</span> Do’s and don’ts of making effective graphics</a><ul>
<li><a href="#goal-create-more-effective-graphs"><span class="toc-section-number">24.1</span> Goal: create more effective graphs</a></li>
<li><a href="#no-nos"><span class="toc-section-number">24.2</span> No no’s</a><ul>
<li><a href="#pie-charts"><span class="toc-section-number">24.2.1</span> Pie charts</a></li>
<li><a href="#more-pie-charts"><span class="toc-section-number">24.2.2</span> More pie charts</a></li>
<li><a href="#stacked-and-group-bar-charts"><span class="toc-section-number">24.2.3</span> Stacked and group bar charts</a></li>
<li><a href="#self-contradiction"><span class="toc-section-number">24.2.4</span> Self-contradiction</a></li>
<li><a href="#using-microsoft-excel-to-obscure-your-data-and-annoy-your-readers"><span class="toc-section-number">24.2.5</span> Using Microsoft Excel to obscure your data and annoy your readers</a></li>
</ul></li>
<li><a href="#do-make-the-data-stand-out"><span class="toc-section-number">24.3</span> Do: make the data stand out</a></li>
<li><a href="#do-spare-your-reader-from-mental-gymnastics"><span class="toc-section-number">24.4</span> Do: spare your reader from mental gymnastics</a></li>
<li><a href="#do-use-position-along-a-common-scale"><span class="toc-section-number">24.5</span> Do: use position along a common scale</a></li>
<li><a href="#do-take-control-of-aspect-ratio"><span class="toc-section-number">24.6</span> Do: take control of aspect ratio</a></li>
<li><a href="#do-think-about-including-zero"><span class="toc-section-number">24.7</span> Do: think about including zero</a></li>
<li><a href="#do-choose-the-scale-with-intention"><span class="toc-section-number">24.8</span> Do: choose the scale with intention</a></li>
<li><a href="#do-connect-the-dots-with-care"><span class="toc-section-number">24.9</span> Do: connect the dots with care</a></li>
<li><a href="#do-convey-groups-clearly"><span class="toc-section-number">24.10</span> Do: convey groups clearly</a><ul>
<li><a href="#a-tour-of-the-dos"><span class="toc-section-number">24.10.1</span> A tour of the Do’s</a></li>
</ul></li>
<li><a href="#effective-graphs-resources"><span class="toc-section-number">24.11</span> Resources</a></li>
</ul></li>
<li><a href="#colors"><span class="toc-section-number">25</span> Using colors in R</a><ul>
<li><a href="#load-dplyr-and-gapminder-2"><span class="toc-section-number">25.1</span> Load dplyr and gapminder</a></li>
<li><a href="#change-the-default-plotting-symbol-to-a-solid-circle"><span class="toc-section-number">25.2</span> Change the default plotting symbol to a solid circle</a></li>
<li><a href="#basic-color-specification-and-the-default-palette"><span class="toc-section-number">25.3</span> Basic color specification and the default palette</a></li>
<li><a href="#what-colors-are-available-ditto-for-symbols-and-line-types"><span class="toc-section-number">25.4</span> What colors are available? Ditto for symbols and line types</a></li>
<li><a href="#rcolorbrewer"><span class="toc-section-number">25.5</span> RColorBrewer</a></li>
<li><a href="#viridis"><span class="toc-section-number">25.6</span> viridis</a></li>
<li><a href="#hexadecimal-rgb-color-specification"><span class="toc-section-number">25.7</span> Hexadecimal RGB color specification</a></li>
<li><a href="#alternatives-to-the-rgb-color-model-especially-hcl"><span class="toc-section-number">25.8</span> Alternatives to the RGB color model, especially HCL</a></li>
<li><a href="#accommodating-color-blindness"><span class="toc-section-number">25.9</span> Accommodating color blindness</a></li>
<li><a href="#clean-up-1"><span class="toc-section-number">25.10</span> Clean up</a></li>
<li><a href="#resources-9"><span class="toc-section-number">25.11</span> Resources</a></li>
</ul></li>
<li><a href="#qualitative-colors"><span class="toc-section-number">26</span> Taking control of qualitative colors in ggplot</a><ul>
<li><a href="#load-packages-and-prepare-the-gapminder-data"><span class="toc-section-number">26.1</span> Load packages and prepare the Gapminder data</a></li>
<li><a href="#take-control-of-the-size-and-color-of-points"><span class="toc-section-number">26.2</span> Take control of the size and color of points</a></li>
<li><a href="#circle-area-population"><span class="toc-section-number">26.3</span> Circle area = population</a></li>
<li><a href="#circle-fill-color-determined-by-a-factor"><span class="toc-section-number">26.4</span> Circle fill color determined by a factor</a></li>
<li><a href="#get-the-color-scheme-for-the-countries"><span class="toc-section-number">26.5</span> Get the color scheme for the countries</a></li>
<li><a href="#prepare-the-color-scheme-for-use-with-ggplot"><span class="toc-section-number">26.6</span> Prepare the color scheme for use with ggplot</a></li>
<li><a href="#make-the-ggplot-bubble-chart"><span class="toc-section-number">26.7</span> Make the ggplot bubble chart</a></li>
<li><a href="#all-together-now"><span class="toc-section-number">26.8</span> All together now</a></li>
</ul></li>
<li><a href="#secrets"><span class="toc-section-number">27</span> Secrets of a happy graphing life</a><ul>
<li><a href="#load-gapminder-and-the-tidyverse-1"><span class="toc-section-number">27.1</span> Load gapminder and the tidyverse</a></li>
<li><a href="#hidden-data-wrangling-problems"><span class="toc-section-number">27.2</span> Hidden data wrangling problems</a></li>
<li><a href="#keep-stuff-in-data-frames"><span class="toc-section-number">27.3</span> Keep stuff in data frames</a><ul>
<li><a href="#explicit-data-frame-creation-via-tibbletibble-and-tibbletribble"><span class="toc-section-number">27.3.1</span> Explicit data frame creation via <code>tibble::tibble()</code> and <code>tibble::tribble()</code></a></li>
<li><a href="#sidebar-with"><span class="toc-section-number">27.3.2</span> Sidebar: <code>with()</code></a></li>
</ul></li>
<li><a href="#tidying-and-reshaping"><span class="toc-section-number">27.4</span> Tidying and reshaping</a></li>
<li><a href="#factor-management"><span class="toc-section-number">27.5</span> Factor management</a></li>
<li><a href="#worked-example"><span class="toc-section-number">27.6</span> Worked example</a><ul>
<li><a href="#reshape-your-data"><span class="toc-section-number">27.6.1</span> Reshape your data</a></li>
<li><a href="#iterate-over-the-variables-via-faceting"><span class="toc-section-number">27.6.2</span> Iterate over the variables via faceting</a></li>
<li><a href="#recap-1"><span class="toc-section-number">27.6.3</span> Recap</a></li>
</ul></li>
</ul></li>
<li><a href="#save-figs"><span class="toc-section-number">28</span> Writing figures to file</a><ul>
<li><a href="#step-away-from-the-mouse"><span class="toc-section-number">28.1</span> Step away from the mouse</a></li>
<li><a href="#good-names-are-like-breadcrumbs"><span class="toc-section-number">28.2</span> Good names are like breadcrumbs</a></li>
<li><a href="#graphics-devices"><span class="toc-section-number">28.3</span> Graphics devices</a></li>
<li><a href="#write-figures-to-file-with-ggsave"><span class="toc-section-number">28.4</span> Write figures to file with <code>ggsave()</code></a><ul>
<li><a href="#passing-a-plot-object-to-ggsave"><span class="toc-section-number">28.4.1</span> Passing a plot object to <code>ggsave()</code></a></li>
<li><a href="#scaling"><span class="toc-section-number">28.4.2</span> Scaling</a></li>
</ul></li>
<li><a href="#write-non-ggplot2-figures-to-file"><span class="toc-section-number">28.5</span> Write non-ggplot2 figures to file</a></li>
<li><a href="#preemptive-answers-to-some-faqs"><span class="toc-section-number">28.6</span> Preemptive answers to some FAQs</a><ul>
<li><a href="#despair-over-non-existent-or-empty-figures"><span class="toc-section-number">28.6.1</span> Despair over non-existent or empty figures</a></li>
<li><a href="#mysterious-empty-rplots.pdf-file"><span class="toc-section-number">28.6.2</span> Mysterious empty <code>Rplots.pdf</code> file</a></li>
</ul></li>
<li><a href="#chunk-name-determines-figure-file-name"><span class="toc-section-number">28.7</span> Chunk name determines figure file name</a></li>
<li><a href="#clean-up-2"><span class="toc-section-number">28.8</span> Clean up</a></li>
</ul></li>
<li><a href="#multiple-plots"><span class="toc-section-number">29</span> Multiple plots on a page</a><ul>
<li><a href="#faceting-is-not-a-panacea"><span class="toc-section-number">29.1</span> Faceting is not a panacea</a></li>
<li><a href="#meet-the-gridextra-package"><span class="toc-section-number">29.2</span> Meet the gridExtra package</a></li>
<li><a href="#load-gapminder-and-ggplot2"><span class="toc-section-number">29.3</span> Load gapminder and ggplot2</a></li>
<li><a href="#use-the-arrangegrob-function-and-friends"><span class="toc-section-number">29.4</span> Use the <code>arrangeGrob()</code> function and friends</a></li>
<li><a href="#use-the-multiplot-function"><span class="toc-section-number">29.5</span> Use the <code>multiplot()</code> function</a></li>
<li><a href="#use-the-cowplot-package"><span class="toc-section-number">29.6</span> Use the cowplot package</a></li>
</ul></li>
<li><a href="#part-all-the-package-things">(PART) All the package things</a></li>
<li><a href="#package-overview">Overview</a><ul>
<li><a href="#resources-10">Resources</a></li>
</ul></li>
<li><a href="#package-slides"><span class="toc-section-number">30</span> Write your first R package</a></li>
<li><a href="#system-prep"><span class="toc-section-number">31</span> System preparation for package development</a><ul>
<li><a href="#update-r-and-rstudio"><span class="toc-section-number">31.1</span> Update R and RStudio</a></li>
<li><a href="#install-devtools-from-cran"><span class="toc-section-number">31.2</span> Install <code>devtools</code> from CRAN</a></li>
<li><a href="#windows-system-prep"><span class="toc-section-number">31.3</span> Windows: system prep</a></li>
<li><a href="#macos-system-prep"><span class="toc-section-number">31.4</span> macOS: system prep</a></li>
<li><a href="#linux-system-prep"><span class="toc-section-number">31.5</span> Linux: system prep</a></li>
<li><a href="#check-system-prep"><span class="toc-section-number">31.6</span> Check system prep</a></li>
<li><a href="#r-packages-to-help-you-build-yet-more-r-packages"><span class="toc-section-number">31.7</span> R packages to help you build yet more R packages</a></li>
<li><a href="#optional-install-devtools-from-github"><span class="toc-section-number">31.8</span> Optional: install <code>devtools</code> from GitHub</a></li>
</ul></li>
<li><a href="#package-from-scratch"><span class="toc-section-number">32</span> Write your own R package</a></li>
<li><a href="#part-all-the-automation-things">(PART) All the automation things</a></li>
<li><a href="#automation-overview">Overview</a><ul>
<li><a href="#resources-11">Resources</a></li>
</ul></li>
<li><a href="#automation-slides"><span class="toc-section-number">33</span> Why and how we automate data analyses + examples</a></li>
<li><a href="#make-windows"><span class="toc-section-number">34</span> <code>make</code>: special considerations for Windows</a><ul>
<li><a href="#install-make-on-microsoft-windows"><span class="toc-section-number">34.1</span> Install <code>make</code> on Microsoft Windows</a></li>
<li><a href="#update-your-path"><span class="toc-section-number">34.2</span> Update your <code>PATH</code></a></li>
<li><a href="#issues-we-are-still-clarifying"><span class="toc-section-number">34.3</span> Issues we are still clarifying</a></li>
</ul></li>
<li><a href="#make-test-drive"><span class="toc-section-number">35</span> Automation: test drive <code>make</code></a><ul>
<li><a href="#create-a-temporary-rstudio-project"><span class="toc-section-number">35.1</span> Create a temporary RStudio project</a></li>
<li><a href="#disable-insert-spaces-for-tab"><span class="toc-section-number">35.2</span> Disable “insert spaces for tab”</a></li>
<li><a href="#write-a-toy-makefile"><span class="toc-section-number">35.3</span> Write a toy <code>Makefile</code></a></li>
<li><a href="#configure-this-rstudio-project-to-use-make"><span class="toc-section-number">35.4</span> Configure this RStudio project to use <code>make</code></a></li>
<li><a href="#run-make-via-rstudio"><span class="toc-section-number">35.5</span> Run <code>make</code> via RStudio</a></li>
<li><a href="#run-make-from-the-shell"><span class="toc-section-number">35.6</span> Run <code>make</code> from the shell</a></li>
</ul></li>
<li><a href="#automating-pipeline"><span class="toc-section-number">36</span> Automating data-analysis pipelines</a><ul>
<li><a href="#dependency-graph-of-the-pipeline"><span class="toc-section-number">36.1</span> Dependency graph of the pipeline</a></li>
<li><a href="#set-up-a-new-rstudio-project-and-git-repo"><span class="toc-section-number">36.2</span> Set up a new RStudio project (and Git repo)</a></li>
<li><a href="#sample-project-and-git-repository"><span class="toc-section-number">36.3</span> Sample project and Git repository</a></li>
<li><a href="#create-the-makefile"><span class="toc-section-number">36.4</span> Create the <code>Makefile</code></a></li>
<li><a href="#get-the-dictionary-of-words"><span class="toc-section-number">36.5</span> Get the dictionary of words</a><ul>
<li><a href="#download-the-dictionary"><span class="toc-section-number">36.5.1</span> Download the dictionary</a></li>
<li><a href="#copy-the-dictionary"><span class="toc-section-number">36.5.2</span> Copy the dictionary</a></li>
</ul></li>
<li><a href="#create-rules-for-all-and-clean"><span class="toc-section-number">36.6</span> Create rules for all and clean</a></li>
<li><a href="#create-a-table-of-word-lengths"><span class="toc-section-number">36.7</span> Create a table of word lengths</a></li>
<li><a href="#update-rules-for-all-and-clean"><span class="toc-section-number">36.8</span> Update rules for all and clean</a></li>
<li><a href="#plot-a-histogram-of-word-lengths-update-all-and-clean"><span class="toc-section-number">36.9</span> Plot a histogram of word lengths, update all and clean</a></li>
<li><a href="#use-make-to-deal-with-an-annoyance"><span class="toc-section-number">36.10</span> Use <code>make</code> to deal with an annoyance</a></li>
<li><a href="#render-an-html-report"><span class="toc-section-number">36.11</span> Render an HTML report</a></li>
<li><a href="#the-final-makefile"><span class="toc-section-number">36.12</span> The final <code>Makefile</code></a></li>
<li><a href="#extending-the-makefile"><span class="toc-section-number">36.13</span> Extending the <code>Makefile</code></a></li>
</ul></li>
<li><a href="#example-pipelines"><span class="toc-section-number">37</span> More example pipelines</a></li>
<li><a href="#part-get-data-from-the-web">(PART) Get data from the web</a></li>
<li><a href="#web-data-slides"><span class="toc-section-number">38</span> Slides</a></li>
<li><a href="#api-wrappers"><span class="toc-section-number">39</span> Use API-wrapping packages</a><ul>
<li><a href="#introduction"><span class="toc-section-number">39.1</span> Introduction</a></li>
<li><a href="#click-and-download"><span class="toc-section-number">39.2</span> Click-and-Download</a><ul>
<li><a href="#from-ropensci-web-services-page"><span class="toc-section-number">39.2.1</span> From rOpenSci web services page:</a></li>
</ul></li>
<li><a href="#data-supplied-on-the-web"><span class="toc-section-number">39.3</span> Data supplied on the web</a></li>
<li><a href="#install-and-play"><span class="toc-section-number">39.4</span> Install-and-play</a><ul>
<li><a href="#load-the-tidyverse-1"><span class="toc-section-number">39.4.1</span> Load the tidyverse</a></li>
<li><a href="#sightings-of-birds-rebird"><span class="toc-section-number">39.4.2</span> Sightings of birds: rebird</a></li>
<li><a href="#geonames"><span class="toc-section-number">39.4.3</span> Searching geographic info: geonames</a></li>
<li><a href="#wikipedia-searching"><span class="toc-section-number">39.4.4</span> Wikipedia searching</a></li>
<li><a href="#plos-one"><span class="toc-section-number">39.4.5</span> Searching the Public Library of Science: rplos</a></li>
<li><a href="#is-it-a-boy-or-a-girl-gender-associated-names-throughout-us-history"><span class="toc-section-number">39.4.6</span> Is it a boy or a girl? gender-associated names throughout US history</a></li>
</ul></li>
</ul></li>
<li><a href="#diy-web-data"><span class="toc-section-number">40</span> DIY web data</a><ul>
<li><a href="#interacting-with-an-api"><span class="toc-section-number">40.1</span> Interacting with an API</a><ul>
<li><a href="#load-the-tidyverse-2"><span class="toc-section-number">40.1.1</span> Load the tidyverse</a></li>
<li><a href="#examine-the-structure-of-api-requests-using-the-open-movie-database"><span class="toc-section-number">40.1.2</span> Examine the structure of API requests using the Open Movie Database</a></li>
<li><a href="#create-an-omdb-api-key"><span class="toc-section-number">40.1.3</span> Create an OMDb API Key</a></li>
<li><a href="#recreate-the-request-url-in-r"><span class="toc-section-number">40.1.4</span> Recreate the request URL in R</a></li>
<li><a href="#get-data-using-the-curl-package"><span class="toc-section-number">40.1.5</span> Get data using the curl package</a></li>
</ul></li>
<li><a href="#intro-to-json-and-xml"><span class="toc-section-number">40.2</span> Intro to JSON and XML</a><ul>
<li><a href="#parsing-the-json-response-with-jsonlite"><span class="toc-section-number">40.2.1</span> Parsing the JSON response with jsonlite</a></li>
<li><a href="#parsing-the-xml-response-using-xml2"><span class="toc-section-number">40.2.2</span> Parsing the XML response using xml2</a></li>
</ul></li>
<li><a href="#introducing-the-easy-way-httr"><span class="toc-section-number">40.3</span> Introducing the easy way: httr</a></li>
<li><a href="#scraping"><span class="toc-section-number">40.4</span> Scraping</a><ul>
<li><a href="#obtain-a-table"><span class="toc-section-number">40.4.1</span> Obtain a table</a></li>
</ul></li>
<li><a href="#scraping-via-css-selectors"><span class="toc-section-number">40.5</span> Scraping via CSS selectors</a></li>
<li><a href="#random-observations-on-scraping"><span class="toc-section-number">40.6</span> Random observations on scraping</a></li>
<li><a href="#extras"><span class="toc-section-number">40.7</span> Extras</a><ul>
<li><a href="#airports"><span class="toc-section-number">40.7.1</span> Airports</a></li>
</ul></li>
</ul></li>
<li><a href="#part-all-the-shiny-things">(PART) All the Shiny things</a></li>
<li><a href="#shiny-overview">Overview</a><ul>
<li><a href="#awesome-add-on-packages-to-shiny">Awesome add-on packages to Shiny</a></li>
<li><a href="#resources-12">Resources</a></li>
</ul></li>
<li><a href="#shiny-slides"><span class="toc-section-number">41</span> Slides</a></li>
<li><a href="#shiny-tutorial"><span class="toc-section-number">42</span> Building Shiny apps</a><ul>
<li><a href="#shiny-tutorial-1"><span class="toc-section-number">42.1</span> Before we begin</a></li>
<li><a href="#shiny-tutorial-2"><span class="toc-section-number">42.2</span> Shiny app basics</a></li>
<li><a href="#shiny-tutorial-3"><span class="toc-section-number">42.3</span> Create an empty Shiny app</a><ul>
<li><a href="#alternate-way-to-create-a-shiny-app-separate-ui-and-server-files"><span class="toc-section-number">42.3.1</span> Alternate way to create a Shiny app: separate UI and server files</a></li>
<li><a href="#let-rstudio-fill-out-a-shiny-app-template-for-you"><span class="toc-section-number">42.3.2</span> Let RStudio fill out a Shiny app template for you</a></li>
</ul></li>
<li><a href="#shiny-tutorial-4"><span class="toc-section-number">42.4</span> Load the dataset</a></li>
<li><a href="#shiny-tutorial-5"><span class="toc-section-number">42.5</span> Build the basic UI</a><ul>
<li><a href="#add-plain-text-to-the-ui"><span class="toc-section-number">42.5.1</span> Add plain text to the UI</a></li>
<li><a href="#add-formatted-text-and-other-html-elements"><span class="toc-section-number">42.5.2</span> Add formatted text and other HTML elements</a></li>
<li><a href="#add-a-title"><span class="toc-section-number">42.5.3</span> Add a title</a></li>
<li><a href="#add-a-layout"><span class="toc-section-number">42.5.4</span> Add a layout</a></li>
<li><a href="#all-ui-functions-are-simply-html-wrappers"><span class="toc-section-number">42.5.5</span> All UI functions are simply HTML wrappers</a></li>
</ul></li>
<li><a href="#shiny-tutorial-6"><span class="toc-section-number">42.6</span> Add inputs to the UI</a><ul>
<li><a href="#input-for-price"><span class="toc-section-number">42.6.1</span> Input for price</a></li>
<li><a href="#input-for-product-type"><span class="toc-section-number">42.6.2</span> Input for product type</a></li>
<li><a href="#input-for-country"><span class="toc-section-number">42.6.3</span> Input for country</a></li>
</ul></li>
<li><a href="#shiny-tutorial-7"><span class="toc-section-number">42.7</span> Add placeholders for outputs</a><ul>
<li><a href="#output-for-a-plot-of-the-results"><span class="toc-section-number">42.7.1</span> Output for a plot of the results</a></li>
<li><a href="#output-for-a-table-summary-of-the-results"><span class="toc-section-number">42.7.2</span> Output for a table summary of the results</a></li>
</ul></li>
<li><a href="#shiny-tutorial-8"><span class="toc-section-number">42.8</span> Checkpoint: what our app looks like after implementing the UI</a></li>
<li><a href="#shiny-tutorial-9"><span class="toc-section-number">42.9</span> Implement server logic to create outputs</a><ul>
<li><a href="#building-an-output"><span class="toc-section-number">42.9.1</span> Building an output</a></li>
<li><a href="#making-an-output-react-to-an-input"><span class="toc-section-number">42.9.2</span> Making an output react to an input</a></li>
<li><a href="#building-the-plot-output"><span class="toc-section-number">42.9.3</span> Building the plot output</a></li>
<li><a href="#building-the-table-output"><span class="toc-section-number">42.9.4</span> Building the table output</a></li>
</ul></li>
<li><a href="#shiny-tutorial-10"><span class="toc-section-number">42.10</span> Reactivity 101</a><ul>
<li><a href="#creating-and-accessing-reactive-variables"><span class="toc-section-number">42.10.1</span> Creating and accessing reactive variables</a></li>
<li><a href="#using-reactive-variables-to-reduce-code-duplication"><span class="toc-section-number">42.10.2</span> Using reactive variables to reduce code duplication</a></li>
</ul></li>
<li><a href="#shiny-tutorial-11"><span class="toc-section-number">42.11</span> Using <code>uiOutput()</code> to create UI elements dynamically</a><ul>
<li><a href="#basic-example-of-uioutput"><span class="toc-section-number">42.11.1</span> Basic example of <code>uiOutput()</code></a></li>
<li><a href="#use-uioutput-in-our-app-to-populate-the-countries"><span class="toc-section-number">42.11.2</span> Use <code>uiOutput()</code> in our app to populate the countries</a></li>
<li><a href="#errors-showing-up-and-quickly-disappearing"><span class="toc-section-number">42.11.3</span> Errors showing up and quickly disappearing</a></li>
</ul></li>
<li><a href="#shiny-tutorial-12"><span class="toc-section-number">42.12</span> Final Shiny app code</a></li>
<li><a href="#shiny-tutorial-13"><span class="toc-section-number">42.13</span> Share your app with the world</a><ul>
<li><a href="#host-on-shinyapps.io"><span class="toc-section-number">42.13.1</span> Host on shinyapps.io</a></li>
<li><a href="#host-on-a-shiny-server"><span class="toc-section-number">42.13.2</span> Host on a Shiny Server</a></li>
</ul></li>
<li><a href="#shiny-tutorial-14"><span class="toc-section-number">42.14</span> More Shiny features to check out</a><ul>
<li><a href="#shiny-in-r-markdown"><span class="toc-section-number">42.14.1</span> Shiny in R Markdown</a></li>
<li><a href="#use-conditionalpanel-to-conditionally-show-ui-elements"><span class="toc-section-number">42.14.2</span> Use <code>conditionalPanel()</code> to conditionally show UI elements</a></li>
<li><a href="#use-navbarpage-or-tabsetpanel-to-have-multiple-tabs-in-the-ui"><span class="toc-section-number">42.14.3</span> Use <code>navbarPage()</code> or <code>tabsetPanel()</code> to have multiple tabs in the UI</a></li>
<li><a href="#use-dt-for-beautiful-interactive-tables"><span class="toc-section-number">42.14.4</span> Use DT for beautiful, interactive tables</a></li>
<li><a href="#use-isolate-function-to-remove-a-dependency-on-a-reactive-variable"><span class="toc-section-number">42.14.5</span> Use <code>isolate()</code> function to remove a dependency on a reactive variable</a></li>
<li><a href="#use-updateinput-functions-to-update-input-values-programmatically"><span class="toc-section-number">42.14.6</span> Use <code>update*Input()</code> functions to update input values programmatically</a></li>
<li><a href="#scoping-rules-in-shiny-apps"><span class="toc-section-number">42.14.7</span> Scoping rules in Shiny apps</a></li>
<li><a href="#use-global.r-to-define-objects-available-to-both-ui.r-and-server.r"><span class="toc-section-number">42.14.8</span> Use <code>global.R</code> to define objects available to both <code>ui.R</code> and <code>server.R</code></a></li>
<li><a href="#add-images"><span class="toc-section-number">42.14.9</span> Add images</a></li>
<li><a href="#add-javascriptcss"><span class="toc-section-number">42.14.10</span> Add JavaScript/CSS</a></li>
</ul></li>
<li><a href="#shiny-tutorial-15"><span class="toc-section-number">42.15</span> Ideas to improve our app</a></li>
</ul></li>
<li><a href="#appendix-appendix">(APPENDIX) Appendix</a></li>
<li><a href="#oldies"><span class="toc-section-number">43</span> Deprecated</a></li>
<li><a href="#random"><span class="toc-section-number">44</span> Short random things</a><ul>
<li><a href="#draw-the-owl"><span class="toc-section-number">44.1</span> Draw the rest of the owl, a pep talk for building off simple examples</a><ul>
<li><a href="#context-writing-a-function-factory"><span class="toc-section-number">44.1.1</span> Context: writing a function factory</a></li>
<li><a href="#start-at-the-beginning"><span class="toc-section-number">44.1.2</span> Start at the beginning</a></li>
<li><a href="#can-the-input-be-a-function"><span class="toc-section-number">44.1.3</span> Can the input be a function?</a></li>
<li><a href="#faux-verb"><span class="toc-section-number">44.1.4</span> Faux VERB</a></li>
<li><a href="#a-better-faux-verb"><span class="toc-section-number">44.1.5</span> A better faux VERB</a></li>
<li><a href="#retry-n-times-and-a-temporary-setback"><span class="toc-section-number">44.1.6</span> Retry <code>n</code> times … and a temporary setback</a></li>
<li><a href="#conditional-retries"><span class="toc-section-number">44.1.7</span> Conditional retries</a></li>
<li><a href="#the-final-result-is-not-that-exciting"><span class="toc-section-number">44.1.8</span> The final result is not that exciting</a></li>
</ul></li>
<li><a href="#gh-package"><span class="toc-section-number">44.2</span> How to obtain a bunch of GitHub issues or pull requests with R</a></li>
<li><a href="#tame-google-sheets"><span class="toc-section-number">44.3</span> How to tame XML with nested data frames and purrr</a></li>
<li><a href="#github-browsability"><span class="toc-section-number">44.4</span> Make browsing your GitHub repos more rewarding</a><ul>
<li><a href="#be-savvy-about-your-files"><span class="toc-section-number">44.4.1</span> Be savvy about your files</a></li>
<li><a href="#get-over-your-hang-ups-re-committing-derived-products"><span class="toc-section-number">44.4.2</span> Get over your hang ups re: committing derived products</a></li>
<li><a href="#markdown"><span class="toc-section-number">44.4.3</span> Markdown</a></li>
<li><a href="#readme.md"><span class="toc-section-number">44.4.4</span> <code>README.md</code></a></li>
<li><a href="#finding-stuff"><span class="toc-section-number">44.4.5</span> Finding stuff</a></li>
<li><a href="#html"><span class="toc-section-number">44.4.6</span> HTML</a></li>
<li><a href="#source-code"><span class="toc-section-number">44.4.7</span> Source code</a></li>
<li><a href="#delimited-files"><span class="toc-section-number">44.4.8</span> Delimited files</a></li>
<li><a href="#pngs"><span class="toc-section-number">44.4.9</span> PNGs</a></li>
<li><a href="#linking-to-a-zip-archive-of-your-repo"><span class="toc-section-number">44.4.10</span> Linking to a ZIP archive of your repo</a></li>
<li><a href="#links-and-embedded-figures"><span class="toc-section-number">44.4.11</span> Links and embedded figures</a></li>
<li><a href="#let-people-correct-you-on-the-internet"><span class="toc-section-number">44.4.12</span> Let people correct you on the internet</a></li>
</ul></li>
<li><a href="#email-in-r"><span class="toc-section-number">44.5</span> How to send a bunch of emails from R</a></li>
<li><a href="#store-api-key"><span class="toc-section-number">44.6</span> Store an API key as an environment variable</a></li>
</ul></li>
<li><a href="#references">References</a></li>
<li><a href="#contract-grading"><span class="toc-section-number">45</span> Contract Grading</a></li>
<li><a href="#portfolio"><span class="toc-section-number">46</span> Portfolio</a><ul>
<li><a href="#possible-assignments"><span class="toc-section-number">46.1</span> Possible Assignments</a></li>
</ul></li>
</ul>
<!--bookdown:toc2:end-->
      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">PSY 703</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<!--bookdown:toc:end-->
<!--bookdown:body:start-->
<div id="welcome-to-psy-703" class="section level1 unnumbered">
<h1>Welcome to PSY 703</h1>
<p>Welcome to class! This website is designed to accompany Mason Garrison’s Data Science for Psychologists (DS4P). DS4P is a graduate-level quantitative methods course at Wake Forest University. This website is both the syllabus and primary lecture materials. All the embedded lecture videos can be found on a <a href="https://www.youtube.com/playlist?list=PLKrrdtYgOUYbWGmSnbLIYwdLOnGm6une6">youtube playlist</a></p>
<center>
<iframe width="560" height="315" src="http://www.youtube.com/embed/nYYJmmcgzr8?rel=0" frameborder="0" allowfullscreen>
</iframe>
</center>
<div id="course-introduction" class="section level2 unnumbered">
<h2>Course Introduction</h2>
<p><img src="http://www.youtube.com/embed/HU39nOxcJYg?rel=0" /></p>
<p>Data Science for Psychologists (DS4P) introduces on the principles of data science, including:</p>
<ul>
<li>data wrangling,</li>
<li>modeling,</li>
<li>visualization, and</li>
<li>communication.</li>
</ul>
<p>In this class, we link those principles to psychological methods and open science practices by emphasizing exploratory analyses and description, rather than confirmatory analyses and prediction. Through the semester we will work our way thru <a href="http://r4ds.had.co.nz/">Wickham and Grolemund’s R for Data Science text</a> and develop proficiency with <a href="https://www.tidyverse.org/">tidyverse</a>. This class emphasizes replication and reproducibility. DS4P is a practical skilled-based class and should be useful to students aiming for academia as well as those interested in industry. Applications of these methods can be applied to a full range of psychological areas, including perception (e.g, eye-tracking data), neuroscience (e.g., visualizing neural networks), and individual differences (e.g., valence analysis).</p>
</div>
<div id="broad-topics" class="section level2 unnumbered">
<h2>Broad Topics</h2>
<p>This class cover the following broad five areas:</p>
<ul>
<li>Reproducibility;</li>
<li>Replication;</li>
<li>Robust Methods;</li>
<li>Resplendent Visualizations; and</li>
<li>R Programming.</li>
</ul>
</div>
<div id="materials" class="section level2 unnumbered">
<h2>Materials</h2>
<div id="hardware" class="section level3 unnumbered">
<h3>Hardware</h3>
<p>This class is requires that you have a laptop that can run R.</p>
</div>
<div id="required-texts" class="section level3 unnumbered">
<h3>Required Texts</h3>
<p>The text is intended to supplement the videos, lecture notes, and in-class tutorials. You need to consume all four in order to be successful in this class.</p>
<ul>
<li><a href="http://r4ds.had.co.nz/">R for Data Science text</a> <span class="citation">(<span class="citeproc-not-found" data-reference-id="Wickham2017R"><strong>???</strong></span>)</span></li>
</ul>
</div>
<div id="software" class="section level3 unnumbered">
<h3>Software</h3>
<div id="r" class="section level4 unnumbered">
<h4>R</h4>
<p>R is a free software environment for statistical computing and graphics. It compiles and runs on a wide variety of UNIX platforms, Windows, and MacOS.</p>
</div>
<div id="r-studio" class="section level4 unnumbered">
<h4>R Studio</h4>
</div>
<div id="github" class="section level4 unnumbered">
<h4>GitHub</h4>
</div>
</div>
</div>
<div id="course-modality" class="section level2">
<h2><span class="header-section-number">0.1</span> Course Modality</h2>
<p>This class is a blended class. The online portions are asynchronous. I’ve created a video highlighting how to be a successful asynchronous learner.</p>
<center>
<iframe width="560" height="315" src="http://www.youtube.com/embed/dc3D2tbl8G0?rel=0" frameborder="0" allowfullscreen>
</iframe>
</center>
<p>Much of this information comes from Northeastern University’s <a href="https://www.northeastern.edu/graduate/blog/tips-for-taking-online-classes/">Tips for Taking Online Classes</a></p>
</div>
<div id="attribution" class="section level2 unnumbered">
<h2>Attribution</h2>
<p>This class leans heavily on other peoples’ materials and ideas. I have done my best to document the origin of the materials and ideas. They include:</p>
<ul>
<li><p>Jenny Bryan’s (<a href="https://jennybryan.org">jennybryan.org</a>) <a href="https://www.Stat545.com">STAT 545</a>;</p></li>
<li><p>Joe Rodgers’s PSY 8751 Exploratory and Graphical Data Analysis Course</p></li>
<li><p><a href="https://jfukuyama.github.io/">Julia Fukuyama</a>’s <a href="https://jfukuyama.github.io/teaching/stat670/">EXPLORATORY DATA ANALYSIS</a></p></li>
</ul>
<p>You can see specific changes by examining the <a href="https://github.com/R-Computing-Lab/DataScience4Psych/commits/master">edit history on the git repo</a></p>
<div id="stat-545" class="section level3 unnumbered">
<h3>STAT 545</h3>
<p>Jenny Bryan’s (<a href="https://jennybryan.org">jennybryan.org</a>) <a href="https://www.Stat545.com">STAT 545</a> course is from the University of British Columbia.</p>
<blockquote>
<p>“The STAT 545 course became notable as an early example of a data science course taught in a statistics program. It is also notable for its focus on teaching using modern R packages, Git and GitHub, its extensive sharing of teaching materials openly online, and its strong emphasis on practical data cleaning, exploration, and visualization skills, rather than algorithms and theory.”</p>
<p>— <a href="https://en.wikipedia.org/wiki/Jenny_Bryan">Wikipedia</a></p>
</blockquote>
</div>
<div id="psy-8751" class="section level3 unnumbered">
<h3>PSY 8751</h3>
<p>Joe Rodgers’s EXPLORATORY and GRAPHICAL DATA ANALYSIS course was developed at the University of Oklahoma. I took his class while a graduate student at Vanderbilt University.</p>
</div>
<div id="stat-470670" class="section level3 unnumbered">
<h3>Stat 470/670</h3>
<p><a href="https://jfukuyama.github.io/">Julia Fukuyama</a>’s <a href="https://jfukuyama.github.io/teaching/stat670/">EXPLORATORY DATA ANALYSIS</a> is an R based class. She’s an Assistant Professor in the Department of Statistics at Indiana University.</p>
</div>
</div>
<div id="colophon" class="section level2 unnumbered">
<h2>Colophon</h2>
<p>This book was written in <a href="http://bookdown.org/">bookdown</a> inside <a href="http://www.rstudio.com/ide/">RStudio</a>. The website <a href="https://r-computing-lab.github.io/DataScience4Psych">r-computing-lab.github.io/DataScience4Psych</a> is hosted with <a href="https://www.github.com">github</a>, The complete source is available from <a href="https://github.com/R-Computing-Lab/DataScience4Psych">GitHub</a>.</p>
<p>The <a href="assets/logo.png">Psych 703 logo</a> was designed by me and the book style was designed by <a href="https://desiree.rbind.io/">Desirée De Leon</a>.</p>
<p>This version of the book was built with:</p>
<pre><code>#&gt; Finding R package dependencies ... Done!
#&gt;  setting  value                       
#&gt;  version  R version 4.0.3 (2020-10-10)
#&gt;  os       Windows 10 x64              
#&gt;  system   x86_64, mingw32             
#&gt;  ui       RTerm                       
#&gt;  language (EN)                        
#&gt;  collate  English_United States.1252  
#&gt;  ctype    English_United States.1252  
#&gt;  tz       America/New_York            
#&gt;  date     2021-01-03</code></pre>
<p>Along with these packages:</p>
<div id="htmlwidget-2f9f5316abd0dd85371d" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-2f9f5316abd0dd85371d">{"x":{"filter":"top","filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["askpass","assertthat","backports","base64enc","BH","blob","bookdown","brew","broom","callr","cellranger","checkmate","cli","clipr","colorspace","commonmark","conflicted","covr","cpp11","crayon","crosstalk","crul","curl","DBI","dbplyr","desc","devtools","dichromat","digest","dplyr","DT","ellipsis","evaluate","fansi","farver","forcats","fs","gapminder","gender","genderdata","generics","geonames","ggplot2","gh","git2r","glue","gridExtra","gt","gtable","haven","highr","hms","htmltools","htmlwidgets","httpcode","httr","ini","isoband","jsonlite","knitr","labeling","later","lattice","lazyeval","lifecycle","lubridate","magrittr","markdown","MASS","Matrix","memoise","mgcv","mime","modelr","munsell","nlme","openssl","pillar","pkgbuild","pkgconfig","pkgload","plyr","praise","prettyunits","processx","progress","promises","ps","purrr","R6","rcmdcheck","RColorBrewer","Rcpp","readr","readxl","rebird","rematch","rematch2","remotes","reprex","reshape2","rex","rjson","rlang","rmarkdown","roxygen2","rplos","rprojroot","rstudioapi","rversions","rvest","sass","scales","selectr","sessioninfo","solrium","stringi","stringr","sys","testthat","tibble","tidyr","tidyselect","tidyverse","tinytex","triebeard","urltools","usethis","utf8","vctrs","viridis","viridisLite","whisker","withr","xfun","xml2","xopen","yaml"],[null,"0.2.1","1.1.10",null,null,"1.2.1","0.21",null,"0.7.1","3.5.1","1.1.0",null,"2.0.2",null,"1.4-1",null,null,null,null,"1.3.4",null,null,null,"1.1.0","1.4.4","1.2.0","2.3.2",null,"0.6.25","1.0.2","0.16","0.3.1","0.14","0.4.1",null,"0.5.0","1.5.0",null,null,null,"0.0.2",null,"3.3.2",null,null,"1.4.2",null,null,"0.3.0","2.3.1",null,"0.5.3","0.5.0","1.5.2",null,"1.4.2",null,null,"1.7.1","1.30",null,null,null,null,"0.2.0","1.7.9","1.5",null,null,null,"1.1.0",null,null,"0.1.8","0.5.0",null,null,"1.4.6","1.1.0","2.0.3","1.1.0",null,null,"1.1.1","3.4.4",null,null,"1.3.4","0.3.4","2.4.1",null,null,"1.0.5","1.3.1","1.3.1",null,null,null,"2.2.0","0.3.0",null,null,null,"0.4.7","2.5",null,null,"1.3-2","0.11",null,"0.3.6",null,"1.1.1",null,"1.1.1",null,"1.5.3","1.4.0",null,"2.3.2","3.0.3","1.1.2","1.1.0","1.3.0",null,null,null,"1.6.3",null,"0.3.4",null,null,null,"2.3.0","0.18","1.3.2",null,"2.2.1"],["2019-01-13","2019-03-21","2020-09-15","2015-07-28","2020-01-08","2020-01-20","2020-10-13","2011-04-13","2020-10-02","2020-10-13","2016-07-27","2020-02-06","2020-02-28","2019-07-23","2019-03-18","2018-12-01",null,"2020-09-16","2020-10-01","2017-09-16","2020-03-13","2020-07-30","2019-12-02","2019-12-15","2020-05-27","2018-05-01","2020-09-18","2013-01-24","2020-02-23","2020-08-18","2020-10-13","2020-05-15","2019-05-28","2020-01-08","2020-01-16","2020-03-01","2020-07-31","2017-10-31","2020-05-15","2020-11-17","2018-11-29","2019-02-19","2020-06-19","2020-01-24","2020-05-03","2020-08-27","2017-09-09","2020-08-05","2019-03-25","2020-06-01","2019-03-20","2020-01-08","2020-06-16","2020-10-03","2020-04-10","2020-07-20","2018-05-20","2020-06-20","2020-09-07","2020-09-22","2014-08-23","2020-06-05","2020-04-02","2019-03-15","2020-03-06","2020-06-08","2014-11-22","2019-08-07","2020-09-09","2019-11-27","2017-04-21","2020-08-27","2020-02-04","2020-05-19","2018-06-12","2020-08-23","2020-09-18","2020-07-10","2020-07-13","2019-09-22","2020-05-29","2020-03-03","2015-08-11","2020-01-24","2020-09-03","2019-05-16","2020-06-09","2020-08-11","2020-04-17","2019-11-12","2019-05-07","2014-12-07","2020-07-06","2018-12-21","2019-03-13","2019-10-24","2016-04-21","2020-05-01","2020-07-21","2019-05-16","2020-04-09","2020-04-21","2018-06-08","2020-07-09","2020-10-21","2020-06-27","2020-04-08","2018-01-03","2020-02-07","2020-05-25","2020-07-25","2020-03-18","2020-05-11","2019-11-20","2018-11-05","2019-11-02","2020-09-09","2019-02-10","2020-07-23","2020-03-02","2020-07-10","2020-08-27","2020-05-11","2019-11-21","2020-09-22","2016-08-04","2019-04-14","2020-09-17","2018-05-24","2020-08-29","2018-03-29","2018-02-01","2019-08-28","2020-09-22","2020-09-29","2020-04-23","2018-09-17","2020-02-01"],["CRAN (R 4.0.0)","CRAN (R 4.0.0)","CRAN (R 4.0.2)","CRAN (R 4.0.0)","CRAN (R 4.0.0)","CRAN (R 4.0.2)","CRAN (R 4.0.3)","CRAN (R 4.0.0)","CRAN (R 4.0.2)","CRAN (R 4.0.3)","CRAN (R 4.0.0)","CRAN (R 4.0.2)","CRAN (R 4.0.0)","CRAN (R 4.0.0)","CRAN (R 4.0.0)","CRAN (R 4.0.0)",null,"CRAN (R 4.0.2)","CRAN (R 4.0.2)","CRAN (R 4.0.0)","CRAN (R 4.0.2)","CRAN (R 4.0.3)","CRAN (R 4.0.0)","CRAN (R 4.0.0)","CRAN (R 4.0.2)","CRAN (R 4.0.0)","CRAN (R 4.0.3)","CRAN (R 4.0.3)","CRAN (R 4.0.0)","CRAN (R 4.0.2)","CRAN (R 4.0.3)","CRAN (R 4.0.2)","CRAN (R 4.0.0)","CRAN (R 4.0.0)","CRAN (R 4.0.0)","CRAN (R 4.0.0)","CRAN (R 4.0.2)","CRAN (R 4.0.3)","CRAN (R 4.0.3)","local","CRAN (R 4.0.0)","CRAN (R 4.0.3)","CRAN (R 4.0.2)","CRAN (R 4.0.2)","CRAN (R 4.0.3)","CRAN (R 4.0.2)","CRAN (R 4.0.3)","CRAN (R 4.0.3)","CRAN (R 4.0.0)","CRAN (R 4.0.2)","CRAN (R 4.0.0)","CRAN (R 4.0.0)","CRAN (R 4.0.2)","CRAN (R 4.0.2)","CRAN (R 4.0.3)","CRAN (R 4.0.3)","CRAN (R 4.0.2)","CRAN (R 4.0.2)","CRAN (R 4.0.2)","CRAN (R 4.0.3)","CRAN (R 4.0.0)","CRAN (R 4.0.2)","CRAN (R 4.0.3)","CRAN (R 4.0.2)","CRAN (R 4.0.0)","CRAN (R 4.0.2)","CRAN (R 4.0.0)","CRAN (R 4.0.0)","CRAN (R 4.0.3)","CRAN (R 4.0.3)","CRAN (R 4.0.2)","CRAN (R 4.0.3)","CRAN (R 4.0.0)","CRAN (R 4.0.2)","CRAN (R 4.0.0)","CRAN (R 4.0.3)","CRAN (R 4.0.2)","CRAN (R 4.0.2)","CRAN (R 4.0.2)","CRAN (R 4.0.0)","CRAN (R 4.0.2)","CRAN (R 4.0.0)","CRAN (R 4.0.0)","CRAN (R 4.0.0)","CRAN (R 4.0.2)","CRAN (R 4.0.0)","CRAN (R 4.0.2)","CRAN (R 4.0.2)","CRAN (R 4.0.0)","CRAN (R 4.0.0)","CRAN (R 4.0.2)","CRAN (R 4.0.3)","CRAN (R 4.0.2)","CRAN (R 4.0.2)","CRAN (R 4.0.0)","CRAN (R 4.0.3)","CRAN (R 4.0.0)","CRAN (R 4.0.2)","CRAN (R 4.0.2)","CRAN (R 4.0.0)","CRAN (R 4.0.3)","CRAN (R 4.0.2)","CRAN (R 4.0.3)","CRAN (R 4.0.2)","CRAN (R 4.0.3)","CRAN (R 4.0.2)","CRAN (R 4.0.3)","CRAN (R 4.0.0)","CRAN (R 4.0.0)","CRAN (R 4.0.2)","CRAN (R 4.0.3)","CRAN (R 4.0.3)","CRAN (R 4.0.0)","CRAN (R 4.0.0)","CRAN (R 4.0.2)","CRAN (R 4.0.3)","CRAN (R 4.0.2)","CRAN (R 4.0.0)","CRAN (R 4.0.2)","CRAN (R 4.0.0)","CRAN (R 4.0.2)","CRAN (R 4.0.2)","CRAN (R 4.0.0)","CRAN (R 4.0.3)","CRAN (R 4.0.2)","CRAN (R 4.0.3)","CRAN (R 4.0.3)","CRAN (R 4.0.3)","CRAN (R 4.0.0)","CRAN (R 4.0.2)","CRAN (R 4.0.3)","CRAN (R 4.0.0)","CRAN (R 4.0.0)","CRAN (R 4.0.2)","CRAN (R 4.0.2)","CRAN (R 4.0.3)","CRAN (R 4.0.2)","CRAN (R 4.0.0)"]],"container":"<table class=\"cell-border stripe\">\n  <thead>\n    <tr>\n      <th>package<\/th>\n      <th>loadedversion<\/th>\n      <th>date<\/th>\n      <th>source<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":138,"autoWidth":true,"bInfo":false,"paging":false,"order":[],"orderClasses":false,"orderCellsTop":true,"lengthMenu":[10,25,50,100,138]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="license" class="section level2 unnumbered">
<h2>License</h2>
<p>This work is licensed under a <a href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.</p>
<center>
<i class="fab fa-creative-commons fa-2x"></i><i class="fab fa-creative-commons-by fa-2x"></i><i class="fab fa-creative-commons-sa fa-2x"></i>
</center>
<p><em>This is a human-readable summary of (and not a substitute for) the license.
Please see <a href="https://creativecommons.org/licenses/by-sa/4.0/legalcode" class="uri">https://creativecommons.org/licenses/by-sa/4.0/legalcode</a> for the full legal text.</em></p>
<p><strong>You are free to:</strong></p>
<ul>
<li><p><strong>Share</strong>—copy and redistribute the material in any medium or
format</p></li>
<li><p><strong>Remix</strong>—remix, transform, and build upon the material for any
purpose, even commercially.</p></li>
</ul>
<p>The licensor cannot revoke these freedoms as long as you follow the
license terms.</p>
<p><strong>Under the following terms:</strong></p>
<ul>
<li><p><strong>Attribution</strong>—You must give appropriate credit, provide a link
to the license, and indicate if changes were made. You may do so in
any reasonable manner, but not in any way that suggests the licensor
endorses you or your use.</p></li>
<li><p><strong>ShareAlike</strong>—If you remix, transform, or build upon the material, you must distribute your contributions under the same license as the original.</p></li>
<li><p><strong>No additional restrictions</strong>—You may not apply legal terms or
technological measures that legally restrict others from doing
anything the license permits.</p></li>
</ul>
<p><strong>Notices:</strong></p>
<p>You do not have to comply with the license for elements of the
material in the public domain or where your use is permitted by an
applicable exception or limitation.</p>
<p>No warranties are given. The license may not give you all of the
permissions necessary for your intended use. For example, other rights
such as publicity, privacy, or moral rights may limit how you use the
material.</p>
<!--chapter:end:index.Rmd-->
</div>
</div>
<div id="part-get-your-r-act-together" class="section level1 unnumbered">
<h1>(PART) Get your R act together</h1>
</div>
<div id="install" class="section level1">
<h1><span class="header-section-number">1</span> Install R and RStudio</h1>
<!--Original content: https://stat545.com/block000_r-rstudio-install.html-->
<div id="r-and-rstudio" class="section level2">
<h2><span class="header-section-number">1.1</span> R and RStudio</h2>
<iframe width="560" height="315" src="http://www.youtube.com/embed/9bZkp7q19f0?rel=0" frameborder="0" allowfullscreen>
</iframe>
<ul>
<li><p>Install <a href="https://www.r-project.org">R, a free software environment for statistical computing and graphics</a> from <a href="https://cloud.r-project.org">CRAN</a>, the Comprehensive R Archive Network. I <strong>highly recommend</strong> you install a precompiled binary distribution for your operating system – use the links up at the top of the CRAN page linked above!</p></li>
<li><p>Install RStudio’s IDE (stands for <em>integrated development environment</em>), a powerful user interface for R. Get the Open Source Edition of RStudio Desktop.</p>
<ul>
<li>You can run either the <a href="https://www.rstudio.com/products/rstudio/download/preview/">Preview version</a> or the official releases available <a href="https://www.rstudio.com/products/rstudio/#Desktop">here</a>.</li>
<li>RStudio comes with a <strong>text editor</strong>, so there is no immediate need to install a separate stand-alone editor.</li>
<li>RStudio can <strong>interface with Git(Hub)</strong>. However, you must do all the Git(Hub) set up <a href="https://happygitwithr.com">described elsewhere</a> before you can take advantage of this.</li>
</ul></li>
</ul>
<p>If you have a pre-existing installation of R and/or RStudio, I <strong>highly recommend</strong> that you reinstall both and get as current as possible. It can be considerably harder to run old software than new.</p>
<ul>
<li><p>If you upgrade R, you will need to update any packages you have installed. The command below should get you started, though you may need to specify more arguments if, e.g., you have been using a non-default library for your packages.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw">update.packages</span>(<span class="dt">ask =</span> <span class="ot">FALSE</span>, <span class="dt">checkBuilt =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><strong>Note:</strong> this will only look for updates on CRAN. So if you use a package that lives <em>only</em> on GitHub or if you want a development version from GitHub, you will need to update manually, e.g. via <code>devtools::install_github()</code>.</p></li>
</ul>
</div>
<div id="testing-testing" class="section level2">
<h2><span class="header-section-number">1.2</span> Testing testing</h2>
<ul>
<li><p>Do whatever is appropriate for your OS to launch RStudio. You should get a window similar to the screenshot you see <a href="https://www.rstudio.com/wp-content/uploads/2014/04/rstudio-workbench.png">here</a>, but yours will be more boring because you haven’t written any code or made any figures yet!</p></li>
<li><p>Put your cursor in the pane labeled Console, which is where you interact with the live R process. Create a simple object with code like <code>x &lt;- 2 * 4</code> (followed by enter or return). Then inspect the <code>x</code> object by typing <code>x</code> followed by enter or return. You should see the value 8 print to screen. If yes, you’ve succeeded in installing R and RStudio.</p></li>
</ul>
</div>
<div id="add-on-packages" class="section level2">
<h2><span class="header-section-number">1.3</span> Add-on packages</h2>
<p>R is an extensible system and many people share useful code they have developed as a <em>package</em> via CRAN and GitHub. To install a package from CRAN, for example the <a href="https://CRAN.R-project.org/package=dplyr">dplyr</a> package for data manipulation, here is one way to do it in the R console (there are others).</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw">install.packages</span>(<span class="st">&quot;dplyr&quot;</span>, <span class="dt">dependencies =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p>By including <code>dependencies = TRUE</code>, we are being explicit and extra-careful to install any additional packages the target package, dplyr in the example above, needs to have around.</p>
<p>You could use the above method to install the following packages, all of which we will use:</p>
<ul>
<li>tidyr, <a href="https://tidyr.tidyverse.org">package webpage</a></li>
<li>ggplot2, <a href="https://ggplot2.tidyverse.org">package webpage</a></li>
</ul>
</div>
<div id="further-resources" class="section level2">
<h2><span class="header-section-number">1.4</span> Further resources</h2>
<p>The above will get your basic setup ready but here are some links if you are interested in reading a bit further.</p>
<ul>
<li><a href="https://support.rstudio.com/hc/en-us">How to Use RStudio</a></li>
<li><a href="https://support.rstudio.com/hc/en-us/articles/200552336-Getting-Help-with-R">RStudio’s leads for learning R</a></li>
<li><a href="https://cran.r-project.org/faqs.html">R FAQ</a></li>
<li><a href="http://cran.r-project.org/doc/manuals/R-admin.html">R Installation and Administration</a></li>
<li><a href="https://cran.r-project.org/doc/manuals/R-admin.html#Add_002don-packages">More about add-on packages in the R Installation and Administration Manual</a></li>
</ul>
<!--RStudio Links-->
<!--HappyGitWithR Links-->
<!--Package Links-->
<!--Shiny links-->
<!--Publications-->
<!--R Documentation-->
<!--Wikipedia Links-->
<!--Misc. Links-->
<!--chapter:end:001_install.Rmd-->
</div>
</div>
<div id="r-basics" class="section level1">
<h1><span class="header-section-number">2</span> R basics and workflows</h1>
<!--Original content: https://stat545.com/block002_hello-r-workspace-wd-project.html-->
<div id="basics-of-working-with-r-at-the-command-line-and-rstudio-goodies" class="section level2">
<h2><span class="header-section-number">2.1</span> Basics of working with R at the command line and RStudio goodies</h2>
<p>Launch RStudio/R.</p>
<p>Notice the default panes:</p>
<ul>
<li>Console (entire left)</li>
<li>Environment/History (tabbed in upper right)</li>
<li>Files/Plots/Packages/Help (tabbed in lower right)</li>
</ul>
<p>FYI: you can change the default location of the panes, among many other things: <a href="https://support.rstudio.com/hc/en-us/articles/200549016-Customizing-RStudio">Customizing RStudio</a>.</p>
<p>Go into the Console, where we interact with the live R process.</p>
<p>Make an assignment and then inspect the object you just created:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>x &lt;-<span class="st"> </span><span class="dv">3</span> <span class="op">*</span><span class="st"> </span><span class="dv">4</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>x</span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="co">#&gt; [1] 12</span></span></code></pre></div>
<p>All R statements where you create objects – “assignments” – have this form:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>objectName &lt;-<span class="st"> </span>value</span></code></pre></div>
<p>and in my head I hear, e.g., “x gets 12”.</p>
<p>You will make lots of assignments and the operator <code>&lt;-</code> is a pain to type. Don’t be lazy and use <code>=</code>, although it would work, because it will just sow confusion later. Instead, utilize RStudio’s keyboard shortcut: Alt + - (the minus sign).</p>
<p>Notice that RStudio automagically surrounds <code>&lt;-</code> with spaces, which demonstrates a useful code formatting practice. Code is miserable to read on a good day. Give your eyes a break and use spaces.</p>
<p>RStudio offers many handy <a href="https://support.rstudio.com/hc/en-us/articles/200711853-Keyboard-Shortcuts">keyboard shortcuts</a>. Also, Alt+Shift+K brings up a keyboard shortcut reference card.</p>
<p>Object names cannot start with a digit and cannot contain certain other characters such as a comma or a space. You will be wise to adopt a <a href="https://en.wikipedia.org/wiki/Snake_case">convention for demarcating words</a> in names.</p>
<pre><code>i_use_snake_case
other.people.use.periods
evenOthersUseCamelCase</code></pre>
<p>Make another assignment:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>this_is_a_really_long_name &lt;-<span class="st"> </span><span class="fl">2.5</span></span></code></pre></div>
<p>To inspect this, try out RStudio’s completion facility: type the first few characters, press TAB, add characters until you disambiguate, then press return.</p>
<p>Make another assignment:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>jenny_rocks &lt;-<span class="st"> </span><span class="dv">2</span> <span class="op">^</span><span class="st"> </span><span class="dv">3</span></span></code></pre></div>
<p>Let’s try to inspect:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>jennyrocks</span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="co">#&gt; Error in eval(expr, envir, enclos): object &#39;jennyrocks&#39; not found</span></span>
<span id="cb9-3"><a href="#cb9-3"></a>jeny_rocks</span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="co">#&gt; Error in eval(expr, envir, enclos): object &#39;jeny_rocks&#39; not found</span></span></code></pre></div>
<p>Implicit contract with the computer / scripting language: Computer will do tedious computation for you. In return, you will be completely precise in your instructions. Typos matter. Case matters. Get better at typing.</p>
<p>R has a mind-blowing collection of built-in functions that are accessed like so:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="kw">functionName</span>(<span class="dt">arg1 =</span> val1, <span class="dt">arg2 =</span> val2, and so on)</span></code></pre></div>
<p>Let’s try using <code>seq()</code> which makes regular sequences of numbers and, while we’re at it, demo more helpful features of RStudio.</p>
<p>Type <code>se</code> and hit TAB. A pop up shows you possible completions. Specify <code>seq()</code> by typing more to disambiguate or using the up/down arrows to select. Notice the floating tool-tip-type help that pops up, reminding you of a function’s arguments. If you want even more help, press F1 as directed to get the full documentation in the help tab of the lower right pane. Now open the parentheses and notice the automatic addition of the closing parenthesis and the placement of cursor in the middle. Type the arguments <code>1, 10</code> and hit return. RStudio also exits the parenthetical expression for you. IDEs are great.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">10</span>)</span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="co">#&gt;  [1]  1  2  3  4  5  6  7  8  9 10</span></span></code></pre></div>
<p>The above also demonstrates something about how R resolves function arguments. You can always specify in <code>name = value</code> form. But if you do not, R attempts to resolve by position. So above, it is assumed that we want a sequence <code>from = 1</code> that goes <code>to = 10</code>. Since we didn’t specify step size, the default value of <code>by</code> in the function definition is used, which ends up being 1 in this case. For functions I call often, I might use this resolve by position for the first
argument or maybe the first two. After that, I always use <code>name = value</code>.</p>
<p>Make this assignment and notice similar help with quotation marks.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>yo &lt;-<span class="st"> &quot;hello world&quot;</span></span></code></pre></div>
<p>If you just make an assignment, you don’t get to see the value, so then you’re tempted to immediately inspect.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>y &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">10</span>)</span>
<span id="cb13-2"><a href="#cb13-2"></a>y</span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="co">#&gt;  [1]  1  2  3  4  5  6  7  8  9 10</span></span></code></pre></div>
<p>This common action can be shortened by surrounding the assignment with parentheses, which causes assignment and “print to screen” to happen.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>(y &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">10</span>))</span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="co">#&gt;  [1]  1  2  3  4  5  6  7  8  9 10</span></span></code></pre></div>
<p>Not all functions have (or require) arguments:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="kw">date</span>()</span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="co">#&gt; [1] &quot;Sun Jan 03 12:26:38 2021&quot;</span></span></code></pre></div>
<p>Now look at your workspace – in the upper right pane. The workspace is where user-defined objects accumulate. You can also get a listing of these objects with commands:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="kw">objects</span>()</span>
<span id="cb16-2"><a href="#cb16-2"></a><span class="co">#&gt; [1] &quot;check_quietly&quot;              &quot;install_quietly&quot;           </span></span>
<span id="cb16-3"><a href="#cb16-3"></a><span class="co">#&gt; [3] &quot;jenny_rocks&quot;                &quot;pretty_install&quot;            </span></span>
<span id="cb16-4"><a href="#cb16-4"></a><span class="co">#&gt; [5] &quot;shhh_check&quot;                 &quot;this_is_a_really_long_name&quot;</span></span>
<span id="cb16-5"><a href="#cb16-5"></a><span class="co">#&gt; [7] &quot;x&quot;                          &quot;y&quot;                         </span></span>
<span id="cb16-6"><a href="#cb16-6"></a><span class="co">#&gt; [9] &quot;yo&quot;</span></span>
<span id="cb16-7"><a href="#cb16-7"></a><span class="kw">ls</span>()</span>
<span id="cb16-8"><a href="#cb16-8"></a><span class="co">#&gt; [1] &quot;check_quietly&quot;              &quot;install_quietly&quot;           </span></span>
<span id="cb16-9"><a href="#cb16-9"></a><span class="co">#&gt; [3] &quot;jenny_rocks&quot;                &quot;pretty_install&quot;            </span></span>
<span id="cb16-10"><a href="#cb16-10"></a><span class="co">#&gt; [5] &quot;shhh_check&quot;                 &quot;this_is_a_really_long_name&quot;</span></span>
<span id="cb16-11"><a href="#cb16-11"></a><span class="co">#&gt; [7] &quot;x&quot;                          &quot;y&quot;                         </span></span>
<span id="cb16-12"><a href="#cb16-12"></a><span class="co">#&gt; [9] &quot;yo&quot;</span></span></code></pre></div>
<p>If you want to remove the object named <code>y</code>, you can do this:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="kw">rm</span>(y)</span></code></pre></div>
<p>To remove everything:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="kw">rm</span>(<span class="dt">list =</span> <span class="kw">ls</span>())</span></code></pre></div>
<p>or click the broom in RStudio’s Environment pane.</p>
</div>
<div id="workspace-and-working-directory" class="section level2">
<h2><span class="header-section-number">2.2</span> Workspace and working directory</h2>
<p>One day you will need to quit R, go do something else and return to your analysis later.</p>
<p>One day you will have multiple analyses going that use R and you want to keep them separate.</p>
<p>One day you will need to bring data from the outside world into R and send numerical results and figures from R back out into the world.</p>
<p>To handle these real life situations, you need to make two decisions:</p>
<ul>
<li>What about your analysis is “real”, i.e. will you save it as your lasting record of what happened?</li>
<li>Where does your analysis “live”?</li>
</ul>
<div id="workspace-.rdata" class="section level3">
<h3><span class="header-section-number">2.2.1</span> Workspace, <code>.RData</code></h3>
<p>As a beginning R user, it’s OK to consider your workspace “real”. <em>Very soon</em>, I urge you to evolve to the next level, where you consider your saved R scripts as “real”. (In either case, of course the input data is very much real and requires preservation!) With the input data and the R code you used, you can reproduce
<em>everything</em>. You can make your analysis fancier. You can get to the bottom of puzzling results and discover and fix bugs in your code. You can reuse the code to conduct similar analyses in new projects. You can remake a figure with different aspect ratio or save is as TIFF instead of PDF. You are ready to take questions. You are ready for the future.</p>
<p>If you regard your workspace as “real” (saving and reloading all the time), if you need to redo analysis … you’re going to either redo a lot of typing (making mistakes all the way) or will have to mine your R history for the commands you used. Rather than <a href="https://support.rstudio.com/hc/en-us/articles/200526217-Command-History">becoming an expert on managing the R history</a>, a better use of your time and psychic energy is to keep your “good” R code in a script for future reuse.</p>
<p>Because it can be useful sometimes, note the commands you’ve recently run appear in the History pane.</p>
<p>But you don’t have to choose right now and the two strategies are not incompatible. Let’s demo the save / reload the workspace approach.</p>
<p>Upon quitting R, you have to decide if you want to save your workspace, for potential restoration the next time you launch R. Depending on your set up, R or your IDE, e.g. RStudio, will probably prompt you to make this decision.</p>
<p>Quit R/RStudio, either from the menu, using a keyboard shortcut, or by typing <code>q()</code> in the Console. You’ll get a prompt like this:</p>
<blockquote>
<p>Save workspace image to ~/.Rdata?</p>
</blockquote>
<p><em>Note where the workspace image is to be saved</em> and then click “Save”.</p>
<p>Using your favorite method, visit the directory where image was saved and verify there is a file named <code>.RData</code>. You will also see a file <code>.Rhistory</code>, holding the commands submitted in your recent session.</p>
<p>Restart RStudio. In the Console you will see a line like this:</p>
<pre><code>[Workspace loaded from ~/.RData]</code></pre>
<p>indicating that your workspace has been restored. Look in the Workspace pane and you’ll see the same objects as before. In the History tab of the same pane, you should also see your command history. You’re back in business. This way of starting and stopping analytical work will not serve you well for long but it’s a start.</p>
</div>
<div id="working-directory" class="section level3">
<h3><span class="header-section-number">2.2.2</span> Working directory</h3>
<p>Any process running on your computer has a notion of its “working directory”. In R, this is where R will look, by default, for files you ask it to load. It also where, by default, any files you write to disk will go. Chances are your current working directory is the directory we inspected above, i.e. the one where RStudio wanted to save the workspace.</p>
<p>You can explicitly check your working directory with:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="kw">getwd</span>()</span></code></pre></div>
<p>It is also displayed at the top of the RStudio console.</p>
<p>As a beginning R user, it’s OK let your home directory or any other weird directory on your computer be R’s working directory. <em>Very soon</em>, I urge you to evolve to the next level, where you organize your analytical projects into directories and, when working on project A, set R’s working directory to the associated directory.</p>
<p><strong>Although I do not recommend it</strong>, in case you’re curious, you can set R’s working directory at the command line like so:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="kw">setwd</span>(<span class="st">&quot;~/myCoolProject&quot;</span>)</span></code></pre></div>
<p><strong>Although I do not recommend it</strong>, you can also use RStudio’s Files pane to navigate to a directory and then set it as working directory from the menu: <em>Session &gt; Set Working Directory &gt; To Files Pane Location</em>. (You’ll see even more options there). Or within the Files pane, choose “More” and “Set As Working Directory”.</p>
<p>But there’s a better way. A way that also puts you on the path to managing your R work like an expert.</p>
</div>
</div>
<div id="rprojs" class="section level2">
<h2><span class="header-section-number">2.3</span> RStudio projects</h2>
<p>Keeping all the files associated with a project organized together – input data, R scripts, analytical results, figures – is such a wise and common practice that RStudio has built-in support for this via its <a href="https://support.rstudio.com/hc/en-us/articles/200526207-Using-Projects"><em>projects</em></a>.</p>
<p>Let’s make one to use for the rest of this workshop/class. Do this: <em>File &gt; New Project…</em>. The directory name you choose here will be the project name. Call it whatever you want (or follow me for convenience).</p>
<p>I created a directory and, therefore RStudio project, called <code>swc</code> in my <code>tmp</code> directory, FYI.</p>
<!--JB: https://github.com/yihui/knitr/issues/277 -->
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="kw">setwd</span>(<span class="st">&quot;~/tmp/swc&quot;</span>)</span></code></pre></div>
<p>Now check that the “home” directory for your project is the working directory of our current R process:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="kw">getwd</span>()</span></code></pre></div>
<p><em>I can’t print my output here because this document itself does not reside in the RStudio Project we just created.</em></p>
<p>Let’s enter a few commands in the Console, as if we are just beginning a project:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>a &lt;-<span class="st"> </span><span class="dv">2</span></span>
<span id="cb24-2"><a href="#cb24-2"></a>b &lt;-<span class="st"> </span><span class="dv">-3</span></span>
<span id="cb24-3"><a href="#cb24-3"></a>sig_sq &lt;-<span class="st"> </span><span class="fl">0.5</span></span>
<span id="cb24-4"><a href="#cb24-4"></a>x &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">40</span>)</span>
<span id="cb24-5"><a href="#cb24-5"></a>y &lt;-<span class="st"> </span>a <span class="op">+</span><span class="st"> </span>b <span class="op">*</span><span class="st"> </span>x <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">40</span>, <span class="dt">sd =</span> <span class="kw">sqrt</span>(sig_sq))</span>
<span id="cb24-6"><a href="#cb24-6"></a>(avg_x &lt;-<span class="st"> </span><span class="kw">mean</span>(x))</span>
<span id="cb24-7"><a href="#cb24-7"></a><span class="co">#&gt; [1] 0.464</span></span>
<span id="cb24-8"><a href="#cb24-8"></a><span class="kw">write</span>(avg_x, <span class="st">&quot;avg_x.txt&quot;</span>)</span>
<span id="cb24-9"><a href="#cb24-9"></a><span class="kw">plot</span>(x, y)</span>
<span id="cb24-10"><a href="#cb24-10"></a><span class="kw">abline</span>(a, b, <span class="dt">col =</span> <span class="st">&quot;purple&quot;</span>)</span></code></pre></div>
<p><img src="002_r-basics_files/figure-html/toy-line-1.png" width="672" /></p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="kw">dev.print</span>(pdf, <span class="st">&quot;toy_line_plot.pdf&quot;</span>)</span>
<span id="cb25-2"><a href="#cb25-2"></a><span class="co">#&gt; png </span></span>
<span id="cb25-3"><a href="#cb25-3"></a><span class="co">#&gt;   2</span></span></code></pre></div>
<p>Let’s say this is a good start of an analysis and your ready to start preserving the logic and code. Visit the History tab of the upper right pane. Select these commands. Click “To Source”. Now you have a new pane containing a nascent R script. Click on the floppy disk to save. Give it a name ending in <code>.R</code> or <code>.r</code>, I used <code>toy-line.r</code> and note that, by default, it will go in the directory associated with your project.</p>
<p>Quit RStudio. Inspect the folder associated with your project if you wish. Maybe view the PDF in an external viewer.</p>
<p>Restart RStudio. Notice that things, by default, restore to where we were earlier, e.g. objects in the workspace, the command history, which files are open for editing, where we are in the file system browser, the working directory for the R process, etc. These are all Good Things.</p>
<p>Change some things about your code. Top priority would be to set a sample size <code>n</code> at the top, e.g. <code>n &lt;- 40</code>, and then replace all the hard-wired 40’s with <code>n</code>. Change some other minor-but-detectable stuff, e.g. alter the sample size <code>n</code>, the slope of the line <code>b</code>,the color of the line … whatever. Practice the different ways to re-run the code:</p>
<ul>
<li><p>Walk through line by line by keyboard shortcut (Command+Enter) or mouse (click “Run” in the upper right corner of editor pane).</p></li>
<li><p>Source the entire document – equivalent to entering <code>source('toy-line.r')</code> in the Console – by keyboard shortcut (Shift+Command+S) or mouse (click “Source” in the upper right corner of editor pane or select from the mini-menu accessible from the associated down triangle).</p></li>
<li><p>Source with echo from the Source mini-menu.</p></li>
</ul>
<p>Visit your figure in an external viewer to verify that the PDF is changing as you expect.</p>
<p>In your favorite OS-specific way, search your files for <code>toy_line_plot.pdf</code> and presumably you will find the PDF itself (no surprise) but <em>also the script that created it (<code>toy-line.r</code>)</em>. This latter phenomenon is a huge win. One day you will want to remake a figure or just simply understand where it came from. If you rigorously save figures to file <strong>with R code and not ever ever ever the mouse or the clipboard</strong>, you will sing my praises one day. Trust me.</p>
</div>
<div id="stuff" class="section level2">
<h2><span class="header-section-number">2.4</span> Stuff</h2>
<p>It is traditional to save R scripts with a <code>.R</code> or <code>.r</code> suffix. Follow this convention unless you have some extraordinary reason not to.</p>
<p>Comments start with one or more <code>#</code> symbols. Use them. RStudio helps you (de)comment selected lines with Ctrl+Shift+C (Windows and Linux) or Command+Shift+C (Mac).</p>
<p>Clean out the workspace, i.e. pretend like you’ve just revisited this project after a long absence. The broom icon or <code>rm(list = ls())</code>. Good idea to do this, restart R (available from the Session menu), re-run your analysis to truly check that the code you’re saving is complete and correct (or at least rule out obvious problems!).</p>
<p>This workflow will serve you well in the future:</p>
<ul>
<li>Create an RStudio project for an analytical project</li>
<li>Keep inputs there (we’ll soon talk about importing)</li>
<li>Keep scripts there; edit them, run them in bits or as a whole from there</li>
<li>Keep outputs there (like the PDF written above)</li>
</ul>
<p>Avoid using the mouse for pieces of your analytical workflow, such as loading a dataset or saving a figure. Terribly important for reproducibility and for making it possible to retrospectively determine how a numerical table or PDF was actually produced (searching on local disk on filename, among <code>.R</code> files, will lead to the relevant script).</p>
<p>Many long-time users never save the workspace, never save <code>.RData</code> files (I’m one of them), never save or consult the history. Once/if you get to that point, there are options available in RStudio to disable the loading of <code>.RData</code> and permanently suppress the prompt on exit to save the workspace (go to <em>Tools &gt; Options &gt; General</em>).</p>
<p>For the record, when loading data into R and/or writing outputs to file, you can always specify the absolute path and thereby insulate yourself from the current working directory. This is rarely necessary when using RStudio projects properly.</p>
<!--RStudio Links-->
<!--HappyGitWithR Links-->
<!--Package Links-->
<!--Shiny links-->
<!--Publications-->
<!--R Documentation-->
<!--Wikipedia Links-->
<!--Misc. Links-->
<!--chapter:end:002_r-basics.Rmd-->
</div>
</div>
<div id="part-version-control-and-r-markdown" class="section level1 unnumbered">
<h1>(PART) Version control and R Markdown</h1>
</div>
<div id="overview" class="section level1 unnumbered">
<h1>Overview</h1>
<p>Although this part now links out to external resources, if you’re working through this material on your own, let this be a nudge to pause around here and think about your workflow. I give you permission to spend some time and energy sorting this out! It can be as or more important than learning a new R function or package. The experts don’t talk about this much, because they’ve already got a workflow and it’s something they do almost without thinking.</p>
<p>Working through subsequent material in R Markdown documents, possibly using Git and GitHub to track and share your progress, is a great idea and will leave you more prepared for your future data analysis projects. Typing individual lines of R code is but a small part of data analysis and it pays off to think holistically about your workflow.</p>
</div>
<div id="version-control" class="section level1">
<h1><span class="header-section-number">3</span> Git, GitHub, and RStudio</h1>
<!--Original content: https://stat545.com/git08_claim-stat545-repo.html-->
<p>At this point in DS4P, all students receive their own DS4P GitHub repository that they will use to develop their course work throughout the rest of the course.</p>
<p>This has two purposes:</p>
<ul>
<li>It is helpful for course mechanics, e.g. homework submission and grading,
peer review.</li>
<li>Learning to use Git and GitHub, with R and RStudio, is a legitimate
pedagogical goal.</li>
</ul>
<p>Our instructions around installation, setup, and early Git usage eventually grew so extensive that we created a dedicated website. This content can now be found here:</p>
<p><a href="https://happygitwithr.com" class="uri">https://happygitwithr.com</a></p>
</div>
<div id="r-markdown" class="section level1">
<h1><span class="header-section-number">4</span> R Markdown</h1>
<!--Original content: https://stat545.com/block007_first-use-rmarkdown.html-->
<p>DS4P course work is generally submitted in the form of R Markdown documents. Students submit an <code>.Rmd</code> file, which they have executed or rendered to a <code>.md</code> markdown file. R Markdown is a very accessible way to create computational documents that combine prose and tables and figures produced by R code.</p>
<p>An introductory R Markdown workflow, including how it intersects with Git, GitHub, and RStudio, is now maintained within the Happy Git site:</p>
<p><a href="https://happygitwithr.com/rmd-test-drive.html">Test drive R Markdown</a></p>
<!--chapter:end:003_version-control-r-markdown.Rmd-->
</div>
<div id="part-data-analysis-1" class="section level1 unnumbered">
<h1>(PART) Data analysis 1</h1>
</div>
<div id="basic-data-care" class="section level1">
<h1><span class="header-section-number">5</span> Basic care and feeding of data in R</h1>
<!--Original content: https://stat545.com/block006_care-feeding-data.html-->
<div id="buckle-your-seatbelt" class="section level2">
<h2><span class="header-section-number">5.1</span> Buckle your seatbelt</h2>
<p><em>Ignore if you don’t need this bit of support.</em></p>
<p>Now is the time to make sure you are working in an appropriate directory on your computer, probably through the use of an <a href="#rprojs">RStudio project</a>. Enter <code>getwd()</code> in the Console to see current working directory or, in RStudio, this is displayed in the bar at the top of Console.</p>
<p>You should clean out your workspace. In RStudio, click on the “Clear” broom icon from the Environment tab or use <em>Session &gt; Clear Workspace</em>. You can also enter <code>rm(list = ls())</code> in the Console to accomplish same.</p>
<p>Now restart R. This will ensure you don’t have any packages loaded from previous calls to <code>library()</code>. In RStudio, use <em>Session &gt; Restart R</em>. Otherwise, quit R with <code>q()</code> and re-launch it.</p>
<p>Why do we do this? So that the code you write is complete and re-runnable. If you return to a clean slate often, you will root out hidden dependencies where one snippet of code only works because it relies on objects created by code saved elsewhere or, much worse, never saved at all. Similarly, an aggressive clean slate approach will expose any usage of packages that have not been explicitly loaded.</p>
<p>Finally, open a new R script and develop and run your code from there. In RStudio, use <em>File &gt; New File &gt; R Script</em>. Save this script with a name ending in <code>.r</code> or <code>.R</code>, containing no spaces or other funny stuff, and that evokes whatever it is we’re doing today. <strong>Example:</strong> <code>cm004_data-care-feeding.r</code>.</p>
<p>Another great idea is to do this in an R Markdown document. See <a href="#r-markdown">Test drive R Markdown</a> for a refresher.</p>
</div>
<div id="data-frames-are-awesome" class="section level2">
<h2><span class="header-section-number">5.2</span> Data frames are awesome</h2>
<p>Whenever you have rectangular, spreadsheet-y data, your default data receptacle in R is a data frame. Do not depart from this without good reason. Data frames are awesome because…</p>
<ul>
<li>Data frames package related variables neatly together,
<ul>
<li>keeping them in sync vis-a-vis row order</li>
<li>applying any filtering of observations uniformly</li>
</ul></li>
<li>Most functions for inference, modelling, and graphing are happy to be passed a data frame via a <code>data =</code> argument. This has been true in base R for a long time.</li>
<li>The set of packages known as the <a href="https://www.tidyverse.org">tidyverse</a> takes this one step further and explicitly prioritizes the processing of data frames. This includes popular packages like dplyr and ggplot2. In fact the tidyverse prioritizes a special flavor of data frame, called a “tibble”.</li>
</ul>
<p>Data frames – unlike general arrays or, specifically, matrices in R – can hold variables of different flavors, such as character data (subject ID or name), quantitative data (white blood cell count), and categorical information (treated vs. untreated). If you use homogeneous structures, like matrices, for data analysis, you are likely to make the terrible mistake of spreading a dataset out over multiple, unlinked objects. Why? Because you can’t put character data, such as subject name, into the numeric matrix that holds white blood cell count. This fragmentation is a Bad Idea.</p>
</div>
<div id="get-the-gapminder-data" class="section level2">
<h2><span class="header-section-number">5.3</span> Get the Gapminder data</h2>
<p>We will work with some of the data from the <a href="https://www.gapminder.org">Gapminder project</a>. I’ve released this as an <a href="https://CRAN.R-project.org/package=gapminder">R package</a>, so we can install it from CRAN like so:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="kw">install.packages</span>(<span class="st">&quot;gapminder&quot;</span>)</span></code></pre></div>
<p>Now load the package:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="kw">library</span>(gapminder)</span></code></pre></div>
</div>
<div id="meet-the-gapminder-data-frame-or-tibble" class="section level2">
<h2><span class="header-section-number">5.4</span> Meet the <code>gapminder</code> data frame or “tibble”</h2>
<p>By loading the gapminder package, we now have access to a data frame by the same name. Get an overview of this with <code>str()</code>, which displays the structure of an object.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="kw">str</span>(gapminder)</span>
<span id="cb28-2"><a href="#cb28-2"></a><span class="co">#&gt; tibble [1,704 x 6] (S3: tbl_df/tbl/data.frame)</span></span>
<span id="cb28-3"><a href="#cb28-3"></a><span class="co">#&gt;  $ country  : Factor w/ 142 levels &quot;Afghanistan&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span id="cb28-4"><a href="#cb28-4"></a><span class="co">#&gt;  $ continent: Factor w/ 5 levels &quot;Africa&quot;,&quot;Americas&quot;,..: 3 3 3 3 3 3 3 3 3 3 ...</span></span>
<span id="cb28-5"><a href="#cb28-5"></a><span class="co">#&gt;  $ year     : int [1:1704] 1952 1957 1962 1967 1972 1977 1982 1987 1992 1997 ...</span></span>
<span id="cb28-6"><a href="#cb28-6"></a><span class="co">#&gt;  $ lifeExp  : num [1:1704] 28.8 30.3 32 34 36.1 ...</span></span>
<span id="cb28-7"><a href="#cb28-7"></a><span class="co">#&gt;  $ pop      : int [1:1704] 8425333 9240934 10267083 11537966 13079460 14880372..</span></span>
<span id="cb28-8"><a href="#cb28-8"></a><span class="co">#&gt;  $ gdpPercap: num [1:1704] 779 821 853 836 740 ...</span></span></code></pre></div>
<p><code>str()</code> will provide a sensible description of almost anything and, worst case, nothing bad can actually happen. When in doubt, just <code>str()</code> some of the recently created objects to get some ideas about what to do next.</p>
<p>We could print the <code>gapminder</code> object itself to screen. However, if you’ve used R before, you might be reluctant to do this, because large datasets just fill up your Console and provide very little insight.</p>
<p>This is the first big win for <strong>tibbles</strong>. The <a href="https://tidyverse.tidyverse.org">tidyverse</a> offers a special case of R’s default data frame: the “tibble”, which is a nod to the actual class of these objects, <code>tbl_df</code>.</p>
<p>If you have not already done so, install the tidyverse meta-package now:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="kw">install.packages</span>(<span class="st">&quot;tidyverse&quot;</span>)</span></code></pre></div>
<p>Now load it:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb30-2"><a href="#cb30-2"></a><span class="co">#&gt; -- Attaching packages ------------------</span></span>
<span id="cb30-3"><a href="#cb30-3"></a><span class="co">#&gt; v ggplot2 3.3.2     v purrr   0.3.4</span></span>
<span id="cb30-4"><a href="#cb30-4"></a><span class="co">#&gt; v tibble  3.0.3     v dplyr   1.0.2</span></span>
<span id="cb30-5"><a href="#cb30-5"></a><span class="co">#&gt; v tidyr   1.1.2     v stringr 1.4.0</span></span>
<span id="cb30-6"><a href="#cb30-6"></a><span class="co">#&gt; v readr   1.3.1     v forcats 0.5.0</span></span>
<span id="cb30-7"><a href="#cb30-7"></a><span class="co">#&gt; -- Conflicts -- tidyverse_conflicts() --</span></span>
<span id="cb30-8"><a href="#cb30-8"></a><span class="co">#&gt; x dplyr::filter() masks stats::filter()</span></span>
<span id="cb30-9"><a href="#cb30-9"></a><span class="co">#&gt; x dplyr::lag()    masks stats::lag()</span></span></code></pre></div>
<p>Now we can boldly print <code>gapminder</code> to screen! It is a tibble (and also a regular data frame) and the tidyverse provides a nice print method that shows the most important stuff and doesn’t fill up your Console.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a><span class="co">## see? it&#39;s still a regular data frame, but also a tibble</span></span>
<span id="cb31-2"><a href="#cb31-2"></a><span class="kw">class</span>(gapminder)</span>
<span id="cb31-3"><a href="#cb31-3"></a><span class="co">#&gt; [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</span></span>
<span id="cb31-4"><a href="#cb31-4"></a>gapminder</span>
<span id="cb31-5"><a href="#cb31-5"></a><span class="co">#&gt; # A tibble: 1,704 x 6</span></span>
<span id="cb31-6"><a href="#cb31-6"></a><span class="co">#&gt;    country     continent  year lifeExp      pop gdpPercap</span></span>
<span id="cb31-7"><a href="#cb31-7"></a><span class="co">#&gt;    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb31-8"><a href="#cb31-8"></a><span class="co">#&gt;  1 Afghanistan Asia       1952    28.8  8425333      779.</span></span>
<span id="cb31-9"><a href="#cb31-9"></a><span class="co">#&gt;  2 Afghanistan Asia       1957    30.3  9240934      821.</span></span>
<span id="cb31-10"><a href="#cb31-10"></a><span class="co">#&gt;  3 Afghanistan Asia       1962    32.0 10267083      853.</span></span>
<span id="cb31-11"><a href="#cb31-11"></a><span class="co">#&gt;  4 Afghanistan Asia       1967    34.0 11537966      836.</span></span>
<span id="cb31-12"><a href="#cb31-12"></a><span class="co">#&gt;  5 Afghanistan Asia       1972    36.1 13079460      740.</span></span>
<span id="cb31-13"><a href="#cb31-13"></a><span class="co">#&gt;  6 Afghanistan Asia       1977    38.4 14880372      786.</span></span>
<span id="cb31-14"><a href="#cb31-14"></a><span class="co">#&gt;  7 Afghanistan Asia       1982    39.9 12881816      978.</span></span>
<span id="cb31-15"><a href="#cb31-15"></a><span class="co">#&gt;  8 Afghanistan Asia       1987    40.8 13867957      852.</span></span>
<span id="cb31-16"><a href="#cb31-16"></a><span class="co">#&gt;  9 Afghanistan Asia       1992    41.7 16317921      649.</span></span>
<span id="cb31-17"><a href="#cb31-17"></a><span class="co">#&gt; 10 Afghanistan Asia       1997    41.8 22227415      635.</span></span>
<span id="cb31-18"><a href="#cb31-18"></a><span class="co">#&gt; # ... with 1,694 more rows</span></span></code></pre></div>
<p>If you are dealing with plain vanilla data frames, you can rein in data frame printing explicitly with <code>head()</code> and <code>tail()</code>. Or turn it into a tibble with <code>as_tibble()</code>!</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="kw">head</span>(gapminder)</span>
<span id="cb32-2"><a href="#cb32-2"></a><span class="co">#&gt; # A tibble: 6 x 6</span></span>
<span id="cb32-3"><a href="#cb32-3"></a><span class="co">#&gt;   country     continent  year lifeExp      pop gdpPercap</span></span>
<span id="cb32-4"><a href="#cb32-4"></a><span class="co">#&gt;   &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb32-5"><a href="#cb32-5"></a><span class="co">#&gt; 1 Afghanistan Asia       1952    28.8  8425333      779.</span></span>
<span id="cb32-6"><a href="#cb32-6"></a><span class="co">#&gt; 2 Afghanistan Asia       1957    30.3  9240934      821.</span></span>
<span id="cb32-7"><a href="#cb32-7"></a><span class="co">#&gt; 3 Afghanistan Asia       1962    32.0 10267083      853.</span></span>
<span id="cb32-8"><a href="#cb32-8"></a><span class="co">#&gt; 4 Afghanistan Asia       1967    34.0 11537966      836.</span></span>
<span id="cb32-9"><a href="#cb32-9"></a><span class="co">#&gt; 5 Afghanistan Asia       1972    36.1 13079460      740.</span></span>
<span id="cb32-10"><a href="#cb32-10"></a><span class="co">#&gt; 6 Afghanistan Asia       1977    38.4 14880372      786.</span></span>
<span id="cb32-11"><a href="#cb32-11"></a><span class="kw">tail</span>(gapminder)</span>
<span id="cb32-12"><a href="#cb32-12"></a><span class="co">#&gt; # A tibble: 6 x 6</span></span>
<span id="cb32-13"><a href="#cb32-13"></a><span class="co">#&gt;   country  continent  year lifeExp      pop gdpPercap</span></span>
<span id="cb32-14"><a href="#cb32-14"></a><span class="co">#&gt;   &lt;fct&gt;    &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb32-15"><a href="#cb32-15"></a><span class="co">#&gt; 1 Zimbabwe Africa     1982    60.4  7636524      789.</span></span>
<span id="cb32-16"><a href="#cb32-16"></a><span class="co">#&gt; 2 Zimbabwe Africa     1987    62.4  9216418      706.</span></span>
<span id="cb32-17"><a href="#cb32-17"></a><span class="co">#&gt; 3 Zimbabwe Africa     1992    60.4 10704340      693.</span></span>
<span id="cb32-18"><a href="#cb32-18"></a><span class="co">#&gt; 4 Zimbabwe Africa     1997    46.8 11404948      792.</span></span>
<span id="cb32-19"><a href="#cb32-19"></a><span class="co">#&gt; 5 Zimbabwe Africa     2002    40.0 11926563      672.</span></span>
<span id="cb32-20"><a href="#cb32-20"></a><span class="co">#&gt; 6 Zimbabwe Africa     2007    43.5 12311143      470.</span></span>
<span id="cb32-21"><a href="#cb32-21"></a><span class="kw">as_tibble</span>(iris)</span>
<span id="cb32-22"><a href="#cb32-22"></a><span class="co">#&gt; # A tibble: 150 x 5</span></span>
<span id="cb32-23"><a href="#cb32-23"></a><span class="co">#&gt;    Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></span>
<span id="cb32-24"><a href="#cb32-24"></a><span class="co">#&gt;           &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt; &lt;fct&gt;  </span></span>
<span id="cb32-25"><a href="#cb32-25"></a><span class="co">#&gt;  1          5.1         3.5          1.4         0.2 setosa </span></span>
<span id="cb32-26"><a href="#cb32-26"></a><span class="co">#&gt;  2          4.9         3            1.4         0.2 setosa </span></span>
<span id="cb32-27"><a href="#cb32-27"></a><span class="co">#&gt;  3          4.7         3.2          1.3         0.2 setosa </span></span>
<span id="cb32-28"><a href="#cb32-28"></a><span class="co">#&gt;  4          4.6         3.1          1.5         0.2 setosa </span></span>
<span id="cb32-29"><a href="#cb32-29"></a><span class="co">#&gt;  5          5           3.6          1.4         0.2 setosa </span></span>
<span id="cb32-30"><a href="#cb32-30"></a><span class="co">#&gt;  6          5.4         3.9          1.7         0.4 setosa </span></span>
<span id="cb32-31"><a href="#cb32-31"></a><span class="co">#&gt;  7          4.6         3.4          1.4         0.3 setosa </span></span>
<span id="cb32-32"><a href="#cb32-32"></a><span class="co">#&gt;  8          5           3.4          1.5         0.2 setosa </span></span>
<span id="cb32-33"><a href="#cb32-33"></a><span class="co">#&gt;  9          4.4         2.9          1.4         0.2 setosa </span></span>
<span id="cb32-34"><a href="#cb32-34"></a><span class="co">#&gt; 10          4.9         3.1          1.5         0.1 setosa </span></span>
<span id="cb32-35"><a href="#cb32-35"></a><span class="co">#&gt; # ... with 140 more rows</span></span></code></pre></div>
<p>More ways to query basic info on a data frame:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="kw">names</span>(gapminder)</span>
<span id="cb33-2"><a href="#cb33-2"></a><span class="co">#&gt; [1] &quot;country&quot;   &quot;continent&quot; &quot;year&quot;      &quot;lifeExp&quot;   &quot;pop&quot;       &quot;gdpPercap&quot;</span></span>
<span id="cb33-3"><a href="#cb33-3"></a><span class="kw">ncol</span>(gapminder)</span>
<span id="cb33-4"><a href="#cb33-4"></a><span class="co">#&gt; [1] 6</span></span>
<span id="cb33-5"><a href="#cb33-5"></a><span class="kw">length</span>(gapminder)</span>
<span id="cb33-6"><a href="#cb33-6"></a><span class="co">#&gt; [1] 6</span></span>
<span id="cb33-7"><a href="#cb33-7"></a><span class="kw">dim</span>(gapminder)</span>
<span id="cb33-8"><a href="#cb33-8"></a><span class="co">#&gt; [1] 1704    6</span></span>
<span id="cb33-9"><a href="#cb33-9"></a><span class="kw">nrow</span>(gapminder)</span>
<span id="cb33-10"><a href="#cb33-10"></a><span class="co">#&gt; [1] 1704</span></span></code></pre></div>
<p>A statistical overview can be obtained with <code>summary()</code>:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a><span class="kw">summary</span>(gapminder)</span>
<span id="cb34-2"><a href="#cb34-2"></a><span class="co">#&gt;         country        continent        year         lifeExp    </span></span>
<span id="cb34-3"><a href="#cb34-3"></a><span class="co">#&gt;  Afghanistan:  12   Africa  :624   Min.   :1952   Min.   :23.6  </span></span>
<span id="cb34-4"><a href="#cb34-4"></a><span class="co">#&gt;  Albania    :  12   Americas:300   1st Qu.:1966   1st Qu.:48.2  </span></span>
<span id="cb34-5"><a href="#cb34-5"></a><span class="co">#&gt;  Algeria    :  12   Asia    :396   Median :1980   Median :60.7  </span></span>
<span id="cb34-6"><a href="#cb34-6"></a><span class="co">#&gt;  Angola     :  12   Europe  :360   Mean   :1980   Mean   :59.5  </span></span>
<span id="cb34-7"><a href="#cb34-7"></a><span class="co">#&gt;  Argentina  :  12   Oceania : 24   3rd Qu.:1993   3rd Qu.:70.8  </span></span>
<span id="cb34-8"><a href="#cb34-8"></a><span class="co">#&gt;  Australia  :  12                  Max.   :2007   Max.   :82.6  </span></span>
<span id="cb34-9"><a href="#cb34-9"></a><span class="co">#&gt;  (Other)    :1632                                               </span></span>
<span id="cb34-10"><a href="#cb34-10"></a><span class="co">#&gt;       pop             gdpPercap     </span></span>
<span id="cb34-11"><a href="#cb34-11"></a><span class="co">#&gt;  Min.   :6.00e+04   Min.   :   241  </span></span>
<span id="cb34-12"><a href="#cb34-12"></a><span class="co">#&gt;  1st Qu.:2.79e+06   1st Qu.:  1202  </span></span>
<span id="cb34-13"><a href="#cb34-13"></a><span class="co">#&gt;  Median :7.02e+06   Median :  3532  </span></span>
<span id="cb34-14"><a href="#cb34-14"></a><span class="co">#&gt;  Mean   :2.96e+07   Mean   :  7215  </span></span>
<span id="cb34-15"><a href="#cb34-15"></a><span class="co">#&gt;  3rd Qu.:1.96e+07   3rd Qu.:  9325  </span></span>
<span id="cb34-16"><a href="#cb34-16"></a><span class="co">#&gt;  Max.   :1.32e+09   Max.   :113523  </span></span>
<span id="cb34-17"><a href="#cb34-17"></a><span class="co">#&gt; </span></span></code></pre></div>
<p>Although we haven’t begun our formal coverage of visualization yet, it’s so important for smell-testing dataset that we will make a few figures anyway. Here we use only base R graphics, which are very basic.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="kw">plot</span>(lifeExp <span class="op">~</span><span class="st"> </span>year, gapminder)</span></code></pre></div>
<p><img src="005_data-care-feeding_files/figure-html/first-plots-base-R-1.png" width="672" /></p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a><span class="kw">plot</span>(lifeExp <span class="op">~</span><span class="st"> </span>gdpPercap, gapminder)</span></code></pre></div>
<p><img src="005_data-care-feeding_files/figure-html/first-plots-base-R-2.png" width="672" /></p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a><span class="kw">plot</span>(lifeExp <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(gdpPercap), gapminder)</span></code></pre></div>
<p><img src="005_data-care-feeding_files/figure-html/first-plots-base-R-3.png" width="672" /></p>
<!--JB: This is a non-sequitur here ... where came from originally?
> Sidebar on equals: A single equal sign `=` is most commonly used to specify values of arguments when calling functions in R, e.g. `group = continent`. It can be used for assignment but we advise against that, in favor of `<-`. A double equal sign `==` is a binary comparison operator, akin to less than `<` or greater than `>`, returning the logical value `TRUE` in the case of equality and `FALSE` otherwise. Although you may not yet understand exactly why, `subset = country == "Colombia"` restricts operation -- scatterplotting, in above examples -- to observations where the country is Colombia.
-->
<p>Let’s go back to the result of <code>str()</code> to talk about what a data frame is.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a><span class="kw">str</span>(gapminder)</span>
<span id="cb38-2"><a href="#cb38-2"></a><span class="co">#&gt; tibble [1,704 x 6] (S3: tbl_df/tbl/data.frame)</span></span>
<span id="cb38-3"><a href="#cb38-3"></a><span class="co">#&gt;  $ country  : Factor w/ 142 levels &quot;Afghanistan&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span id="cb38-4"><a href="#cb38-4"></a><span class="co">#&gt;  $ continent: Factor w/ 5 levels &quot;Africa&quot;,&quot;Americas&quot;,..: 3 3 3 3 3 3 3 3 3 3 ...</span></span>
<span id="cb38-5"><a href="#cb38-5"></a><span class="co">#&gt;  $ year     : int [1:1704] 1952 1957 1962 1967 1972 1977 1982 1987 1992 1997 ...</span></span>
<span id="cb38-6"><a href="#cb38-6"></a><span class="co">#&gt;  $ lifeExp  : num [1:1704] 28.8 30.3 32 34 36.1 ...</span></span>
<span id="cb38-7"><a href="#cb38-7"></a><span class="co">#&gt;  $ pop      : int [1:1704] 8425333 9240934 10267083 11537966 13079460 14880372..</span></span>
<span id="cb38-8"><a href="#cb38-8"></a><span class="co">#&gt;  $ gdpPercap: num [1:1704] 779 821 853 836 740 ...</span></span></code></pre></div>
<p>A data frame is a special case of a <em>list</em>, which is used in R to hold just about anything. Data frames are a special case where the length of each list component is the same. Data frames are superior to matrices in R because they can hold vectors of different flavors, e.g. numeric, character, and categorical data can be stored together. This comes up a lot!</p>
</div>
<div id="look-at-the-variables-inside-a-data-frame" class="section level2">
<h2><span class="header-section-number">5.5</span> Look at the variables inside a data frame</h2>
<p>To specify a single variable from a data frame, use the dollar sign <code>$</code>. Let’s explore the numeric variable for life expectancy.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a><span class="kw">head</span>(gapminder<span class="op">$</span>lifeExp)</span>
<span id="cb39-2"><a href="#cb39-2"></a><span class="co">#&gt; [1] 28.8 30.3 32.0 34.0 36.1 38.4</span></span>
<span id="cb39-3"><a href="#cb39-3"></a><span class="kw">summary</span>(gapminder<span class="op">$</span>lifeExp)</span>
<span id="cb39-4"><a href="#cb39-4"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb39-5"><a href="#cb39-5"></a><span class="co">#&gt;    23.6    48.2    60.7    59.5    70.8    82.6</span></span>
<span id="cb39-6"><a href="#cb39-6"></a><span class="kw">hist</span>(gapminder<span class="op">$</span>lifeExp)</span></code></pre></div>
<p><img src="005_data-care-feeding_files/figure-html/histogram-lifeExp-1.png" width="672" /></p>
<p>The year variable is an integer variable, but since there are so few unique values it also functions a bit like a categorical variable.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a><span class="kw">summary</span>(gapminder<span class="op">$</span>year)</span>
<span id="cb40-2"><a href="#cb40-2"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb40-3"><a href="#cb40-3"></a><span class="co">#&gt;    1952    1966    1980    1980    1993    2007</span></span>
<span id="cb40-4"><a href="#cb40-4"></a><span class="kw">table</span>(gapminder<span class="op">$</span>year)</span>
<span id="cb40-5"><a href="#cb40-5"></a><span class="co">#&gt; </span></span>
<span id="cb40-6"><a href="#cb40-6"></a><span class="co">#&gt; 1952 1957 1962 1967 1972 1977 1982 1987 1992 1997 2002 2007 </span></span>
<span id="cb40-7"><a href="#cb40-7"></a><span class="co">#&gt;  142  142  142  142  142  142  142  142  142  142  142  142</span></span></code></pre></div>
<p>The variables for country and continent hold truly categorical information, which is stored as a <em>factor</em> in R.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a><span class="kw">class</span>(gapminder<span class="op">$</span>continent)</span>
<span id="cb41-2"><a href="#cb41-2"></a><span class="co">#&gt; [1] &quot;factor&quot;</span></span>
<span id="cb41-3"><a href="#cb41-3"></a><span class="kw">summary</span>(gapminder<span class="op">$</span>continent)</span>
<span id="cb41-4"><a href="#cb41-4"></a><span class="co">#&gt;   Africa Americas     Asia   Europe  Oceania </span></span>
<span id="cb41-5"><a href="#cb41-5"></a><span class="co">#&gt;      624      300      396      360       24</span></span>
<span id="cb41-6"><a href="#cb41-6"></a><span class="kw">levels</span>(gapminder<span class="op">$</span>continent)</span>
<span id="cb41-7"><a href="#cb41-7"></a><span class="co">#&gt; [1] &quot;Africa&quot;   &quot;Americas&quot; &quot;Asia&quot;     &quot;Europe&quot;   &quot;Oceania&quot;</span></span>
<span id="cb41-8"><a href="#cb41-8"></a><span class="kw">nlevels</span>(gapminder<span class="op">$</span>continent)</span>
<span id="cb41-9"><a href="#cb41-9"></a><span class="co">#&gt; [1] 5</span></span></code></pre></div>
<p>The <strong>levels</strong> of the factor <code>continent</code> are “Africa”, “Americas”, etc. and this is what’s usually presented to your eyeballs by R. In general, the levels are friendly human-readable character strings, like “male/female” and “control/treated”. But <em>never ever ever</em> forget that, under the hood, R is really storing integer codes 1, 2, 3, etc. Look at the result from <code>str(gapminder$continent)</code> if you are skeptical.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a><span class="kw">str</span>(gapminder<span class="op">$</span>continent)</span>
<span id="cb42-2"><a href="#cb42-2"></a><span class="co">#&gt;  Factor w/ 5 levels &quot;Africa&quot;,&quot;Americas&quot;,..: 3 3 3 3 3 3 3 3 3 3 ...</span></span></code></pre></div>
<p>This <a href="https://en.wikipedia.org/wiki/Janus">Janus</a>-like nature of factors means they are rich with booby traps for the unsuspecting but they are a necessary evil. I recommend you resolve to learn how to <a href="#factors-boss">properly care and feed for factors</a>. The pros far outweigh the cons. Specifically in modelling and figure-making, factors are anticipated and accommodated by the functions and packages you will want to exploit.</p>
<p>Here we count how many observations are associated with each continent and, as usual, try to portray that info visually. This makes it much easier to quickly see that African countries are well represented in this dataset.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a><span class="kw">table</span>(gapminder<span class="op">$</span>continent)</span>
<span id="cb43-2"><a href="#cb43-2"></a><span class="co">#&gt; </span></span>
<span id="cb43-3"><a href="#cb43-3"></a><span class="co">#&gt;   Africa Americas     Asia   Europe  Oceania </span></span>
<span id="cb43-4"><a href="#cb43-4"></a><span class="co">#&gt;      624      300      396      360       24</span></span>
<span id="cb43-5"><a href="#cb43-5"></a><span class="kw">barplot</span>(<span class="kw">table</span>(gapminder<span class="op">$</span>continent))</span></code></pre></div>
<p><img src="005_data-care-feeding_files/figure-html/tabulate-continent-1.png" width="672" /></p>
<p>In the figures below, we see how factors can be put to work in figures. The <code>continent</code> factor is easily mapped into “facets” or colors and a legend by the ggplot2 package. <em>Making figures with ggplot2 is covered in Chapter @ref(ggplot2-tutorial) so feel free to just sit back and enjoy these plots or blindly copy/paste.</em></p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a><span class="co">## we exploit the fact that ggplot2 was installed and loaded via the tidyverse</span></span>
<span id="cb44-2"><a href="#cb44-2"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">filter</span>(gapminder, continent <span class="op">!=</span><span class="st"> &quot;Oceania&quot;</span>),</span>
<span id="cb44-3"><a href="#cb44-3"></a>            <span class="kw">aes</span>(<span class="dt">x =</span> gdpPercap, <span class="dt">y =</span> lifeExp)) <span class="co"># just initializes</span></span>
<span id="cb44-4"><a href="#cb44-4"></a>p &lt;-<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">scale_x_log10</span>() <span class="co"># log the x axis the right way</span></span>
<span id="cb44-5"><a href="#cb44-5"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="co"># scatterplot</span></span>
<span id="cb44-6"><a href="#cb44-6"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> continent)) <span class="co"># map continent to color</span></span>
<span id="cb44-7"><a href="#cb44-7"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> (<span class="dv">1</span><span class="op">/</span><span class="dv">3</span>), <span class="dt">size =</span> <span class="dv">3</span>) <span class="op">+</span><span class="st"> </span><span class="kw">geom_smooth</span>(<span class="dt">lwd =</span> <span class="dv">3</span>, <span class="dt">se =</span> <span class="ot">FALSE</span>)</span>
<span id="cb44-8"><a href="#cb44-8"></a><span class="co">#&gt; `geom_smooth()` using method = &#39;gam&#39; and formula &#39;y ~ s(x, bs = &quot;cs&quot;)&#39;</span></span>
<span id="cb44-9"><a href="#cb44-9"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> (<span class="dv">1</span><span class="op">/</span><span class="dv">3</span>), <span class="dt">size =</span> <span class="dv">3</span>) <span class="op">+</span><span class="st"> </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>continent) <span class="op">+</span></span>
<span id="cb44-10"><a href="#cb44-10"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">lwd =</span> <span class="fl">1.5</span>, <span class="dt">se =</span> <span class="ot">FALSE</span>)</span>
<span id="cb44-11"><a href="#cb44-11"></a><span class="co">#&gt; `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</span></span></code></pre></div>
<p><img src="005_data-care-feeding_files/figure-html/factors-nice-for-plots-1.png" width="49%" /><img src="005_data-care-feeding_files/figure-html/factors-nice-for-plots-2.png" width="49%" /><img src="005_data-care-feeding_files/figure-html/factors-nice-for-plots-3.png" width="49%" /><img src="005_data-care-feeding_files/figure-html/factors-nice-for-plots-4.png" width="49%" /></p>
<!---JB:
EXERCISES I have used and let languish.
Let's get the data for just 2007.
How many rows?
How many observations per continent?
Scatterplot life expectancy against GDP per capita.
Variants of that: indicate continent by color, do for just one continent, do for multiple continents at once but in separate plots

```r
hDat <- subset(gapminder, subset = year == 2007)
str(hDat)
#> tibble [142 x 6] (S3: tbl_df/tbl/data.frame)
#>  $ country  : Factor w/ 142 levels "Afghanistan",..: 1 2 3 4 5 6 7 8 9 10 ...
#>  $ continent: Factor w/ 5 levels "Africa","Americas",..: 3 4 1 1 2 5 4 3 3 4 ...
#>  $ year     : int [1:142] 2007 2007 2007 2007 2007 2007 2007 2007 2007 2007 ...
#>  $ lifeExp  : num [1:142] 43.8 76.4 72.3 42.7 75.3 ...
#>  $ pop      : int [1:142] 31889923 3600523 33333216 12420476 40301927 20434176..
#>  $ gdpPercap: num [1:142] 975 5937 6223 4797 12779 ...
table(hDat$continent)
#> 
#>   Africa Americas     Asia   Europe  Oceania 
#>       52       25       33       30        2
#xyplot(lifeExp ~ gdpPercap, hDat)
#xyplot(lifeExp ~ gdpPercap, hDat, group = continent, auto.key = TRUE)
#xyplot(lifeExp ~ gdpPercap | continent, hDat)
```
## if you want just some rows and/or just some variables, for inspection or to
## assign as a new object, use subset()
subset(gapminder, subset = country == "Cambodia")
subset(gapminder, subset = country %in% c("Japan", "Belgium"))
subset(gapminder, subset = year == 1952)
subset(gapminder, subset = country == "Uruguay", select = c(country, year, lifeExp))

plot(lifeExp ~ year, gapminder, subset = country == "Zimbabwe")
plot(lifeExp ~ log(gdpPercap), gapminder, subset = year == 2007)

## exercise:
## get data for which life expectancy is less than 32 years
## assign to an object
## how many rows? how many observations per continent?
--->
</div>
<div id="recap" class="section level2">
<h2><span class="header-section-number">5.6</span> Recap</h2>
<ul>
<li><p>Use data frames!!!</p></li>
<li><p>Use the <a href="https://tidyverse.tidyverse.org">tidyverse</a>!!! This will provide a special type of data frame called a “tibble” that has nice default printing behavior, among other benefits.</p></li>
<li><p>When in doubt, <code>str()</code> something or print something.</p></li>
<li><p>Always understand the basic extent of your data frames: number of rows and columns.</p></li>
<li><p>Understand what flavor the variables are.</p></li>
<li><p>Use factors!!! But with intention and care.</p></li>
<li><p>Do basic statistical and visual sanity checking of each variable.</p></li>
<li><p>Refer to variables by name, e.g., <code>gapminder$lifeExp</code>, not by column number. Your code will be more robust and readable.</p></li>
</ul>
<!--RStudio Links-->
<!--HappyGitWithR Links-->
<!--Package Links-->
<!--Shiny links-->
<!--Publications-->
<!--R Documentation-->
<!--Wikipedia Links-->
<!--Misc. Links-->
<!--chapter:end:005_data-care-feeding.Rmd-->
</div>
</div>
<div id="dplyr-intro" class="section level1">
<h1><span class="header-section-number">6</span> Introduction to dplyr</h1>
<!--Original content: https://stat545.com/block009_dplyr-intro.html-->
<div id="intro" class="section level2">
<h2><span class="header-section-number">6.1</span> Intro</h2>
<p><a href="https://dplyr.tidyverse.org">dplyr</a> is a package for data manipulation, developed by Hadley Wickham and Romain Francois. It is built to be fast, highly expressive, and open-minded about how your data is stored. It is installed as part of the <a href="https://tidyverse.tidyverse.org">tidyverse</a> meta-package and, as a core package, it is among those loaded via <code>library(tidyverse)</code>.</p>
<p>dplyr’s roots are in an earlier package called <a href="http://plyr.had.co.nz">plyr</a>, which implements the <a href="https://www.jstatsoft.org/article/view/v040i01">“split-apply-combine” strategy for data analysis</a> <span class="citation">(Hadley Wickham <a href="#ref-wickham2011a" role="doc-biblioref">2011</a><a href="#ref-wickham2011a" role="doc-biblioref">b</a>)</span>. Where plyr covers a diverse set of inputs and outputs (e.g., arrays, data frames, lists), dplyr has a laser-like focus on data frames or, in the tidyverse, “tibbles”. dplyr is a package-level treatment of the <code>ddply()</code> function from plyr, because “data frame in, data frame out” proved to be so incredibly important.</p>
<p>Have no idea what I’m talking about? Not sure if you care? If you use these base R functions: <code>subset()</code>, <code>apply()</code>, <code>[sl]apply()</code>, <code>tapply()</code>, <code>aggregate()</code>, <code>split()</code>, <code>do.call()</code>, <code>with()</code>, <code>within()</code>, then you should keep reading. Also, if you use <code>for()</code> loops a lot, you might enjoy learning other ways to iterate over rows or groups of rows or variables in a data frame.</p>
<div id="load-dplyr-and-gapminder" class="section level3">
<h3><span class="header-section-number">6.1.1</span> Load dplyr and gapminder</h3>
<p>I choose to load the tidyverse, which will load dplyr, among other packages we use incidentally below.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb45-2"><a href="#cb45-2"></a><span class="co">#&gt; -- Attaching packages ------------------</span></span>
<span id="cb45-3"><a href="#cb45-3"></a><span class="co">#&gt; v ggplot2 3.3.2     v purrr   0.3.4</span></span>
<span id="cb45-4"><a href="#cb45-4"></a><span class="co">#&gt; v tibble  3.0.3     v dplyr   1.0.2</span></span>
<span id="cb45-5"><a href="#cb45-5"></a><span class="co">#&gt; v tidyr   1.1.2     v stringr 1.4.0</span></span>
<span id="cb45-6"><a href="#cb45-6"></a><span class="co">#&gt; v readr   1.3.1     v forcats 0.5.0</span></span>
<span id="cb45-7"><a href="#cb45-7"></a><span class="co">#&gt; -- Conflicts -- tidyverse_conflicts() --</span></span>
<span id="cb45-8"><a href="#cb45-8"></a><span class="co">#&gt; x dplyr::filter() masks stats::filter()</span></span>
<span id="cb45-9"><a href="#cb45-9"></a><span class="co">#&gt; x dplyr::lag()    masks stats::lag()</span></span></code></pre></div>
<p>Also load gapminder.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a><span class="kw">library</span>(gapminder)</span></code></pre></div>
</div>
<div id="say-hello-to-the-gapminder-tibble" class="section level3">
<h3><span class="header-section-number">6.1.2</span> Say hello to the <code>gapminder</code> tibble</h3>
<p>The <code>gapminder</code> data frame is a special kind of data frame: a tibble.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a>gapminder</span>
<span id="cb47-2"><a href="#cb47-2"></a><span class="co">#&gt; # A tibble: 1,704 x 6</span></span>
<span id="cb47-3"><a href="#cb47-3"></a><span class="co">#&gt;    country     continent  year lifeExp      pop gdpPercap</span></span>
<span id="cb47-4"><a href="#cb47-4"></a><span class="co">#&gt;    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb47-5"><a href="#cb47-5"></a><span class="co">#&gt;  1 Afghanistan Asia       1952    28.8  8425333      779.</span></span>
<span id="cb47-6"><a href="#cb47-6"></a><span class="co">#&gt;  2 Afghanistan Asia       1957    30.3  9240934      821.</span></span>
<span id="cb47-7"><a href="#cb47-7"></a><span class="co">#&gt;  3 Afghanistan Asia       1962    32.0 10267083      853.</span></span>
<span id="cb47-8"><a href="#cb47-8"></a><span class="co">#&gt;  4 Afghanistan Asia       1967    34.0 11537966      836.</span></span>
<span id="cb47-9"><a href="#cb47-9"></a><span class="co">#&gt;  5 Afghanistan Asia       1972    36.1 13079460      740.</span></span>
<span id="cb47-10"><a href="#cb47-10"></a><span class="co">#&gt;  6 Afghanistan Asia       1977    38.4 14880372      786.</span></span>
<span id="cb47-11"><a href="#cb47-11"></a><span class="co">#&gt;  7 Afghanistan Asia       1982    39.9 12881816      978.</span></span>
<span id="cb47-12"><a href="#cb47-12"></a><span class="co">#&gt;  8 Afghanistan Asia       1987    40.8 13867957      852.</span></span>
<span id="cb47-13"><a href="#cb47-13"></a><span class="co">#&gt;  9 Afghanistan Asia       1992    41.7 16317921      649.</span></span>
<span id="cb47-14"><a href="#cb47-14"></a><span class="co">#&gt; 10 Afghanistan Asia       1997    41.8 22227415      635.</span></span>
<span id="cb47-15"><a href="#cb47-15"></a><span class="co">#&gt; # ... with 1,694 more rows</span></span></code></pre></div>
<p>It’s tibble-ness is why we get nice compact printing. For a reminder of the problems with base data frame printing, go type <code>iris</code> in the R Console or, better yet, print a data frame to screen that has lots of columns.</p>
<p>Note how <code>gapminder</code>’s <code>class()</code> includes <code>tbl_df</code>; the “tibble” terminology is a nod to this.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a><span class="kw">class</span>(gapminder)</span>
<span id="cb48-2"><a href="#cb48-2"></a><span class="co">#&gt; [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</span></span></code></pre></div>
<p>There will be some functions, like <code>print()</code>, that know about tibbles and do something special. There will others that do not, like <code>summary()</code>. In which case the regular data frame treatment will happen, because every tibble is also a regular data frame.</p>
<p>To turn any data frame into a tibble use <code>as_tibble()</code>:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a><span class="kw">as_tibble</span>(iris)</span>
<span id="cb49-2"><a href="#cb49-2"></a><span class="co">#&gt; # A tibble: 150 x 5</span></span>
<span id="cb49-3"><a href="#cb49-3"></a><span class="co">#&gt;    Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></span>
<span id="cb49-4"><a href="#cb49-4"></a><span class="co">#&gt;           &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt; &lt;fct&gt;  </span></span>
<span id="cb49-5"><a href="#cb49-5"></a><span class="co">#&gt;  1          5.1         3.5          1.4         0.2 setosa </span></span>
<span id="cb49-6"><a href="#cb49-6"></a><span class="co">#&gt;  2          4.9         3            1.4         0.2 setosa </span></span>
<span id="cb49-7"><a href="#cb49-7"></a><span class="co">#&gt;  3          4.7         3.2          1.3         0.2 setosa </span></span>
<span id="cb49-8"><a href="#cb49-8"></a><span class="co">#&gt;  4          4.6         3.1          1.5         0.2 setosa </span></span>
<span id="cb49-9"><a href="#cb49-9"></a><span class="co">#&gt;  5          5           3.6          1.4         0.2 setosa </span></span>
<span id="cb49-10"><a href="#cb49-10"></a><span class="co">#&gt;  6          5.4         3.9          1.7         0.4 setosa </span></span>
<span id="cb49-11"><a href="#cb49-11"></a><span class="co">#&gt;  7          4.6         3.4          1.4         0.3 setosa </span></span>
<span id="cb49-12"><a href="#cb49-12"></a><span class="co">#&gt;  8          5           3.4          1.5         0.2 setosa </span></span>
<span id="cb49-13"><a href="#cb49-13"></a><span class="co">#&gt;  9          4.4         2.9          1.4         0.2 setosa </span></span>
<span id="cb49-14"><a href="#cb49-14"></a><span class="co">#&gt; 10          4.9         3.1          1.5         0.1 setosa </span></span>
<span id="cb49-15"><a href="#cb49-15"></a><span class="co">#&gt; # ... with 140 more rows</span></span></code></pre></div>
</div>
</div>
<div id="think-before-you-create-excerpts-of-your-data" class="section level2">
<h2><span class="header-section-number">6.2</span> Think before you create excerpts of your data …</h2>
<p>If you feel the urge to store a little snippet of your data:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a>(canada &lt;-<span class="st"> </span>gapminder[<span class="dv">241</span><span class="op">:</span><span class="dv">252</span>, ])</span>
<span id="cb50-2"><a href="#cb50-2"></a><span class="co">#&gt; # A tibble: 12 x 6</span></span>
<span id="cb50-3"><a href="#cb50-3"></a><span class="co">#&gt;    country continent  year lifeExp      pop gdpPercap</span></span>
<span id="cb50-4"><a href="#cb50-4"></a><span class="co">#&gt;    &lt;fct&gt;   &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb50-5"><a href="#cb50-5"></a><span class="co">#&gt;  1 Canada  Americas   1952    68.8 14785584    11367.</span></span>
<span id="cb50-6"><a href="#cb50-6"></a><span class="co">#&gt;  2 Canada  Americas   1957    70.0 17010154    12490.</span></span>
<span id="cb50-7"><a href="#cb50-7"></a><span class="co">#&gt;  3 Canada  Americas   1962    71.3 18985849    13462.</span></span>
<span id="cb50-8"><a href="#cb50-8"></a><span class="co">#&gt;  4 Canada  Americas   1967    72.1 20819767    16077.</span></span>
<span id="cb50-9"><a href="#cb50-9"></a><span class="co">#&gt;  5 Canada  Americas   1972    72.9 22284500    18971.</span></span>
<span id="cb50-10"><a href="#cb50-10"></a><span class="co">#&gt;  6 Canada  Americas   1977    74.2 23796400    22091.</span></span>
<span id="cb50-11"><a href="#cb50-11"></a><span class="co">#&gt;  7 Canada  Americas   1982    75.8 25201900    22899.</span></span>
<span id="cb50-12"><a href="#cb50-12"></a><span class="co">#&gt;  8 Canada  Americas   1987    76.9 26549700    26627.</span></span>
<span id="cb50-13"><a href="#cb50-13"></a><span class="co">#&gt;  9 Canada  Americas   1992    78.0 28523502    26343.</span></span>
<span id="cb50-14"><a href="#cb50-14"></a><span class="co">#&gt; 10 Canada  Americas   1997    78.6 30305843    28955.</span></span>
<span id="cb50-15"><a href="#cb50-15"></a><span class="co">#&gt; 11 Canada  Americas   2002    79.8 31902268    33329.</span></span>
<span id="cb50-16"><a href="#cb50-16"></a><span class="co">#&gt; 12 Canada  Americas   2007    80.7 33390141    36319.</span></span></code></pre></div>
<p>Stop and ask yourself …</p>
<blockquote>
<p>Do I want to create mini datasets for each level of some factor (or unique combination of several factors) … in order to compute or graph something?</p>
</blockquote>
<p>If YES, <strong>use proper data aggregation techniques</strong> or faceting in ggplot2 – <strong>don’t subset the data</strong>. Or, more realistic, only subset the data as a temporary measure while you develop your elegant code for computing on or visualizing these data subsets.</p>
<p>If NO, then maybe you really do need to store a copy of a subset of the data. But seriously consider whether you can achieve your goals by simply using the <code>subset =</code> argument of, e.g., the <code>lm()</code> function, to limit computation to your excerpt of choice. Lots of functions offer a <code>subset =</code> argument!</p>
<p>Copies and excerpts of your data clutter your workspace, invite mistakes, and sow general confusion. Avoid whenever possible.</p>
<p>Reality can also lie somewhere in between. You will find the workflows presented below can help you accomplish your goals with minimal creation of temporary, intermediate objects.</p>
</div>
<div id="use-filter-to-subset-data-row-wise" class="section level2">
<h2><span class="header-section-number">6.3</span> Use <code>filter()</code> to subset data row-wise</h2>
<p><code>filter()</code> takes logical expressions and returns the rows for which all are <code>TRUE</code>.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a><span class="kw">filter</span>(gapminder, lifeExp <span class="op">&lt;</span><span class="st"> </span><span class="dv">29</span>)</span>
<span id="cb51-2"><a href="#cb51-2"></a><span class="co">#&gt; # A tibble: 2 x 6</span></span>
<span id="cb51-3"><a href="#cb51-3"></a><span class="co">#&gt;   country     continent  year lifeExp     pop gdpPercap</span></span>
<span id="cb51-4"><a href="#cb51-4"></a><span class="co">#&gt;   &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb51-5"><a href="#cb51-5"></a><span class="co">#&gt; 1 Afghanistan Asia       1952    28.8 8425333      779.</span></span>
<span id="cb51-6"><a href="#cb51-6"></a><span class="co">#&gt; 2 Rwanda      Africa     1992    23.6 7290203      737.</span></span>
<span id="cb51-7"><a href="#cb51-7"></a><span class="kw">filter</span>(gapminder, country <span class="op">==</span><span class="st"> &quot;Rwanda&quot;</span>, year <span class="op">&gt;</span><span class="st"> </span><span class="dv">1979</span>)</span>
<span id="cb51-8"><a href="#cb51-8"></a><span class="co">#&gt; # A tibble: 6 x 6</span></span>
<span id="cb51-9"><a href="#cb51-9"></a><span class="co">#&gt;   country continent  year lifeExp     pop gdpPercap</span></span>
<span id="cb51-10"><a href="#cb51-10"></a><span class="co">#&gt;   &lt;fct&gt;   &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb51-11"><a href="#cb51-11"></a><span class="co">#&gt; 1 Rwanda  Africa     1982    46.2 5507565      882.</span></span>
<span id="cb51-12"><a href="#cb51-12"></a><span class="co">#&gt; 2 Rwanda  Africa     1987    44.0 6349365      848.</span></span>
<span id="cb51-13"><a href="#cb51-13"></a><span class="co">#&gt; 3 Rwanda  Africa     1992    23.6 7290203      737.</span></span>
<span id="cb51-14"><a href="#cb51-14"></a><span class="co">#&gt; 4 Rwanda  Africa     1997    36.1 7212583      590.</span></span>
<span id="cb51-15"><a href="#cb51-15"></a><span class="co">#&gt; 5 Rwanda  Africa     2002    43.4 7852401      786.</span></span>
<span id="cb51-16"><a href="#cb51-16"></a><span class="co">#&gt; 6 Rwanda  Africa     2007    46.2 8860588      863.</span></span>
<span id="cb51-17"><a href="#cb51-17"></a><span class="kw">filter</span>(gapminder, country <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Rwanda&quot;</span>, <span class="st">&quot;Afghanistan&quot;</span>))</span>
<span id="cb51-18"><a href="#cb51-18"></a><span class="co">#&gt; # A tibble: 24 x 6</span></span>
<span id="cb51-19"><a href="#cb51-19"></a><span class="co">#&gt;    country     continent  year lifeExp      pop gdpPercap</span></span>
<span id="cb51-20"><a href="#cb51-20"></a><span class="co">#&gt;    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb51-21"><a href="#cb51-21"></a><span class="co">#&gt;  1 Afghanistan Asia       1952    28.8  8425333      779.</span></span>
<span id="cb51-22"><a href="#cb51-22"></a><span class="co">#&gt;  2 Afghanistan Asia       1957    30.3  9240934      821.</span></span>
<span id="cb51-23"><a href="#cb51-23"></a><span class="co">#&gt;  3 Afghanistan Asia       1962    32.0 10267083      853.</span></span>
<span id="cb51-24"><a href="#cb51-24"></a><span class="co">#&gt;  4 Afghanistan Asia       1967    34.0 11537966      836.</span></span>
<span id="cb51-25"><a href="#cb51-25"></a><span class="co">#&gt;  5 Afghanistan Asia       1972    36.1 13079460      740.</span></span>
<span id="cb51-26"><a href="#cb51-26"></a><span class="co">#&gt;  6 Afghanistan Asia       1977    38.4 14880372      786.</span></span>
<span id="cb51-27"><a href="#cb51-27"></a><span class="co">#&gt;  7 Afghanistan Asia       1982    39.9 12881816      978.</span></span>
<span id="cb51-28"><a href="#cb51-28"></a><span class="co">#&gt;  8 Afghanistan Asia       1987    40.8 13867957      852.</span></span>
<span id="cb51-29"><a href="#cb51-29"></a><span class="co">#&gt;  9 Afghanistan Asia       1992    41.7 16317921      649.</span></span>
<span id="cb51-30"><a href="#cb51-30"></a><span class="co">#&gt; 10 Afghanistan Asia       1997    41.8 22227415      635.</span></span>
<span id="cb51-31"><a href="#cb51-31"></a><span class="co">#&gt; # ... with 14 more rows</span></span></code></pre></div>
<p>Compare with some base R code to accomplish the same things:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a>gapminder[gapminder<span class="op">$</span>lifeExp <span class="op">&lt;</span><span class="st"> </span><span class="dv">29</span>, ] <span class="co">## repeat `gapminder`, [i, j] indexing is distracting</span></span>
<span id="cb52-2"><a href="#cb52-2"></a><span class="kw">subset</span>(gapminder, country <span class="op">==</span><span class="st"> &quot;Rwanda&quot;</span>) <span class="co">## almost same as filter; quite nice actually</span></span></code></pre></div>
<p>Under no circumstances should you subset your data the way I did at first:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a>excerpt &lt;-<span class="st"> </span>gapminder[<span class="dv">241</span><span class="op">:</span><span class="dv">252</span>, ]</span></code></pre></div>
<p>Why is this a terrible idea?</p>
<ul>
<li>It is not self-documenting. What is so special about rows 241 through 252?</li>
<li>It is fragile. This line of code will produce different results if someone changes the row order of <code>gapminder</code>, e.g. sorts the data earlier in the script.</li>
</ul>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1"></a><span class="kw">filter</span>(gapminder, country <span class="op">==</span><span class="st"> &quot;Canada&quot;</span>)</span></code></pre></div>
<p>This call explains itself and is fairly robust.</p>
</div>
<div id="meet-the-new-pipe-operator" class="section level2">
<h2><span class="header-section-number">6.4</span> Meet the new pipe operator</h2>
<p>Before we go any further, we should exploit the new pipe operator that the tidyverse imports from the <a href="https://magrittr.tidyverse.org">magrittr</a> package by Stefan Bache. This is going to change your data analytical life. You no longer need to enact multi-operation commands by nesting them inside each other, like so many <a href="https://en.wikipedia.org/wiki/Matryoshka_doll">Russian nesting dolls</a>. This new syntax leads to code that is much easier to write and to read.</p>
<p>Here’s what it looks like: <code>%&gt;%</code>. The RStudio keyboard shortcut: Ctrl+Shift+M (Windows), Cmd+Shift+M (Mac).</p>
<p>Let’s demo then I’ll explain.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a>gapminder <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()</span>
<span id="cb55-2"><a href="#cb55-2"></a><span class="co">#&gt; # A tibble: 6 x 6</span></span>
<span id="cb55-3"><a href="#cb55-3"></a><span class="co">#&gt;   country     continent  year lifeExp      pop gdpPercap</span></span>
<span id="cb55-4"><a href="#cb55-4"></a><span class="co">#&gt;   &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb55-5"><a href="#cb55-5"></a><span class="co">#&gt; 1 Afghanistan Asia       1952    28.8  8425333      779.</span></span>
<span id="cb55-6"><a href="#cb55-6"></a><span class="co">#&gt; 2 Afghanistan Asia       1957    30.3  9240934      821.</span></span>
<span id="cb55-7"><a href="#cb55-7"></a><span class="co">#&gt; 3 Afghanistan Asia       1962    32.0 10267083      853.</span></span>
<span id="cb55-8"><a href="#cb55-8"></a><span class="co">#&gt; 4 Afghanistan Asia       1967    34.0 11537966      836.</span></span>
<span id="cb55-9"><a href="#cb55-9"></a><span class="co">#&gt; 5 Afghanistan Asia       1972    36.1 13079460      740.</span></span>
<span id="cb55-10"><a href="#cb55-10"></a><span class="co">#&gt; 6 Afghanistan Asia       1977    38.4 14880372      786.</span></span></code></pre></div>
<p>This is equivalent to <code>head(gapminder)</code>. The pipe operator takes the thing on the left-hand-side and <strong>pipes</strong> it into the function call on the right-hand-side – literally, drops it in as the first argument.</p>
<p>Never fear, you can still specify other arguments to this function! To see the first 3 rows of <code>gapminder</code>, we could say <code>head(gapminder, 3)</code> or this:</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1"></a>gapminder <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dv">3</span>)</span>
<span id="cb56-2"><a href="#cb56-2"></a><span class="co">#&gt; # A tibble: 3 x 6</span></span>
<span id="cb56-3"><a href="#cb56-3"></a><span class="co">#&gt;   country     continent  year lifeExp      pop gdpPercap</span></span>
<span id="cb56-4"><a href="#cb56-4"></a><span class="co">#&gt;   &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb56-5"><a href="#cb56-5"></a><span class="co">#&gt; 1 Afghanistan Asia       1952    28.8  8425333      779.</span></span>
<span id="cb56-6"><a href="#cb56-6"></a><span class="co">#&gt; 2 Afghanistan Asia       1957    30.3  9240934      821.</span></span>
<span id="cb56-7"><a href="#cb56-7"></a><span class="co">#&gt; 3 Afghanistan Asia       1962    32.0 10267083      853.</span></span></code></pre></div>
<p>I’ve advised you to think “gets” whenever you see the assignment operator, <code>&lt;-</code>. Similarly, you should think “then” whenever you see the pipe operator, <code>%&gt;%</code>.</p>
<p>You are probably not impressed yet, but the magic will soon happen.</p>
</div>
<div id="use-select-to-subset-the-data-on-variables-or-columns." class="section level2">
<h2><span class="header-section-number">6.5</span> Use <code>select()</code> to subset the data on variables or columns.</h2>
<p>Back to dplyr….</p>
<p>Use <code>select()</code> to subset the data on variables or columns. Here’s a conventional call:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a><span class="kw">select</span>(gapminder, year, lifeExp)</span>
<span id="cb57-2"><a href="#cb57-2"></a><span class="co">#&gt; # A tibble: 1,704 x 2</span></span>
<span id="cb57-3"><a href="#cb57-3"></a><span class="co">#&gt;     year lifeExp</span></span>
<span id="cb57-4"><a href="#cb57-4"></a><span class="co">#&gt;    &lt;int&gt;   &lt;dbl&gt;</span></span>
<span id="cb57-5"><a href="#cb57-5"></a><span class="co">#&gt;  1  1952    28.8</span></span>
<span id="cb57-6"><a href="#cb57-6"></a><span class="co">#&gt;  2  1957    30.3</span></span>
<span id="cb57-7"><a href="#cb57-7"></a><span class="co">#&gt;  3  1962    32.0</span></span>
<span id="cb57-8"><a href="#cb57-8"></a><span class="co">#&gt;  4  1967    34.0</span></span>
<span id="cb57-9"><a href="#cb57-9"></a><span class="co">#&gt;  5  1972    36.1</span></span>
<span id="cb57-10"><a href="#cb57-10"></a><span class="co">#&gt;  6  1977    38.4</span></span>
<span id="cb57-11"><a href="#cb57-11"></a><span class="co">#&gt;  7  1982    39.9</span></span>
<span id="cb57-12"><a href="#cb57-12"></a><span class="co">#&gt;  8  1987    40.8</span></span>
<span id="cb57-13"><a href="#cb57-13"></a><span class="co">#&gt;  9  1992    41.7</span></span>
<span id="cb57-14"><a href="#cb57-14"></a><span class="co">#&gt; 10  1997    41.8</span></span>
<span id="cb57-15"><a href="#cb57-15"></a><span class="co">#&gt; # ... with 1,694 more rows</span></span></code></pre></div>
<p>And here’s the same operation, but written with the pipe operator and piped through <code>head()</code>:</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1"></a>gapminder <span class="op">%&gt;%</span></span>
<span id="cb58-2"><a href="#cb58-2"></a><span class="st">  </span><span class="kw">select</span>(year, lifeExp) <span class="op">%&gt;%</span></span>
<span id="cb58-3"><a href="#cb58-3"></a><span class="st">  </span><span class="kw">head</span>(<span class="dv">4</span>)</span>
<span id="cb58-4"><a href="#cb58-4"></a><span class="co">#&gt; # A tibble: 4 x 2</span></span>
<span id="cb58-5"><a href="#cb58-5"></a><span class="co">#&gt;    year lifeExp</span></span>
<span id="cb58-6"><a href="#cb58-6"></a><span class="co">#&gt;   &lt;int&gt;   &lt;dbl&gt;</span></span>
<span id="cb58-7"><a href="#cb58-7"></a><span class="co">#&gt; 1  1952    28.8</span></span>
<span id="cb58-8"><a href="#cb58-8"></a><span class="co">#&gt; 2  1957    30.3</span></span>
<span id="cb58-9"><a href="#cb58-9"></a><span class="co">#&gt; 3  1962    32.0</span></span>
<span id="cb58-10"><a href="#cb58-10"></a><span class="co">#&gt; 4  1967    34.0</span></span></code></pre></div>
<p>Think: “Take <code>gapminder</code>, then select the variables year and lifeExp, then show the first 4 rows.”</p>
</div>
<div id="revel-in-the-convenience" class="section level2">
<h2><span class="header-section-number">6.6</span> Revel in the convenience</h2>
<p>Here’s the data for Cambodia, but only certain variables:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1"></a>gapminder <span class="op">%&gt;%</span></span>
<span id="cb59-2"><a href="#cb59-2"></a><span class="st">  </span><span class="kw">filter</span>(country <span class="op">==</span><span class="st"> &quot;Cambodia&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb59-3"><a href="#cb59-3"></a><span class="st">  </span><span class="kw">select</span>(year, lifeExp)</span>
<span id="cb59-4"><a href="#cb59-4"></a><span class="co">#&gt; # A tibble: 12 x 2</span></span>
<span id="cb59-5"><a href="#cb59-5"></a><span class="co">#&gt;     year lifeExp</span></span>
<span id="cb59-6"><a href="#cb59-6"></a><span class="co">#&gt;    &lt;int&gt;   &lt;dbl&gt;</span></span>
<span id="cb59-7"><a href="#cb59-7"></a><span class="co">#&gt;  1  1952    39.4</span></span>
<span id="cb59-8"><a href="#cb59-8"></a><span class="co">#&gt;  2  1957    41.4</span></span>
<span id="cb59-9"><a href="#cb59-9"></a><span class="co">#&gt;  3  1962    43.4</span></span>
<span id="cb59-10"><a href="#cb59-10"></a><span class="co">#&gt;  4  1967    45.4</span></span>
<span id="cb59-11"><a href="#cb59-11"></a><span class="co">#&gt;  5  1972    40.3</span></span>
<span id="cb59-12"><a href="#cb59-12"></a><span class="co">#&gt;  6  1977    31.2</span></span>
<span id="cb59-13"><a href="#cb59-13"></a><span class="co">#&gt;  7  1982    51.0</span></span>
<span id="cb59-14"><a href="#cb59-14"></a><span class="co">#&gt;  8  1987    53.9</span></span>
<span id="cb59-15"><a href="#cb59-15"></a><span class="co">#&gt;  9  1992    55.8</span></span>
<span id="cb59-16"><a href="#cb59-16"></a><span class="co">#&gt; 10  1997    56.5</span></span>
<span id="cb59-17"><a href="#cb59-17"></a><span class="co">#&gt; 11  2002    56.8</span></span>
<span id="cb59-18"><a href="#cb59-18"></a><span class="co">#&gt; 12  2007    59.7</span></span></code></pre></div>
<p>and what a typical base R call would look like:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1"></a>gapminder[gapminder<span class="op">$</span>country <span class="op">==</span><span class="st"> &quot;Cambodia&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;lifeExp&quot;</span>)]</span>
<span id="cb60-2"><a href="#cb60-2"></a><span class="co">#&gt; # A tibble: 12 x 2</span></span>
<span id="cb60-3"><a href="#cb60-3"></a><span class="co">#&gt;     year lifeExp</span></span>
<span id="cb60-4"><a href="#cb60-4"></a><span class="co">#&gt;    &lt;int&gt;   &lt;dbl&gt;</span></span>
<span id="cb60-5"><a href="#cb60-5"></a><span class="co">#&gt;  1  1952    39.4</span></span>
<span id="cb60-6"><a href="#cb60-6"></a><span class="co">#&gt;  2  1957    41.4</span></span>
<span id="cb60-7"><a href="#cb60-7"></a><span class="co">#&gt;  3  1962    43.4</span></span>
<span id="cb60-8"><a href="#cb60-8"></a><span class="co">#&gt;  4  1967    45.4</span></span>
<span id="cb60-9"><a href="#cb60-9"></a><span class="co">#&gt;  5  1972    40.3</span></span>
<span id="cb60-10"><a href="#cb60-10"></a><span class="co">#&gt;  6  1977    31.2</span></span>
<span id="cb60-11"><a href="#cb60-11"></a><span class="co">#&gt;  7  1982    51.0</span></span>
<span id="cb60-12"><a href="#cb60-12"></a><span class="co">#&gt;  8  1987    53.9</span></span>
<span id="cb60-13"><a href="#cb60-13"></a><span class="co">#&gt;  9  1992    55.8</span></span>
<span id="cb60-14"><a href="#cb60-14"></a><span class="co">#&gt; 10  1997    56.5</span></span>
<span id="cb60-15"><a href="#cb60-15"></a><span class="co">#&gt; 11  2002    56.8</span></span>
<span id="cb60-16"><a href="#cb60-16"></a><span class="co">#&gt; 12  2007    59.7</span></span></code></pre></div>
</div>
<div id="pure-predictable-pipeable" class="section level2">
<h2><span class="header-section-number">6.7</span> Pure, predictable, pipeable</h2>
<p>We’ve barely scratched the surface of dplyr but I want to point out key principles you may start to appreciate. If you’re new to R or “programming with data”, feel free skip this section and <a href="#dplyr-single">move on</a>.</p>
<p>dplyr’s verbs, such as <code>filter()</code> and <code>select()</code>, are what’s called <a href="https://en.wikipedia.org/wiki/Pure_function">pure functions</a>. To quote from Wickham’s <a href="http://adv-r.had.co.nz/Functions.html">Advanced R Programming book</a> <span class="citation">(<a href="#ref-wickham2015a" role="doc-biblioref">2015</a>)</span>:</p>
<blockquote>
<p>The functions that are the easiest to understand and reason about are pure functions: functions that always map the same input to the same output and have no other impact on the workspace. In other words, pure functions have no side effects: they don’t affect the state of the world in any way apart from the value they return.</p>
</blockquote>
<p>In fact, these verbs are a special case of pure functions: they take the same flavor of object as input and output. Namely, a data frame or one of the other data receptacles dplyr supports.</p>
<p>And finally, the data is <strong>always</strong> the very first argument of the verb functions.</p>
<p>This set of deliberate design choices, together with the new pipe operator, produces a highly effective, low friction <a href="http://adv-r.had.co.nz/dsl.html">domain-specific language</a> for data analysis.</p>
<p>Go to the next Chapter, <a href="#dplyr-single">dplyr functions for a single dataset</a>, for more dplyr!</p>
</div>
<div id="resources" class="section level2">
<h2><span class="header-section-number">6.8</span> Resources</h2>
<p>dplyr official stuff:</p>
<ul>
<li>Package home <a href="https://CRAN.R-project.org/package=dplyr">on CRAN</a>.
<ul>
<li>Note there are several vignettes, with the <a href="https://cran.r-project.org/web/packages/dplyr/vignettes/dplyr.html">introduction</a> being the most relevant right now.</li>
<li>The <a href="https://cran.r-project.org/web/packages/dplyr/vignettes/window-functions.html">one on window functions</a> will also be interesting to you now.</li>
</ul></li>
<li>Development home <a href="https://github.com/hadley/dplyr">on GitHub</a>.</li>
<li><a href="https://www.dropbox.com/sh/i8qnluwmuieicxc/AAAgt9tIKoIm7WZKIyK25lh6a">Tutorial HW delivered</a> (note this links to a DropBox folder) at useR! 2014 conference.</li>
</ul>
<p><a href="https://github.com/rstudio/cheatsheets/raw/master/data-transformation.pdf">RStudio Data Transformation Cheat Sheet</a>, covering dplyr. Remember you can get to these via <em>Help &gt; Cheatsheets.</em></p>
<p><a href="https://r4ds.had.co.nz/transform.html">Data transformation</a> chapter of <a href="https://r4ds.had.co.nz">R for Data Science</a> <span class="citation">(Wickham and Grolemund <a href="#ref-wickham2016" role="doc-biblioref">2016</a>)</span>.</p>
<!--TODO: This should probably be updated with something more recent-->
<p><a href="https://github.com/tjmahr/MadR_Pipelines">Excellent slides</a> on pipelines and dplyr by TJ Mahr, talk given to the Madison R Users Group.</p>
<!--TODO: This should probably be updated with something more recent-->
<p>Blog post <a href="https://www.dataschool.io/dplyr-tutorial-for-faster-data-manipulation-in-r/">Hands-on dplyr tutorial for faster data manipulation in R</a> by Data School, that includes a link to an R Markdown document and links to videos.</p>
<p>Chapter @ref(join-cheatsheet): cheatsheet I made for dplyr join functions (not relevant yet but soon).</p>
<!--RStudio Links-->
<!--HappyGitWithR Links-->
<!--Package Links-->
<!--Shiny links-->
<!--Publications-->
<!--R Documentation-->
<!--Wikipedia Links-->
<!--Misc. Links-->
<!--chapter:end:006_dplyr-intro.Rmd-->
</div>
</div>
<div id="dplyr-single" class="section level1">
<h1><span class="header-section-number">7</span> Single table dplyr functions</h1>
<!--Original content: https://stat545.com/block010_dplyr-end-single-table.html-->
<div id="where-were-we" class="section level2">
<h2><span class="header-section-number">7.1</span> Where were we?</h2>
<p>In Chapter @ref(dplyr-intro), <a href="#dplyr-intro">Introduction to dplyr</a>, we used two very important verbs and an operator:</p>
<ul>
<li><code>filter()</code> for subsetting data with row logic</li>
<li><code>select()</code> for subsetting data variable- or column-wise</li>
<li>the pipe operator <code>%&gt;%</code>, which feeds the LHS as the first argument to the expression on the RHS</li>
</ul>
<p>We also discussed dplyr’s role inside the tidyverse and tibbles:</p>
<ul>
<li>dplyr is a core package in the <a href="https://github.com/hadley/tidyverse">tidyverse</a> meta-package. Since we often make incidental usage of the others, we will load dplyr and the others via <code>library(tidyverse)</code>.</li>
<li>The tidyverse embraces a special flavor of data frame, called a tibble. The <code>gapminder</code> dataset is stored as a tibble.</li>
</ul>
</div>
<div id="load-dplyr-and-gapminder-1" class="section level2">
<h2><span class="header-section-number">7.2</span> Load dplyr and gapminder</h2>
<p>I choose to load the tidyverse, which will load dplyr, among other packages we use incidentally below.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb61-2"><a href="#cb61-2"></a><span class="co">#&gt; -- Attaching packages ------------------</span></span>
<span id="cb61-3"><a href="#cb61-3"></a><span class="co">#&gt; v ggplot2 3.3.2     v purrr   0.3.4</span></span>
<span id="cb61-4"><a href="#cb61-4"></a><span class="co">#&gt; v tibble  3.0.3     v dplyr   1.0.2</span></span>
<span id="cb61-5"><a href="#cb61-5"></a><span class="co">#&gt; v tidyr   1.1.2     v stringr 1.4.0</span></span>
<span id="cb61-6"><a href="#cb61-6"></a><span class="co">#&gt; v readr   1.3.1     v forcats 0.5.0</span></span>
<span id="cb61-7"><a href="#cb61-7"></a><span class="co">#&gt; -- Conflicts -- tidyverse_conflicts() --</span></span>
<span id="cb61-8"><a href="#cb61-8"></a><span class="co">#&gt; x dplyr::filter() masks stats::filter()</span></span>
<span id="cb61-9"><a href="#cb61-9"></a><span class="co">#&gt; x dplyr::lag()    masks stats::lag()</span></span></code></pre></div>
<p>Also load <code>gapminder.</code></p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1"></a><span class="kw">library</span>(gapminder)</span></code></pre></div>
</div>
<div id="create-a-copy-of-gapminder" class="section level2">
<h2><span class="header-section-number">7.3</span> Create a copy of <code>gapminder</code></h2>
<p>We’re going to make changes to the <code>gapminder</code> tibble. To eliminate any fear that you’re damaging the data that comes with the package, we create an explicit copy of <code>gapminder</code> for our experiments.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1"></a>(my_gap &lt;-<span class="st"> </span>gapminder)</span>
<span id="cb63-2"><a href="#cb63-2"></a><span class="co">#&gt; # A tibble: 1,704 x 6</span></span>
<span id="cb63-3"><a href="#cb63-3"></a><span class="co">#&gt;    country     continent  year lifeExp      pop gdpPercap</span></span>
<span id="cb63-4"><a href="#cb63-4"></a><span class="co">#&gt;    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb63-5"><a href="#cb63-5"></a><span class="co">#&gt;  1 Afghanistan Asia       1952    28.8  8425333      779.</span></span>
<span id="cb63-6"><a href="#cb63-6"></a><span class="co">#&gt;  2 Afghanistan Asia       1957    30.3  9240934      821.</span></span>
<span id="cb63-7"><a href="#cb63-7"></a><span class="co">#&gt;  3 Afghanistan Asia       1962    32.0 10267083      853.</span></span>
<span id="cb63-8"><a href="#cb63-8"></a><span class="co">#&gt;  4 Afghanistan Asia       1967    34.0 11537966      836.</span></span>
<span id="cb63-9"><a href="#cb63-9"></a><span class="co">#&gt;  5 Afghanistan Asia       1972    36.1 13079460      740.</span></span>
<span id="cb63-10"><a href="#cb63-10"></a><span class="co">#&gt;  6 Afghanistan Asia       1977    38.4 14880372      786.</span></span>
<span id="cb63-11"><a href="#cb63-11"></a><span class="co">#&gt;  7 Afghanistan Asia       1982    39.9 12881816      978.</span></span>
<span id="cb63-12"><a href="#cb63-12"></a><span class="co">#&gt;  8 Afghanistan Asia       1987    40.8 13867957      852.</span></span>
<span id="cb63-13"><a href="#cb63-13"></a><span class="co">#&gt;  9 Afghanistan Asia       1992    41.7 16317921      649.</span></span>
<span id="cb63-14"><a href="#cb63-14"></a><span class="co">#&gt; 10 Afghanistan Asia       1997    41.8 22227415      635.</span></span>
<span id="cb63-15"><a href="#cb63-15"></a><span class="co">#&gt; # ... with 1,694 more rows</span></span></code></pre></div>
<p><strong>Pay close attention</strong> to when we evaluate statements but let the output just print to screen:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1"></a><span class="co">## let output print to screen, but do not store</span></span>
<span id="cb64-2"><a href="#cb64-2"></a>my_gap <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(country <span class="op">==</span><span class="st"> &quot;Canada&quot;</span>)</span></code></pre></div>
<p>… versus when we assign the output to an object, possibly overwriting an existing object.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1"></a><span class="co">## store the output as an R object</span></span>
<span id="cb65-2"><a href="#cb65-2"></a>my_precious &lt;-<span class="st"> </span>my_gap <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(country <span class="op">==</span><span class="st"> &quot;Canada&quot;</span>)</span></code></pre></div>
</div>
<div id="use-mutate-to-add-new-variables" class="section level2">
<h2><span class="header-section-number">7.4</span> Use <code>mutate()</code> to add new variables</h2>
<p>Imagine we wanted to recover each country’s GDP. After all, the Gapminder data has a variable for population and GDP per capita. Let’s multiply them together.</p>
<p><code>mutate()</code> is a function that defines and inserts new variables into a tibble. You can refer to existing variables by name.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1"></a>my_gap <span class="op">%&gt;%</span></span>
<span id="cb66-2"><a href="#cb66-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">gdp =</span> pop <span class="op">*</span><span class="st"> </span>gdpPercap)</span>
<span id="cb66-3"><a href="#cb66-3"></a><span class="co">#&gt; # A tibble: 1,704 x 7</span></span>
<span id="cb66-4"><a href="#cb66-4"></a><span class="co">#&gt;    country     continent  year lifeExp      pop gdpPercap          gdp</span></span>
<span id="cb66-5"><a href="#cb66-5"></a><span class="co">#&gt;    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;        &lt;dbl&gt;</span></span>
<span id="cb66-6"><a href="#cb66-6"></a><span class="co">#&gt;  1 Afghanistan Asia       1952    28.8  8425333      779.  6567086330.</span></span>
<span id="cb66-7"><a href="#cb66-7"></a><span class="co">#&gt;  2 Afghanistan Asia       1957    30.3  9240934      821.  7585448670.</span></span>
<span id="cb66-8"><a href="#cb66-8"></a><span class="co">#&gt;  3 Afghanistan Asia       1962    32.0 10267083      853.  8758855797.</span></span>
<span id="cb66-9"><a href="#cb66-9"></a><span class="co">#&gt;  4 Afghanistan Asia       1967    34.0 11537966      836.  9648014150.</span></span>
<span id="cb66-10"><a href="#cb66-10"></a><span class="co">#&gt;  5 Afghanistan Asia       1972    36.1 13079460      740.  9678553274.</span></span>
<span id="cb66-11"><a href="#cb66-11"></a><span class="co">#&gt;  6 Afghanistan Asia       1977    38.4 14880372      786. 11697659231.</span></span>
<span id="cb66-12"><a href="#cb66-12"></a><span class="co">#&gt;  7 Afghanistan Asia       1982    39.9 12881816      978. 12598563401.</span></span>
<span id="cb66-13"><a href="#cb66-13"></a><span class="co">#&gt;  8 Afghanistan Asia       1987    40.8 13867957      852. 11820990309.</span></span>
<span id="cb66-14"><a href="#cb66-14"></a><span class="co">#&gt;  9 Afghanistan Asia       1992    41.7 16317921      649. 10595901589.</span></span>
<span id="cb66-15"><a href="#cb66-15"></a><span class="co">#&gt; 10 Afghanistan Asia       1997    41.8 22227415      635. 14121995875.</span></span>
<span id="cb66-16"><a href="#cb66-16"></a><span class="co">#&gt; # ... with 1,694 more rows</span></span></code></pre></div>
<p>Hmmmm … those GDP numbers are almost uselessly large and abstract. Consider the <a href="https://fivethirtyeight.com/features/xkcd-randall-munroe-qanda-what-if/">advice of Randall Munroe of xkcd</a>:</p>
<blockquote>
<p>One thing that bothers me is large numbers presented without context… ‘If I added a zero to this number, would the sentence containing it mean something different to me?’ If the answer is ‘no,’ maybe the number has no business being in the sentence in the first place."</p>
</blockquote>
<p>Maybe it would be more meaningful to consumers of my tables and figures to stick with GDP per capita. But what if I reported GDP per capita, <em>relative to some benchmark country</em>. Since Canada is my adopted home, I’ll go with that.</p>
<p>I need to create a new variable that is <code>gdpPercap</code> divided by Canadian <code>gdpPercap</code>, taking care that I always divide two numbers that pertain to the same year.</p>
<p>How I achieve this:</p>
<ol style="list-style-type: decimal">
<li>Filter down to the rows for Canada.</li>
<li>Create a new temporary variable in <code>my_gap</code>:
<ol style="list-style-type: lower-roman">
<li>Extract the <code>gdpPercap</code> variable from the Canadian data.</li>
<li>Replicate it once per country in the dataset, so it has the right length.</li>
</ol></li>
<li>Divide raw <code>gdpPercap</code> by this Canadian figure.</li>
<li>Discard the temporary variable of replicated Canadian <code>gdpPercap</code>.</li>
</ol>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1"></a>ctib &lt;-<span class="st"> </span>my_gap <span class="op">%&gt;%</span></span>
<span id="cb67-2"><a href="#cb67-2"></a><span class="st">  </span><span class="kw">filter</span>(country <span class="op">==</span><span class="st"> &quot;Canada&quot;</span>)</span>
<span id="cb67-3"><a href="#cb67-3"></a><span class="co">## this is a semi-dangerous way to add this variable</span></span>
<span id="cb67-4"><a href="#cb67-4"></a><span class="co">## I&#39;d prefer to join on year, but we haven&#39;t covered joins yet</span></span>
<span id="cb67-5"><a href="#cb67-5"></a>my_gap &lt;-<span class="st"> </span>my_gap <span class="op">%&gt;%</span></span>
<span id="cb67-6"><a href="#cb67-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">tmp =</span> <span class="kw">rep</span>(ctib<span class="op">$</span>gdpPercap, <span class="kw">nlevels</span>(country)),</span>
<span id="cb67-7"><a href="#cb67-7"></a>         <span class="dt">gdpPercapRel =</span> gdpPercap <span class="op">/</span><span class="st"> </span>tmp,</span>
<span id="cb67-8"><a href="#cb67-8"></a>         <span class="dt">tmp =</span> <span class="ot">NULL</span>)</span></code></pre></div>
<p>Note that, <code>mutate()</code> builds new variables sequentially so you can reference earlier ones (like <code>tmp</code>) when defining later ones (like <code>gdpPercapRel</code>). Also, you can get rid of a variable by setting it to <code>NULL</code>.</p>
<p>How could we sanity check that this worked? The Canadian values for <code>gdpPercapRel</code> better all be 1!</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1"></a>my_gap <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb68-2"><a href="#cb68-2"></a><span class="st">  </span><span class="kw">filter</span>(country <span class="op">==</span><span class="st"> &quot;Canada&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb68-3"><a href="#cb68-3"></a><span class="st">  </span><span class="kw">select</span>(country, year, gdpPercapRel)</span>
<span id="cb68-4"><a href="#cb68-4"></a><span class="co">#&gt; # A tibble: 12 x 3</span></span>
<span id="cb68-5"><a href="#cb68-5"></a><span class="co">#&gt;    country  year gdpPercapRel</span></span>
<span id="cb68-6"><a href="#cb68-6"></a><span class="co">#&gt;    &lt;fct&gt;   &lt;int&gt;        &lt;dbl&gt;</span></span>
<span id="cb68-7"><a href="#cb68-7"></a><span class="co">#&gt;  1 Canada   1952            1</span></span>
<span id="cb68-8"><a href="#cb68-8"></a><span class="co">#&gt;  2 Canada   1957            1</span></span>
<span id="cb68-9"><a href="#cb68-9"></a><span class="co">#&gt;  3 Canada   1962            1</span></span>
<span id="cb68-10"><a href="#cb68-10"></a><span class="co">#&gt;  4 Canada   1967            1</span></span>
<span id="cb68-11"><a href="#cb68-11"></a><span class="co">#&gt;  5 Canada   1972            1</span></span>
<span id="cb68-12"><a href="#cb68-12"></a><span class="co">#&gt;  6 Canada   1977            1</span></span>
<span id="cb68-13"><a href="#cb68-13"></a><span class="co">#&gt;  7 Canada   1982            1</span></span>
<span id="cb68-14"><a href="#cb68-14"></a><span class="co">#&gt;  8 Canada   1987            1</span></span>
<span id="cb68-15"><a href="#cb68-15"></a><span class="co">#&gt;  9 Canada   1992            1</span></span>
<span id="cb68-16"><a href="#cb68-16"></a><span class="co">#&gt; 10 Canada   1997            1</span></span>
<span id="cb68-17"><a href="#cb68-17"></a><span class="co">#&gt; 11 Canada   2002            1</span></span>
<span id="cb68-18"><a href="#cb68-18"></a><span class="co">#&gt; 12 Canada   2007            1</span></span></code></pre></div>
<p>I perceive Canada to be a “high GDP” country, so I predict that the distribution of <code>gdpPercapRel</code> is located below 1, possibly even well below. Check your intuition!</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1"></a><span class="kw">summary</span>(my_gap<span class="op">$</span>gdpPercapRel)</span>
<span id="cb69-2"><a href="#cb69-2"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb69-3"><a href="#cb69-3"></a><span class="co">#&gt;    0.01    0.06    0.17    0.33    0.45    9.53</span></span></code></pre></div>
<p>The relative GDP per capita numbers are, in general, well below 1. We see that most of the countries covered by this dataset have substantially lower GDP per capita, relative to Canada, across the entire time period.</p>
<p>Remember: Trust No One. Including (especially?) yourself. Always try to find a way to check that you’ve done what meant to. Prepare to be horrified.</p>
</div>
<div id="use-arrange-to-row-order-data-in-a-principled-way" class="section level2">
<h2><span class="header-section-number">7.5</span> Use <code>arrange()</code> to row-order data in a principled way</h2>
<p><code>arrange()</code> reorders the rows in a data frame. Imagine you wanted this data ordered by year then country, as opposed to by country then year.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1"></a>my_gap <span class="op">%&gt;%</span></span>
<span id="cb70-2"><a href="#cb70-2"></a><span class="st">  </span><span class="kw">arrange</span>(year, country)</span>
<span id="cb70-3"><a href="#cb70-3"></a><span class="co">#&gt; # A tibble: 1,704 x 7</span></span>
<span id="cb70-4"><a href="#cb70-4"></a><span class="co">#&gt;    country     continent  year lifeExp      pop gdpPercap gdpPercapRel</span></span>
<span id="cb70-5"><a href="#cb70-5"></a><span class="co">#&gt;    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;        &lt;dbl&gt;</span></span>
<span id="cb70-6"><a href="#cb70-6"></a><span class="co">#&gt;  1 Afghanistan Asia       1952    28.8  8425333      779.       0.0686</span></span>
<span id="cb70-7"><a href="#cb70-7"></a><span class="co">#&gt;  2 Albania     Europe     1952    55.2  1282697     1601.       0.141 </span></span>
<span id="cb70-8"><a href="#cb70-8"></a><span class="co">#&gt;  3 Algeria     Africa     1952    43.1  9279525     2449.       0.215 </span></span>
<span id="cb70-9"><a href="#cb70-9"></a><span class="co">#&gt;  4 Angola      Africa     1952    30.0  4232095     3521.       0.310 </span></span>
<span id="cb70-10"><a href="#cb70-10"></a><span class="co">#&gt;  5 Argentina   Americas   1952    62.5 17876956     5911.       0.520 </span></span>
<span id="cb70-11"><a href="#cb70-11"></a><span class="co">#&gt;  6 Australia   Oceania    1952    69.1  8691212    10040.       0.883 </span></span>
<span id="cb70-12"><a href="#cb70-12"></a><span class="co">#&gt;  7 Austria     Europe     1952    66.8  6927772     6137.       0.540 </span></span>
<span id="cb70-13"><a href="#cb70-13"></a><span class="co">#&gt;  8 Bahrain     Asia       1952    50.9   120447     9867.       0.868 </span></span>
<span id="cb70-14"><a href="#cb70-14"></a><span class="co">#&gt;  9 Bangladesh  Asia       1952    37.5 46886859      684.       0.0602</span></span>
<span id="cb70-15"><a href="#cb70-15"></a><span class="co">#&gt; 10 Belgium     Europe     1952    68    8730405     8343.       0.734 </span></span>
<span id="cb70-16"><a href="#cb70-16"></a><span class="co">#&gt; # ... with 1,694 more rows</span></span></code></pre></div>
<p>Or maybe you want just the data from 2007, sorted on life expectancy?</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1"></a>my_gap <span class="op">%&gt;%</span></span>
<span id="cb71-2"><a href="#cb71-2"></a><span class="st">  </span><span class="kw">filter</span>(year <span class="op">==</span><span class="st"> </span><span class="dv">2007</span>) <span class="op">%&gt;%</span></span>
<span id="cb71-3"><a href="#cb71-3"></a><span class="st">  </span><span class="kw">arrange</span>(lifeExp)</span>
<span id="cb71-4"><a href="#cb71-4"></a><span class="co">#&gt; # A tibble: 142 x 7</span></span>
<span id="cb71-5"><a href="#cb71-5"></a><span class="co">#&gt;    country                continent  year lifeExp     pop gdpPercap gdpPercapRel</span></span>
<span id="cb71-6"><a href="#cb71-6"></a><span class="co">#&gt;    &lt;fct&gt;                  &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;     &lt;dbl&gt;        &lt;dbl&gt;</span></span>
<span id="cb71-7"><a href="#cb71-7"></a><span class="co">#&gt;  1 Swaziland              Africa     2007    39.6  1.13e6     4513.       0.124 </span></span>
<span id="cb71-8"><a href="#cb71-8"></a><span class="co">#&gt;  2 Mozambique             Africa     2007    42.1  2.00e7      824.       0.0227</span></span>
<span id="cb71-9"><a href="#cb71-9"></a><span class="co">#&gt;  3 Zambia                 Africa     2007    42.4  1.17e7     1271.       0.0350</span></span>
<span id="cb71-10"><a href="#cb71-10"></a><span class="co">#&gt;  4 Sierra Leone           Africa     2007    42.6  6.14e6      863.       0.0237</span></span>
<span id="cb71-11"><a href="#cb71-11"></a><span class="co">#&gt;  5 Lesotho                Africa     2007    42.6  2.01e6     1569.       0.0432</span></span>
<span id="cb71-12"><a href="#cb71-12"></a><span class="co">#&gt;  6 Angola                 Africa     2007    42.7  1.24e7     4797.       0.132 </span></span>
<span id="cb71-13"><a href="#cb71-13"></a><span class="co">#&gt;  7 Zimbabwe               Africa     2007    43.5  1.23e7      470.       0.0129</span></span>
<span id="cb71-14"><a href="#cb71-14"></a><span class="co">#&gt;  8 Afghanistan            Asia       2007    43.8  3.19e7      975.       0.0268</span></span>
<span id="cb71-15"><a href="#cb71-15"></a><span class="co">#&gt;  9 Central African Repub~ Africa     2007    44.7  4.37e6      706.       0.0194</span></span>
<span id="cb71-16"><a href="#cb71-16"></a><span class="co">#&gt; 10 Liberia                Africa     2007    45.7  3.19e6      415.       0.0114</span></span>
<span id="cb71-17"><a href="#cb71-17"></a><span class="co">#&gt; # ... with 132 more rows</span></span></code></pre></div>
<p>Oh, you’d like to sort on life expectancy in <strong>desc</strong>ending order? Then use <code>desc()</code>.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1"></a>my_gap <span class="op">%&gt;%</span></span>
<span id="cb72-2"><a href="#cb72-2"></a><span class="st">  </span><span class="kw">filter</span>(year <span class="op">==</span><span class="st"> </span><span class="dv">2007</span>) <span class="op">%&gt;%</span></span>
<span id="cb72-3"><a href="#cb72-3"></a><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(lifeExp))</span>
<span id="cb72-4"><a href="#cb72-4"></a><span class="co">#&gt; # A tibble: 142 x 7</span></span>
<span id="cb72-5"><a href="#cb72-5"></a><span class="co">#&gt;    country          continent  year lifeExp       pop gdpPercap gdpPercapRel</span></span>
<span id="cb72-6"><a href="#cb72-6"></a><span class="co">#&gt;    &lt;fct&gt;            &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;     &lt;int&gt;     &lt;dbl&gt;        &lt;dbl&gt;</span></span>
<span id="cb72-7"><a href="#cb72-7"></a><span class="co">#&gt;  1 Japan            Asia       2007    82.6 127467972    31656.        0.872</span></span>
<span id="cb72-8"><a href="#cb72-8"></a><span class="co">#&gt;  2 Hong Kong, China Asia       2007    82.2   6980412    39725.        1.09 </span></span>
<span id="cb72-9"><a href="#cb72-9"></a><span class="co">#&gt;  3 Iceland          Europe     2007    81.8    301931    36181.        0.996</span></span>
<span id="cb72-10"><a href="#cb72-10"></a><span class="co">#&gt;  4 Switzerland      Europe     2007    81.7   7554661    37506.        1.03 </span></span>
<span id="cb72-11"><a href="#cb72-11"></a><span class="co">#&gt;  5 Australia        Oceania    2007    81.2  20434176    34435.        0.948</span></span>
<span id="cb72-12"><a href="#cb72-12"></a><span class="co">#&gt;  6 Spain            Europe     2007    80.9  40448191    28821.        0.794</span></span>
<span id="cb72-13"><a href="#cb72-13"></a><span class="co">#&gt;  7 Sweden           Europe     2007    80.9   9031088    33860.        0.932</span></span>
<span id="cb72-14"><a href="#cb72-14"></a><span class="co">#&gt;  8 Israel           Asia       2007    80.7   6426679    25523.        0.703</span></span>
<span id="cb72-15"><a href="#cb72-15"></a><span class="co">#&gt;  9 France           Europe     2007    80.7  61083916    30470.        0.839</span></span>
<span id="cb72-16"><a href="#cb72-16"></a><span class="co">#&gt; 10 Canada           Americas   2007    80.7  33390141    36319.        1    </span></span>
<span id="cb72-17"><a href="#cb72-17"></a><span class="co">#&gt; # ... with 132 more rows</span></span></code></pre></div>
<p>I advise that your analyses NEVER rely on rows or variables being in a specific order. But it’s still true that human beings write the code and the interactive development process can be much nicer if you reorder the rows of your data as you go along. Also, once you are preparing tables for human eyeballs, it is imperative that you step up and take control of row order.</p>
</div>
<div id="use-rename-to-rename-variables" class="section level2">
<h2><span class="header-section-number">7.6</span> Use <code>rename()</code> to rename variables</h2>
<p>When I first cleaned this Gapminder excerpt, I was a <a href="https://en.wikipedia.org/wiki/Camel_case"><code>camelCase</code></a> person, but now I’m all about <a href="https://en.wikipedia.org/wiki/Snake_case"><code>snake_case</code></a>. So I am vexed by the variable names I chose when I cleaned this data years ago. Let’s rename some variables!</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1"></a>my_gap <span class="op">%&gt;%</span></span>
<span id="cb73-2"><a href="#cb73-2"></a><span class="st">  </span><span class="kw">rename</span>(<span class="dt">life_exp =</span> lifeExp,</span>
<span id="cb73-3"><a href="#cb73-3"></a>         <span class="dt">gdp_percap =</span> gdpPercap,</span>
<span id="cb73-4"><a href="#cb73-4"></a>         <span class="dt">gdp_percap_rel =</span> gdpPercapRel)</span>
<span id="cb73-5"><a href="#cb73-5"></a><span class="co">#&gt; # A tibble: 1,704 x 7</span></span>
<span id="cb73-6"><a href="#cb73-6"></a><span class="co">#&gt;    country     continent  year life_exp      pop gdp_percap gdp_percap_rel</span></span>
<span id="cb73-7"><a href="#cb73-7"></a><span class="co">#&gt;    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;    &lt;dbl&gt;    &lt;int&gt;      &lt;dbl&gt;          &lt;dbl&gt;</span></span>
<span id="cb73-8"><a href="#cb73-8"></a><span class="co">#&gt;  1 Afghanistan Asia       1952     28.8  8425333       779.         0.0686</span></span>
<span id="cb73-9"><a href="#cb73-9"></a><span class="co">#&gt;  2 Afghanistan Asia       1957     30.3  9240934       821.         0.0657</span></span>
<span id="cb73-10"><a href="#cb73-10"></a><span class="co">#&gt;  3 Afghanistan Asia       1962     32.0 10267083       853.         0.0634</span></span>
<span id="cb73-11"><a href="#cb73-11"></a><span class="co">#&gt;  4 Afghanistan Asia       1967     34.0 11537966       836.         0.0520</span></span>
<span id="cb73-12"><a href="#cb73-12"></a><span class="co">#&gt;  5 Afghanistan Asia       1972     36.1 13079460       740.         0.0390</span></span>
<span id="cb73-13"><a href="#cb73-13"></a><span class="co">#&gt;  6 Afghanistan Asia       1977     38.4 14880372       786.         0.0356</span></span>
<span id="cb73-14"><a href="#cb73-14"></a><span class="co">#&gt;  7 Afghanistan Asia       1982     39.9 12881816       978.         0.0427</span></span>
<span id="cb73-15"><a href="#cb73-15"></a><span class="co">#&gt;  8 Afghanistan Asia       1987     40.8 13867957       852.         0.0320</span></span>
<span id="cb73-16"><a href="#cb73-16"></a><span class="co">#&gt;  9 Afghanistan Asia       1992     41.7 16317921       649.         0.0246</span></span>
<span id="cb73-17"><a href="#cb73-17"></a><span class="co">#&gt; 10 Afghanistan Asia       1997     41.8 22227415       635.         0.0219</span></span>
<span id="cb73-18"><a href="#cb73-18"></a><span class="co">#&gt; # ... with 1,694 more rows</span></span></code></pre></div>
<p>I did NOT assign the post-rename object back to <code>my_gap</code> because that would make the chunks in this tutorial harder to copy/paste and run out of order. In real life, I would probably assign this back to <code>my_gap</code>, in a data preparation script, and proceed with the new variable names.</p>
</div>
<div id="select-can-rename-and-reposition-variables" class="section level2">
<h2><span class="header-section-number">7.7</span> <code>select()</code> can rename and reposition variables</h2>
<p>You’ve seen simple use of <code>select()</code>. There are two tricks you might enjoy:</p>
<ol style="list-style-type: decimal">
<li><code>select()</code> can rename the variables you request to keep.</li>
<li><code>select()</code> can be used with <code>everything()</code> to hoist a variable up to the front of the tibble.</li>
</ol>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1"></a>my_gap <span class="op">%&gt;%</span></span>
<span id="cb74-2"><a href="#cb74-2"></a><span class="st">  </span><span class="kw">filter</span>(country <span class="op">==</span><span class="st"> &quot;Burundi&quot;</span>, year <span class="op">&gt;</span><span class="st"> </span><span class="dv">1996</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb74-3"><a href="#cb74-3"></a><span class="st">  </span><span class="kw">select</span>(<span class="dt">yr =</span> year, lifeExp, gdpPercap) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb74-4"><a href="#cb74-4"></a><span class="st">  </span><span class="kw">select</span>(gdpPercap, <span class="kw">everything</span>())</span>
<span id="cb74-5"><a href="#cb74-5"></a><span class="co">#&gt; # A tibble: 3 x 3</span></span>
<span id="cb74-6"><a href="#cb74-6"></a><span class="co">#&gt;   gdpPercap    yr lifeExp</span></span>
<span id="cb74-7"><a href="#cb74-7"></a><span class="co">#&gt;       &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;</span></span>
<span id="cb74-8"><a href="#cb74-8"></a><span class="co">#&gt; 1      463.  1997    45.3</span></span>
<span id="cb74-9"><a href="#cb74-9"></a><span class="co">#&gt; 2      446.  2002    47.4</span></span>
<span id="cb74-10"><a href="#cb74-10"></a><span class="co">#&gt; 3      430.  2007    49.6</span></span></code></pre></div>
<p><code>everything()</code> is one of several helpers for variable selection. Read its help to see the rest.</p>
</div>
<div id="group_by-is-a-mighty-weapon" class="section level2">
<h2><span class="header-section-number">7.8</span> <code>group_by()</code> is a mighty weapon</h2>
<p>I have found <del>friends and family</del> collaborators love to ask seemingly innocuous questions like, “which country experienced the sharpest 5-year drop in life expectancy?”. In fact, that is a totally natural question to ask. But if you are using a language that doesn’t know about data, it’s an incredibly annoying question to answer.</p>
<p>dplyr offers powerful tools to solve this class of problem:</p>
<ul>
<li><code>group_by()</code> adds extra structure to your dataset – grouping information – which lays the groundwork for computations within the groups.</li>
<li><code>summarize()</code> takes a dataset with <span class="math inline">\(n\)</span> observations, computes requested summaries, and returns a dataset with 1 observation.</li>
<li>Window functions take a dataset with <span class="math inline">\(n\)</span> observations and return a dataset with <span class="math inline">\(n\)</span> observations.</li>
<li><code>mutate()</code> and <code>summarize()</code> will honor groups.</li>
<li>You can also do very general computations on your groups with <code>do()</code>, though elsewhere in this course, I advocate for other approaches that I find more intuitive, using the <a href="https://purrr.tidyverse.org">purrr package</a>.</li>
</ul>
<p>Combined with the verbs you already know, these new tools allow you to solve an extremely diverse set of problems with relative ease.</p>
<div id="counting-things-up" class="section level3">
<h3><span class="header-section-number">7.8.1</span> Counting things up</h3>
<p>Let’s start with simple counting. How many observations do we have per continent?</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1"></a>my_gap <span class="op">%&gt;%</span></span>
<span id="cb75-2"><a href="#cb75-2"></a><span class="st">  </span><span class="kw">group_by</span>(continent) <span class="op">%&gt;%</span></span>
<span id="cb75-3"><a href="#cb75-3"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">n =</span> <span class="kw">n</span>())</span>
<span id="cb75-4"><a href="#cb75-4"></a><span class="co">#&gt; `summarise()` ungrouping output (override with `.groups` argument)</span></span>
<span id="cb75-5"><a href="#cb75-5"></a><span class="co">#&gt; # A tibble: 5 x 2</span></span>
<span id="cb75-6"><a href="#cb75-6"></a><span class="co">#&gt;   continent     n</span></span>
<span id="cb75-7"><a href="#cb75-7"></a><span class="co">#&gt;   &lt;fct&gt;     &lt;int&gt;</span></span>
<span id="cb75-8"><a href="#cb75-8"></a><span class="co">#&gt; 1 Africa      624</span></span>
<span id="cb75-9"><a href="#cb75-9"></a><span class="co">#&gt; 2 Americas    300</span></span>
<span id="cb75-10"><a href="#cb75-10"></a><span class="co">#&gt; 3 Asia        396</span></span>
<span id="cb75-11"><a href="#cb75-11"></a><span class="co">#&gt; 4 Europe      360</span></span>
<span id="cb75-12"><a href="#cb75-12"></a><span class="co">#&gt; 5 Oceania      24</span></span></code></pre></div>
<p>Let us pause here to think about the tidyverse. You could get these same frequencies using <code>table()</code> from base R.</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1"></a><span class="kw">table</span>(gapminder<span class="op">$</span>continent)</span>
<span id="cb76-2"><a href="#cb76-2"></a><span class="co">#&gt; </span></span>
<span id="cb76-3"><a href="#cb76-3"></a><span class="co">#&gt;   Africa Americas     Asia   Europe  Oceania </span></span>
<span id="cb76-4"><a href="#cb76-4"></a><span class="co">#&gt;      624      300      396      360       24</span></span>
<span id="cb76-5"><a href="#cb76-5"></a><span class="kw">str</span>(<span class="kw">table</span>(gapminder<span class="op">$</span>continent))</span>
<span id="cb76-6"><a href="#cb76-6"></a><span class="co">#&gt;  &#39;table&#39; int [1:5(1d)] 624 300 396 360 24</span></span>
<span id="cb76-7"><a href="#cb76-7"></a><span class="co">#&gt;  - attr(*, &quot;dimnames&quot;)=List of 1</span></span>
<span id="cb76-8"><a href="#cb76-8"></a><span class="co">#&gt;   ..$ : chr [1:5] &quot;Africa&quot; &quot;Americas&quot; &quot;Asia&quot; &quot;Europe&quot; ...</span></span></code></pre></div>
<p>But the object of class <code>table</code> that is returned makes downstream computation a bit fiddlier than you’d like. For example, it’s too bad the continent levels come back only as <em>names</em> and not as a proper factor, with the original set of levels. This is an example of how the tidyverse smooths transitions where you want the output of step <code>i</code> to become the input of step <code>i + 1</code>.</p>
<p>The <code>tally()</code> function is a convenience function that knows to count rows. It honors groups.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1"></a>my_gap <span class="op">%&gt;%</span></span>
<span id="cb77-2"><a href="#cb77-2"></a><span class="st">  </span><span class="kw">group_by</span>(continent) <span class="op">%&gt;%</span></span>
<span id="cb77-3"><a href="#cb77-3"></a><span class="st">  </span><span class="kw">tally</span>()</span>
<span id="cb77-4"><a href="#cb77-4"></a><span class="co">#&gt; # A tibble: 5 x 2</span></span>
<span id="cb77-5"><a href="#cb77-5"></a><span class="co">#&gt;   continent     n</span></span>
<span id="cb77-6"><a href="#cb77-6"></a><span class="co">#&gt;   &lt;fct&gt;     &lt;int&gt;</span></span>
<span id="cb77-7"><a href="#cb77-7"></a><span class="co">#&gt; 1 Africa      624</span></span>
<span id="cb77-8"><a href="#cb77-8"></a><span class="co">#&gt; 2 Americas    300</span></span>
<span id="cb77-9"><a href="#cb77-9"></a><span class="co">#&gt; 3 Asia        396</span></span>
<span id="cb77-10"><a href="#cb77-10"></a><span class="co">#&gt; 4 Europe      360</span></span>
<span id="cb77-11"><a href="#cb77-11"></a><span class="co">#&gt; 5 Oceania      24</span></span></code></pre></div>
<p>The <code>count()</code> function is an even more convenient function that does both grouping and counting.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1"></a>my_gap <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb78-2"><a href="#cb78-2"></a><span class="st">  </span><span class="kw">count</span>(continent)</span>
<span id="cb78-3"><a href="#cb78-3"></a><span class="co">#&gt; # A tibble: 5 x 2</span></span>
<span id="cb78-4"><a href="#cb78-4"></a><span class="co">#&gt;   continent     n</span></span>
<span id="cb78-5"><a href="#cb78-5"></a><span class="co">#&gt;   &lt;fct&gt;     &lt;int&gt;</span></span>
<span id="cb78-6"><a href="#cb78-6"></a><span class="co">#&gt; 1 Africa      624</span></span>
<span id="cb78-7"><a href="#cb78-7"></a><span class="co">#&gt; 2 Americas    300</span></span>
<span id="cb78-8"><a href="#cb78-8"></a><span class="co">#&gt; 3 Asia        396</span></span>
<span id="cb78-9"><a href="#cb78-9"></a><span class="co">#&gt; 4 Europe      360</span></span>
<span id="cb78-10"><a href="#cb78-10"></a><span class="co">#&gt; 5 Oceania      24</span></span></code></pre></div>
<p>What if we wanted to add the number of unique countries for each continent? You can compute multiple summaries inside <code>summarize()</code>. Use the <code>n_distinct()</code> function to count the number of distinct countries within each continent.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1"></a>my_gap <span class="op">%&gt;%</span></span>
<span id="cb79-2"><a href="#cb79-2"></a><span class="st">  </span><span class="kw">group_by</span>(continent) <span class="op">%&gt;%</span></span>
<span id="cb79-3"><a href="#cb79-3"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">n =</span> <span class="kw">n</span>(),</span>
<span id="cb79-4"><a href="#cb79-4"></a>            <span class="dt">n_countries =</span> <span class="kw">n_distinct</span>(country))</span>
<span id="cb79-5"><a href="#cb79-5"></a><span class="co">#&gt; `summarise()` ungrouping output (override with `.groups` argument)</span></span>
<span id="cb79-6"><a href="#cb79-6"></a><span class="co">#&gt; # A tibble: 5 x 3</span></span>
<span id="cb79-7"><a href="#cb79-7"></a><span class="co">#&gt;   continent     n n_countries</span></span>
<span id="cb79-8"><a href="#cb79-8"></a><span class="co">#&gt;   &lt;fct&gt;     &lt;int&gt;       &lt;int&gt;</span></span>
<span id="cb79-9"><a href="#cb79-9"></a><span class="co">#&gt; 1 Africa      624          52</span></span>
<span id="cb79-10"><a href="#cb79-10"></a><span class="co">#&gt; 2 Americas    300          25</span></span>
<span id="cb79-11"><a href="#cb79-11"></a><span class="co">#&gt; 3 Asia        396          33</span></span>
<span id="cb79-12"><a href="#cb79-12"></a><span class="co">#&gt; 4 Europe      360          30</span></span>
<span id="cb79-13"><a href="#cb79-13"></a><span class="co">#&gt; 5 Oceania      24           2</span></span></code></pre></div>
</div>
<div id="general-summarization" class="section level3">
<h3><span class="header-section-number">7.8.2</span> General summarization</h3>
<p>The functions you’ll apply within <code>summarize()</code> include classical statistical summaries, like <code>mean()</code>, <code>median()</code>, <code>var()</code>, <code>sd()</code>, <code>mad()</code>, <code>IQR()</code>, <code>min()</code>, and <code>max()</code>. Remember they are functions that take <span class="math inline">\(n\)</span> inputs and distill them down into 1 output.</p>
<p>Although this may be statistically ill-advised, let’s compute the average life expectancy by continent.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1"></a>my_gap <span class="op">%&gt;%</span></span>
<span id="cb80-2"><a href="#cb80-2"></a><span class="st">  </span><span class="kw">group_by</span>(continent) <span class="op">%&gt;%</span></span>
<span id="cb80-3"><a href="#cb80-3"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">avg_lifeExp =</span> <span class="kw">mean</span>(lifeExp))</span>
<span id="cb80-4"><a href="#cb80-4"></a><span class="co">#&gt; `summarise()` ungrouping output (override with `.groups` argument)</span></span>
<span id="cb80-5"><a href="#cb80-5"></a><span class="co">#&gt; # A tibble: 5 x 2</span></span>
<span id="cb80-6"><a href="#cb80-6"></a><span class="co">#&gt;   continent avg_lifeExp</span></span>
<span id="cb80-7"><a href="#cb80-7"></a><span class="co">#&gt;   &lt;fct&gt;           &lt;dbl&gt;</span></span>
<span id="cb80-8"><a href="#cb80-8"></a><span class="co">#&gt; 1 Africa           48.9</span></span>
<span id="cb80-9"><a href="#cb80-9"></a><span class="co">#&gt; 2 Americas         64.7</span></span>
<span id="cb80-10"><a href="#cb80-10"></a><span class="co">#&gt; 3 Asia             60.1</span></span>
<span id="cb80-11"><a href="#cb80-11"></a><span class="co">#&gt; 4 Europe           71.9</span></span>
<span id="cb80-12"><a href="#cb80-12"></a><span class="co">#&gt; 5 Oceania          74.3</span></span></code></pre></div>
<!--TODO: summarize_at() is soft deprecated as of dplyr 0.8.0-->
<p><code>summarize_at()</code> applies the same summary function(s) to multiple variables. Let’s compute average and median life expectancy and GDP per capita by continent by year…but only for 1952 and 2007.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1"></a>my_gap <span class="op">%&gt;%</span></span>
<span id="cb81-2"><a href="#cb81-2"></a><span class="st">  </span><span class="kw">filter</span>(year <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">1952</span>, <span class="dv">2007</span>)) <span class="op">%&gt;%</span></span>
<span id="cb81-3"><a href="#cb81-3"></a><span class="st">  </span><span class="kw">group_by</span>(continent, year) <span class="op">%&gt;%</span></span>
<span id="cb81-4"><a href="#cb81-4"></a><span class="st">  </span><span class="kw">summarize_at</span>(<span class="kw">vars</span>(lifeExp, gdpPercap), <span class="kw">list</span>(<span class="op">~</span><span class="kw">mean</span>(.), <span class="op">~</span><span class="kw">median</span>(.)))</span>
<span id="cb81-5"><a href="#cb81-5"></a><span class="co">#&gt; # A tibble: 10 x 6</span></span>
<span id="cb81-6"><a href="#cb81-6"></a><span class="co">#&gt; # Groups:   continent [5]</span></span>
<span id="cb81-7"><a href="#cb81-7"></a><span class="co">#&gt;    continent  year lifeExp_mean gdpPercap_mean lifeExp_median gdpPercap_median</span></span>
<span id="cb81-8"><a href="#cb81-8"></a><span class="co">#&gt;    &lt;fct&gt;     &lt;int&gt;        &lt;dbl&gt;          &lt;dbl&gt;          &lt;dbl&gt;            &lt;dbl&gt;</span></span>
<span id="cb81-9"><a href="#cb81-9"></a><span class="co">#&gt;  1 Africa     1952         39.1          1253.           38.8             987.</span></span>
<span id="cb81-10"><a href="#cb81-10"></a><span class="co">#&gt;  2 Africa     2007         54.8          3089.           52.9            1452.</span></span>
<span id="cb81-11"><a href="#cb81-11"></a><span class="co">#&gt;  3 Americas   1952         53.3          4079.           54.7            3048.</span></span>
<span id="cb81-12"><a href="#cb81-12"></a><span class="co">#&gt;  4 Americas   2007         73.6         11003.           72.9            8948.</span></span>
<span id="cb81-13"><a href="#cb81-13"></a><span class="co">#&gt;  5 Asia       1952         46.3          5195.           44.9            1207.</span></span>
<span id="cb81-14"><a href="#cb81-14"></a><span class="co">#&gt;  6 Asia       2007         70.7         12473.           72.4            4471.</span></span>
<span id="cb81-15"><a href="#cb81-15"></a><span class="co">#&gt;  7 Europe     1952         64.4          5661.           65.9            5142.</span></span>
<span id="cb81-16"><a href="#cb81-16"></a><span class="co">#&gt;  8 Europe     2007         77.6         25054.           78.6           28054.</span></span>
<span id="cb81-17"><a href="#cb81-17"></a><span class="co">#&gt;  9 Oceania    1952         69.3         10298.           69.3           10298.</span></span>
<span id="cb81-18"><a href="#cb81-18"></a><span class="co">#&gt; 10 Oceania    2007         80.7         29810.           80.7           29810.</span></span></code></pre></div>
<p>Let’s focus just on Asia. What are the minimum and maximum life expectancies seen by year?</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1"></a>my_gap <span class="op">%&gt;%</span></span>
<span id="cb82-2"><a href="#cb82-2"></a><span class="st">  </span><span class="kw">filter</span>(continent <span class="op">==</span><span class="st"> &quot;Asia&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb82-3"><a href="#cb82-3"></a><span class="st">  </span><span class="kw">group_by</span>(year) <span class="op">%&gt;%</span></span>
<span id="cb82-4"><a href="#cb82-4"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">min_lifeExp =</span> <span class="kw">min</span>(lifeExp), <span class="dt">max_lifeExp =</span> <span class="kw">max</span>(lifeExp))</span>
<span id="cb82-5"><a href="#cb82-5"></a><span class="co">#&gt; `summarise()` ungrouping output (override with `.groups` argument)</span></span>
<span id="cb82-6"><a href="#cb82-6"></a><span class="co">#&gt; # A tibble: 12 x 3</span></span>
<span id="cb82-7"><a href="#cb82-7"></a><span class="co">#&gt;     year min_lifeExp max_lifeExp</span></span>
<span id="cb82-8"><a href="#cb82-8"></a><span class="co">#&gt;    &lt;int&gt;       &lt;dbl&gt;       &lt;dbl&gt;</span></span>
<span id="cb82-9"><a href="#cb82-9"></a><span class="co">#&gt;  1  1952        28.8        65.4</span></span>
<span id="cb82-10"><a href="#cb82-10"></a><span class="co">#&gt;  2  1957        30.3        67.8</span></span>
<span id="cb82-11"><a href="#cb82-11"></a><span class="co">#&gt;  3  1962        32.0        69.4</span></span>
<span id="cb82-12"><a href="#cb82-12"></a><span class="co">#&gt;  4  1967        34.0        71.4</span></span>
<span id="cb82-13"><a href="#cb82-13"></a><span class="co">#&gt;  5  1972        36.1        73.4</span></span>
<span id="cb82-14"><a href="#cb82-14"></a><span class="co">#&gt;  6  1977        31.2        75.4</span></span>
<span id="cb82-15"><a href="#cb82-15"></a><span class="co">#&gt;  7  1982        39.9        77.1</span></span>
<span id="cb82-16"><a href="#cb82-16"></a><span class="co">#&gt;  8  1987        40.8        78.7</span></span>
<span id="cb82-17"><a href="#cb82-17"></a><span class="co">#&gt;  9  1992        41.7        79.4</span></span>
<span id="cb82-18"><a href="#cb82-18"></a><span class="co">#&gt; 10  1997        41.8        80.7</span></span>
<span id="cb82-19"><a href="#cb82-19"></a><span class="co">#&gt; 11  2002        42.1        82  </span></span>
<span id="cb82-20"><a href="#cb82-20"></a><span class="co">#&gt; 12  2007        43.8        82.6</span></span></code></pre></div>
<p>Of course it would be much more interesting to see <em>which</em> country contributed these extreme observations. Is the minimum (maximum) always coming from the same country? We tackle that with window functions shortly.</p>
</div>
</div>
<div id="grouped-mutate" class="section level2">
<h2><span class="header-section-number">7.9</span> Grouped mutate</h2>
<p>Sometimes you don’t want to collapse the <span class="math inline">\(n\)</span> rows for each group into one row. You want to keep your groups, but compute within them.</p>
<div id="computing-with-group-wise-summaries" class="section level3">
<h3><span class="header-section-number">7.9.1</span> Computing with group-wise summaries</h3>
<p>Let’s make a new variable that is the years of life expectancy gained (lost) relative to 1952, for each individual country. We group by country and use <code>mutate()</code> to make a new variable. The <code>first()</code> function extracts the first value from a vector. Notice that <code>first()</code> is operating on the vector of life expectancies <em>within each country group</em>.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1"></a>my_gap <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb83-2"><a href="#cb83-2"></a><span class="st">  </span><span class="kw">group_by</span>(country) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb83-3"><a href="#cb83-3"></a><span class="st">  </span><span class="kw">select</span>(country, year, lifeExp) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb83-4"><a href="#cb83-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">lifeExp_gain =</span> lifeExp <span class="op">-</span><span class="st"> </span><span class="kw">first</span>(lifeExp)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb83-5"><a href="#cb83-5"></a><span class="st">  </span><span class="kw">filter</span>(year <span class="op">&lt;</span><span class="st"> </span><span class="dv">1963</span>)</span>
<span id="cb83-6"><a href="#cb83-6"></a><span class="co">#&gt; # A tibble: 426 x 4</span></span>
<span id="cb83-7"><a href="#cb83-7"></a><span class="co">#&gt; # Groups:   country [142]</span></span>
<span id="cb83-8"><a href="#cb83-8"></a><span class="co">#&gt;    country      year lifeExp lifeExp_gain</span></span>
<span id="cb83-9"><a href="#cb83-9"></a><span class="co">#&gt;    &lt;fct&gt;       &lt;int&gt;   &lt;dbl&gt;        &lt;dbl&gt;</span></span>
<span id="cb83-10"><a href="#cb83-10"></a><span class="co">#&gt;  1 Afghanistan  1952    28.8         0   </span></span>
<span id="cb83-11"><a href="#cb83-11"></a><span class="co">#&gt;  2 Afghanistan  1957    30.3         1.53</span></span>
<span id="cb83-12"><a href="#cb83-12"></a><span class="co">#&gt;  3 Afghanistan  1962    32.0         3.20</span></span>
<span id="cb83-13"><a href="#cb83-13"></a><span class="co">#&gt;  4 Albania      1952    55.2         0   </span></span>
<span id="cb83-14"><a href="#cb83-14"></a><span class="co">#&gt;  5 Albania      1957    59.3         4.05</span></span>
<span id="cb83-15"><a href="#cb83-15"></a><span class="co">#&gt;  6 Albania      1962    64.8         9.59</span></span>
<span id="cb83-16"><a href="#cb83-16"></a><span class="co">#&gt;  7 Algeria      1952    43.1         0   </span></span>
<span id="cb83-17"><a href="#cb83-17"></a><span class="co">#&gt;  8 Algeria      1957    45.7         2.61</span></span>
<span id="cb83-18"><a href="#cb83-18"></a><span class="co">#&gt;  9 Algeria      1962    48.3         5.23</span></span>
<span id="cb83-19"><a href="#cb83-19"></a><span class="co">#&gt; 10 Angola       1952    30.0         0   </span></span>
<span id="cb83-20"><a href="#cb83-20"></a><span class="co">#&gt; # ... with 416 more rows</span></span></code></pre></div>
<p>Within country, we take the difference between life expectancy in year <span class="math inline">\(i\)</span> and life expectancy in 1952. Therefore we always see zeroes for 1952 and, for most countries, a sequence of positive and increasing numbers.</p>
</div>
<div id="window-functions" class="section level3">
<h3><span class="header-section-number">7.9.2</span> Window functions</h3>
<p>Window functions take <span class="math inline">\(n\)</span> inputs and give back <span class="math inline">\(n\)</span> outputs. Furthermore, the output depends on all the values. So <code>rank()</code> is a window function but <code>log()</code> is not. Here we use window functions based on ranks and offsets.</p>
<p>Let’s revisit the worst and best life expectancies in Asia over time, but retaining info about <em>which</em> country contributes these extreme values.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1"></a>my_gap <span class="op">%&gt;%</span></span>
<span id="cb84-2"><a href="#cb84-2"></a><span class="st">  </span><span class="kw">filter</span>(continent <span class="op">==</span><span class="st"> &quot;Asia&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb84-3"><a href="#cb84-3"></a><span class="st">  </span><span class="kw">select</span>(year, country, lifeExp) <span class="op">%&gt;%</span></span>
<span id="cb84-4"><a href="#cb84-4"></a><span class="st">  </span><span class="kw">group_by</span>(year) <span class="op">%&gt;%</span></span>
<span id="cb84-5"><a href="#cb84-5"></a><span class="st">  </span><span class="kw">filter</span>(<span class="kw">min_rank</span>(<span class="kw">desc</span>(lifeExp)) <span class="op">&lt;</span><span class="st"> </span><span class="dv">2</span> <span class="op">|</span><span class="st"> </span><span class="kw">min_rank</span>(lifeExp) <span class="op">&lt;</span><span class="st"> </span><span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb84-6"><a href="#cb84-6"></a><span class="st">  </span><span class="kw">arrange</span>(year) <span class="op">%&gt;%</span></span>
<span id="cb84-7"><a href="#cb84-7"></a><span class="st">  </span><span class="kw">print</span>(<span class="dt">n =</span> <span class="ot">Inf</span>)</span>
<span id="cb84-8"><a href="#cb84-8"></a><span class="co">#&gt; # A tibble: 24 x 3</span></span>
<span id="cb84-9"><a href="#cb84-9"></a><span class="co">#&gt; # Groups:   year [12]</span></span>
<span id="cb84-10"><a href="#cb84-10"></a><span class="co">#&gt;     year country     lifeExp</span></span>
<span id="cb84-11"><a href="#cb84-11"></a><span class="co">#&gt;    &lt;int&gt; &lt;fct&gt;         &lt;dbl&gt;</span></span>
<span id="cb84-12"><a href="#cb84-12"></a><span class="co">#&gt;  1  1952 Afghanistan    28.8</span></span>
<span id="cb84-13"><a href="#cb84-13"></a><span class="co">#&gt;  2  1952 Israel         65.4</span></span>
<span id="cb84-14"><a href="#cb84-14"></a><span class="co">#&gt;  3  1957 Afghanistan    30.3</span></span>
<span id="cb84-15"><a href="#cb84-15"></a><span class="co">#&gt;  4  1957 Israel         67.8</span></span>
<span id="cb84-16"><a href="#cb84-16"></a><span class="co">#&gt;  5  1962 Afghanistan    32.0</span></span>
<span id="cb84-17"><a href="#cb84-17"></a><span class="co">#&gt;  6  1962 Israel         69.4</span></span>
<span id="cb84-18"><a href="#cb84-18"></a><span class="co">#&gt;  7  1967 Afghanistan    34.0</span></span>
<span id="cb84-19"><a href="#cb84-19"></a><span class="co">#&gt;  8  1967 Japan          71.4</span></span>
<span id="cb84-20"><a href="#cb84-20"></a><span class="co">#&gt;  9  1972 Afghanistan    36.1</span></span>
<span id="cb84-21"><a href="#cb84-21"></a><span class="co">#&gt; 10  1972 Japan          73.4</span></span>
<span id="cb84-22"><a href="#cb84-22"></a><span class="co">#&gt; 11  1977 Cambodia       31.2</span></span>
<span id="cb84-23"><a href="#cb84-23"></a><span class="co">#&gt; 12  1977 Japan          75.4</span></span>
<span id="cb84-24"><a href="#cb84-24"></a><span class="co">#&gt; 13  1982 Afghanistan    39.9</span></span>
<span id="cb84-25"><a href="#cb84-25"></a><span class="co">#&gt; 14  1982 Japan          77.1</span></span>
<span id="cb84-26"><a href="#cb84-26"></a><span class="co">#&gt; 15  1987 Afghanistan    40.8</span></span>
<span id="cb84-27"><a href="#cb84-27"></a><span class="co">#&gt; 16  1987 Japan          78.7</span></span>
<span id="cb84-28"><a href="#cb84-28"></a><span class="co">#&gt; 17  1992 Afghanistan    41.7</span></span>
<span id="cb84-29"><a href="#cb84-29"></a><span class="co">#&gt; 18  1992 Japan          79.4</span></span>
<span id="cb84-30"><a href="#cb84-30"></a><span class="co">#&gt; 19  1997 Afghanistan    41.8</span></span>
<span id="cb84-31"><a href="#cb84-31"></a><span class="co">#&gt; 20  1997 Japan          80.7</span></span>
<span id="cb84-32"><a href="#cb84-32"></a><span class="co">#&gt; 21  2002 Afghanistan    42.1</span></span>
<span id="cb84-33"><a href="#cb84-33"></a><span class="co">#&gt; 22  2002 Japan          82  </span></span>
<span id="cb84-34"><a href="#cb84-34"></a><span class="co">#&gt; 23  2007 Afghanistan    43.8</span></span>
<span id="cb84-35"><a href="#cb84-35"></a><span class="co">#&gt; 24  2007 Japan          82.6</span></span></code></pre></div>
<p>We see that (min = Afghanistan, max = Japan) is the most frequent result, but Cambodia and Israel pop up at least once each as the min or max, respectively. That table should make you impatient for our upcoming work on tidying and reshaping data! Wouldn’t it be nice to have one row per year?</p>
<p>How did that actually work? First, I store and view a partial that leaves off the <code>filter()</code> statement. All of these operations should be familiar.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1"></a>asia &lt;-<span class="st"> </span>my_gap <span class="op">%&gt;%</span></span>
<span id="cb85-2"><a href="#cb85-2"></a><span class="st">  </span><span class="kw">filter</span>(continent <span class="op">==</span><span class="st"> &quot;Asia&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb85-3"><a href="#cb85-3"></a><span class="st">  </span><span class="kw">select</span>(year, country, lifeExp) <span class="op">%&gt;%</span></span>
<span id="cb85-4"><a href="#cb85-4"></a><span class="st">  </span><span class="kw">group_by</span>(year)</span>
<span id="cb85-5"><a href="#cb85-5"></a>asia</span>
<span id="cb85-6"><a href="#cb85-6"></a><span class="co">#&gt; # A tibble: 396 x 3</span></span>
<span id="cb85-7"><a href="#cb85-7"></a><span class="co">#&gt; # Groups:   year [12]</span></span>
<span id="cb85-8"><a href="#cb85-8"></a><span class="co">#&gt;     year country     lifeExp</span></span>
<span id="cb85-9"><a href="#cb85-9"></a><span class="co">#&gt;    &lt;int&gt; &lt;fct&gt;         &lt;dbl&gt;</span></span>
<span id="cb85-10"><a href="#cb85-10"></a><span class="co">#&gt;  1  1952 Afghanistan    28.8</span></span>
<span id="cb85-11"><a href="#cb85-11"></a><span class="co">#&gt;  2  1957 Afghanistan    30.3</span></span>
<span id="cb85-12"><a href="#cb85-12"></a><span class="co">#&gt;  3  1962 Afghanistan    32.0</span></span>
<span id="cb85-13"><a href="#cb85-13"></a><span class="co">#&gt;  4  1967 Afghanistan    34.0</span></span>
<span id="cb85-14"><a href="#cb85-14"></a><span class="co">#&gt;  5  1972 Afghanistan    36.1</span></span>
<span id="cb85-15"><a href="#cb85-15"></a><span class="co">#&gt;  6  1977 Afghanistan    38.4</span></span>
<span id="cb85-16"><a href="#cb85-16"></a><span class="co">#&gt;  7  1982 Afghanistan    39.9</span></span>
<span id="cb85-17"><a href="#cb85-17"></a><span class="co">#&gt;  8  1987 Afghanistan    40.8</span></span>
<span id="cb85-18"><a href="#cb85-18"></a><span class="co">#&gt;  9  1992 Afghanistan    41.7</span></span>
<span id="cb85-19"><a href="#cb85-19"></a><span class="co">#&gt; 10  1997 Afghanistan    41.8</span></span>
<span id="cb85-20"><a href="#cb85-20"></a><span class="co">#&gt; # ... with 386 more rows</span></span></code></pre></div>
<p>Now we apply a window function – <code>min_rank()</code>. Since <code>asia</code> is grouped by year, <code>min_rank()</code> operates within mini-datasets, each for a specific year. Applied to the variable <code>lifeExp</code>, <code>min_rank()</code> returns the rank of each country’s observed life expectancy. FYI, the <code>min</code> part just specifies how ties are broken. Here is an explicit peek at these within-year life expectancy ranks, in both the (default) ascending and descending order.</p>
<p>For concreteness, I use <code>mutate()</code> to actually create these variables, even though I dropped this in the solution above. Let’s look at a bit of that.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1"></a>asia <span class="op">%&gt;%</span></span>
<span id="cb86-2"><a href="#cb86-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">le_rank =</span> <span class="kw">min_rank</span>(lifeExp),</span>
<span id="cb86-3"><a href="#cb86-3"></a>         <span class="dt">le_desc_rank =</span> <span class="kw">min_rank</span>(<span class="kw">desc</span>(lifeExp))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb86-4"><a href="#cb86-4"></a><span class="st">  </span><span class="kw">filter</span>(country <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Afghanistan&quot;</span>, <span class="st">&quot;Japan&quot;</span>, <span class="st">&quot;Thailand&quot;</span>), year <span class="op">&gt;</span><span class="st"> </span><span class="dv">1995</span>)</span>
<span id="cb86-5"><a href="#cb86-5"></a><span class="co">#&gt; # A tibble: 9 x 5</span></span>
<span id="cb86-6"><a href="#cb86-6"></a><span class="co">#&gt; # Groups:   year [3]</span></span>
<span id="cb86-7"><a href="#cb86-7"></a><span class="co">#&gt;    year country     lifeExp le_rank le_desc_rank</span></span>
<span id="cb86-8"><a href="#cb86-8"></a><span class="co">#&gt;   &lt;int&gt; &lt;fct&gt;         &lt;dbl&gt;   &lt;int&gt;        &lt;int&gt;</span></span>
<span id="cb86-9"><a href="#cb86-9"></a><span class="co">#&gt; 1  1997 Afghanistan    41.8       1           33</span></span>
<span id="cb86-10"><a href="#cb86-10"></a><span class="co">#&gt; 2  2002 Afghanistan    42.1       1           33</span></span>
<span id="cb86-11"><a href="#cb86-11"></a><span class="co">#&gt; 3  2007 Afghanistan    43.8       1           33</span></span>
<span id="cb86-12"><a href="#cb86-12"></a><span class="co">#&gt; 4  1997 Japan          80.7      33            1</span></span>
<span id="cb86-13"><a href="#cb86-13"></a><span class="co">#&gt; 5  2002 Japan          82        33            1</span></span>
<span id="cb86-14"><a href="#cb86-14"></a><span class="co">#&gt; 6  2007 Japan          82.6      33            1</span></span>
<span id="cb86-15"><a href="#cb86-15"></a><span class="co">#&gt; 7  1997 Thailand       67.5      12           22</span></span>
<span id="cb86-16"><a href="#cb86-16"></a><span class="co">#&gt; 8  2002 Thailand       68.6      12           22</span></span>
<span id="cb86-17"><a href="#cb86-17"></a><span class="co">#&gt; 9  2007 Thailand       70.6      12           22</span></span></code></pre></div>
<p>Afghanistan tends to present 1’s in the <code>le_rank</code> variable, Japan tends to present 1’s in the <code>le_desc_rank</code> variable and other countries, like Thailand, present less extreme ranks.</p>
<p>You can understand the original <code>filter()</code> statement now:</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1"></a><span class="kw">filter</span>(<span class="kw">min_rank</span>(<span class="kw">desc</span>(lifeExp)) <span class="op">&lt;</span><span class="st"> </span><span class="dv">2</span> <span class="op">|</span><span class="st"> </span><span class="kw">min_rank</span>(lifeExp) <span class="op">&lt;</span><span class="st"> </span><span class="dv">2</span>)</span></code></pre></div>
<p>These two sets of ranks are formed on-the-fly, within year group, and <code>filter()</code> retains rows with rank less than 2, which means … the row with rank = 1. Since we do for ascending and descending ranks, we get both the min and the max.</p>
<p>If we had wanted just the min OR the max, an alternative approach using <code>top_n()</code> would have worked.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1"></a>my_gap <span class="op">%&gt;%</span></span>
<span id="cb88-2"><a href="#cb88-2"></a><span class="st">  </span><span class="kw">filter</span>(continent <span class="op">==</span><span class="st"> &quot;Asia&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb88-3"><a href="#cb88-3"></a><span class="st">  </span><span class="kw">select</span>(year, country, lifeExp) <span class="op">%&gt;%</span></span>
<span id="cb88-4"><a href="#cb88-4"></a><span class="st">  </span><span class="kw">arrange</span>(year) <span class="op">%&gt;%</span></span>
<span id="cb88-5"><a href="#cb88-5"></a><span class="st">  </span><span class="kw">group_by</span>(year) <span class="op">%&gt;%</span></span>
<span id="cb88-6"><a href="#cb88-6"></a><span class="st">  </span><span class="co">#top_n(1, wt = lifeExp)        ## gets the min</span></span>
<span id="cb88-7"><a href="#cb88-7"></a><span class="st">  </span><span class="kw">top_n</span>(<span class="dv">1</span>, <span class="dt">wt =</span> <span class="kw">desc</span>(lifeExp)) <span class="co">## gets the max</span></span>
<span id="cb88-8"><a href="#cb88-8"></a><span class="co">#&gt; # A tibble: 12 x 3</span></span>
<span id="cb88-9"><a href="#cb88-9"></a><span class="co">#&gt; # Groups:   year [12]</span></span>
<span id="cb88-10"><a href="#cb88-10"></a><span class="co">#&gt;     year country     lifeExp</span></span>
<span id="cb88-11"><a href="#cb88-11"></a><span class="co">#&gt;    &lt;int&gt; &lt;fct&gt;         &lt;dbl&gt;</span></span>
<span id="cb88-12"><a href="#cb88-12"></a><span class="co">#&gt;  1  1952 Afghanistan    28.8</span></span>
<span id="cb88-13"><a href="#cb88-13"></a><span class="co">#&gt;  2  1957 Afghanistan    30.3</span></span>
<span id="cb88-14"><a href="#cb88-14"></a><span class="co">#&gt;  3  1962 Afghanistan    32.0</span></span>
<span id="cb88-15"><a href="#cb88-15"></a><span class="co">#&gt;  4  1967 Afghanistan    34.0</span></span>
<span id="cb88-16"><a href="#cb88-16"></a><span class="co">#&gt;  5  1972 Afghanistan    36.1</span></span>
<span id="cb88-17"><a href="#cb88-17"></a><span class="co">#&gt;  6  1977 Cambodia       31.2</span></span>
<span id="cb88-18"><a href="#cb88-18"></a><span class="co">#&gt;  7  1982 Afghanistan    39.9</span></span>
<span id="cb88-19"><a href="#cb88-19"></a><span class="co">#&gt;  8  1987 Afghanistan    40.8</span></span>
<span id="cb88-20"><a href="#cb88-20"></a><span class="co">#&gt;  9  1992 Afghanistan    41.7</span></span>
<span id="cb88-21"><a href="#cb88-21"></a><span class="co">#&gt; 10  1997 Afghanistan    41.8</span></span>
<span id="cb88-22"><a href="#cb88-22"></a><span class="co">#&gt; 11  2002 Afghanistan    42.1</span></span>
<span id="cb88-23"><a href="#cb88-23"></a><span class="co">#&gt; 12  2007 Afghanistan    43.8</span></span></code></pre></div>
</div>
</div>
<div id="grand-finale" class="section level2">
<h2><span class="header-section-number">7.10</span> Grand Finale</h2>
<p>So let’s answer that “simple” question: which country experienced the sharpest 5-year drop in life expectancy? Recall that this excerpt of the Gapminder data only has data every five years, e.g. for 1952, 1957, etc. So this really means looking at life expectancy changes between adjacent timepoints.</p>
<p>At this point, that’s just too easy, so let’s do it by continent while we’re at it.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1"></a>my_gap <span class="op">%&gt;%</span></span>
<span id="cb89-2"><a href="#cb89-2"></a><span class="st">  </span><span class="kw">select</span>(country, year, continent, lifeExp) <span class="op">%&gt;%</span></span>
<span id="cb89-3"><a href="#cb89-3"></a><span class="st">  </span><span class="kw">group_by</span>(continent, country) <span class="op">%&gt;%</span></span>
<span id="cb89-4"><a href="#cb89-4"></a><span class="st">  </span><span class="co">## within country, take (lifeExp in year i) - (lifeExp in year i - 1)</span></span>
<span id="cb89-5"><a href="#cb89-5"></a><span class="st">  </span><span class="co">## positive means lifeExp went up, negative means it went down</span></span>
<span id="cb89-6"><a href="#cb89-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">le_delta =</span> lifeExp <span class="op">-</span><span class="st"> </span><span class="kw">lag</span>(lifeExp)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb89-7"><a href="#cb89-7"></a><span class="st">  </span><span class="co">## within country, retain the worst lifeExp change = smallest or most negative</span></span>
<span id="cb89-8"><a href="#cb89-8"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">worst_le_delta =</span> <span class="kw">min</span>(le_delta, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb89-9"><a href="#cb89-9"></a><span class="st">  </span><span class="co">## within continent, retain the row with the lowest worst_le_delta</span></span>
<span id="cb89-10"><a href="#cb89-10"></a><span class="st">  </span><span class="kw">top_n</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dt">wt =</span> worst_le_delta) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb89-11"><a href="#cb89-11"></a><span class="st">  </span><span class="kw">arrange</span>(worst_le_delta)</span>
<span id="cb89-12"><a href="#cb89-12"></a><span class="co">#&gt; `summarise()` regrouping output by &#39;continent&#39; (override with `.groups` argument)</span></span>
<span id="cb89-13"><a href="#cb89-13"></a><span class="co">#&gt; # A tibble: 5 x 3</span></span>
<span id="cb89-14"><a href="#cb89-14"></a><span class="co">#&gt; # Groups:   continent [5]</span></span>
<span id="cb89-15"><a href="#cb89-15"></a><span class="co">#&gt;   continent country     worst_le_delta</span></span>
<span id="cb89-16"><a href="#cb89-16"></a><span class="co">#&gt;   &lt;fct&gt;     &lt;fct&gt;                &lt;dbl&gt;</span></span>
<span id="cb89-17"><a href="#cb89-17"></a><span class="co">#&gt; 1 Africa    Rwanda             -20.4  </span></span>
<span id="cb89-18"><a href="#cb89-18"></a><span class="co">#&gt; 2 Asia      Cambodia            -9.10 </span></span>
<span id="cb89-19"><a href="#cb89-19"></a><span class="co">#&gt; 3 Americas  El Salvador         -1.51 </span></span>
<span id="cb89-20"><a href="#cb89-20"></a><span class="co">#&gt; 4 Europe    Montenegro          -1.46 </span></span>
<span id="cb89-21"><a href="#cb89-21"></a><span class="co">#&gt; 5 Oceania   Australia            0.170</span></span></code></pre></div>
<p>Ponder that for a while. The subject matter and the code. Mostly you’re seeing what genocide looks like in dry statistics on average life expectancy.</p>
<p>Break the code into pieces, starting at the top, and inspect the intermediate results. That’s certainly how I was able to <em>write</em> such a thing. These commands do not <a href="https://tinyurl.com/athenaforehead">leap fully formed out of anyone’s forehead</a> – they are built up gradually, with lots of errors and refinements along the way. I’m not even sure it’s a great idea to do so much manipulation in one fell swoop. Is the statement above really hard for you to read? If yes, then by all means break it into pieces and make some intermediate objects. Your code should be easy to write and read when you’re done.</p>
<p>In later tutorials, we’ll explore more of dplyr, such as operations based on two datasets.</p>
</div>
<div id="resources-1" class="section level2">
<h2><span class="header-section-number">7.11</span> Resources</h2>
<p>dplyr official stuff:</p>
<ul>
<li>Package home <a href="https://CRAN.R-project.org/package=dplyr">on CRAN</a>.
<ul>
<li>Note there are several vignettes, with the <a href="https://cran.r-project.org/web/packages/dplyr/vignettes/dplyr.html">introduction</a> being the most relevant right now.</li>
<li>The <a href="https://cran.r-project.org/web/packages/dplyr/vignettes/window-functions.html">one on window functions</a> will also be interesting to you now.</li>
</ul></li>
<li>Development home <a href="https://github.com/hadley/dplyr">on GitHub</a>.</li>
<li><a href="https://www.dropbox.com/sh/i8qnluwmuieicxc/AAAgt9tIKoIm7WZKIyK25lh6a">Tutorial HW delivered</a> (note this links to a DropBox folder) at useR! 2014 conference.</li>
</ul>
<p><a href="https://github.com/rstudio/cheatsheets/raw/master/data-transformation.pdf">RStudio Data Transformation Cheat Sheet</a>, covering dplyr. Remember you can get to these via <em>Help &gt; Cheatsheets.</em></p>
<p><a href="https://r4ds.had.co.nz/transform.html">Data transformation</a> chapter of <a href="https://r4ds.had.co.nz">R for Data Science</a> <span class="citation">(Wickham and Grolemund <a href="#ref-wickham2016" role="doc-biblioref">2016</a>)</span>.</p>
<!--TODO: This should probably be updated with something more recent-->
<p><a href="https://github.com/tjmahr/MadR_Pipelines">Excellent slides</a> on pipelines and dplyr by TJ Mahr, talk given to the Madison R Users Group.</p>
<!--TODO: This should probably be updated with something more recent-->
<p>Blog post <a href="https://www.dataschool.io/dplyr-tutorial-for-faster-data-manipulation-in-r/">Hands-on dplyr tutorial for faster data manipulation in R</a> by Data School, that includes a link to an R Markdown document and links to videos.</p>
<p>Chapter @ref(join-cheatsheet): cheatsheet I made for dplyr join functions (not relevant yet but soon).</p>
<!--RStudio Links-->
<!--HappyGitWithR Links-->
<!--Package Links-->
<!--Shiny links-->
<!--Publications-->
<!--R Documentation-->
<!--Wikipedia Links-->
<!--Misc. Links-->
<!--chapter:end:007_dplyr-single-table.Rmd-->
</div>
</div>
<div id="tidy-data" class="section level1">
<h1><span class="header-section-number">8</span> Tidy data</h1>
<p><a href="https://github.com/jennybc/lotr-tidy#readme">Tidy data using Lord of the Rings</a>: tidy data, tidyr.</p>
<!--RStudio Links-->
<!--HappyGitWithR Links-->
<!--Package Links-->
<!--Shiny links-->
<!--Publications-->
<!--R Documentation-->
<!--Wikipedia Links-->
<!--Misc. Links-->
<!--chapter:end:008_tidy-data.Rmd-->
</div>
<div id="import-export" class="section level1">
<h1><span class="header-section-number">9</span> Writing and reading files</h1>
<!--Original content: https://stat545.com/block026_file-out-in.html-->
<div id="file-io-overview" class="section level2">
<h2><span class="header-section-number">9.1</span> File I/O overview</h2>
<p>We’ve been loading the Gapminder data as a data frame from the gapminder data package. We haven’t been explicitly writing any data or derived results to file. In real life, you’ll bring rectangular data into and out of R all the time. Sometimes you’ll need to do same for non-rectangular objects.</p>
<p>How do you do this? What issues should you think about?</p>
<div id="data-import-mindset" class="section level3">
<h3><span class="header-section-number">9.1.1</span> Data import mindset</h3>
<p>Data import generally feels one of two ways:</p>
<ul>
<li>“Surprise me!” This is the attitude you must adopt when you first get a dataset. You are just happy to import without an error. You start to explore. You discover flaws in the data and/or the import. You address them. Lather, rinse, repeat.</li>
<li>“Another day in paradise.” This is the attitude when you bring in a tidy dataset you have maniacally cleaned in one or more cleaning scripts. There should be no surprises. You should express your expectations about the data in formal assertions at the very start of these downstream scripts.</li>
</ul>
<p>In the second case, and as the first cases progresses, you actually know a lot about how the data is / should be. My main import advice: <strong>use the arguments of your import function to get as far as you can, as fast as possible</strong>. Novice code often has a great deal of unnecessary post import fussing around. Read the docs for the import functions and take maximum advantage of the arguments to control the import.</p>
</div>
<div id="data-export-mindset" class="section level3">
<h3><span class="header-section-number">9.1.2</span> Data export mindset</h3>
<p>There will be many occasions when you need to write data from R. Two main examples:</p>
<ul>
<li>a tidy ready-to-analyze dataset that you heroically created from messy data</li>
<li>a numerical result from data aggregation or modelling or statistical inference</li>
</ul>
<p>First tip: <strong>today’s outputs are tomorrow’s inputs</strong>. Think back on all the pain you have suffered importing data and don’t inflict such pain on yourself!</p>
<p>Second tip: don’t be too cute or clever. A plain text file that is readable by a human being in a text editor should be your default until you have <strong>actual proof</strong> that this will not work. Reading and writing to exotic or proprietary formats will be the first thing to break in the future or on a different computer. It also creates barriers for anyone who has a different toolkit than you do. Be software-agnostic. Aim for future-proof and moron-proof.</p>
<p>How does this fit with our emphasis on dynamic reporting via R Markdown? There is a time and place for everything. There are projects and documents where the scope and personnel will allow you to geek out with knitr and R Markdown. But there are lots of good reasons why (parts of) an analysis should not (only) be embedded in a dynamic report. Maybe you are just doing data cleaning to produce a valid input dataset. Maybe you are making a small but crucial contribution to a giant multi-author paper. Etc. Also remember there are other tools and workflows for making something reproducible. I’m looking at you, <a href="https://kbroman.org/minimal_make/">make</a>.</p>
</div>
</div>
<div id="load-the-tidyverse" class="section level2">
<h2><span class="header-section-number">9.2</span> Load the tidyverse</h2>
<p>The main package we will be using is <a href="https://readr.tidyverse.org">readr</a>, which provides drop-in substitute functions for <code>read.table()</code> and friends. However, to make some points about data export and import, it is nice to reorder factor levels. For that, we will use the <a href="https://forcats.tidyverse.org">forcats</a> package, which is also included in the tidyverse package.</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb90-2"><a href="#cb90-2"></a><span class="co">#&gt; -- Attaching packages ------------------</span></span>
<span id="cb90-3"><a href="#cb90-3"></a><span class="co">#&gt; v ggplot2 3.3.2     v purrr   0.3.4</span></span>
<span id="cb90-4"><a href="#cb90-4"></a><span class="co">#&gt; v tibble  3.0.3     v dplyr   1.0.2</span></span>
<span id="cb90-5"><a href="#cb90-5"></a><span class="co">#&gt; v tidyr   1.1.2     v stringr 1.4.0</span></span>
<span id="cb90-6"><a href="#cb90-6"></a><span class="co">#&gt; v readr   1.3.1     v forcats 0.5.0</span></span>
<span id="cb90-7"><a href="#cb90-7"></a><span class="co">#&gt; -- Conflicts -- tidyverse_conflicts() --</span></span>
<span id="cb90-8"><a href="#cb90-8"></a><span class="co">#&gt; x dplyr::filter() masks stats::filter()</span></span>
<span id="cb90-9"><a href="#cb90-9"></a><span class="co">#&gt; x dplyr::lag()    masks stats::lag()</span></span></code></pre></div>
</div>
<div id="locate-the-gapminder-data" class="section level2">
<h2><span class="header-section-number">9.3</span> Locate the Gapminder data</h2>
<p>We could load the data from the package as usual, but instead we will load it from tab delimited file. The gapminder package includes the data normally found in the <code>gapminder</code> data frame as a <code>.tsv</code>. So let’s get the path to that file on <em>your</em> system using the <a href="https://fs.r-lib.org/index.html"><code>fs</code> package</a>.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1"></a><span class="kw">library</span>(fs)</span>
<span id="cb91-2"><a href="#cb91-2"></a>(gap_tsv &lt;-<span class="st"> </span><span class="kw">path_package</span>(<span class="st">&quot;gapminder&quot;</span>, <span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;gapminder.tsv&quot;</span>))</span>
<span id="cb91-3"><a href="#cb91-3"></a><span class="co">#&gt; C:/Users/smaso/Documents/R/win-library/4.0/gapminder/extdata/gapminder.tsv</span></span></code></pre></div>
</div>
<div id="bring-rectangular-data-in" class="section level2">
<h2><span class="header-section-number">9.4</span> Bring rectangular data in</h2>
<p>The workhorse data import function of readr is <code>read_delim()</code>. Here we’ll use a variant, <code>read_tsv()</code>, that anticipates tab-delimited data:</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1"></a>gapminder &lt;-<span class="st"> </span><span class="kw">read_tsv</span>(gap_tsv)</span>
<span id="cb92-2"><a href="#cb92-2"></a><span class="co">#&gt; Parsed with column specification:</span></span>
<span id="cb92-3"><a href="#cb92-3"></a><span class="co">#&gt; cols(</span></span>
<span id="cb92-4"><a href="#cb92-4"></a><span class="co">#&gt;   country = col_character(),</span></span>
<span id="cb92-5"><a href="#cb92-5"></a><span class="co">#&gt;   continent = col_character(),</span></span>
<span id="cb92-6"><a href="#cb92-6"></a><span class="co">#&gt;   year = col_double(),</span></span>
<span id="cb92-7"><a href="#cb92-7"></a><span class="co">#&gt;   lifeExp = col_double(),</span></span>
<span id="cb92-8"><a href="#cb92-8"></a><span class="co">#&gt;   pop = col_double(),</span></span>
<span id="cb92-9"><a href="#cb92-9"></a><span class="co">#&gt;   gdpPercap = col_double()</span></span>
<span id="cb92-10"><a href="#cb92-10"></a><span class="co">#&gt; )</span></span>
<span id="cb92-11"><a href="#cb92-11"></a><span class="kw">str</span>(gapminder, <span class="dt">give.attr =</span> <span class="ot">FALSE</span>)</span>
<span id="cb92-12"><a href="#cb92-12"></a><span class="co">#&gt; tibble [1,704 x 6] (S3: spec_tbl_df/tbl_df/tbl/data.frame)</span></span>
<span id="cb92-13"><a href="#cb92-13"></a><span class="co">#&gt;  $ country  : chr [1:1704] &quot;Afghanistan&quot; &quot;Afghanistan&quot; &quot;Afghanistan&quot; &quot;Afghani&quot;..</span></span>
<span id="cb92-14"><a href="#cb92-14"></a><span class="co">#&gt;  $ continent: chr [1:1704] &quot;Asia&quot; &quot;Asia&quot; &quot;Asia&quot; &quot;Asia&quot; ...</span></span>
<span id="cb92-15"><a href="#cb92-15"></a><span class="co">#&gt;  $ year     : num [1:1704] 1952 1957 1962 1967 1972 ...</span></span>
<span id="cb92-16"><a href="#cb92-16"></a><span class="co">#&gt;  $ lifeExp  : num [1:1704] 28.8 30.3 32 34 36.1 ...</span></span>
<span id="cb92-17"><a href="#cb92-17"></a><span class="co">#&gt;  $ pop      : num [1:1704] 8425333 9240934 10267083 11537966 13079460 ...</span></span>
<span id="cb92-18"><a href="#cb92-18"></a><span class="co">#&gt;  $ gdpPercap: num [1:1704] 779 821 853 836 740 ...</span></span></code></pre></div>
<p>For full flexibility re: specifying the delimiter, you can always use <code>readr::read_delim()</code>.</p>
<p>There’s a similar convenience wrapper for comma-separated values, <code>read_csv()</code>.</p>
<p>The most noticeable difference between the readr functions and base is that readr does NOT convert strings to factors by default. In the grand scheme of things, this is better default behavior, although we go ahead and convert them to factor here. Do not be deceived – in general, you will do less post-import fussing if you use readr.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1"></a>gapminder &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span></span>
<span id="cb93-2"><a href="#cb93-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">country =</span> <span class="kw">factor</span>(country),</span>
<span id="cb93-3"><a href="#cb93-3"></a>         <span class="dt">continent =</span> <span class="kw">factor</span>(continent))</span>
<span id="cb93-4"><a href="#cb93-4"></a><span class="kw">str</span>(gapminder)</span>
<span id="cb93-5"><a href="#cb93-5"></a><span class="co">#&gt; tibble [1,704 x 6] (S3: spec_tbl_df/tbl_df/tbl/data.frame)</span></span>
<span id="cb93-6"><a href="#cb93-6"></a><span class="co">#&gt;  $ country  : Factor w/ 142 levels &quot;Afghanistan&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span id="cb93-7"><a href="#cb93-7"></a><span class="co">#&gt;  $ continent: Factor w/ 5 levels &quot;Africa&quot;,&quot;Americas&quot;,..: 3 3 3 3 3 3 3 3 3 3 ...</span></span>
<span id="cb93-8"><a href="#cb93-8"></a><span class="co">#&gt;  $ year     : num [1:1704] 1952 1957 1962 1967 1972 ...</span></span>
<span id="cb93-9"><a href="#cb93-9"></a><span class="co">#&gt;  $ lifeExp  : num [1:1704] 28.8 30.3 32 34 36.1 ...</span></span>
<span id="cb93-10"><a href="#cb93-10"></a><span class="co">#&gt;  $ pop      : num [1:1704] 8425333 9240934 10267083 11537966 13079460 ...</span></span>
<span id="cb93-11"><a href="#cb93-11"></a><span class="co">#&gt;  $ gdpPercap: num [1:1704] 779 821 853 836 740 ...</span></span>
<span id="cb93-12"><a href="#cb93-12"></a><span class="co">#&gt;  - attr(*, &quot;spec&quot;)=</span></span>
<span id="cb93-13"><a href="#cb93-13"></a><span class="co">#&gt;   .. cols(</span></span>
<span id="cb93-14"><a href="#cb93-14"></a><span class="co">#&gt;   ..   country = col_character(),</span></span>
<span id="cb93-15"><a href="#cb93-15"></a><span class="co">#&gt;   ..   continent = col_character(),</span></span>
<span id="cb93-16"><a href="#cb93-16"></a><span class="co">#&gt;   ..   year = col_double(),</span></span>
<span id="cb93-17"><a href="#cb93-17"></a><span class="co">#&gt;   ..   lifeExp = col_double(),</span></span>
<span id="cb93-18"><a href="#cb93-18"></a><span class="co">#&gt;   ..   pop = col_double(),</span></span>
<span id="cb93-19"><a href="#cb93-19"></a><span class="co">#&gt;   ..   gdpPercap = col_double()</span></span>
<span id="cb93-20"><a href="#cb93-20"></a><span class="co">#&gt;   .. )</span></span></code></pre></div>
<div id="bring-rectangular-data-in-summary" class="section level3">
<h3><span class="header-section-number">9.4.1</span> Bring rectangular data in – summary</h3>
<p>Default to <code>readr::read_delim()</code> and friends. Use the arguments!</p>
<p>The Gapminder data is too clean and simple to show off the great features of readr, so I encourage you to check out the part of the introduction vignette on <a href="https://cran.r-project.org/web/packages/readr/vignettes/readr.html">column types</a>. There are many variable types that you will be able to parse correctly upon import, thereby eliminating a great deal of post-import fussing.</p>
</div>
</div>
<div id="compute-something-worthy-of-export" class="section level2">
<h2><span class="header-section-number">9.5</span> Compute something worthy of export</h2>
<p>We need compute something worth writing to file. Let’s create a country-level summary of maximum life expectancy.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1"></a>gap_life_exp &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span></span>
<span id="cb94-2"><a href="#cb94-2"></a><span class="st">  </span><span class="kw">group_by</span>(country, continent) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb94-3"><a href="#cb94-3"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">life_exp =</span> <span class="kw">max</span>(lifeExp)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb94-4"><a href="#cb94-4"></a><span class="st">  </span><span class="kw">ungroup</span>()</span>
<span id="cb94-5"><a href="#cb94-5"></a><span class="co">#&gt; `summarise()` regrouping output by &#39;country&#39; (override with `.groups` argument)</span></span>
<span id="cb94-6"><a href="#cb94-6"></a>gap_life_exp</span>
<span id="cb94-7"><a href="#cb94-7"></a><span class="co">#&gt; # A tibble: 142 x 3</span></span>
<span id="cb94-8"><a href="#cb94-8"></a><span class="co">#&gt;    country     continent life_exp</span></span>
<span id="cb94-9"><a href="#cb94-9"></a><span class="co">#&gt;    &lt;fct&gt;       &lt;fct&gt;        &lt;dbl&gt;</span></span>
<span id="cb94-10"><a href="#cb94-10"></a><span class="co">#&gt;  1 Afghanistan Asia          43.8</span></span>
<span id="cb94-11"><a href="#cb94-11"></a><span class="co">#&gt;  2 Albania     Europe        76.4</span></span>
<span id="cb94-12"><a href="#cb94-12"></a><span class="co">#&gt;  3 Algeria     Africa        72.3</span></span>
<span id="cb94-13"><a href="#cb94-13"></a><span class="co">#&gt;  4 Angola      Africa        42.7</span></span>
<span id="cb94-14"><a href="#cb94-14"></a><span class="co">#&gt;  5 Argentina   Americas      75.3</span></span>
<span id="cb94-15"><a href="#cb94-15"></a><span class="co">#&gt;  6 Australia   Oceania       81.2</span></span>
<span id="cb94-16"><a href="#cb94-16"></a><span class="co">#&gt;  7 Austria     Europe        79.8</span></span>
<span id="cb94-17"><a href="#cb94-17"></a><span class="co">#&gt;  8 Bahrain     Asia          75.6</span></span>
<span id="cb94-18"><a href="#cb94-18"></a><span class="co">#&gt;  9 Bangladesh  Asia          64.1</span></span>
<span id="cb94-19"><a href="#cb94-19"></a><span class="co">#&gt; 10 Belgium     Europe        79.4</span></span>
<span id="cb94-20"><a href="#cb94-20"></a><span class="co">#&gt; # ... with 132 more rows</span></span></code></pre></div>
<p>The <code>gap_life_exp</code> data frame is an example of an intermediate result that we want to store for the future and for downstream analyses or visualizations.</p>
</div>
<div id="write-rectangular-data-out" class="section level2">
<h2><span class="header-section-number">9.6</span> Write rectangular data out</h2>
<p>The workhorse export function for rectangular data in readr is <code>write_delim()</code> and friends. Let’s use <code>write_csv()</code> to get a comma-delimited file.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1"></a><span class="kw">write_csv</span>(gap_life_exp, <span class="st">&quot;gap_life_exp.csv&quot;</span>)</span></code></pre></div>
<p>Let’s look at the first few lines of <code>gap_life_exp.csv</code>. If you’re following along, you should be able to open this file or, in a shell, use <code>head()</code> on it.</p>
<pre><code>country,continent,life_exp
Afghanistan,Asia,43.828
Albania,Europe,76.423
Algeria,Africa,72.301
Angola,Africa,42.731
Argentina,Americas,75.32</code></pre>
<p>This is pretty decent looking, though there is no visible alignment or separation into columns. Had we used the base function <code>read.csv()</code>, we would be seeing rownames and lots of quotes, unless we had explicitly shut that down. Nicer default behavior is the main reason we are using <code>readr::write_csv()</code> over <code>write.csv()</code>.</p>
<ul>
<li>It’s not really fair to complain about the lack of visible alignment. Remember we are <a href="https://twitter.com/vsbuffalo/statuses/358699162679787521">“writing data for computers”</a>. If you really want to browse around the file, use <code>View()</code> in RStudio or open it in Microsoft Excel (!) but don’t succumb to the temptation to start doing artisanal data manipulations there … get back to R and construct commands that you can re-run the next 15 times you import/clean/aggregate/export the same dataset. Trust me, it will happen.</li>
</ul>
</div>
<div id="invertibility" class="section level2">
<h2><span class="header-section-number">9.7</span> Invertibility</h2>
<p>It turns out these self-imposed rules are often in conflict with one another:</p>
<ul>
<li>Write to plain text files</li>
<li>Break analysis into pieces: the output of script <code>i</code> is an input for script <code>i + 1</code></li>
<li>Be the boss of factors: order the levels in a meaningful, usually non-alphabetical way</li>
<li>Avoid duplication of code and data</li>
</ul>
<p><strong>Example:</strong> after performing the country-level summarization, we reorder the levels of the country factor, based on life expectancy. This reordering operation is conceptually important and must be embodied in R commands stored in a script. However, as soon as we write <code>gap_life_exp</code> to a plain text file, that meta-information about the countries is lost. Upon re-import with <code>read_delim()</code> and friends, we are back to alphabetically ordered factor levels. Any measure we take to avoid this loss immediately breaks another one of our rules.</p>
<p>So what do I do? I must admit I save (and re-load) R-specific binary files. Right after I save the plain text file. <a href="https://www.wisegeek.com/what-does-it-mean-to-wear-belt-and-suspenders.htm">Belt and suspenders</a>.</p>
<p>I have toyed with the idea of writing import helper functions for a specific project, that would re-order factor levels in principled ways. They could be defined in one file and called from many. This would also have a very natural implementation within <a href="https://www.carlboettiger.info/2012/05/06/research-workflow.html">a workflow where each analytical project is an R package</a>. But so far it has seemed too much like <a href="https://seths.blog/2005/03/dont_shave_that/">yak shaving</a>. I’m intrigued by a recent discussion of putting such information in YAML frontmatter (see Martin Fenner blog post <a href="https://blog.datacite.org/using-yaml-frontmatter-with-csv/">Using YAML frontmatter with CSV</a>).</p>
</div>
<div id="reordering-the-levels-of-the-country-factor" class="section level2">
<h2><span class="header-section-number">9.8</span> Reordering the levels of the country factor</h2>
<p>The topic of factor level reordering is covered in Chapter @ref(factors-boss), so let’s Just. Do. It. I reorder the country factor levels according to the life expectancy summary we’ve already computed.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1"></a><span class="kw">head</span>(<span class="kw">levels</span>(gap_life_exp<span class="op">$</span>country)) <span class="co"># alphabetical order</span></span>
<span id="cb97-2"><a href="#cb97-2"></a><span class="co">#&gt; [1] &quot;Afghanistan&quot; &quot;Albania&quot;     &quot;Algeria&quot;     &quot;Angola&quot;      &quot;Argentina&quot;  </span></span>
<span id="cb97-3"><a href="#cb97-3"></a><span class="co">#&gt; [6] &quot;Australia&quot;</span></span>
<span id="cb97-4"><a href="#cb97-4"></a>gap_life_exp &lt;-<span class="st"> </span>gap_life_exp <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb97-5"><a href="#cb97-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">country =</span> <span class="kw">fct_reorder</span>(country, life_exp))</span>
<span id="cb97-6"><a href="#cb97-6"></a><span class="kw">head</span>(<span class="kw">levels</span>(gap_life_exp<span class="op">$</span>country)) <span class="co"># in increasing order of maximum life expectancy</span></span>
<span id="cb97-7"><a href="#cb97-7"></a><span class="co">#&gt; [1] &quot;Sierra Leone&quot; &quot;Angola&quot;       &quot;Afghanistan&quot;  &quot;Liberia&quot;      &quot;Rwanda&quot;      </span></span>
<span id="cb97-8"><a href="#cb97-8"></a><span class="co">#&gt; [6] &quot;Mozambique&quot;</span></span>
<span id="cb97-9"><a href="#cb97-9"></a><span class="kw">head</span>(gap_life_exp)</span>
<span id="cb97-10"><a href="#cb97-10"></a><span class="co">#&gt; # A tibble: 6 x 3</span></span>
<span id="cb97-11"><a href="#cb97-11"></a><span class="co">#&gt;   country     continent life_exp</span></span>
<span id="cb97-12"><a href="#cb97-12"></a><span class="co">#&gt;   &lt;fct&gt;       &lt;fct&gt;        &lt;dbl&gt;</span></span>
<span id="cb97-13"><a href="#cb97-13"></a><span class="co">#&gt; 1 Afghanistan Asia          43.8</span></span>
<span id="cb97-14"><a href="#cb97-14"></a><span class="co">#&gt; 2 Albania     Europe        76.4</span></span>
<span id="cb97-15"><a href="#cb97-15"></a><span class="co">#&gt; 3 Algeria     Africa        72.3</span></span>
<span id="cb97-16"><a href="#cb97-16"></a><span class="co">#&gt; 4 Angola      Africa        42.7</span></span>
<span id="cb97-17"><a href="#cb97-17"></a><span class="co">#&gt; 5 Argentina   Americas      75.3</span></span>
<span id="cb97-18"><a href="#cb97-18"></a><span class="co">#&gt; 6 Australia   Oceania       81.2</span></span></code></pre></div>
<p>Note that the <strong>row order of <code>gap_life_exp</code> has not changed</strong>. I could choose to reorder the rows of the data frame if, for example, I was about to prepare a table to present to people. But I’m not, so I won’t.</p>
</div>
<div id="saverds-and-readrds" class="section level2">
<h2><span class="header-section-number">9.9</span> <code>saveRDS()</code> and <code>readRDS()</code></h2>
<p>If you have a data frame AND you have exerted yourself to rationalize the factor levels, you have my blessing to save it to file in a way that will preserve this hard work upon re-import. Use <code>saveRDS()</code>.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1"></a><span class="kw">saveRDS</span>(gap_life_exp, <span class="st">&quot;gap_life_exp.rds&quot;</span>)</span></code></pre></div>
<p><code>saveRDS()</code> serializes an R object to a binary file. It’s not a file you will able to open in an editor, diff nicely with Git(Hub), or share with non-R friends. It’s a special purpose, limited use function that I use in specific situations.</p>
<p>The opposite of <code>saveRDS()</code> is <code>readRDS()</code>. You must assign the return value to an object. I highly recommend you assign back to the same name as before. Why confuse yourself?!?</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1"></a><span class="kw">rm</span>(gap_life_exp)</span>
<span id="cb99-2"><a href="#cb99-2"></a>gap_life_exp</span>
<span id="cb99-3"><a href="#cb99-3"></a><span class="co">#&gt; Error in eval(expr, envir, enclos): object &#39;gap_life_exp&#39; not found</span></span>
<span id="cb99-4"><a href="#cb99-4"></a>gap_life_exp &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;gap_life_exp.rds&quot;</span>)</span>
<span id="cb99-5"><a href="#cb99-5"></a>gap_life_exp</span>
<span id="cb99-6"><a href="#cb99-6"></a><span class="co">#&gt; # A tibble: 142 x 3</span></span>
<span id="cb99-7"><a href="#cb99-7"></a><span class="co">#&gt;    country     continent life_exp</span></span>
<span id="cb99-8"><a href="#cb99-8"></a><span class="co">#&gt;    &lt;fct&gt;       &lt;fct&gt;        &lt;dbl&gt;</span></span>
<span id="cb99-9"><a href="#cb99-9"></a><span class="co">#&gt;  1 Afghanistan Asia          43.8</span></span>
<span id="cb99-10"><a href="#cb99-10"></a><span class="co">#&gt;  2 Albania     Europe        76.4</span></span>
<span id="cb99-11"><a href="#cb99-11"></a><span class="co">#&gt;  3 Algeria     Africa        72.3</span></span>
<span id="cb99-12"><a href="#cb99-12"></a><span class="co">#&gt;  4 Angola      Africa        42.7</span></span>
<span id="cb99-13"><a href="#cb99-13"></a><span class="co">#&gt;  5 Argentina   Americas      75.3</span></span>
<span id="cb99-14"><a href="#cb99-14"></a><span class="co">#&gt;  6 Australia   Oceania       81.2</span></span>
<span id="cb99-15"><a href="#cb99-15"></a><span class="co">#&gt;  7 Austria     Europe        79.8</span></span>
<span id="cb99-16"><a href="#cb99-16"></a><span class="co">#&gt;  8 Bahrain     Asia          75.6</span></span>
<span id="cb99-17"><a href="#cb99-17"></a><span class="co">#&gt;  9 Bangladesh  Asia          64.1</span></span>
<span id="cb99-18"><a href="#cb99-18"></a><span class="co">#&gt; 10 Belgium     Europe        79.4</span></span>
<span id="cb99-19"><a href="#cb99-19"></a><span class="co">#&gt; # ... with 132 more rows</span></span></code></pre></div>
<p><code>saveRDS()</code> has more arguments, in particular <code>compress</code> for controlling compression, so read the help for more advanced usage. It is also very handy for saving non-rectangular objects, like a fitted regression model, that took a nontrivial amount of time to compute.</p>
<p>You will eventually hear about <code>save()</code> + <code>load()</code> and even <code>save.image()</code>. You may even see them in documentation and tutorials, but don’t be tempted. Just say no. These functions encourage unsafe practices, like storing multiple objects together and even entire workspaces. There are legitimate uses of these functions, but not in your typical data analysis.</p>
</div>
<div id="retaining-factor-levels-upon-re-import" class="section level2">
<h2><span class="header-section-number">9.10</span> Retaining factor levels upon re-import</h2>
<p>Concrete demonstration of how non-alphabetical factor level order is lost with <code>write_delim()</code> / <code>read_delim()</code> workflows but maintained with <code>saveRDS()</code> / <code>readRDS()</code>.</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1"></a>(country_levels &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">original =</span> <span class="kw">head</span>(<span class="kw">levels</span>(gap_life_exp<span class="op">$</span>country))))</span>
<span id="cb100-2"><a href="#cb100-2"></a><span class="co">#&gt; # A tibble: 6 x 1</span></span>
<span id="cb100-3"><a href="#cb100-3"></a><span class="co">#&gt;   original    </span></span>
<span id="cb100-4"><a href="#cb100-4"></a><span class="co">#&gt;   &lt;chr&gt;       </span></span>
<span id="cb100-5"><a href="#cb100-5"></a><span class="co">#&gt; 1 Sierra Leone</span></span>
<span id="cb100-6"><a href="#cb100-6"></a><span class="co">#&gt; 2 Angola      </span></span>
<span id="cb100-7"><a href="#cb100-7"></a><span class="co">#&gt; 3 Afghanistan </span></span>
<span id="cb100-8"><a href="#cb100-8"></a><span class="co">#&gt; 4 Liberia     </span></span>
<span id="cb100-9"><a href="#cb100-9"></a><span class="co">#&gt; 5 Rwanda      </span></span>
<span id="cb100-10"><a href="#cb100-10"></a><span class="co">#&gt; 6 Mozambique</span></span>
<span id="cb100-11"><a href="#cb100-11"></a><span class="kw">write_csv</span>(gap_life_exp, <span class="st">&quot;gap_life_exp.csv&quot;</span>)</span>
<span id="cb100-12"><a href="#cb100-12"></a><span class="kw">saveRDS</span>(gap_life_exp, <span class="st">&quot;gap_life_exp.rds&quot;</span>)</span>
<span id="cb100-13"><a href="#cb100-13"></a><span class="kw">rm</span>(gap_life_exp)</span>
<span id="cb100-14"><a href="#cb100-14"></a><span class="kw">head</span>(gap_life_exp) <span class="co"># will cause error! proving gap_life_exp is really gone </span></span>
<span id="cb100-15"><a href="#cb100-15"></a><span class="co">#&gt; Error in head(gap_life_exp): object &#39;gap_life_exp&#39; not found</span></span>
<span id="cb100-16"><a href="#cb100-16"></a>gap_via_csv &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;gap_life_exp.csv&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb100-17"><a href="#cb100-17"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">country =</span> <span class="kw">factor</span>(country))</span>
<span id="cb100-18"><a href="#cb100-18"></a><span class="co">#&gt; Parsed with column specification:</span></span>
<span id="cb100-19"><a href="#cb100-19"></a><span class="co">#&gt; cols(</span></span>
<span id="cb100-20"><a href="#cb100-20"></a><span class="co">#&gt;   country = col_character(),</span></span>
<span id="cb100-21"><a href="#cb100-21"></a><span class="co">#&gt;   continent = col_character(),</span></span>
<span id="cb100-22"><a href="#cb100-22"></a><span class="co">#&gt;   life_exp = col_double()</span></span>
<span id="cb100-23"><a href="#cb100-23"></a><span class="co">#&gt; )</span></span>
<span id="cb100-24"><a href="#cb100-24"></a>gap_via_rds &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;gap_life_exp.rds&quot;</span>)</span>
<span id="cb100-25"><a href="#cb100-25"></a>country_levels &lt;-<span class="st"> </span>country_levels <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb100-26"><a href="#cb100-26"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">via_csv =</span> <span class="kw">head</span>(<span class="kw">levels</span>(gap_via_csv<span class="op">$</span>country)),</span>
<span id="cb100-27"><a href="#cb100-27"></a>         <span class="dt">via_rds =</span> <span class="kw">head</span>(<span class="kw">levels</span>(gap_via_rds<span class="op">$</span>country)))</span>
<span id="cb100-28"><a href="#cb100-28"></a>country_levels</span>
<span id="cb100-29"><a href="#cb100-29"></a><span class="co">#&gt; # A tibble: 6 x 3</span></span>
<span id="cb100-30"><a href="#cb100-30"></a><span class="co">#&gt;   original     via_csv     via_rds     </span></span>
<span id="cb100-31"><a href="#cb100-31"></a><span class="co">#&gt;   &lt;chr&gt;        &lt;chr&gt;       &lt;chr&gt;       </span></span>
<span id="cb100-32"><a href="#cb100-32"></a><span class="co">#&gt; 1 Sierra Leone Afghanistan Sierra Leone</span></span>
<span id="cb100-33"><a href="#cb100-33"></a><span class="co">#&gt; 2 Angola       Albania     Angola      </span></span>
<span id="cb100-34"><a href="#cb100-34"></a><span class="co">#&gt; 3 Afghanistan  Algeria     Afghanistan </span></span>
<span id="cb100-35"><a href="#cb100-35"></a><span class="co">#&gt; 4 Liberia      Angola      Liberia     </span></span>
<span id="cb100-36"><a href="#cb100-36"></a><span class="co">#&gt; 5 Rwanda       Argentina   Rwanda      </span></span>
<span id="cb100-37"><a href="#cb100-37"></a><span class="co">#&gt; 6 Mozambique   Australia   Mozambique</span></span></code></pre></div>
<p>Note how the original, post-reordering country factor levels are restored using the <code>saveRDS()</code> / <code>readRDS()</code> strategy but revert to alphabetical ordering using <code>write_csv()</code> / <code>read_csv()</code>.</p>
</div>
<div id="dput-and-dget" class="section level2">
<h2><span class="header-section-number">9.11</span> <code>dput()</code> and <code>dget()</code></h2>
<p>One last method of saving and restoring data deserves a mention: <code>dput()</code> and <code>dget()</code>. <code>dput()</code> offers this odd combination of features: it creates a plain text representation of an R object which still manages to be quite opaque. If you use the <code>file =</code> argument, <code>dput()</code> can write this representation to file but you won’t be tempted to actually read that thing. <code>dput()</code> creates an R-specific-but-not-binary representation. Let’s try it out.</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1"></a><span class="co">## first restore gap_life_exp with our desired country factor level order</span></span>
<span id="cb101-2"><a href="#cb101-2"></a>gap_life_exp &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;gap_life_exp.rds&quot;</span>)</span>
<span id="cb101-3"><a href="#cb101-3"></a><span class="kw">dput</span>(gap_life_exp, <span class="st">&quot;gap_life_exp-dput.txt&quot;</span>)</span></code></pre></div>
<p>Now let’s look at the first few lines of the file <code>gap_life_exp-dput.txt</code>.</p>
<pre><code>structure(list(country = structure(c(3L, 107L, 74L, 2L, 98L, 
138L, 128L, 102L, 49L, 125L, 26L, 56L, 96L, 47L, 75L, 85L, 18L, 
12L, 37L, 24L, 133L, 13L, 16L, 117L, 84L, 82L, 53L, 9L, 28L, 
120L, 22L, 104L, 114L, 109L, 115L, 23L, 73L, 97L, 66L, 71L, 15L, 
29L, 20L, 122L, 134L, 40L, 35L, 123L, 38L, 126L, 60L, 25L, 7L, 
39L, 59L, 141L, 86L, 140L, 51L, 63L, 64L, 52L, 121L, 135L, 132L, </code></pre>
<p>Huh? Don’t worry about it. Remember we are <a href="https://twitter.com/vsbuffalo/statuses/358699162679787521">“writing data for computers”</a>. The partner function <code>dget()</code> reads this representation back in.</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1"></a>gap_life_exp_dget &lt;-<span class="st"> </span><span class="kw">dget</span>(<span class="st">&quot;gap_life_exp-dput.txt&quot;</span>)</span>
<span id="cb103-2"><a href="#cb103-2"></a>country_levels &lt;-<span class="st"> </span>country_levels <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb103-3"><a href="#cb103-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">via_dput =</span> <span class="kw">head</span>(<span class="kw">levels</span>(gap_life_exp_dget<span class="op">$</span>country)))</span>
<span id="cb103-4"><a href="#cb103-4"></a>country_levels</span>
<span id="cb103-5"><a href="#cb103-5"></a><span class="co">#&gt; # A tibble: 6 x 4</span></span>
<span id="cb103-6"><a href="#cb103-6"></a><span class="co">#&gt;   original     via_csv     via_rds      via_dput    </span></span>
<span id="cb103-7"><a href="#cb103-7"></a><span class="co">#&gt;   &lt;chr&gt;        &lt;chr&gt;       &lt;chr&gt;        &lt;chr&gt;       </span></span>
<span id="cb103-8"><a href="#cb103-8"></a><span class="co">#&gt; 1 Sierra Leone Afghanistan Sierra Leone Sierra Leone</span></span>
<span id="cb103-9"><a href="#cb103-9"></a><span class="co">#&gt; 2 Angola       Albania     Angola       Angola      </span></span>
<span id="cb103-10"><a href="#cb103-10"></a><span class="co">#&gt; 3 Afghanistan  Algeria     Afghanistan  Afghanistan </span></span>
<span id="cb103-11"><a href="#cb103-11"></a><span class="co">#&gt; 4 Liberia      Angola      Liberia      Liberia     </span></span>
<span id="cb103-12"><a href="#cb103-12"></a><span class="co">#&gt; 5 Rwanda       Argentina   Rwanda       Rwanda      </span></span>
<span id="cb103-13"><a href="#cb103-13"></a><span class="co">#&gt; 6 Mozambique   Australia   Mozambique   Mozambique</span></span></code></pre></div>
<p>Note how the original, post-reordering country factor levels are restored using the <code>dput()</code> / <code>dget()</code> strategy.</p>
<p>But why on earth would you ever do this?</p>
<p>The main application of this is <a href="https://stackoverflow.com/questions/5963269/how-to-make-a-great-r-reproducible-example">the creation of highly portable, self-contained minimal examples</a>. For example, if you want to pose a question on a forum or directly to an expert, it might be required or just plain courteous to NOT attach any data files. You will need a monolithic, plain text blob that defines any necessary objects and has the necessary code. <code>dput()</code> can be helpful for producing the piece of code that defines the object. If you <code>dput()</code> without specifying a file, you can copy the return value from Console and paste into a script. Or you can write to file and copy from there or add R commands below.</p>
</div>
<div id="other-types-of-objects-to-use-dput-or-saverds-on" class="section level2">
<h2><span class="header-section-number">9.12</span> Other types of objects to use <code>dput()</code> or <code>saveRDS()</code> on</h2>
<p>My special dispensation to abandon human-readable, plain text files is even broader than I’ve let on. Above, I give my blessing to store data.frames via <code>dput()</code> and/or <code>saveRDS()</code>, when you’ve done some rational factor level re-ordering. The same advice and mechanics apply a bit more broadly: you’re also allowed to use R-specific file formats to save vital non-rectangular objects, such as a fitted nonlinear mixed effects model or a classification and regression tree.</p>
</div>
<div id="clean-up" class="section level2">
<h2><span class="header-section-number">9.13</span> Clean up</h2>
<p>We’ve written several files in this tutorial. Some of them are not of lasting value or have confusing filenames. I choose to delete them, while demonstrating some of the many functions R offers for interacting with the filesystem. It’s up to you whether you want to submit this command or not.</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1"></a><span class="kw">file.remove</span>(<span class="kw">list.files</span>(<span class="dt">pattern =</span> <span class="st">&quot;^gap_life_exp&quot;</span>))</span>
<span id="cb104-2"><a href="#cb104-2"></a><span class="co">#&gt; [1] TRUE TRUE TRUE</span></span></code></pre></div>
</div>
<div id="pitfalls-of-delimited-files" class="section level2">
<h2><span class="header-section-number">9.14</span> Pitfalls of delimited files</h2>
<p>If a delimited file contains fields where a human being has typed, be crazy paranoid because people do really nutty things. Especially people who aren’t in the business of programming and have never had to compute on text. Claim: a person’s regular expression skill is inversely proportional to the skill required to handle the files they create. Implication: if someone has never heard of regular expressions, prepare for lots of pain working with their files.</p>
<p>When the header fields (often, but not always, the variable names) or actual data contain the delimiter, it can lead to parsing and import failures. Two popular delimiters are the comma <code>,</code> and the TAB <code>\t</code> and humans tend to use these when typing. If you can design this problem away during data capture, such as by using a drop down menu on an input form, by all means do so. Sometimes this is impossible or undesirable and you must deal with fairly free form text. That’s a good time to allow/force text to be protected with quotes, because it will make parsing the delimited file go more smoothly.</p>
<p>Sometimes, instead of rigid tab-delimiting, whitespace is used as the delimiter. That is, in fact, the default for both <code>read.table()</code> and <code>write.table()</code>. Assuming you will write/read variable names from the first line (a.k.a. the <code>header</code> in <code>write.table()</code> and <code>read.table()</code>), they must be valid R variable names … or they will be coerced into something valid. So, for these two reasons, it is good practice to use “one word” variable names whenever possible. If you need to evoke multiple words, use <code>snake_case</code> or <code>camelCase</code> to cope. <strong>Example:</strong> the header entry for the field holding the subject’s last name should be <code>last_name</code> or <code>lastName</code> NOT <code>last name</code>. With the readr package, “column names are left as is, not munged into valid R identifiers (i.e. there is no <code>check.names = TRUE</code>)”. So you can get away with whitespace in variable names and yet I recommend that you do not.</p>
</div>
<div id="resources-2" class="section level2">
<h2><span class="header-section-number">9.15</span> Resources</h2>
<p><a href="http://r4ds.had.co.nz/data-import.html">Data import</a> chapter of <a href="https://r4ds.had.co.nz">R for Data Science</a> by Hadley Wickham and Garrett Grolemund <span class="citation">(<a href="#ref-wickham2016" role="doc-biblioref">2016</a>)</span>.</p>
<p>White et al.’s “Nine simple ways to make it easier to (re)use your data” <span class="citation">(<a href="#ref-white2013" role="doc-biblioref">2013</a>)</span>.</p>
<ul>
<li>First appeared <a href="https://doi.org/10.7287/peerj.preprints.7v2">in PeerJ Preprints</a></li>
<li>Published in <a href="https://ojs.library.queensu.ca/index.php/IEE/article/view/4608">Ideas in Ecology and Evolution in 2013</a></li>
<li>Section 4 “Use Standard Data Formats” is especially good reading.</li>
</ul>
<p>Wickham’s paper on tidy data in the Journal of Statistical Software <span class="citation">(<a href="#ref-wickham2014" role="doc-biblioref">2014</a>)</span>.</p>
<ul>
<li>Available as a PDF <a href="http://vita.had.co.nz/papers/tidy-data.pdf">here</a></li>
</ul>
<p>Data Manipulation in R by Phil Spector <span class="citation">(<a href="#ref-spector2008" role="doc-biblioref">2008</a>)</span>.</p>
<ul>
<li>Available via <a href="https://www.springer.com/gp/book/9780387747309">SpringerLink</a></li>
<li><a href="https://www.stat.berkeley.edu/%7Espector/">Author’s webpage</a></li>
<li><a href="https://books.google.com/books?id=grfuq1twFe4C&amp;lpg=PP1&amp;dq=data%2520manipulation%2520spector&amp;pg=PP1#v=onepage&amp;q&amp;f=false">GoogleBooks search</a></li>
<li>See Chapter 2 (“Reading and Writing Data”)</li>
</ul>
<!--RStudio Links-->
<!--HappyGitWithR Links-->
<!--Package Links-->
<!--Shiny links-->
<!--Publications-->
<!--R Documentation-->
<!--Wikipedia Links-->
<!--Misc. Links-->
<!--chapter:end:009_import-export.Rmd-->
</div>
</div>
<div id="part-data-analysis-2" class="section level1 unnumbered">
<h1>(PART) Data analysis 2</h1>
</div>
<div id="factors-boss" class="section level1">
<h1><span class="header-section-number">10</span> Be the boss of your factors</h1>
<!--Original content: https://stat545.com/block029_factors.html-->
<div id="factors-where-they-fit-in" class="section level2">
<h2><span class="header-section-number">10.1</span> Factors: where they fit in</h2>
<p>We’ve spent a lot of time working with big, beautiful data frames, like the Gapminder data. But we also need to manage the individual variables housed within.</p>
<p>Factors are the variable type that useRs love to hate. It is how we store truly categorical information in R. The values a factor can take on are called the <strong>levels</strong>. For example, the levels of the factor <code>continent</code> in Gapminder are are “Africa”, “Americas”, etc. and this is what’s usually presented to your eyeballs by R. In general, the levels are friendly human-readable character strings, like “male/female” and “control/treated”. But <em>never ever ever</em> forget that, under the hood, R is really storing integer codes 1, 2, 3, etc.</p>
<p>This <a href="https://en.wikipedia.org/wiki/Janus">Janus</a>-like nature of factors means they are rich with booby traps for the unsuspecting but they are a necessary evil. I recommend you learn how to be the boss of your factors. The pros far outweigh the cons. Specifically in modelling and figure-making, factors are anticipated and accommodated by the functions and packages you will want to exploit.</p>
<p><strong>The worst kind of factor is the stealth factor.</strong> The variable that you think of as character, but that is actually a factor (numeric!!). This is a classic R gotcha. Check your variable types explicitly when things seem weird. It happens to the best of us.</p>
<p>Where do stealth factors come from? Base R has a burning desire to turn character information into factor. The happens most commonly at data import via <code>read.table()</code> and friends. But <code>data.frame()</code> and other functions are also eager to convert character to factor. To shut this down, use <code>stringsAsFactors = FALSE</code> in <code>read.table()</code> and <code>data.frame()</code> or – even better – <strong>use the tidyverse</strong>! For data import, use <code>readr::read_csv()</code>, <code>readr::read_tsv()</code>, etc. For data frame creation, use <code>tibble::tibble()</code>. And so on.</p>
<p>Good articles about how the factor fiasco came to be:</p>
<ul>
<li><a href="https://simplystatistics.org/2015/07/24/stringsasfactors-an-unauthorized-biography">stringsAsFactors: An unauthorized biography</a> by Roger Peng</li>
<li><a href="https://notstatschat.tumblr.com/post/124987394001/stringsasfactors-sigh">stringsAsFactors = &lt;sigh&gt;</a> by Thomas Lumley</li>
</ul>
</div>
<div id="the-forcats-package" class="section level2">
<h2><span class="header-section-number">10.2</span> The forcats package</h2>
<p><a href="https://forcats.tidyverse.org">forcats</a> is a core package in the tidyverse. It is installed via <code>install.packages("tidyverse")</code>, and loaded with <code>library(tidyverse)</code>. You can also install via <code>install.packages("forcats")</code>and load it yourself separately as needed via <code>library(forcats)</code>. Main functions start with <code>fct_</code>. There really is no coherent family of base functions that forcats replaces – that’s why it’s such a welcome addition.</p>
<p>Currently this lesson will be mostly code vs prose. See the previous lesson for more discussion during the transition.</p>
</div>
<div id="load-forcats-and-gapminder" class="section level2">
<h2><span class="header-section-number">10.3</span> Load forcats and gapminder</h2>
<p>I choose to load the tidyverse, which will load forcats, among other packages we use incidentally below.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb105-2"><a href="#cb105-2"></a><span class="co">#&gt; -- Attaching packages ------------------</span></span>
<span id="cb105-3"><a href="#cb105-3"></a><span class="co">#&gt; v ggplot2 3.3.2     v purrr   0.3.4</span></span>
<span id="cb105-4"><a href="#cb105-4"></a><span class="co">#&gt; v tibble  3.0.3     v dplyr   1.0.2</span></span>
<span id="cb105-5"><a href="#cb105-5"></a><span class="co">#&gt; v tidyr   1.1.2     v stringr 1.4.0</span></span>
<span id="cb105-6"><a href="#cb105-6"></a><span class="co">#&gt; v readr   1.3.1     v forcats 0.5.0</span></span>
<span id="cb105-7"><a href="#cb105-7"></a><span class="co">#&gt; -- Conflicts -- tidyverse_conflicts() --</span></span>
<span id="cb105-8"><a href="#cb105-8"></a><span class="co">#&gt; x dplyr::filter() masks stats::filter()</span></span>
<span id="cb105-9"><a href="#cb105-9"></a><span class="co">#&gt; x dplyr::lag()    masks stats::lag()</span></span></code></pre></div>
<p>Also load gapminder.</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1"></a><span class="kw">library</span>(gapminder)</span></code></pre></div>
</div>
<div id="factor-inspection" class="section level2">
<h2><span class="header-section-number">10.4</span> Factor inspection</h2>
<p>Get to know your factor before you start touching it! It’s polite. Let’s use <code>gapminder$continent</code> as our example.</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1"></a><span class="kw">str</span>(gapminder<span class="op">$</span>continent)</span>
<span id="cb107-2"><a href="#cb107-2"></a><span class="co">#&gt;  Factor w/ 5 levels &quot;Africa&quot;,&quot;Americas&quot;,..: 3 3 3 3 3 3 3 3 3 3 ...</span></span>
<span id="cb107-3"><a href="#cb107-3"></a><span class="kw">levels</span>(gapminder<span class="op">$</span>continent)</span>
<span id="cb107-4"><a href="#cb107-4"></a><span class="co">#&gt; [1] &quot;Africa&quot;   &quot;Americas&quot; &quot;Asia&quot;     &quot;Europe&quot;   &quot;Oceania&quot;</span></span>
<span id="cb107-5"><a href="#cb107-5"></a><span class="kw">nlevels</span>(gapminder<span class="op">$</span>continent)</span>
<span id="cb107-6"><a href="#cb107-6"></a><span class="co">#&gt; [1] 5</span></span>
<span id="cb107-7"><a href="#cb107-7"></a><span class="kw">class</span>(gapminder<span class="op">$</span>continent)</span>
<span id="cb107-8"><a href="#cb107-8"></a><span class="co">#&gt; [1] &quot;factor&quot;</span></span></code></pre></div>
<p>To get a frequency table as a tibble, from a tibble, use <code>dplyr::count()</code>. To get similar from a free-range factor, use <code>forcats::fct_count()</code>.</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1"></a>gapminder <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb108-2"><a href="#cb108-2"></a><span class="st">  </span><span class="kw">count</span>(continent)</span>
<span id="cb108-3"><a href="#cb108-3"></a><span class="co">#&gt; # A tibble: 5 x 2</span></span>
<span id="cb108-4"><a href="#cb108-4"></a><span class="co">#&gt;   continent     n</span></span>
<span id="cb108-5"><a href="#cb108-5"></a><span class="co">#&gt;   &lt;fct&gt;     &lt;int&gt;</span></span>
<span id="cb108-6"><a href="#cb108-6"></a><span class="co">#&gt; 1 Africa      624</span></span>
<span id="cb108-7"><a href="#cb108-7"></a><span class="co">#&gt; 2 Americas    300</span></span>
<span id="cb108-8"><a href="#cb108-8"></a><span class="co">#&gt; 3 Asia        396</span></span>
<span id="cb108-9"><a href="#cb108-9"></a><span class="co">#&gt; 4 Europe      360</span></span>
<span id="cb108-10"><a href="#cb108-10"></a><span class="co">#&gt; 5 Oceania      24</span></span>
<span id="cb108-11"><a href="#cb108-11"></a><span class="kw">fct_count</span>(gapminder<span class="op">$</span>continent)</span>
<span id="cb108-12"><a href="#cb108-12"></a><span class="co">#&gt; # A tibble: 5 x 2</span></span>
<span id="cb108-13"><a href="#cb108-13"></a><span class="co">#&gt;   f            n</span></span>
<span id="cb108-14"><a href="#cb108-14"></a><span class="co">#&gt;   &lt;fct&gt;    &lt;int&gt;</span></span>
<span id="cb108-15"><a href="#cb108-15"></a><span class="co">#&gt; 1 Africa     624</span></span>
<span id="cb108-16"><a href="#cb108-16"></a><span class="co">#&gt; 2 Americas   300</span></span>
<span id="cb108-17"><a href="#cb108-17"></a><span class="co">#&gt; 3 Asia       396</span></span>
<span id="cb108-18"><a href="#cb108-18"></a><span class="co">#&gt; 4 Europe     360</span></span>
<span id="cb108-19"><a href="#cb108-19"></a><span class="co">#&gt; 5 Oceania     24</span></span></code></pre></div>
</div>
<div id="dropping-unused-levels" class="section level2">
<h2><span class="header-section-number">10.5</span> Dropping unused levels</h2>
<p>Just because you drop all the rows corresponding to a specific factor level, the levels of the factor itself do not change. Sometimes all these unused levels can come back to haunt you later, e.g., in figure legends.</p>
<p>Watch what happens to the levels of <code>country</code> (= nothing) when we filter Gapminder to a handful of countries.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1"></a><span class="kw">nlevels</span>(gapminder<span class="op">$</span>country)</span>
<span id="cb109-2"><a href="#cb109-2"></a><span class="co">#&gt; [1] 142</span></span>
<span id="cb109-3"><a href="#cb109-3"></a>h_countries &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Egypt&quot;</span>, <span class="st">&quot;Haiti&quot;</span>, <span class="st">&quot;Romania&quot;</span>, <span class="st">&quot;Thailand&quot;</span>, <span class="st">&quot;Venezuela&quot;</span>)</span>
<span id="cb109-4"><a href="#cb109-4"></a>h_gap &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span></span>
<span id="cb109-5"><a href="#cb109-5"></a><span class="st">  </span><span class="kw">filter</span>(country <span class="op">%in%</span><span class="st"> </span>h_countries)</span>
<span id="cb109-6"><a href="#cb109-6"></a><span class="kw">nlevels</span>(h_gap<span class="op">$</span>country)</span>
<span id="cb109-7"><a href="#cb109-7"></a><span class="co">#&gt; [1] 142</span></span></code></pre></div>
<p>Even though <code>h_gap</code> only has data for a handful of countries, we are still schlepping around all 142 levels from the original <code>gapminder</code> tibble.</p>
<p>How can you get rid of them? The base function <code>droplevels()</code> operates on all the factors in a data frame or on a single factor. The function <code>forcats::fct_drop()</code> operates on a factor.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1"></a>h_gap_dropped &lt;-<span class="st"> </span>h_gap <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb110-2"><a href="#cb110-2"></a><span class="st">  </span><span class="kw">droplevels</span>()</span>
<span id="cb110-3"><a href="#cb110-3"></a><span class="kw">nlevels</span>(h_gap_dropped<span class="op">$</span>country)</span>
<span id="cb110-4"><a href="#cb110-4"></a><span class="co">#&gt; [1] 5</span></span>
<span id="cb110-5"><a href="#cb110-5"></a></span>
<span id="cb110-6"><a href="#cb110-6"></a><span class="co">## use forcats::fct_drop() on a free-range factor</span></span>
<span id="cb110-7"><a href="#cb110-7"></a>h_gap<span class="op">$</span>country <span class="op">%&gt;%</span></span>
<span id="cb110-8"><a href="#cb110-8"></a><span class="st">  </span><span class="kw">fct_drop</span>() <span class="op">%&gt;%</span></span>
<span id="cb110-9"><a href="#cb110-9"></a><span class="st">  </span><span class="kw">levels</span>()</span>
<span id="cb110-10"><a href="#cb110-10"></a><span class="co">#&gt; [1] &quot;Egypt&quot;     &quot;Haiti&quot;     &quot;Romania&quot;   &quot;Thailand&quot;  &quot;Venezuela&quot;</span></span></code></pre></div>
<p><strong>Exercise:</strong> Filter the gapminder data down to rows where population is less than a quarter of a million, i.e. 250,000. Get rid of the unused factor levels for <code>country</code> and <code>continent</code> in different ways, such as:</p>
<ul>
<li><code>droplevels()</code></li>
<li><code>fct_drop()</code> inside <code>mutate()</code></li>
<li><code>fct_dopr()</code> with <code>mutate_at()</code> or <code>mutate_if()</code></li>
</ul>
</div>
<div id="reorder-factors" class="section level2">
<h2><span class="header-section-number">10.6</span> Change order of the levels, principled</h2>
<p>By default, factor levels are ordered alphabetically. Which might as well be random, when you think about it! It is preferable to order the levels according to some principle:</p>
<ul>
<li>Frequency. Make the most common level the first and so on.</li>
<li>Another variable. Order factor levels according to a summary statistic for another variable. <strong>Example:</strong> order Gapminder countries by life expectancy.</li>
</ul>
<p>First, let’s order continent by frequency, forwards and backwards. This is often a great idea for tables and figures, esp. frequency barplots.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1"></a><span class="co">## default order is alphabetical</span></span>
<span id="cb111-2"><a href="#cb111-2"></a>gapminder<span class="op">$</span>continent <span class="op">%&gt;%</span></span>
<span id="cb111-3"><a href="#cb111-3"></a><span class="st">  </span><span class="kw">levels</span>()</span>
<span id="cb111-4"><a href="#cb111-4"></a><span class="co">#&gt; [1] &quot;Africa&quot;   &quot;Americas&quot; &quot;Asia&quot;     &quot;Europe&quot;   &quot;Oceania&quot;</span></span>
<span id="cb111-5"><a href="#cb111-5"></a></span>
<span id="cb111-6"><a href="#cb111-6"></a><span class="co">## order by frequency</span></span>
<span id="cb111-7"><a href="#cb111-7"></a>gapminder<span class="op">$</span>continent <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb111-8"><a href="#cb111-8"></a><span class="st">  </span><span class="kw">fct_infreq</span>() <span class="op">%&gt;%</span></span>
<span id="cb111-9"><a href="#cb111-9"></a><span class="st">  </span><span class="kw">levels</span>()</span>
<span id="cb111-10"><a href="#cb111-10"></a><span class="co">#&gt; [1] &quot;Africa&quot;   &quot;Asia&quot;     &quot;Europe&quot;   &quot;Americas&quot; &quot;Oceania&quot;</span></span>
<span id="cb111-11"><a href="#cb111-11"></a></span>
<span id="cb111-12"><a href="#cb111-12"></a><span class="co">## backwards!</span></span>
<span id="cb111-13"><a href="#cb111-13"></a>gapminder<span class="op">$</span>continent <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb111-14"><a href="#cb111-14"></a><span class="st">  </span><span class="kw">fct_infreq</span>() <span class="op">%&gt;%</span></span>
<span id="cb111-15"><a href="#cb111-15"></a><span class="st">  </span><span class="kw">fct_rev</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb111-16"><a href="#cb111-16"></a><span class="st">  </span><span class="kw">levels</span>()</span>
<span id="cb111-17"><a href="#cb111-17"></a><span class="co">#&gt; [1] &quot;Oceania&quot;  &quot;Americas&quot; &quot;Europe&quot;   &quot;Asia&quot;     &quot;Africa&quot;</span></span></code></pre></div>
<p>These two barcharts of frequency by continent differ only in the order of the continents. Which do you prefer?</p>
<p><img src="010_factors_files/figure-html/unnamed-chunk-9-1.png" width="49%" /><img src="010_factors_files/figure-html/unnamed-chunk-9-2.png" width="49%" /></p>
<p>Now we order <code>country</code> by another variable, forwards and backwards. This other variable is usually quantitative and you will order the factor according to a grouped summary. The factor is the grouping variable and the default summarizing function is <code>median()</code> but you can specify something else.</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1"></a><span class="co">## order countries by median life expectancy</span></span>
<span id="cb112-2"><a href="#cb112-2"></a><span class="kw">fct_reorder</span>(gapminder<span class="op">$</span>country, gapminder<span class="op">$</span>lifeExp) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb112-3"><a href="#cb112-3"></a><span class="st">  </span><span class="kw">levels</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()</span>
<span id="cb112-4"><a href="#cb112-4"></a><span class="co">#&gt; [1] &quot;Sierra Leone&quot;  &quot;Guinea-Bissau&quot; &quot;Afghanistan&quot;   &quot;Angola&quot;       </span></span>
<span id="cb112-5"><a href="#cb112-5"></a><span class="co">#&gt; [5] &quot;Somalia&quot;       &quot;Guinea&quot;</span></span>
<span id="cb112-6"><a href="#cb112-6"></a></span>
<span id="cb112-7"><a href="#cb112-7"></a><span class="co">## order accoring to minimum life exp instead of median</span></span>
<span id="cb112-8"><a href="#cb112-8"></a><span class="kw">fct_reorder</span>(gapminder<span class="op">$</span>country, gapminder<span class="op">$</span>lifeExp, min) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb112-9"><a href="#cb112-9"></a><span class="st">  </span><span class="kw">levels</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()</span>
<span id="cb112-10"><a href="#cb112-10"></a><span class="co">#&gt; [1] &quot;Rwanda&quot;       &quot;Afghanistan&quot;  &quot;Gambia&quot;       &quot;Angola&quot;       &quot;Sierra Leone&quot;</span></span>
<span id="cb112-11"><a href="#cb112-11"></a><span class="co">#&gt; [6] &quot;Cambodia&quot;</span></span>
<span id="cb112-12"><a href="#cb112-12"></a></span>
<span id="cb112-13"><a href="#cb112-13"></a><span class="co">## backwards!</span></span>
<span id="cb112-14"><a href="#cb112-14"></a><span class="kw">fct_reorder</span>(gapminder<span class="op">$</span>country, gapminder<span class="op">$</span>lifeExp, <span class="dt">.desc =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb112-15"><a href="#cb112-15"></a><span class="st">  </span><span class="kw">levels</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()</span>
<span id="cb112-16"><a href="#cb112-16"></a><span class="co">#&gt; [1] &quot;Iceland&quot;     &quot;Japan&quot;       &quot;Sweden&quot;      &quot;Switzerland&quot; &quot;Netherlands&quot;</span></span>
<span id="cb112-17"><a href="#cb112-17"></a><span class="co">#&gt; [6] &quot;Norway&quot;</span></span></code></pre></div>
<p>Example of why we reorder factor levels: often makes plots much better! When a factor is mapped to x or y, it should almost always be reordered by the quantitative variable you are mapping to the other one.</p>
<p>Compare the interpretability of these two plots of life expectancy in Asian countries in 2007. The <em>only difference</em> is the order of the <code>country</code> factor. Which one do you find easier to learn from?</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1"></a>gap_asia_<span class="dv">2007</span> &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(year <span class="op">==</span><span class="st"> </span><span class="dv">2007</span>, continent <span class="op">==</span><span class="st"> &quot;Asia&quot;</span>)</span>
<span id="cb113-2"><a href="#cb113-2"></a><span class="kw">ggplot</span>(gap_asia_<span class="dv">2007</span>, <span class="kw">aes</span>(<span class="dt">x =</span> lifeExp, <span class="dt">y =</span> country)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</span>
<span id="cb113-3"><a href="#cb113-3"></a><span class="kw">ggplot</span>(gap_asia_<span class="dv">2007</span>, <span class="kw">aes</span>(<span class="dt">x =</span> lifeExp, <span class="dt">y =</span> <span class="kw">fct_reorder</span>(country, lifeExp))) <span class="op">+</span></span>
<span id="cb113-4"><a href="#cb113-4"></a><span class="st">  </span><span class="kw">geom_point</span>()</span></code></pre></div>
<p><img src="010_factors_files/figure-html/alpha-order-silly-1.png" width="49%" /><img src="010_factors_files/figure-html/alpha-order-silly-2.png" width="49%" /></p>
<p>Use <code>fct_reorder2()</code> when you have a line chart of a quantitative x against another quantitative y and your factor provides the color. This way the legend appears in some order as the data! Contrast the legend on the left with the one on the right.</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1"></a>h_countries &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Egypt&quot;</span>, <span class="st">&quot;Haiti&quot;</span>, <span class="st">&quot;Romania&quot;</span>, <span class="st">&quot;Thailand&quot;</span>, <span class="st">&quot;Venezuela&quot;</span>)</span>
<span id="cb114-2"><a href="#cb114-2"></a>h_gap &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span></span>
<span id="cb114-3"><a href="#cb114-3"></a><span class="st">  </span><span class="kw">filter</span>(country <span class="op">%in%</span><span class="st"> </span>h_countries) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb114-4"><a href="#cb114-4"></a><span class="st">  </span><span class="kw">droplevels</span>()</span>
<span id="cb114-5"><a href="#cb114-5"></a><span class="kw">ggplot</span>(h_gap, <span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> lifeExp, <span class="dt">color =</span> country)) <span class="op">+</span></span>
<span id="cb114-6"><a href="#cb114-6"></a><span class="st">  </span><span class="kw">geom_line</span>()</span>
<span id="cb114-7"><a href="#cb114-7"></a><span class="kw">ggplot</span>(h_gap, <span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> lifeExp,</span>
<span id="cb114-8"><a href="#cb114-8"></a>                  <span class="dt">color =</span> <span class="kw">fct_reorder2</span>(country, year, lifeExp))) <span class="op">+</span></span>
<span id="cb114-9"><a href="#cb114-9"></a><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb114-10"><a href="#cb114-10"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">color =</span> <span class="st">&quot;country&quot;</span>)</span></code></pre></div>
<p><img src="010_factors_files/figure-html/legends-made-for-humans-1.png" width="49%" /><img src="010_factors_files/figure-html/legends-made-for-humans-2.png" width="49%" /></p>
</div>
<div id="change-order-of-the-levels-because-i-said-so" class="section level2">
<h2><span class="header-section-number">10.7</span> Change order of the levels, “because I said so”</h2>
<p>Sometimes you just want to hoist one or more levels to the front. Why? Because I said so. This resembles what we do when we move variables to the front with <code>dplyr::select(special_var, everything())</code>.</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1"></a>h_gap<span class="op">$</span>country <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">levels</span>()</span>
<span id="cb115-2"><a href="#cb115-2"></a><span class="co">#&gt; [1] &quot;Egypt&quot;     &quot;Haiti&quot;     &quot;Romania&quot;   &quot;Thailand&quot;  &quot;Venezuela&quot;</span></span>
<span id="cb115-3"><a href="#cb115-3"></a>h_gap<span class="op">$</span>country <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">fct_relevel</span>(<span class="st">&quot;Romania&quot;</span>, <span class="st">&quot;Haiti&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">levels</span>()</span>
<span id="cb115-4"><a href="#cb115-4"></a><span class="co">#&gt; [1] &quot;Romania&quot;   &quot;Haiti&quot;     &quot;Egypt&quot;     &quot;Thailand&quot;  &quot;Venezuela&quot;</span></span></code></pre></div>
<p>This might be useful if you are preparing a report for, say, the Romanian government. The reason for always putting Romania first has nothing to do with the <em>data</em>, it is important for external reasons and you need a way to express this.</p>
</div>
<div id="recode-the-levels" class="section level2">
<h2><span class="header-section-number">10.8</span> Recode the levels</h2>
<p>Sometimes you have better ideas about what certain levels should be. This is called recoding.</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1"></a>i_gap &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb116-2"><a href="#cb116-2"></a><span class="st">  </span><span class="kw">filter</span>(country <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;United States&quot;</span>, <span class="st">&quot;Sweden&quot;</span>, <span class="st">&quot;Australia&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb116-3"><a href="#cb116-3"></a><span class="st">  </span><span class="kw">droplevels</span>()</span>
<span id="cb116-4"><a href="#cb116-4"></a>i_gap<span class="op">$</span>country <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">levels</span>()</span>
<span id="cb116-5"><a href="#cb116-5"></a><span class="co">#&gt; [1] &quot;Australia&quot;     &quot;Sweden&quot;        &quot;United States&quot;</span></span>
<span id="cb116-6"><a href="#cb116-6"></a>i_gap<span class="op">$</span>country <span class="op">%&gt;%</span></span>
<span id="cb116-7"><a href="#cb116-7"></a><span class="st">  </span><span class="kw">fct_recode</span>(<span class="st">&quot;USA&quot;</span> =<span class="st"> &quot;United States&quot;</span>, <span class="st">&quot;Oz&quot;</span> =<span class="st"> &quot;Australia&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">levels</span>()</span>
<span id="cb116-8"><a href="#cb116-8"></a><span class="co">#&gt; [1] &quot;Oz&quot;     &quot;Sweden&quot; &quot;USA&quot;</span></span></code></pre></div>
<p><strong>Exercise:</strong> Isolate the data for <code>"Australia"</code>, <code>"Korea, Dem. Rep."</code>, and <code>"Korea, Rep."</code> in the 2000x. Revalue the country factor levels to <code>"Oz"</code>, <code>"North Korea"</code>, and <code>"South Korea"</code>.</p>
</div>
<div id="grow-a-factor" class="section level2">
<h2><span class="header-section-number">10.9</span> Grow a factor</h2>
<p>Let’s create two data frames, each with data from two countries, dropping unused factor levels.</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1"></a>df1 &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span></span>
<span id="cb117-2"><a href="#cb117-2"></a><span class="st">  </span><span class="kw">filter</span>(country <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;United States&quot;</span>, <span class="st">&quot;Mexico&quot;</span>), year <span class="op">&gt;</span><span class="st"> </span><span class="dv">2000</span>) <span class="op">%&gt;%</span></span>
<span id="cb117-3"><a href="#cb117-3"></a><span class="st">  </span><span class="kw">droplevels</span>()</span>
<span id="cb117-4"><a href="#cb117-4"></a>df2 &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span></span>
<span id="cb117-5"><a href="#cb117-5"></a><span class="st">  </span><span class="kw">filter</span>(country <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;France&quot;</span>, <span class="st">&quot;Germany&quot;</span>), year <span class="op">&gt;</span><span class="st"> </span><span class="dv">2000</span>) <span class="op">%&gt;%</span></span>
<span id="cb117-6"><a href="#cb117-6"></a><span class="st">  </span><span class="kw">droplevels</span>()</span></code></pre></div>
<p>The <code>country</code> factors in <code>df1</code> and <code>df2</code> have different levels.</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1"></a><span class="kw">levels</span>(df1<span class="op">$</span>country)</span>
<span id="cb118-2"><a href="#cb118-2"></a><span class="co">#&gt; [1] &quot;Mexico&quot;        &quot;United States&quot;</span></span>
<span id="cb118-3"><a href="#cb118-3"></a><span class="kw">levels</span>(df2<span class="op">$</span>country)</span>
<span id="cb118-4"><a href="#cb118-4"></a><span class="co">#&gt; [1] &quot;France&quot;  &quot;Germany&quot;</span></span></code></pre></div>
<p>Can you just combine them?</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1"></a><span class="kw">c</span>(df1<span class="op">$</span>country, df2<span class="op">$</span>country)</span>
<span id="cb119-2"><a href="#cb119-2"></a><span class="co">#&gt; [1] 1 1 2 2 1 1 2 2</span></span></code></pre></div>
<p>Umm, no. That is wrong on many levels! Use <code>fct_c()</code> to do this.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1"></a><span class="kw">fct_c</span>(df1<span class="op">$</span>country, df2<span class="op">$</span>country)</span>
<span id="cb120-2"><a href="#cb120-2"></a><span class="co">#&gt; [1] Mexico        Mexico        United States United States France       </span></span>
<span id="cb120-3"><a href="#cb120-3"></a><span class="co">#&gt; [6] France        Germany       Germany      </span></span>
<span id="cb120-4"><a href="#cb120-4"></a><span class="co">#&gt; Levels: Mexico United States France Germany</span></span></code></pre></div>
<p><strong>Exercise:</strong> Explore how different forms of row binding work behave here, in terms of the <code>country</code> variable in the result.</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1"></a><span class="kw">bind_rows</span>(df1, df2)</span>
<span id="cb121-2"><a href="#cb121-2"></a><span class="co">#&gt; # A tibble: 8 x 6</span></span>
<span id="cb121-3"><a href="#cb121-3"></a><span class="co">#&gt;   country       continent  year lifeExp       pop gdpPercap</span></span>
<span id="cb121-4"><a href="#cb121-4"></a><span class="co">#&gt;   &lt;fct&gt;         &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;     &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb121-5"><a href="#cb121-5"></a><span class="co">#&gt; 1 Mexico        Americas   2002    74.9 102479927    10742.</span></span>
<span id="cb121-6"><a href="#cb121-6"></a><span class="co">#&gt; 2 Mexico        Americas   2007    76.2 108700891    11978.</span></span>
<span id="cb121-7"><a href="#cb121-7"></a><span class="co">#&gt; 3 United States Americas   2002    77.3 287675526    39097.</span></span>
<span id="cb121-8"><a href="#cb121-8"></a><span class="co">#&gt; 4 United States Americas   2007    78.2 301139947    42952.</span></span>
<span id="cb121-9"><a href="#cb121-9"></a><span class="co">#&gt; 5 France        Europe     2002    79.6  59925035    28926.</span></span>
<span id="cb121-10"><a href="#cb121-10"></a><span class="co">#&gt; 6 France        Europe     2007    80.7  61083916    30470.</span></span>
<span id="cb121-11"><a href="#cb121-11"></a><span class="co">#&gt; 7 Germany       Europe     2002    78.7  82350671    30036.</span></span>
<span id="cb121-12"><a href="#cb121-12"></a><span class="co">#&gt; 8 Germany       Europe     2007    79.4  82400996    32170.</span></span>
<span id="cb121-13"><a href="#cb121-13"></a><span class="kw">rbind</span>(df1, df2)</span>
<span id="cb121-14"><a href="#cb121-14"></a><span class="co">#&gt; # A tibble: 8 x 6</span></span>
<span id="cb121-15"><a href="#cb121-15"></a><span class="co">#&gt;   country       continent  year lifeExp       pop gdpPercap</span></span>
<span id="cb121-16"><a href="#cb121-16"></a><span class="co">#&gt;   &lt;fct&gt;         &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;     &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb121-17"><a href="#cb121-17"></a><span class="co">#&gt; 1 Mexico        Americas   2002    74.9 102479927    10742.</span></span>
<span id="cb121-18"><a href="#cb121-18"></a><span class="co">#&gt; 2 Mexico        Americas   2007    76.2 108700891    11978.</span></span>
<span id="cb121-19"><a href="#cb121-19"></a><span class="co">#&gt; 3 United States Americas   2002    77.3 287675526    39097.</span></span>
<span id="cb121-20"><a href="#cb121-20"></a><span class="co">#&gt; 4 United States Americas   2007    78.2 301139947    42952.</span></span>
<span id="cb121-21"><a href="#cb121-21"></a><span class="co">#&gt; 5 France        Europe     2002    79.6  59925035    28926.</span></span>
<span id="cb121-22"><a href="#cb121-22"></a><span class="co">#&gt; 6 France        Europe     2007    80.7  61083916    30470.</span></span>
<span id="cb121-23"><a href="#cb121-23"></a><span class="co">#&gt; 7 Germany       Europe     2002    78.7  82350671    30036.</span></span>
<span id="cb121-24"><a href="#cb121-24"></a><span class="co">#&gt; 8 Germany       Europe     2007    79.4  82400996    32170.</span></span></code></pre></div>
<!--RStudio Links-->
<!--HappyGitWithR Links-->
<!--Package Links-->
<!--Shiny links-->
<!--Publications-->
<!--R Documentation-->
<!--Wikipedia Links-->
<!--Misc. Links-->
<!--chapter:end:010_factors.Rmd-->
</div>
</div>
<div id="character-vectors" class="section level1">
<h1><span class="header-section-number">11</span> Character vectors</h1>
<!--Original content: https://stat545.com/block028_character-data.html-->
<div id="character-vectors-where-they-fit-in" class="section level2">
<h2><span class="header-section-number">11.1</span> Character vectors: where they fit in</h2>
<p>We’ve spent a lot of time working with big, beautiful data frames. That are clean and wholesome, like the Gapminder data.</p>
<p>But real life will be much nastier. You will bring data into R from the outside world and discover there are problems. You might think: how hard can it be to deal with character data? And the answer is: it can be very hard!</p>
<ul>
<li><a href="https://stackstatus.net/post/147710624694/outage-postmortem-july-20-2016">Stack Exchange outage</a></li>
<li><a href="https://emailregex.com">Regexes to validate/match email addresses</a></li>
<li><a href="https://davidvgalbraith.com/how-i-fixed-atom/">Fixing an Atom bug</a></li>
</ul>
<p>Here we discuss common remedial tasks for cleaning and transforming character data, also known as “strings”. A data frame or tibble will consist of one or more <em>atomic vectors</em> of a certain class. This lesson deals with things you can do with vectors of class <code>character</code>.</p>
</div>
<div id="resources-3" class="section level2">
<h2><span class="header-section-number">11.2</span> Resources</h2>
<p>I start with this because we cannot possibly do this topic justice in a short amount of time. Our goal is to make you aware of broad classes of problems and their respective solutions. Once you have a character problem in real life, these resources will be extremely helpful as you delve deeper.</p>
<div id="manipulating-character-vectors" class="section level3">
<h3><span class="header-section-number">11.2.1</span> Manipulating character vectors</h3>
<ul>
<li><a href="https://stringr.tidyverse.org">stringr package</a>.
<ul>
<li>A core package in the <code>tidyverse.</code> It is installed via <code>install.packages("tidyverse")</code> and also loaded via <code>library(tidyverse)</code>. Of course, you can also install or load it individually.</li>
<li>Main functions start with <code>str_</code>. Auto-complete is your friend.</li>
<li>Replacements for base functions re: string manipulation and regular expressions (see below).</li>
<li>Main advantages over base functions: greater consistency about inputs and outputs. Outputs are more ready for your next analytical task.</li>
</ul></li>
<li><a href="https://tidyr.tidyverse.org">tidyr package</a>.
<ul>
<li>Especially useful for functions that split one character vector into many and <em>vice versa</em>: <code>separate()</code>, <code>unite()</code>, <code>extract()</code>.</li>
</ul></li>
<li>Base functions: <code>nchar()</code>, <code>strsplit()</code>, <code>substr()</code>, <code>paste()</code>, <code>paste0()</code>.</li>
<li>The <a href="https://glue.tidyverse.org">glue package</a> is fantastic for string interpolation. If <code>stringr::str_interp()</code> doesn’t get your job done, check out the glue package.</li>
</ul>
</div>
<div id="regular-expressions-resources" class="section level3">
<h3><span class="header-section-number">11.2.2</span> Regular expressions resources</h3>
<p>A God-awful and powerful language for expressing patterns to match in text or for search-and-replace. Frequently described as “write only”, because regular expressions are easier to write than to read/understand. And they are not particularly easy to write.</p>
<ul>
<li>We again prefer the <a href="https://CRAN.R-project.org/package=stringr">stringr package</a> over base functions. Why?
<ul>
<li>Wraps <a href="https://CRAN.R-project.org/package=stringi">stringi</a>, which is a great place to look if stringr isn’t powerful enough.</li>
<li>Standardized on <a href="http://userguide.icu-project.org/strings/regexp">ICU regular expressions</a>, so you can stop toggling <code>perl = TRUE/FALSE</code> at random.</li>
<li>Results come back in a form that is much friendlier for downstream work.</li>
</ul></li>
<li>The <a href="https://r4ds.had.co.nz/strings.html">Strings chapter</a> of <a href="https://r4ds.had.co.nz">R for Data Science</a> <span class="citation">(Wickham and Grolemund <a href="#ref-wickham2016" role="doc-biblioref">2016</a>)</span> is a great resource.</li>
<li>RStudio Cheat Sheet on <a href="https://www.rstudio.com/wp-content/uploads/2016/09/RegExCheatsheet.pdf">Regular Expressions in R</a>.</li>
<li>Regex testers:
<ul>
<li><a href="https://regex101.com">regex101.com</a></li>
<li><a href="https://regexr.com">regexr.com</a></li>
</ul></li>
<li><a href="https://github.com/kevinushey/rex"><code>rex</code> R package</a>: make regular expression from human readable expressions.</li>
<li>Base functions: <code>grep()</code> and friends.</li>
</ul>
</div>
<div id="character-encoding-resources" class="section level3">
<h3><span class="header-section-number">11.2.3</span> Character encoding resources</h3>
<ul>
<li><a href="https://r4ds.had.co.nz/data-import.html#readr-strings">Strings subsection of data import chapter</a> in <a href="https://r4ds.had.co.nz">R for Data Science</a> <span class="citation">(Wickham and Grolemund <a href="#ref-wickham2016" role="doc-biblioref">2016</a>)</span>.</li>
<li>Screeds on the Minimum Everyone Needs to Know about encoding:
<ul>
<li><a href="https://www.joelonsoftware.com/2003/10/08/the-absolute-minimum-every-software-developer-absolutely-positively-must-know-about-unicode-and-character-sets-no-excuses/">The Absolute Minimum Every Software Developer Absolutely, Positively Must Know About Unicode and Character Sets (No Excuses!)</a></li>
<li><a href="http://kunststube.net/encoding/">What Every Programmer Absolutely, Positively Needs To Know About Encodings And Character Sets To Work With Text</a></li>
</ul></li>
<li>Chapter @ref(character-encoding) - I’ve translated this blog post <a href="https://www.justinweiss.com/articles/3-steps-to-fix-encoding-problems-in-ruby/">Guide to fixing encoding problems in Ruby</a> into R as the first step to developing a lesson.</li>
</ul>
</div>
<div id="character-vectors-that-live-in-a-data-frame" class="section level3">
<h3><span class="header-section-number">11.2.4</span> Character vectors that live in a data frame</h3>
<ul>
<li>Certain operations are facilitated by tidyr. These are described below.</li>
<li>For a general discussion of how to work on variables that live in a data frame, see <a href="#oldies">Vectors versus tibbles</a> (Appendix @ref(oldies)).</li>
</ul>
</div>
</div>
<div id="load-the-tidyverse-which-includes-stringr" class="section level2">
<h2><span class="header-section-number">11.3</span> Load the tidyverse, which includes stringr</h2>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb122-2"><a href="#cb122-2"></a><span class="co">#&gt; -- Attaching packages ------------------</span></span>
<span id="cb122-3"><a href="#cb122-3"></a><span class="co">#&gt; v ggplot2 3.3.2     v purrr   0.3.4</span></span>
<span id="cb122-4"><a href="#cb122-4"></a><span class="co">#&gt; v tibble  3.0.3     v dplyr   1.0.2</span></span>
<span id="cb122-5"><a href="#cb122-5"></a><span class="co">#&gt; v tidyr   1.1.2     v stringr 1.4.0</span></span>
<span id="cb122-6"><a href="#cb122-6"></a><span class="co">#&gt; v readr   1.3.1     v forcats 0.5.0</span></span>
<span id="cb122-7"><a href="#cb122-7"></a><span class="co">#&gt; -- Conflicts -- tidyverse_conflicts() --</span></span>
<span id="cb122-8"><a href="#cb122-8"></a><span class="co">#&gt; x dplyr::filter() masks stats::filter()</span></span>
<span id="cb122-9"><a href="#cb122-9"></a><span class="co">#&gt; x dplyr::lag()    masks stats::lag()</span></span></code></pre></div>
</div>
<div id="regex-free-string-manipulation-with-stringr-and-tidyr" class="section level2">
<h2><span class="header-section-number">11.4</span> Regex-free string manipulation with stringr and tidyr</h2>
<p>Basic string manipulation tasks:</p>
<ul>
<li>Study a single character vector
<ul>
<li>How long are the strings?</li>
<li>Presence/absence of a literal string</li>
</ul></li>
<li>Operate on a single character vector
<ul>
<li>Keep/discard elements that contain a literal string</li>
<li>Split into two or more character vectors using a fixed delimiter<br />
</li>
<li>Snip out pieces of the strings based on character position</li>
<li>Collapse into a single string</li>
</ul></li>
<li>Operate on two or more character vectors
<ul>
<li>Glue them together element-wise to get a new character vector.</li>
</ul></li>
</ul>
<p><em><code>fruit</code>, <code>words</code>, and <code>sentences</code> are character vectors that ship with stringr for practicing.</em></p>
<div id="detect-or-filter-on-a-target-string" class="section level3">
<h3><span class="header-section-number">11.4.1</span> Detect or filter on a target string</h3>
<p>Determine presence/absence of a literal string with <code>str_detect()</code>. Spoiler: later we see <code>str_detect()</code> also detects regular expressions.</p>
<p>Which fruits actually use the word “fruit”?</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1"></a><span class="kw">str_detect</span>(fruit, <span class="dt">pattern =</span> <span class="st">&quot;fruit&quot;</span>)</span>
<span id="cb123-2"><a href="#cb123-2"></a><span class="co">#&gt;  [1] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE</span></span>
<span id="cb123-3"><a href="#cb123-3"></a><span class="co">#&gt; [13] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE</span></span>
<span id="cb123-4"><a href="#cb123-4"></a><span class="co">#&gt; [25] FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE</span></span>
<span id="cb123-5"><a href="#cb123-5"></a><span class="co">#&gt; [37] FALSE FALSE  TRUE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE</span></span>
<span id="cb123-6"><a href="#cb123-6"></a><span class="co">#&gt; [49] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE</span></span>
<span id="cb123-7"><a href="#cb123-7"></a><span class="co">#&gt; [61] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE</span></span>
<span id="cb123-8"><a href="#cb123-8"></a><span class="co">#&gt; [73] FALSE FALSE  TRUE FALSE FALSE FALSE  TRUE FALSE</span></span></code></pre></div>
<p>What’s the easiest way to get the actual fruits that match? Use <code>str_subset()</code> to keep only the matching elements. Note we are storing this new vector <code>my_fruit</code> to use in later examples!</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1"></a>(my_fruit &lt;-<span class="st"> </span><span class="kw">str_subset</span>(fruit, <span class="dt">pattern =</span> <span class="st">&quot;fruit&quot;</span>))</span>
<span id="cb124-2"><a href="#cb124-2"></a><span class="co">#&gt; [1] &quot;breadfruit&quot;   &quot;dragonfruit&quot;  &quot;grapefruit&quot;   &quot;jackfruit&quot;    &quot;kiwi fruit&quot;  </span></span>
<span id="cb124-3"><a href="#cb124-3"></a><span class="co">#&gt; [6] &quot;passionfruit&quot; &quot;star fruit&quot;   &quot;ugli fruit&quot;</span></span></code></pre></div>
</div>
<div id="string-splitting-by-delimiter" class="section level3">
<h3><span class="header-section-number">11.4.2</span> String splitting by delimiter</h3>
<p>Use <code>stringr::str_split()</code> to split strings on a delimiter. Some of our fruits are compound words, like “grapefruit”, but some have two words, like “ugli fruit”. Here we split on a single space <code>" "</code>, but show use of a regular expression later.</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1"></a><span class="kw">str_split</span>(my_fruit, <span class="dt">pattern =</span> <span class="st">&quot; &quot;</span>)</span>
<span id="cb125-2"><a href="#cb125-2"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb125-3"><a href="#cb125-3"></a><span class="co">#&gt; [1] &quot;breadfruit&quot;</span></span>
<span id="cb125-4"><a href="#cb125-4"></a><span class="co">#&gt; </span></span>
<span id="cb125-5"><a href="#cb125-5"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb125-6"><a href="#cb125-6"></a><span class="co">#&gt; [1] &quot;dragonfruit&quot;</span></span>
<span id="cb125-7"><a href="#cb125-7"></a><span class="co">#&gt; </span></span>
<span id="cb125-8"><a href="#cb125-8"></a><span class="co">#&gt; [[3]]</span></span>
<span id="cb125-9"><a href="#cb125-9"></a><span class="co">#&gt; [1] &quot;grapefruit&quot;</span></span>
<span id="cb125-10"><a href="#cb125-10"></a><span class="co">#&gt; </span></span>
<span id="cb125-11"><a href="#cb125-11"></a><span class="co">#&gt; [[4]]</span></span>
<span id="cb125-12"><a href="#cb125-12"></a><span class="co">#&gt; [1] &quot;jackfruit&quot;</span></span>
<span id="cb125-13"><a href="#cb125-13"></a><span class="co">#&gt; </span></span>
<span id="cb125-14"><a href="#cb125-14"></a><span class="co">#&gt; [[5]]</span></span>
<span id="cb125-15"><a href="#cb125-15"></a><span class="co">#&gt; [1] &quot;kiwi&quot;  &quot;fruit&quot;</span></span>
<span id="cb125-16"><a href="#cb125-16"></a><span class="co">#&gt; </span></span>
<span id="cb125-17"><a href="#cb125-17"></a><span class="co">#&gt; [[6]]</span></span>
<span id="cb125-18"><a href="#cb125-18"></a><span class="co">#&gt; [1] &quot;passionfruit&quot;</span></span>
<span id="cb125-19"><a href="#cb125-19"></a><span class="co">#&gt; </span></span>
<span id="cb125-20"><a href="#cb125-20"></a><span class="co">#&gt; [[7]]</span></span>
<span id="cb125-21"><a href="#cb125-21"></a><span class="co">#&gt; [1] &quot;star&quot;  &quot;fruit&quot;</span></span>
<span id="cb125-22"><a href="#cb125-22"></a><span class="co">#&gt; </span></span>
<span id="cb125-23"><a href="#cb125-23"></a><span class="co">#&gt; [[8]]</span></span>
<span id="cb125-24"><a href="#cb125-24"></a><span class="co">#&gt; [1] &quot;ugli&quot;  &quot;fruit&quot;</span></span></code></pre></div>
<p>It’s bummer that we get a <em>list</em> back. But it must be so! In full generality, split strings must return list, because who knows how many pieces there will be?</p>
<p>If you are willing to commit to the number of pieces, you can use <code>str_split_fixed()</code> and get a character matrix. You’re welcome!</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1"></a><span class="kw">str_split_fixed</span>(my_fruit, <span class="dt">pattern =</span> <span class="st">&quot; &quot;</span>, <span class="dt">n =</span> <span class="dv">2</span>)</span>
<span id="cb126-2"><a href="#cb126-2"></a><span class="co">#&gt;      [,1]           [,2]   </span></span>
<span id="cb126-3"><a href="#cb126-3"></a><span class="co">#&gt; [1,] &quot;breadfruit&quot;   &quot;&quot;     </span></span>
<span id="cb126-4"><a href="#cb126-4"></a><span class="co">#&gt; [2,] &quot;dragonfruit&quot;  &quot;&quot;     </span></span>
<span id="cb126-5"><a href="#cb126-5"></a><span class="co">#&gt; [3,] &quot;grapefruit&quot;   &quot;&quot;     </span></span>
<span id="cb126-6"><a href="#cb126-6"></a><span class="co">#&gt; [4,] &quot;jackfruit&quot;    &quot;&quot;     </span></span>
<span id="cb126-7"><a href="#cb126-7"></a><span class="co">#&gt; [5,] &quot;kiwi&quot;         &quot;fruit&quot;</span></span>
<span id="cb126-8"><a href="#cb126-8"></a><span class="co">#&gt; [6,] &quot;passionfruit&quot; &quot;&quot;     </span></span>
<span id="cb126-9"><a href="#cb126-9"></a><span class="co">#&gt; [7,] &quot;star&quot;         &quot;fruit&quot;</span></span>
<span id="cb126-10"><a href="#cb126-10"></a><span class="co">#&gt; [8,] &quot;ugli&quot;         &quot;fruit&quot;</span></span></code></pre></div>
<p>If the to-be-split variable lives in a data frame, <code>tidyr::separate()</code> will split it into 2 or more variables.</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1"></a>my_fruit_df &lt;-<span class="st"> </span><span class="kw">tibble</span>(my_fruit)</span>
<span id="cb127-2"><a href="#cb127-2"></a>my_fruit_df <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb127-3"><a href="#cb127-3"></a><span class="st">  </span><span class="kw">separate</span>(my_fruit, <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;pre&quot;</span>, <span class="st">&quot;post&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot; &quot;</span>)</span>
<span id="cb127-4"><a href="#cb127-4"></a><span class="co">#&gt; Warning: Expected 2 pieces. Missing pieces filled with `NA` in 5 rows [1, 2, 3,</span></span>
<span id="cb127-5"><a href="#cb127-5"></a><span class="co">#&gt; 4, 6].</span></span>
<span id="cb127-6"><a href="#cb127-6"></a><span class="co">#&gt; # A tibble: 8 x 2</span></span>
<span id="cb127-7"><a href="#cb127-7"></a><span class="co">#&gt;   pre          post </span></span>
<span id="cb127-8"><a href="#cb127-8"></a><span class="co">#&gt;   &lt;chr&gt;        &lt;chr&gt;</span></span>
<span id="cb127-9"><a href="#cb127-9"></a><span class="co">#&gt; 1 breadfruit   &lt;NA&gt; </span></span>
<span id="cb127-10"><a href="#cb127-10"></a><span class="co">#&gt; 2 dragonfruit  &lt;NA&gt; </span></span>
<span id="cb127-11"><a href="#cb127-11"></a><span class="co">#&gt; 3 grapefruit   &lt;NA&gt; </span></span>
<span id="cb127-12"><a href="#cb127-12"></a><span class="co">#&gt; 4 jackfruit    &lt;NA&gt; </span></span>
<span id="cb127-13"><a href="#cb127-13"></a><span class="co">#&gt; 5 kiwi         fruit</span></span>
<span id="cb127-14"><a href="#cb127-14"></a><span class="co">#&gt; 6 passionfruit &lt;NA&gt; </span></span>
<span id="cb127-15"><a href="#cb127-15"></a><span class="co">#&gt; 7 star         fruit</span></span>
<span id="cb127-16"><a href="#cb127-16"></a><span class="co">#&gt; 8 ugli         fruit</span></span></code></pre></div>
</div>
<div id="substring-extraction-and-replacement-by-position" class="section level3">
<h3><span class="header-section-number">11.4.3</span> Substring extraction (and replacement) by position</h3>
<p>Count characters in your strings with <code>str_length()</code>. Note this is different from the length of the character vector itself.</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1"></a><span class="kw">length</span>(my_fruit)</span>
<span id="cb128-2"><a href="#cb128-2"></a><span class="co">#&gt; [1] 8</span></span>
<span id="cb128-3"><a href="#cb128-3"></a><span class="kw">str_length</span>(my_fruit)</span>
<span id="cb128-4"><a href="#cb128-4"></a><span class="co">#&gt; [1] 10 11 10  9 10 12 10 10</span></span></code></pre></div>
<p>You can snip out substrings based on character position with <code>str_sub()</code>.</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1"></a><span class="kw">head</span>(fruit) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb129-2"><a href="#cb129-2"></a><span class="st">  </span><span class="kw">str_sub</span>(<span class="dv">1</span>, <span class="dv">3</span>)</span>
<span id="cb129-3"><a href="#cb129-3"></a><span class="co">#&gt; [1] &quot;app&quot; &quot;apr&quot; &quot;avo&quot; &quot;ban&quot; &quot;bel&quot; &quot;bil&quot;</span></span></code></pre></div>
<p>The <code>start</code> and <code>end</code> arguments are vectorised. <strong>Example:</strong> a sliding 3-character window.</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1"></a><span class="kw">tibble</span>(fruit) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb130-2"><a href="#cb130-2"></a><span class="st">  </span><span class="kw">head</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb130-3"><a href="#cb130-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">snip =</span> <span class="kw">str_sub</span>(fruit, <span class="dv">1</span><span class="op">:</span><span class="dv">6</span>, <span class="dv">3</span><span class="op">:</span><span class="dv">8</span>))</span>
<span id="cb130-4"><a href="#cb130-4"></a><span class="co">#&gt; # A tibble: 6 x 2</span></span>
<span id="cb130-5"><a href="#cb130-5"></a><span class="co">#&gt;   fruit       snip </span></span>
<span id="cb130-6"><a href="#cb130-6"></a><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;</span></span>
<span id="cb130-7"><a href="#cb130-7"></a><span class="co">#&gt; 1 apple       &quot;app&quot;</span></span>
<span id="cb130-8"><a href="#cb130-8"></a><span class="co">#&gt; 2 apricot     &quot;pri&quot;</span></span>
<span id="cb130-9"><a href="#cb130-9"></a><span class="co">#&gt; 3 avocado     &quot;oca&quot;</span></span>
<span id="cb130-10"><a href="#cb130-10"></a><span class="co">#&gt; 4 banana      &quot;ana&quot;</span></span>
<span id="cb130-11"><a href="#cb130-11"></a><span class="co">#&gt; 5 bell pepper &quot; pe&quot;</span></span>
<span id="cb130-12"><a href="#cb130-12"></a><span class="co">#&gt; 6 bilberry    &quot;rry&quot;</span></span></code></pre></div>
<p>Finally, <code>str_sub()</code> also works for assignment, i.e. on the left hand side of <code>&lt;-</code>.</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1"></a>(x &lt;-<span class="st"> </span><span class="kw">head</span>(fruit, <span class="dv">3</span>))</span>
<span id="cb131-2"><a href="#cb131-2"></a><span class="co">#&gt; [1] &quot;apple&quot;   &quot;apricot&quot; &quot;avocado&quot;</span></span>
<span id="cb131-3"><a href="#cb131-3"></a><span class="kw">str_sub</span>(x, <span class="dv">1</span>, <span class="dv">3</span>) &lt;-<span class="st"> &quot;AAA&quot;</span></span>
<span id="cb131-4"><a href="#cb131-4"></a>x</span>
<span id="cb131-5"><a href="#cb131-5"></a><span class="co">#&gt; [1] &quot;AAAle&quot;   &quot;AAAicot&quot; &quot;AAAcado&quot;</span></span></code></pre></div>
</div>
<div id="collapse-a-vector" class="section level3">
<h3><span class="header-section-number">11.4.4</span> Collapse a vector</h3>
<p>You can collapse a character vector of length <code>n &gt; 1</code> to a single string with <code>str_c()</code>, which also has other uses (see the <a href="#catenate-vectors">next section</a>).</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1"></a><span class="kw">head</span>(fruit) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb132-2"><a href="#cb132-2"></a><span class="st">  </span><span class="kw">str_c</span>(<span class="dt">collapse =</span> <span class="st">&quot;, &quot;</span>)</span>
<span id="cb132-3"><a href="#cb132-3"></a><span class="co">#&gt; [1] &quot;apple, apricot, avocado, banana, bell pepper, bilberry&quot;</span></span></code></pre></div>
</div>
<div id="catenate-vectors" class="section level3">
<h3><span class="header-section-number">11.4.5</span> Create a character vector by catenating multiple vectors</h3>
<p>If you have two or more character vectors of the same length, you can glue them together element-wise, to get a new vector of that length. Here are some … awful smoothie flavors?</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1"></a><span class="kw">str_c</span>(fruit[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>], fruit[<span class="dv">5</span><span class="op">:</span><span class="dv">8</span>], <span class="dt">sep =</span> <span class="st">&quot; &amp; &quot;</span>)</span>
<span id="cb133-2"><a href="#cb133-2"></a><span class="co">#&gt; [1] &quot;apple &amp; bell pepper&quot;   &quot;apricot &amp; bilberry&quot;    &quot;avocado &amp; blackberry&quot; </span></span>
<span id="cb133-3"><a href="#cb133-3"></a><span class="co">#&gt; [4] &quot;banana &amp; blackcurrant&quot;</span></span></code></pre></div>
<p>Element-wise catenation can be combined with collapsing.</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1"></a><span class="kw">str_c</span>(fruit[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>], fruit[<span class="dv">5</span><span class="op">:</span><span class="dv">8</span>], <span class="dt">sep =</span> <span class="st">&quot; &amp; &quot;</span>, <span class="dt">collapse =</span> <span class="st">&quot;, &quot;</span>)</span>
<span id="cb134-2"><a href="#cb134-2"></a><span class="co">#&gt; [1] &quot;apple &amp; bell pepper, apricot &amp; bilberry, avocado &amp; blackberry, banana &amp; blackcurrant&quot;</span></span></code></pre></div>
<p>If the to-be-combined vectors are variables in a data frame, you can use <code>tidyr::unite()</code> to make a single new variable from them.</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1"></a>fruit_df &lt;-<span class="st"> </span><span class="kw">tibble</span>(</span>
<span id="cb135-2"><a href="#cb135-2"></a>  <span class="dt">fruit1 =</span> fruit[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>],</span>
<span id="cb135-3"><a href="#cb135-3"></a>  <span class="dt">fruit2 =</span> fruit[<span class="dv">5</span><span class="op">:</span><span class="dv">8</span>]</span>
<span id="cb135-4"><a href="#cb135-4"></a>)</span>
<span id="cb135-5"><a href="#cb135-5"></a>fruit_df <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb135-6"><a href="#cb135-6"></a><span class="st">  </span><span class="kw">unite</span>(<span class="st">&quot;flavor_combo&quot;</span>, fruit1, fruit2, <span class="dt">sep =</span> <span class="st">&quot; &amp; &quot;</span>)</span>
<span id="cb135-7"><a href="#cb135-7"></a><span class="co">#&gt; # A tibble: 4 x 1</span></span>
<span id="cb135-8"><a href="#cb135-8"></a><span class="co">#&gt;   flavor_combo         </span></span>
<span id="cb135-9"><a href="#cb135-9"></a><span class="co">#&gt;   &lt;chr&gt;                </span></span>
<span id="cb135-10"><a href="#cb135-10"></a><span class="co">#&gt; 1 apple &amp; bell pepper  </span></span>
<span id="cb135-11"><a href="#cb135-11"></a><span class="co">#&gt; 2 apricot &amp; bilberry   </span></span>
<span id="cb135-12"><a href="#cb135-12"></a><span class="co">#&gt; 3 avocado &amp; blackberry </span></span>
<span id="cb135-13"><a href="#cb135-13"></a><span class="co">#&gt; 4 banana &amp; blackcurrant</span></span></code></pre></div>
</div>
<div id="substring-replacement" class="section level3">
<h3><span class="header-section-number">11.4.6</span> Substring replacement</h3>
<p>You can replace a pattern with <code>str_replace()</code>. Here we use an explicit string-to-replace, but later we revisit with a regular expression.</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1"></a><span class="kw">str_replace</span>(my_fruit, <span class="dt">pattern =</span> <span class="st">&quot;fruit&quot;</span>, <span class="dt">replacement =</span> <span class="st">&quot;THINGY&quot;</span>)</span>
<span id="cb136-2"><a href="#cb136-2"></a><span class="co">#&gt; [1] &quot;breadTHINGY&quot;   &quot;dragonTHINGY&quot;  &quot;grapeTHINGY&quot;   &quot;jackTHINGY&quot;   </span></span>
<span id="cb136-3"><a href="#cb136-3"></a><span class="co">#&gt; [5] &quot;kiwi THINGY&quot;   &quot;passionTHINGY&quot; &quot;star THINGY&quot;   &quot;ugli THINGY&quot;</span></span></code></pre></div>
<p>A special case that comes up a lot is replacing <code>NA</code>, for which there is <code>str_replace_na()</code>.</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1"></a>melons &lt;-<span class="st"> </span><span class="kw">str_subset</span>(fruit, <span class="dt">pattern =</span> <span class="st">&quot;melon&quot;</span>)</span>
<span id="cb137-2"><a href="#cb137-2"></a>melons[<span class="dv">2</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb137-3"><a href="#cb137-3"></a>melons</span>
<span id="cb137-4"><a href="#cb137-4"></a><span class="co">#&gt; [1] &quot;canary melon&quot; NA             &quot;watermelon&quot;</span></span>
<span id="cb137-5"><a href="#cb137-5"></a><span class="kw">str_replace_na</span>(melons, <span class="st">&quot;UNKNOWN MELON&quot;</span>)</span>
<span id="cb137-6"><a href="#cb137-6"></a><span class="co">#&gt; [1] &quot;canary melon&quot;  &quot;UNKNOWN MELON&quot; &quot;watermelon&quot;</span></span></code></pre></div>
<p>If the <code>NA</code>-afflicted variable lives in a data frame, you can use <code>tidyr::replace_na()</code>.</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1"></a><span class="kw">tibble</span>(melons) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb138-2"><a href="#cb138-2"></a><span class="st">  </span><span class="kw">replace_na</span>(<span class="dt">replace =</span> <span class="kw">list</span>(<span class="dt">melons =</span> <span class="st">&quot;UNKNOWN MELON&quot;</span>))</span>
<span id="cb138-3"><a href="#cb138-3"></a><span class="co">#&gt; # A tibble: 3 x 1</span></span>
<span id="cb138-4"><a href="#cb138-4"></a><span class="co">#&gt;   melons       </span></span>
<span id="cb138-5"><a href="#cb138-5"></a><span class="co">#&gt;   &lt;chr&gt;        </span></span>
<span id="cb138-6"><a href="#cb138-6"></a><span class="co">#&gt; 1 canary melon </span></span>
<span id="cb138-7"><a href="#cb138-7"></a><span class="co">#&gt; 2 UNKNOWN MELON</span></span>
<span id="cb138-8"><a href="#cb138-8"></a><span class="co">#&gt; 3 watermelon</span></span></code></pre></div>
<p>And that concludes our treatment of regex-free manipulations of character data!</p>
</div>
</div>
<div id="regular-expressions-with-stringr" class="section level2">
<h2><span class="header-section-number">11.5</span> Regular expressions with stringr</h2>
<div class="figure">
<img src="img/regexbytrialanderror-big-smaller.png" alt="From [\@ThePracticalDev](https://twitter.com/ThePracticalDev/status/774309983467016193)" width="50%" />
<p class="caption">
(#fig:unnamed-chunk-18)From <a href="https://twitter.com/ThePracticalDev/status/774309983467016193">@ThePracticalDev</a>
</p>
</div>
<div id="load-gapminder" class="section level3">
<h3><span class="header-section-number">11.5.1</span> Load gapminder</h3>
<p>The country names in the <code>gapminder</code> dataset are convenient for examples. Load it now and store the 142 unique country names to the object <code>countries</code>.</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1"></a><span class="kw">library</span>(gapminder)</span>
<span id="cb139-2"><a href="#cb139-2"></a>countries &lt;-<span class="st"> </span><span class="kw">levels</span>(gapminder<span class="op">$</span>country)</span></code></pre></div>
</div>
<div id="characters-with-special-meaning" class="section level3">
<h3><span class="header-section-number">11.5.2</span> Characters with special meaning</h3>
<p>Frequently your string tasks cannot be expressed in terms of a fixed string, but can be described in terms of a <strong>pattern</strong>. Regular expressions, aka “regexes”, are the standard way to specify these patterns. In regexes, specific characters and constructs take on special meaning in order to match multiple strings.</p>
<p>The first metacharacter is the period <code>.</code>, which stands for any single character, except a newline (which by the way, is represented by <code>\n</code>). The regex <code>a.b</code> will match all countries that have an <code>a</code>, followed by any single character, followed by <code>b</code>. Yes, regexes are case sensitive, i.e. “Italy” does not match.</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1"></a><span class="kw">str_subset</span>(countries, <span class="dt">pattern =</span> <span class="st">&quot;i.a&quot;</span>)</span>
<span id="cb140-2"><a href="#cb140-2"></a><span class="co">#&gt;  [1] &quot;Argentina&quot;                &quot;Bosnia and Herzegovina&quot;  </span></span>
<span id="cb140-3"><a href="#cb140-3"></a><span class="co">#&gt;  [3] &quot;Burkina Faso&quot;             &quot;Central African Republic&quot;</span></span>
<span id="cb140-4"><a href="#cb140-4"></a><span class="co">#&gt;  [5] &quot;China&quot;                    &quot;Costa Rica&quot;              </span></span>
<span id="cb140-5"><a href="#cb140-5"></a><span class="co">#&gt;  [7] &quot;Dominican Republic&quot;       &quot;Hong Kong, China&quot;        </span></span>
<span id="cb140-6"><a href="#cb140-6"></a><span class="co">#&gt;  [9] &quot;Jamaica&quot;                  &quot;Mauritania&quot;              </span></span>
<span id="cb140-7"><a href="#cb140-7"></a><span class="co">#&gt; [11] &quot;Nicaragua&quot;                &quot;South Africa&quot;            </span></span>
<span id="cb140-8"><a href="#cb140-8"></a><span class="co">#&gt; [13] &quot;Swaziland&quot;                &quot;Taiwan&quot;                  </span></span>
<span id="cb140-9"><a href="#cb140-9"></a><span class="co">#&gt; [15] &quot;Thailand&quot;                 &quot;Trinidad and Tobago&quot;</span></span></code></pre></div>
<p>Notice that <code>i.a</code> matches “ina”, “ica”, “ita”, and more.</p>
<p><strong>Anchors</strong> can be included to express where the expression must occur within the string. The <code>^</code> indicates the beginning of string and <code>$</code> indicates the end.</p>
<p>Note how the regex <code>i.a$</code> matches many fewer countries than <code>i.a</code> alone. Likewise, more elements of <code>my_fruit</code> match <code>d</code> than <code>^d</code>, which requires “d” at string start.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1"></a><span class="kw">str_subset</span>(countries, <span class="dt">pattern =</span> <span class="st">&quot;i.a$&quot;</span>)</span>
<span id="cb141-2"><a href="#cb141-2"></a><span class="co">#&gt; [1] &quot;Argentina&quot;              &quot;Bosnia and Herzegovina&quot; &quot;China&quot;                 </span></span>
<span id="cb141-3"><a href="#cb141-3"></a><span class="co">#&gt; [4] &quot;Costa Rica&quot;             &quot;Hong Kong, China&quot;       &quot;Jamaica&quot;               </span></span>
<span id="cb141-4"><a href="#cb141-4"></a><span class="co">#&gt; [7] &quot;South Africa&quot;</span></span>
<span id="cb141-5"><a href="#cb141-5"></a><span class="kw">str_subset</span>(my_fruit, <span class="dt">pattern =</span> <span class="st">&quot;d&quot;</span>)</span>
<span id="cb141-6"><a href="#cb141-6"></a><span class="co">#&gt; [1] &quot;breadfruit&quot;  &quot;dragonfruit&quot;</span></span>
<span id="cb141-7"><a href="#cb141-7"></a><span class="kw">str_subset</span>(my_fruit, <span class="dt">pattern =</span> <span class="st">&quot;^d&quot;</span>)</span>
<span id="cb141-8"><a href="#cb141-8"></a><span class="co">#&gt; [1] &quot;dragonfruit&quot;</span></span></code></pre></div>
<p>The metacharacter <code>\b</code> indicates a <strong>word boundary</strong> and <code>\B</code> indicates NOT a word boundary. This is our first encounter with something called “escaping” and right now I just want you at accept that we need to prepend a second backslash to use these sequences in regexes in R. We’ll come back to this tedious point later.</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1"></a><span class="kw">str_subset</span>(fruit, <span class="dt">pattern =</span> <span class="st">&quot;melon&quot;</span>)</span>
<span id="cb142-2"><a href="#cb142-2"></a><span class="co">#&gt; [1] &quot;canary melon&quot; &quot;rock melon&quot;   &quot;watermelon&quot;</span></span>
<span id="cb142-3"><a href="#cb142-3"></a><span class="kw">str_subset</span>(fruit, <span class="dt">pattern =</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">bmelon&quot;</span>)</span>
<span id="cb142-4"><a href="#cb142-4"></a><span class="co">#&gt; [1] &quot;canary melon&quot; &quot;rock melon&quot;</span></span>
<span id="cb142-5"><a href="#cb142-5"></a><span class="kw">str_subset</span>(fruit, <span class="dt">pattern =</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">Bmelon&quot;</span>)</span>
<span id="cb142-6"><a href="#cb142-6"></a><span class="co">#&gt; [1] &quot;watermelon&quot;</span></span></code></pre></div>
</div>
<div id="character-classes" class="section level3">
<h3><span class="header-section-number">11.5.3</span> Character classes</h3>
<p>Characters can be specified via classes. You can make them explicitly “by hand” or use some pre-existing ones. The <a href="#oldies">2014 STAT 545 regex lesson</a> (Appendix @ref(oldies)) has a good list of character classes. Character classes are usually given inside square brackets, <code>[]</code> but a few come up so often that we have a metacharacter for them, such as <code>\d</code> for a single digit.</p>
<p>Here we match <code>ia</code> at the end of the country name, preceded by one of the characters in the class. Or, in the negated class, preceded by anything but one of those characters.</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1"></a><span class="co">## make a class &quot;by hand&quot;</span></span>
<span id="cb143-2"><a href="#cb143-2"></a><span class="kw">str_subset</span>(countries, <span class="dt">pattern =</span> <span class="st">&quot;[nls]ia$&quot;</span>)</span>
<span id="cb143-3"><a href="#cb143-3"></a><span class="co">#&gt;  [1] &quot;Albania&quot;    &quot;Australia&quot;  &quot;Indonesia&quot;  &quot;Malaysia&quot;   &quot;Mauritania&quot;</span></span>
<span id="cb143-4"><a href="#cb143-4"></a><span class="co">#&gt;  [6] &quot;Mongolia&quot;   &quot;Romania&quot;    &quot;Slovenia&quot;   &quot;Somalia&quot;    &quot;Tanzania&quot;  </span></span>
<span id="cb143-5"><a href="#cb143-5"></a><span class="co">#&gt; [11] &quot;Tunisia&quot;</span></span>
<span id="cb143-6"><a href="#cb143-6"></a><span class="co">## use ^ to negate the class</span></span>
<span id="cb143-7"><a href="#cb143-7"></a><span class="kw">str_subset</span>(countries, <span class="dt">pattern =</span> <span class="st">&quot;[^nls]ia$&quot;</span>)</span>
<span id="cb143-8"><a href="#cb143-8"></a><span class="co">#&gt;  [1] &quot;Algeria&quot;      &quot;Austria&quot;      &quot;Bolivia&quot;      &quot;Bulgaria&quot;     &quot;Cambodia&quot;    </span></span>
<span id="cb143-9"><a href="#cb143-9"></a><span class="co">#&gt;  [6] &quot;Colombia&quot;     &quot;Croatia&quot;      &quot;Ethiopia&quot;     &quot;Gambia&quot;       &quot;India&quot;       </span></span>
<span id="cb143-10"><a href="#cb143-10"></a><span class="co">#&gt; [11] &quot;Liberia&quot;      &quot;Namibia&quot;      &quot;Nigeria&quot;      &quot;Saudi Arabia&quot; &quot;Serbia&quot;      </span></span>
<span id="cb143-11"><a href="#cb143-11"></a><span class="co">#&gt; [16] &quot;Syria&quot;        &quot;Zambia&quot;</span></span></code></pre></div>
<p>Here we revisit splitting <code>my_fruit</code> with two more general ways to match whitespace: the <code>\s</code> metacharacter and the POSIX class <code>[:space:]</code>. Notice that we must prepend an extra backslash <code>\</code> to escape <code>\s</code> and the POSIX class has to be surrounded by two sets of square brackets.</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1"></a><span class="co">## remember this?</span></span>
<span id="cb144-2"><a href="#cb144-2"></a><span class="co"># str_split_fixed(fruit, pattern = &quot; &quot;, n = 2)</span></span>
<span id="cb144-3"><a href="#cb144-3"></a><span class="co">## alternatives</span></span>
<span id="cb144-4"><a href="#cb144-4"></a><span class="kw">str_split_fixed</span>(my_fruit, <span class="dt">pattern =</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">s&quot;</span>, <span class="dt">n =</span> <span class="dv">2</span>)</span>
<span id="cb144-5"><a href="#cb144-5"></a><span class="co">#&gt;      [,1]           [,2]   </span></span>
<span id="cb144-6"><a href="#cb144-6"></a><span class="co">#&gt; [1,] &quot;breadfruit&quot;   &quot;&quot;     </span></span>
<span id="cb144-7"><a href="#cb144-7"></a><span class="co">#&gt; [2,] &quot;dragonfruit&quot;  &quot;&quot;     </span></span>
<span id="cb144-8"><a href="#cb144-8"></a><span class="co">#&gt; [3,] &quot;grapefruit&quot;   &quot;&quot;     </span></span>
<span id="cb144-9"><a href="#cb144-9"></a><span class="co">#&gt; [4,] &quot;jackfruit&quot;    &quot;&quot;     </span></span>
<span id="cb144-10"><a href="#cb144-10"></a><span class="co">#&gt; [5,] &quot;kiwi&quot;         &quot;fruit&quot;</span></span>
<span id="cb144-11"><a href="#cb144-11"></a><span class="co">#&gt; [6,] &quot;passionfruit&quot; &quot;&quot;     </span></span>
<span id="cb144-12"><a href="#cb144-12"></a><span class="co">#&gt; [7,] &quot;star&quot;         &quot;fruit&quot;</span></span>
<span id="cb144-13"><a href="#cb144-13"></a><span class="co">#&gt; [8,] &quot;ugli&quot;         &quot;fruit&quot;</span></span>
<span id="cb144-14"><a href="#cb144-14"></a><span class="kw">str_split_fixed</span>(my_fruit, <span class="dt">pattern =</span> <span class="st">&quot;[[:space:]]&quot;</span>, <span class="dt">n =</span> <span class="dv">2</span>)</span>
<span id="cb144-15"><a href="#cb144-15"></a><span class="co">#&gt;      [,1]           [,2]   </span></span>
<span id="cb144-16"><a href="#cb144-16"></a><span class="co">#&gt; [1,] &quot;breadfruit&quot;   &quot;&quot;     </span></span>
<span id="cb144-17"><a href="#cb144-17"></a><span class="co">#&gt; [2,] &quot;dragonfruit&quot;  &quot;&quot;     </span></span>
<span id="cb144-18"><a href="#cb144-18"></a><span class="co">#&gt; [3,] &quot;grapefruit&quot;   &quot;&quot;     </span></span>
<span id="cb144-19"><a href="#cb144-19"></a><span class="co">#&gt; [4,] &quot;jackfruit&quot;    &quot;&quot;     </span></span>
<span id="cb144-20"><a href="#cb144-20"></a><span class="co">#&gt; [5,] &quot;kiwi&quot;         &quot;fruit&quot;</span></span>
<span id="cb144-21"><a href="#cb144-21"></a><span class="co">#&gt; [6,] &quot;passionfruit&quot; &quot;&quot;     </span></span>
<span id="cb144-22"><a href="#cb144-22"></a><span class="co">#&gt; [7,] &quot;star&quot;         &quot;fruit&quot;</span></span>
<span id="cb144-23"><a href="#cb144-23"></a><span class="co">#&gt; [8,] &quot;ugli&quot;         &quot;fruit&quot;</span></span></code></pre></div>
<p>Let’s see the country names that contain punctuation.</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1"></a><span class="kw">str_subset</span>(countries, <span class="st">&quot;[[:punct:]]&quot;</span>)</span>
<span id="cb145-2"><a href="#cb145-2"></a><span class="co">#&gt; [1] &quot;Congo, Dem. Rep.&quot; &quot;Congo, Rep.&quot;      &quot;Cote d&#39;Ivoire&quot;    &quot;Guinea-Bissau&quot;   </span></span>
<span id="cb145-3"><a href="#cb145-3"></a><span class="co">#&gt; [5] &quot;Hong Kong, China&quot; &quot;Korea, Dem. Rep.&quot; &quot;Korea, Rep.&quot;      &quot;Yemen, Rep.&quot;</span></span></code></pre></div>
</div>
<div id="quantifiers" class="section level3">
<h3><span class="header-section-number">11.5.4</span> Quantifiers</h3>
<p>You can decorate characters (and other constructs, like metacharacters and classes) with information about how many characters they are allowed to match.</p>
<table>
<thead>
<tr class="header">
<th>quantifier</th>
<th>meaning</th>
<th>quantifier</th>
<th>meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>*</td>
<td>0 or more</td>
<td>{n}</td>
<td>exactly n</td>
</tr>
<tr class="even">
<td>+</td>
<td>1 or more</td>
<td>{n,}</td>
<td>at least n</td>
</tr>
<tr class="odd">
<td>?</td>
<td>0 or 1</td>
<td>{,m}</td>
<td>at most m</td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td>{n,m}</td>
<td>between n and m, inclusive</td>
</tr>
</tbody>
</table>
<p>Explore these by inspecting matches for <code>l</code> followed by <code>e</code>, allowing for various numbers of characters in between.</p>
<p><code>l.*e</code> will match strings with 0 or more characters in between, i.e. any string with an <code>l</code> eventually followed by an <code>e</code>. This is the most inclusive regex for this example, so we store the result as <code>matches</code> to use as a baseline for comparison.</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1"></a>(matches &lt;-<span class="st"> </span><span class="kw">str_subset</span>(fruit, <span class="dt">pattern =</span> <span class="st">&quot;l.*e&quot;</span>))</span>
<span id="cb146-2"><a href="#cb146-2"></a><span class="co">#&gt;  [1] &quot;apple&quot;             &quot;bell pepper&quot;       &quot;bilberry&quot;         </span></span>
<span id="cb146-3"><a href="#cb146-3"></a><span class="co">#&gt;  [4] &quot;blackberry&quot;        &quot;blood orange&quot;      &quot;blueberry&quot;        </span></span>
<span id="cb146-4"><a href="#cb146-4"></a><span class="co">#&gt;  [7] &quot;cantaloupe&quot;        &quot;chili pepper&quot;      &quot;clementine&quot;       </span></span>
<span id="cb146-5"><a href="#cb146-5"></a><span class="co">#&gt; [10] &quot;cloudberry&quot;        &quot;elderberry&quot;        &quot;huckleberry&quot;      </span></span>
<span id="cb146-6"><a href="#cb146-6"></a><span class="co">#&gt; [13] &quot;lemon&quot;             &quot;lime&quot;              &quot;lychee&quot;           </span></span>
<span id="cb146-7"><a href="#cb146-7"></a><span class="co">#&gt; [16] &quot;mulberry&quot;          &quot;olive&quot;             &quot;pineapple&quot;        </span></span>
<span id="cb146-8"><a href="#cb146-8"></a><span class="co">#&gt; [19] &quot;purple mangosteen&quot; &quot;salal berry&quot;</span></span></code></pre></div>
<p>Change the quantifier from <code>*</code> to <code>+</code> to require at least one intervening character. The strings that no longer match: all have a literal <code>le</code> with no preceding <code>l</code> and no following <code>e</code>.</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1"></a><span class="kw">list</span>(<span class="dt">match =</span> <span class="kw">intersect</span>(matches, <span class="kw">str_subset</span>(fruit, <span class="dt">pattern =</span> <span class="st">&quot;l.+e&quot;</span>)),</span>
<span id="cb147-2"><a href="#cb147-2"></a>     <span class="dt">no_match =</span> <span class="kw">setdiff</span>(matches, <span class="kw">str_subset</span>(fruit, <span class="dt">pattern =</span> <span class="st">&quot;l.+e&quot;</span>)))</span>
<span id="cb147-3"><a href="#cb147-3"></a><span class="co">#&gt; $match</span></span>
<span id="cb147-4"><a href="#cb147-4"></a><span class="co">#&gt;  [1] &quot;bell pepper&quot;       &quot;bilberry&quot;          &quot;blackberry&quot;       </span></span>
<span id="cb147-5"><a href="#cb147-5"></a><span class="co">#&gt;  [4] &quot;blood orange&quot;      &quot;blueberry&quot;         &quot;cantaloupe&quot;       </span></span>
<span id="cb147-6"><a href="#cb147-6"></a><span class="co">#&gt;  [7] &quot;chili pepper&quot;      &quot;clementine&quot;        &quot;cloudberry&quot;       </span></span>
<span id="cb147-7"><a href="#cb147-7"></a><span class="co">#&gt; [10] &quot;elderberry&quot;        &quot;huckleberry&quot;       &quot;lime&quot;             </span></span>
<span id="cb147-8"><a href="#cb147-8"></a><span class="co">#&gt; [13] &quot;lychee&quot;            &quot;mulberry&quot;          &quot;olive&quot;            </span></span>
<span id="cb147-9"><a href="#cb147-9"></a><span class="co">#&gt; [16] &quot;purple mangosteen&quot; &quot;salal berry&quot;      </span></span>
<span id="cb147-10"><a href="#cb147-10"></a><span class="co">#&gt; </span></span>
<span id="cb147-11"><a href="#cb147-11"></a><span class="co">#&gt; $no_match</span></span>
<span id="cb147-12"><a href="#cb147-12"></a><span class="co">#&gt; [1] &quot;apple&quot;     &quot;lemon&quot;     &quot;pineapple&quot;</span></span></code></pre></div>
<p>Change the quantifier from <code>*</code> to <code>?</code> to require at most one intervening character. In the strings that no longer match, the shortest gap between <code>l</code> and following <code>e</code> is at least two characters.</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1"></a><span class="kw">list</span>(<span class="dt">match =</span> <span class="kw">intersect</span>(matches, <span class="kw">str_subset</span>(fruit, <span class="dt">pattern =</span> <span class="st">&quot;l.?e&quot;</span>)),</span>
<span id="cb148-2"><a href="#cb148-2"></a>     <span class="dt">no_match =</span> <span class="kw">setdiff</span>(matches, <span class="kw">str_subset</span>(fruit, <span class="dt">pattern =</span> <span class="st">&quot;l.?e&quot;</span>)))</span>
<span id="cb148-3"><a href="#cb148-3"></a><span class="co">#&gt; $match</span></span>
<span id="cb148-4"><a href="#cb148-4"></a><span class="co">#&gt;  [1] &quot;apple&quot;             &quot;bilberry&quot;          &quot;blueberry&quot;        </span></span>
<span id="cb148-5"><a href="#cb148-5"></a><span class="co">#&gt;  [4] &quot;clementine&quot;        &quot;elderberry&quot;        &quot;huckleberry&quot;      </span></span>
<span id="cb148-6"><a href="#cb148-6"></a><span class="co">#&gt;  [7] &quot;lemon&quot;             &quot;mulberry&quot;          &quot;pineapple&quot;        </span></span>
<span id="cb148-7"><a href="#cb148-7"></a><span class="co">#&gt; [10] &quot;purple mangosteen&quot;</span></span>
<span id="cb148-8"><a href="#cb148-8"></a><span class="co">#&gt; </span></span>
<span id="cb148-9"><a href="#cb148-9"></a><span class="co">#&gt; $no_match</span></span>
<span id="cb148-10"><a href="#cb148-10"></a><span class="co">#&gt;  [1] &quot;bell pepper&quot;  &quot;blackberry&quot;   &quot;blood orange&quot; &quot;cantaloupe&quot;   &quot;chili pepper&quot;</span></span>
<span id="cb148-11"><a href="#cb148-11"></a><span class="co">#&gt;  [6] &quot;cloudberry&quot;   &quot;lime&quot;         &quot;lychee&quot;       &quot;olive&quot;        &quot;salal berry&quot;</span></span></code></pre></div>
<p>Finally, we remove the quantifier and allow for no intervening characters. The strings that no longer match lack a literal <code>le</code>.</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1"></a><span class="kw">list</span>(<span class="dt">match =</span> <span class="kw">intersect</span>(matches, <span class="kw">str_subset</span>(fruit, <span class="dt">pattern =</span> <span class="st">&quot;le&quot;</span>)),</span>
<span id="cb149-2"><a href="#cb149-2"></a>     <span class="dt">no_match =</span> <span class="kw">setdiff</span>(matches, <span class="kw">str_subset</span>(fruit, <span class="dt">pattern =</span> <span class="st">&quot;le&quot;</span>)))</span>
<span id="cb149-3"><a href="#cb149-3"></a><span class="co">#&gt; $match</span></span>
<span id="cb149-4"><a href="#cb149-4"></a><span class="co">#&gt; [1] &quot;apple&quot;             &quot;clementine&quot;        &quot;huckleberry&quot;      </span></span>
<span id="cb149-5"><a href="#cb149-5"></a><span class="co">#&gt; [4] &quot;lemon&quot;             &quot;pineapple&quot;         &quot;purple mangosteen&quot;</span></span>
<span id="cb149-6"><a href="#cb149-6"></a><span class="co">#&gt; </span></span>
<span id="cb149-7"><a href="#cb149-7"></a><span class="co">#&gt; $no_match</span></span>
<span id="cb149-8"><a href="#cb149-8"></a><span class="co">#&gt;  [1] &quot;bell pepper&quot;  &quot;bilberry&quot;     &quot;blackberry&quot;   &quot;blood orange&quot; &quot;blueberry&quot;   </span></span>
<span id="cb149-9"><a href="#cb149-9"></a><span class="co">#&gt;  [6] &quot;cantaloupe&quot;   &quot;chili pepper&quot; &quot;cloudberry&quot;   &quot;elderberry&quot;   &quot;lime&quot;        </span></span>
<span id="cb149-10"><a href="#cb149-10"></a><span class="co">#&gt; [11] &quot;lychee&quot;       &quot;mulberry&quot;     &quot;olive&quot;        &quot;salal berry&quot;</span></span></code></pre></div>
</div>
<div id="escaping" class="section level3">
<h3><span class="header-section-number">11.5.5</span> Escaping</h3>
<p>You’ve probably caught on by now that there are certain characters with special meaning in regexes, including <code>$ * + . ? [ ] ^ { } | ( ) \</code>.</p>
<p>What if you really need the plus sign to be a literal plus sign and not a regex quantifier? You will need to <em>escape</em> it by prepending a backslash. But wait … there’s more! Before a regex is interpreted as a regular expression, it is also interpreted by R as a string. And backslash is used to escape there as well. So, in the end, you need to preprend two backslashes in order to match a literal plus sign in a regex.</p>
<p>This will be more clear with examples!</p>
<div id="escapes-in-plain-old-strings" class="section level4">
<h4><span class="header-section-number">11.5.5.1</span> Escapes in plain old strings</h4>
<p>Here is routine, non-regex use of backslash <code>\</code> escapes in plain vanilla R strings. We intentionally use <code>cat()</code> instead of <code>print()</code> here.</p>
<ul>
<li><p>To escape quotes inside quotes:</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1"></a><span class="kw">cat</span>(<span class="st">&quot;Do you use </span><span class="ch">\&quot;</span><span class="st">airquotes</span><span class="ch">\&quot;</span><span class="st"> much?&quot;</span>)</span>
<span id="cb150-2"><a href="#cb150-2"></a><span class="co">#&gt; Do you use &quot;airquotes&quot; much?</span></span></code></pre></div>
<p>Sidebar: eliminating the need for these escapes is exactly why people use double quotes inside single quotes and <em>vice versa</em>.</p></li>
<li><p>To insert newline (<code>\n</code>) or tab (<code>\t</code>):</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1"></a><span class="kw">cat</span>(<span class="st">&quot;before the newline</span><span class="ch">\n</span><span class="st">after the newline&quot;</span>)</span>
<span id="cb151-2"><a href="#cb151-2"></a><span class="co">#&gt; before the newline</span></span>
<span id="cb151-3"><a href="#cb151-3"></a><span class="co">#&gt; after the newline</span></span>
<span id="cb151-4"><a href="#cb151-4"></a><span class="kw">cat</span>(<span class="st">&quot;before the tab</span><span class="ch">\t</span><span class="st">after the tab&quot;</span>)</span>
<span id="cb151-5"><a href="#cb151-5"></a><span class="co">#&gt; before the tab   after the tab</span></span></code></pre></div></li>
</ul>
</div>
<div id="escapes-in-regular-expressions" class="section level4">
<h4><span class="header-section-number">11.5.5.2</span> Escapes in regular expressions</h4>
<p>Examples of using escapes in regexes to match characters that would otherwise have a special interpretation.</p>
<p>We know several <code>gapminder</code> country names contain a period. How do we isolate them? Although it’s tempting, this command <code>str_subset(countries, pattern = ".")</code> won’t work!</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1"></a><span class="co">## cheating using a POSIX class ;)</span></span>
<span id="cb152-2"><a href="#cb152-2"></a><span class="kw">str_subset</span>(countries, <span class="dt">pattern =</span> <span class="st">&quot;[[:punct:]]&quot;</span>)</span>
<span id="cb152-3"><a href="#cb152-3"></a><span class="co">#&gt; [1] &quot;Congo, Dem. Rep.&quot; &quot;Congo, Rep.&quot;      &quot;Cote d&#39;Ivoire&quot;    &quot;Guinea-Bissau&quot;   </span></span>
<span id="cb152-4"><a href="#cb152-4"></a><span class="co">#&gt; [5] &quot;Hong Kong, China&quot; &quot;Korea, Dem. Rep.&quot; &quot;Korea, Rep.&quot;      &quot;Yemen, Rep.&quot;</span></span>
<span id="cb152-5"><a href="#cb152-5"></a><span class="co">## using two backslashes to escape the period</span></span>
<span id="cb152-6"><a href="#cb152-6"></a><span class="kw">str_subset</span>(countries, <span class="dt">pattern =</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">.&quot;</span>)</span>
<span id="cb152-7"><a href="#cb152-7"></a><span class="co">#&gt; [1] &quot;Congo, Dem. Rep.&quot; &quot;Congo, Rep.&quot;      &quot;Korea, Dem. Rep.&quot; &quot;Korea, Rep.&quot;     </span></span>
<span id="cb152-8"><a href="#cb152-8"></a><span class="co">#&gt; [5] &quot;Yemen, Rep.&quot;</span></span></code></pre></div>
<p>A last example that matches an actual square bracket.</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1"></a>(x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;whatever&quot;</span>, <span class="st">&quot;X is distributed U[0,1]&quot;</span>))</span>
<span id="cb153-2"><a href="#cb153-2"></a><span class="co">#&gt; [1] &quot;whatever&quot;                &quot;X is distributed U[0,1]&quot;</span></span>
<span id="cb153-3"><a href="#cb153-3"></a><span class="kw">str_subset</span>(x, <span class="dt">pattern =</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">[&quot;</span>)</span>
<span id="cb153-4"><a href="#cb153-4"></a><span class="co">#&gt; [1] &quot;X is distributed U[0,1]&quot;</span></span></code></pre></div>
</div>
</div>
<div id="groups-and-backreferences" class="section level3">
<h3><span class="header-section-number">11.5.6</span> Groups and backreferences</h3>
<p>Your first use of regex is likely to be simple matching: detecting or isolating strings that match a pattern.</p>
<p>But soon you will want to use regexes to transform the strings in character vectors. That means you need a way to address specific parts of the matching strings and to operate on them.</p>
<p>You can use parentheses inside regexes to define <em>groups</em> and you can refer to those groups later with <em>backreferences</em>.</p>
<p>For now, this lesson will refer you to other place to read up on this:</p>
<ul>
<li>STAT 545 <a href="#oldies">2014 Intro to regular expressions</a> by TA Gloria Li (Appendix @ref(oldies)).</li>
<li>The <a href="https://r4ds.had.co.nz/strings.html">Strings chapter</a> of <a href="https://r4ds.had.co.nz">R for Data Science</a> <span class="citation">(Wickham and Grolemund <a href="#ref-wickham2016" role="doc-biblioref">2016</a>)</span>.</li>
</ul>
<!--RStudio Links-->
<!--HappyGitWithR Links-->
<!--Package Links-->
<!--Shiny links-->
<!--Publications-->
<!--R Documentation-->
<!--Wikipedia Links-->
<!--Misc. Links-->
<!--chapter:end:011_character-vectors.Rmd-->
</div>
</div>
</div>
<div id="character-encoding" class="section level1">
<h1><span class="header-section-number">12</span> Character encoding</h1>
<!--TODO: *under development ... not clear where this is going*-->
<!--Original content: https://stat545.com/block032_character-encoding.html-->
<div id="resources-4" class="section level2">
<h2><span class="header-section-number">12.1</span> Resources</h2>
<ul>
<li><a href="https://r4ds.had.co.nz/data-import.html#readr-strings">Strings subsection of data import chapter</a> in R for Data Science <span class="citation">(Wickham and Grolemund <a href="#ref-wickham2016" role="doc-biblioref">2016</a>)</span>.</li>
<li>Screeds on the Minimum Everyone Needs to Know about encoding:
<ul>
<li><a href="https://www.joelonsoftware.com/2003/10/08/the-absolute-minimum-every-software-developer-absolutely-positively-must-know-about-unicode-and-character-sets-no-excuses/">The Absolute Minimum Every Software Developer Absolutely, Positively Must Know About Unicode and Character Sets (No Excuses!)</a></li>
<li><a href="http://kunststube.net/encoding/">What Every Programmer Absolutely, Positively Needs To Know About Encodings And Character Sets To Work With Text</a></li>
</ul></li>
<li>Debugging charts:
<ul>
<li><a href="http://www.i18nqa.com/debug/utf8-debug.html">Windows-1252 Characters to UTF-8 Bytes to Latin-1 Characters</a></li>
</ul></li>
<li>Character inspection:
<ul>
<li><a href="https://apps.timwhitlock.info/unicode/inspect" class="uri">https://apps.timwhitlock.info/unicode/inspect</a></li>
</ul></li>
</ul>
</div>
<div id="translating-two-blog-posts-from-ruby-to-r" class="section level2">
<h2><span class="header-section-number">12.2</span> Translating two blog posts from Ruby to R</h2>
<p>For now, this page walks through these two mini-tutorials (written for Ruby), but translated to R:</p>
<ul>
<li><a href="https://www.justinweiss.com/articles/3-steps-to-fix-encoding-problems-in-ruby/">Guide to fixing encoding problems in Ruby</a></li>
<li><a href="https://www.justinweiss.com/articles/how-to-get-from-theyre-to-theyre/">How to Get From Theyâ€™re to They’re</a></li>
</ul>
<p>Don’t expect much creativity from me here. My goal is faithful translation.</p>
</div>
<div id="what-is-an-encoding" class="section level2">
<h2><span class="header-section-number">12.3</span> What is an encoding?</h2>
<p>Look at the string <code>"hello!"</code> in bytes. <em>Ruby</em></p>
<div class="sourceCode" id="cb154"><pre class="sourceCode ruby"><code class="sourceCode ruby"><span id="cb154-1"><a href="#cb154-1"></a>irb(main):<span class="dv">001</span>:<span class="dv">0</span>&gt; <span class="st">&quot;hello!&quot;</span>.bytes</span>
<span id="cb154-2"><a href="#cb154-2"></a>=&gt; [<span class="dv">104</span>, <span class="dv">101</span>, <span class="dv">108</span>, <span class="dv">108</span>, <span class="dv">111</span>, <span class="dv">33</span>]</span></code></pre></div>
<p>The base function <code>charToRaw()</code> “converts a length-one character string to raw bytes. It does so without taking into account any declared encoding”. It displays bytes in hexadecimal. Use <code>as.integer()</code> to convert to decimal, which is more intuitive and allows us to compare against the Ruby results.</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1"></a><span class="kw">charToRaw</span>(<span class="st">&quot;hello!&quot;</span>)</span>
<span id="cb155-2"><a href="#cb155-2"></a><span class="co">#&gt; [1] 68 65 6c 6c 6f 21</span></span>
<span id="cb155-3"><a href="#cb155-3"></a><span class="kw">as.integer</span>(<span class="kw">charToRaw</span>(<span class="st">&quot;hello!&quot;</span>))</span>
<span id="cb155-4"><a href="#cb155-4"></a><span class="co">#&gt; [1] 104 101 108 108 111  33</span></span></code></pre></div>
<p>Use a character less common in English: <em>Ruby</em></p>
<pre><code>irb(main):002:0&gt; &quot;hellṏ!&quot;.bytes
=&gt; [104, 101, 108, 108, 225, 185, 143, 33]</code></pre>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1"></a><span class="kw">charToRaw</span>(<span class="st">&quot;hellṏ!&quot;</span>)</span>
<span id="cb157-2"><a href="#cb157-2"></a><span class="co">#&gt;  [1] 68 65 6c 6c 3c 55 2b 31 45 34 46 3e 21</span></span>
<span id="cb157-3"><a href="#cb157-3"></a><span class="kw">as.integer</span>(<span class="kw">charToRaw</span>(<span class="st">&quot;hellṏ!&quot;</span>))</span>
<span id="cb157-4"><a href="#cb157-4"></a><span class="co">#&gt;  [1] 104 101 108 108  60  85  43  49  69  52  70  62  33</span></span></code></pre></div>
<p>Now we see that it takes more than one byte to represent <code>"ṏ"</code>. Three in fact: [60, 85, 43, 49, 69, 52, 70, 62]. The encoding of a string defines this relationship: encoding is a map between one or more bytes and a displayable character.</p>
<p>Take a look at what a single set of bytes looks like when you try different encodings.</p>
<p>Here’s, a string encoded as ISO-8859-1 (also known as “Latin1”) with a special character. <em>Ruby</em></p>
<pre><code>irb(main):003:0&gt; str = &quot;hellÔ!&quot;.encode(&quot;ISO-8859-1&quot;); str.encode(&quot;UTF-8&quot;)
=&gt; &quot;hellÔ!&quot;

irb(main):004:0&gt; str.bytes
=&gt; [104, 101, 108, 108, 212, 33]</code></pre>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1"></a>string_latin &lt;-<span class="st"> </span><span class="kw">iconv</span>(<span class="st">&quot;hellÔ!&quot;</span>, <span class="dt">from =</span> <span class="st">&quot;UTF-8&quot;</span>, <span class="dt">to =</span> <span class="st">&quot;Latin1&quot;</span>)</span>
<span id="cb159-2"><a href="#cb159-2"></a>string_latin</span>
<span id="cb159-3"><a href="#cb159-3"></a><span class="co">#&gt; [1] NA</span></span>
<span id="cb159-4"><a href="#cb159-4"></a><span class="kw">charToRaw</span>(string_latin)</span>
<span id="cb159-5"><a href="#cb159-5"></a><span class="co">#&gt; [1] 4e 41</span></span>
<span id="cb159-6"><a href="#cb159-6"></a><span class="kw">as.integer</span>(<span class="kw">charToRaw</span>(string_latin))</span>
<span id="cb159-7"><a href="#cb159-7"></a><span class="co">#&gt; [1] 78 65</span></span></code></pre></div>
<p>We’ve confirmed that we have the correct bytes (meaning the same as the Ruby example). What would that string look like interpreted as ISO-8859-5 instead? <em>Ruby</em></p>
<pre><code>irb(main):005:0&gt; str.force_encoding(&quot;ISO-8859-5&quot;); str.encode(&quot;UTF-8&quot;)
=&gt; &quot;hellд!&quot;</code></pre>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1"></a><span class="kw">iconv</span>(string_latin, <span class="dt">from =</span> <span class="st">&quot;ISO-8859-5&quot;</span>, <span class="dt">to =</span> <span class="st">&quot;UTF-8&quot;</span>)</span>
<span id="cb161-2"><a href="#cb161-2"></a><span class="co">#&gt; [1] NA</span></span></code></pre></div>
<p>It’s garbled, which is your first tip-off to an encoding problem.</p>
<p>Also not all strings can be represented in all encodings: <em>Ruby</em></p>
<pre><code>irb(main):006:0&gt; &quot;hi∑&quot;.encode(&quot;Windows-1252&quot;)
Encoding::UndefinedConversionError: U+2211 to WINDOWS-1252 in conversion from UTF-8 to WINDOWS-1252
 from (irb):61:in `encode&#39;
 from (irb):61
 from /usr/local/bin/irb:11:in `&lt;main&gt;&#39;</code></pre>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1"></a>(string &lt;-<span class="st"> &quot;hi∑&quot;</span>)</span>
<span id="cb163-2"><a href="#cb163-2"></a><span class="co">#&gt; [1] &quot;hi&lt;U+2211&gt;&quot;</span></span>
<span id="cb163-3"><a href="#cb163-3"></a><span class="kw">Encoding</span>(string)</span>
<span id="cb163-4"><a href="#cb163-4"></a><span class="co">#&gt; [1] &quot;unknown&quot;</span></span>
<span id="cb163-5"><a href="#cb163-5"></a><span class="kw">as.integer</span>(<span class="kw">charToRaw</span>(string))</span>
<span id="cb163-6"><a href="#cb163-6"></a><span class="co">#&gt;  [1] 104 105  60  85  43  50  50  49  49  62</span></span>
<span id="cb163-7"><a href="#cb163-7"></a>(string_windows &lt;-<span class="st"> </span><span class="kw">iconv</span>(string, <span class="dt">from =</span> <span class="st">&quot;UTF-8&quot;</span>, <span class="dt">to =</span> <span class="st">&quot;Windows-1252&quot;</span>))</span>
<span id="cb163-8"><a href="#cb163-8"></a><span class="co">#&gt; [1] &quot;hi&lt;U+2211&gt;&quot;</span></span></code></pre></div>
<p>In Ruby, apparently that is an error. In R, we just get <code>NA</code>. Alternatively, and somewhat like Ruby, you can specify a substitution for non-convertible bytes.</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1"></a>(string_windows &lt;-<span class="st"> </span><span class="kw">iconv</span>(string, <span class="dt">from =</span> <span class="st">&quot;UTF-8&quot;</span>, <span class="dt">to =</span> <span class="st">&quot;Windows-1252&quot;</span>, <span class="dt">sub =</span> <span class="st">&quot;?&quot;</span>))</span>
<span id="cb164-2"><a href="#cb164-2"></a><span class="co">#&gt; [1] &quot;hi&lt;U+2211&gt;&quot;</span></span></code></pre></div>
<p>In the Ruby post, we’ve seen 3 string functions so far. Review and note which R function was used in the translation.</p>
<ul>
<li><code>encode</code> translates a string to another encoding. We’ve used <code>iconv(x, from = "UTF-8", to = &lt;DIFFERENT_ENCODING&gt;)</code> here.</li>
<li><code>bytes</code> shows the bytes that make up a string. We’ve used <code>charToRaw()</code>, which returns hexadecimal in R. For the sake of comparison to the Ruby post, I’ve converted to decimal with <code>as.integer()</code>.</li>
<li><code>force_encoding</code> shows what the input bytes would look like if interpreted by a different encoding. We’ve used <code>iconv(x, from = &lt;DIFFERENT_ENCODING&gt;, to = "UTF-8")</code>.</li>
</ul>
</div>
<div id="a-three-step-process-for-fixing-encoding-bugs" class="section level2">
<h2><span class="header-section-number">12.4</span> A three-step process for fixing encoding bugs</h2>
<div id="discover-which-encoding-your-string-is-actually-in." class="section level3">
<h3><span class="header-section-number">12.4.1</span> Discover which encoding your string is actually in.</h3>
<p>Shhh. Secret: this is encoded as Windows-1252. <code>\x99</code> should be the trademark symbol ™. Ruby can guess at the encoding. <em>Ruby</em></p>
<div class="sourceCode" id="cb165"><pre class="sourceCode ruby"><code class="sourceCode ruby"><span id="cb165-1"><a href="#cb165-1"></a>irb(main):<span class="bn">07</span>8:<span class="dv">0</span>&gt; <span class="st">&quot;hi\x99!&quot;</span>.encoding</span>
<span id="cb165-2"><a href="#cb165-2"></a>=&gt; <span class="co">#&lt;Encoding:UTF-8&gt;</span></span></code></pre></div>
<p>Ruby’s guess is bad. This is not encoded as UTF-8. R admits it doesn’t know and <code>stringi</code>’s guess is not good.</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1"></a>string &lt;-<span class="st"> &quot;hi</span><span class="ch">\x99</span><span class="st">!&quot;</span></span>
<span id="cb166-2"><a href="#cb166-2"></a>string</span>
<span id="cb166-3"><a href="#cb166-3"></a><span class="co">#&gt; [1] &quot;hi\231!&quot;</span></span>
<span id="cb166-4"><a href="#cb166-4"></a><span class="kw">Encoding</span>(string)</span>
<span id="cb166-5"><a href="#cb166-5"></a><span class="co">#&gt; [1] &quot;latin1&quot;</span></span>
<span id="cb166-6"><a href="#cb166-6"></a>stringi<span class="op">::</span><span class="kw">stri_enc_detect</span>(string)</span>
<span id="cb166-7"><a href="#cb166-7"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb166-8"><a href="#cb166-8"></a><span class="co">#&gt;   Encoding Language Confidence</span></span>
<span id="cb166-9"><a href="#cb166-9"></a><span class="co">#&gt; 1 UTF-16BE                 0.1</span></span>
<span id="cb166-10"><a href="#cb166-10"></a><span class="co">#&gt; 2 UTF-16LE                 0.1</span></span>
<span id="cb166-11"><a href="#cb166-11"></a><span class="co">#&gt; 3   EUC-JP       ja        0.1</span></span>
<span id="cb166-12"><a href="#cb166-12"></a><span class="co">#&gt; 4   EUC-KR       ko        0.1</span></span></code></pre></div>
<p>Advice given in post is to sleuth it out based on where the data came from. With larger amounts of text, each language’s guessing facilities presumably do better than they do here. In real life, all of this advice can prove to be … overly optimistic?</p>
<p>I find it helpful to scrutinize debugging charts and look for the weird stuff showing up in my text. Here’s <a href="http://www.i18nqa.com/debug/utf8-debug.html">one that shows what UTF-8 bytes look like</a> when erroneously interpreted under Windows-1252 encoding. This phenomenon is known as <a href="https://en.wikipedia.org/wiki/Mojibake"><em>mojibake</em></a>, which is a delightful word for a super-annoying phenomenon. If it helps, know that the most common encodings are UTF-8, ISO-8859-1 (or Latin1), and Windows-1252, so that really narrows things down.</p>
</div>
<div id="decide-which-encoding-you-want-the-string-to-be" class="section level3">
<h3><span class="header-section-number">12.4.2</span> Decide which encoding you want the string to be</h3>
<p>That’s easy. UTF-8. Done.</p>
</div>
<div id="re-encode-your-string" class="section level3">
<h3><span class="header-section-number">12.4.3</span> Re-encode your string</h3>
<pre><code>irb(main):088:0&gt; &quot;hi\x99!&quot;.encode(&quot;UTF-8&quot;, &quot;Windows-1252&quot;)
=&gt; &quot;hi™!&quot;</code></pre>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1"></a>string_windows &lt;-<span class="st"> &quot;hi</span><span class="ch">\x99</span><span class="st">!&quot;</span></span>
<span id="cb168-2"><a href="#cb168-2"></a>string_utf8 &lt;-<span class="st"> </span><span class="kw">iconv</span>(string_windows, <span class="dt">from =</span> <span class="st">&quot;Windows-1252&quot;</span>, <span class="dt">to =</span> <span class="st">&quot;UTF-8&quot;</span>)</span>
<span id="cb168-3"><a href="#cb168-3"></a><span class="kw">Encoding</span>(string_utf8)</span>
<span id="cb168-4"><a href="#cb168-4"></a><span class="co">#&gt; [1] &quot;UTF-8&quot;</span></span>
<span id="cb168-5"><a href="#cb168-5"></a>string_utf8</span>
<span id="cb168-6"><a href="#cb168-6"></a><span class="co">#&gt; [1] &quot;hi\231!&quot;</span></span></code></pre></div>
</div>
</div>
<div id="how-to-get-from-theyâre-to-theyre" class="section level2">
<h2><span class="header-section-number">12.5</span> How to Get From Theyâ€™re to They’re</h2>
<p>Moving on to the second blog post now.</p>
<div id="multi-byte-characters" class="section level3">
<h3><span class="header-section-number">12.5.1</span> Multi-byte characters</h3>
<p>Since we need to represent more than 256 characters, not all can be represented by a single byte. Let’s look at the curly single quote. <em>Ruby</em></p>
<pre><code>irb(main):001:0&gt; &quot;they’re&quot;.bytes
=&gt; [116, 104, 101, 121, 226, 128, 153, 114, 101]</code></pre>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1"></a>string_curly &lt;-<span class="st"> &quot;they’re&quot;</span></span>
<span id="cb170-2"><a href="#cb170-2"></a><span class="kw">charToRaw</span>(string_curly)</span>
<span id="cb170-3"><a href="#cb170-3"></a><span class="co">#&gt; [1] 74 68 65 79 92 72 65</span></span>
<span id="cb170-4"><a href="#cb170-4"></a><span class="kw">as.integer</span>(<span class="kw">charToRaw</span>(string_curly))</span>
<span id="cb170-5"><a href="#cb170-5"></a><span class="co">#&gt; [1] 116 104 101 121 146 114 101</span></span>
<span id="cb170-6"><a href="#cb170-6"></a><span class="kw">length</span>(<span class="kw">as.integer</span>(<span class="kw">charToRaw</span>(string_curly)))</span>
<span id="cb170-7"><a href="#cb170-7"></a><span class="co">#&gt; [1] 7</span></span>
<span id="cb170-8"><a href="#cb170-8"></a><span class="kw">nchar</span>(string_curly)</span>
<span id="cb170-9"><a href="#cb170-9"></a><span class="co">#&gt; [1] 7</span></span></code></pre></div>
<p>The string has 7 characters, but 9 bytes, because we’re using 3 bytes to represent the curly single quote. Let’s focus just on that. <em>Ruby</em></p>
<pre><code>irb(main):002:0&gt; &quot;’&quot;.bytes
=&gt; [226, 128, 153]</code></pre>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1"></a><span class="kw">charToRaw</span>(<span class="st">&quot;’&quot;</span>)</span>
<span id="cb172-2"><a href="#cb172-2"></a><span class="co">#&gt; [1] 92</span></span>
<span id="cb172-3"><a href="#cb172-3"></a><span class="kw">as.integer</span>(<span class="kw">charToRaw</span>(<span class="st">&quot;’&quot;</span>))</span>
<span id="cb172-4"><a href="#cb172-4"></a><span class="co">#&gt; [1] 146</span></span>
<span id="cb172-5"><a href="#cb172-5"></a><span class="kw">length</span>(<span class="kw">as.integer</span>(<span class="kw">charToRaw</span>(<span class="st">&quot;’&quot;</span>)))</span>
<span id="cb172-6"><a href="#cb172-6"></a><span class="co">#&gt; [1] 1</span></span></code></pre></div>
<p>One of the most common encoding fiascos you’ll see is this: theyâ€™re. Note that the curly single quote has been turned into a 3 character monstrosity. This is no coincidence. Remember those 3 bytes?</p>
<p>This is what happens when you interpret bytes that represent text in the UTF-8 encoding as if it’s encoded as Windows-1252. Learn to recognize it. <em>Ruby</em></p>
<pre><code>irb(main):003:0&gt; &quot;they’re&quot;.force_encoding(&quot;Windows-1252&quot;).encode(&quot;UTF-8&quot;)
=&gt; &quot;theyâ€™re&quot;</code></pre>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1"></a>(string_mis_encoded &lt;-<span class="st"> </span><span class="kw">iconv</span>(string_curly, <span class="dt">to =</span> <span class="st">&quot;UTF-8&quot;</span>, <span class="dt">from =</span> <span class="st">&quot;windows-1252&quot;</span>))</span>
<span id="cb174-2"><a href="#cb174-2"></a><span class="co">#&gt; [1] &quot;they’re&quot;</span></span></code></pre></div>
<p>Let’s assume this little gem is buried in some large file and you don’t immediately notice. So this string is interpreted with the wrong encoding, i.e. stored as the wrong bytes, either in an R object or in a file on disk. Now what?</p>
<p>Let’s review the original, correct bytes vs. the current, incorrect bytes and print the associated strings.</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1"></a><span class="kw">as.integer</span>(<span class="kw">charToRaw</span>(string_curly))</span>
<span id="cb175-2"><a href="#cb175-2"></a><span class="co">#&gt; [1] 116 104 101 121 146 114 101</span></span>
<span id="cb175-3"><a href="#cb175-3"></a><span class="kw">as.integer</span>(<span class="kw">charToRaw</span>(string_mis_encoded))</span>
<span id="cb175-4"><a href="#cb175-4"></a><span class="co">#&gt; [1] 116 104 101 121 226 128 153 114 101</span></span>
<span id="cb175-5"><a href="#cb175-5"></a>string_curly</span>
<span id="cb175-6"><a href="#cb175-6"></a><span class="co">#&gt; [1] &quot;they’re&quot;</span></span>
<span id="cb175-7"><a href="#cb175-7"></a>string_mis_encoded</span>
<span id="cb175-8"><a href="#cb175-8"></a><span class="co">#&gt; [1] &quot;they’re&quot;</span></span></code></pre></div>
</div>
<div id="encoding-repair" class="section level3">
<h3><span class="header-section-number">12.5.2</span> Encoding repair</h3>
<p>How do you fix this? You have to reverse your steps. You have a UTF-8 encoded string. Convert it back to Windows-1252, to get the original bytes. Then re-encode that as UTF-8. <em>Ruby</em></p>
<pre><code>irb(main):006:0&gt; &quot;theyâ€™re&quot;.encode(&quot;Windows-1252&quot;).force_encoding(&quot;UTF-8&quot;)
=&gt; &quot;they’re&quot;</code></pre>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1"></a>string_mis_encoded</span>
<span id="cb177-2"><a href="#cb177-2"></a><span class="co">#&gt; [1] &quot;they’re&quot;</span></span>
<span id="cb177-3"><a href="#cb177-3"></a>backwards_one &lt;-<span class="st"> </span><span class="kw">iconv</span>(string_mis_encoded, <span class="dt">from =</span> <span class="st">&quot;UTF-8&quot;</span>, <span class="dt">to =</span> <span class="st">&quot;Windows-1252&quot;</span>)</span>
<span id="cb177-4"><a href="#cb177-4"></a>backwards_one</span>
<span id="cb177-5"><a href="#cb177-5"></a><span class="co">#&gt; [1] &quot;they’re&quot;</span></span>
<span id="cb177-6"><a href="#cb177-6"></a><span class="kw">Encoding</span>(backwards_one)</span>
<span id="cb177-7"><a href="#cb177-7"></a><span class="co">#&gt; [1] &quot;unknown&quot;</span></span>
<span id="cb177-8"><a href="#cb177-8"></a><span class="kw">as.integer</span>(<span class="kw">charToRaw</span>(backwards_one))</span>
<span id="cb177-9"><a href="#cb177-9"></a><span class="co">#&gt; [1] 116 104 101 121 146 114 101</span></span>
<span id="cb177-10"><a href="#cb177-10"></a><span class="kw">as.integer</span>(<span class="kw">charToRaw</span>(string_curly))</span>
<span id="cb177-11"><a href="#cb177-11"></a><span class="co">#&gt; [1] 116 104 101 121 146 114 101</span></span></code></pre></div>
<!--RStudio Links-->
<!--HappyGitWithR Links-->
<!--Package Links-->
<!--Shiny links-->
<!--Publications-->
<!--R Documentation-->
<!--Wikipedia Links-->
<!--Misc. Links-->
<!--chapter:end:012_character-encoding.Rmd-->
</div>
</div>
</div>
<div id="date-time" class="section level1">
<h1><span class="header-section-number">13</span> Dates and times</h1>
<!--JB: *Under development ... really just a placeholder / collection of links*-->
<!--Original content: https://stat545.com/block030_date-times.html-->
<div id="date-time-vectors-where-they-fit-in" class="section level2">
<h2><span class="header-section-number">13.1</span> Date-time vectors: where they fit in</h2>
<p>We’ve spent a lot of time working with big, beautiful data frames. That are clean and wholesome, like the Gapminder data. With crude temporal information like, “THE YEAR IS 1952”.</p>
<p>But real life will be much nastier. This information will come to you with much greater precision, reported to the last second or worse, complicated by time zones and daylight savings time idiosyncrasies. Or in some weird format.</p>
<p>Here we discuss common remedial tasks for dealing with date-times.</p>
</div>
<div id="resources-5" class="section level2">
<h2><span class="header-section-number">13.2</span> Resources</h2>
<p>I start with this because we cannot possibly do this topic justice in a short amount of time. Our goal is to make you aware of specific problems and solutions. Once you have a character problem in real life, these resources will be extremely helpful as you delve deeper.</p>
<p><a href="https://r4ds.had.co.nz/dates-and-times.html">Dates and times</a> chapter from <a href="https://r4ds.had.co.nz">R for Data Science</a> by Hadley Wickham and Garrett Grolemund <span class="citation">(<a href="#ref-wickham2016" role="doc-biblioref">2016</a>)</span>. See also the subsection on dates and times in the <a href="http://r4ds.had.co.nz/data-import.html">Data import chapter</a>.</p>
<p>The <a href="https://lubridate.tidyverse.org">lubridate</a> package (<a href="https://CRAN.R-project.org/package=lubridate">CRAN</a>; <a href="https://github.com/tidyverse/lubridate">GitHub</a>; <a href="https://cran.r-project.org/web/packages/lubridate/vignettes/lubridate.html">main vignette</a>).</p>
<p>Grolemund and Wickham’s paper on lubridate in the Journal of Statistical Software <span class="citation">(<a href="#ref-grolemund2011" role="doc-biblioref">2011</a>)</span>.</p>
<p>Exercises to push you to learn lubridate: <a href="https://www.r-exercises.com/2016/08/15/dates-and-times-simple-and-easy-with-lubridate-part-1/">part 1</a>, <a href="https://www.r-exercises.com/2016/08/29/dates-and-times-simple-and-easy-with-lubridate-exercises-part-2/">part 2</a>, and <a href="https://www.r-exercises.com/2016/10/04/dates-and-times-simple-and-easy-with-lubridate-exercises-part-3/">part 3</a> <em>posts include links to answers!</em></p>
</div>
<div id="load-the-tidyverse-and-lubridate" class="section level2">
<h2><span class="header-section-number">13.3</span> Load the tidyverse and lubridate</h2>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb178-2"><a href="#cb178-2"></a><span class="kw">library</span>(lubridate)</span></code></pre></div>
</div>
<div id="get-your-hands-on-some-dates-or-date-times" class="section level2">
<h2><span class="header-section-number">13.4</span> Get your hands on some dates or date-times</h2>
<p>Use base <code>Sys.Date()</code> or lubridate’s <code>today()</code> to get today’s date, without any time.</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1"></a><span class="kw">Sys.Date</span>()</span>
<span id="cb179-2"><a href="#cb179-2"></a><span class="co">#&gt; [1] &quot;2021-01-03&quot;</span></span>
<span id="cb179-3"><a href="#cb179-3"></a><span class="kw">today</span>()</span>
<span id="cb179-4"><a href="#cb179-4"></a><span class="co">#&gt; [1] &quot;2021-01-03&quot;</span></span></code></pre></div>
<p>They both give you something of class <code>Date</code>.</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1"></a><span class="kw">str</span>(<span class="kw">Sys.Date</span>())</span>
<span id="cb180-2"><a href="#cb180-2"></a><span class="co">#&gt;  Date[1:1], format: &quot;2021-01-03&quot;</span></span>
<span id="cb180-3"><a href="#cb180-3"></a><span class="kw">class</span>(<span class="kw">Sys.Date</span>())</span>
<span id="cb180-4"><a href="#cb180-4"></a><span class="co">#&gt; [1] &quot;Date&quot;</span></span>
<span id="cb180-5"><a href="#cb180-5"></a><span class="kw">str</span>(<span class="kw">today</span>())</span>
<span id="cb180-6"><a href="#cb180-6"></a><span class="co">#&gt;  Date[1:1], format: &quot;2021-01-03&quot;</span></span>
<span id="cb180-7"><a href="#cb180-7"></a><span class="kw">class</span>(<span class="kw">today</span>())</span>
<span id="cb180-8"><a href="#cb180-8"></a><span class="co">#&gt; [1] &quot;Date&quot;</span></span></code></pre></div>
<p>Use base <code>Sys.time()</code> or lubridate’s <code>now()</code> to get RIGHT NOW, meaning the date and the time.</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1"></a><span class="kw">Sys.time</span>()</span>
<span id="cb181-2"><a href="#cb181-2"></a><span class="co">#&gt; [1] &quot;2021-01-03 12:27:07 EST&quot;</span></span>
<span id="cb181-3"><a href="#cb181-3"></a><span class="kw">now</span>()</span>
<span id="cb181-4"><a href="#cb181-4"></a><span class="co">#&gt; [1] &quot;2021-01-03 12:27:07 EST&quot;</span></span></code></pre></div>
<p>They both give you something of class <code>POSIXct</code> in R jargon.</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1"></a><span class="kw">str</span>(<span class="kw">Sys.time</span>())</span>
<span id="cb182-2"><a href="#cb182-2"></a><span class="co">#&gt;  POSIXct[1:1], format: &quot;2021-01-03 12:27:07&quot;</span></span>
<span id="cb182-3"><a href="#cb182-3"></a><span class="kw">class</span>(<span class="kw">Sys.time</span>())</span>
<span id="cb182-4"><a href="#cb182-4"></a><span class="co">#&gt; [1] &quot;POSIXct&quot; &quot;POSIXt&quot;</span></span>
<span id="cb182-5"><a href="#cb182-5"></a><span class="kw">str</span>(<span class="kw">now</span>())</span>
<span id="cb182-6"><a href="#cb182-6"></a><span class="co">#&gt;  POSIXct[1:1], format: &quot;2021-01-03 12:27:07&quot;</span></span>
<span id="cb182-7"><a href="#cb182-7"></a><span class="kw">class</span>(<span class="kw">now</span>())</span>
<span id="cb182-8"><a href="#cb182-8"></a><span class="co">#&gt; [1] &quot;POSIXct&quot; &quot;POSIXt&quot;</span></span></code></pre></div>
</div>
<div id="get-date-or-date-time-from-character" class="section level2">
<h2><span class="header-section-number">13.5</span> Get date or date-time from character</h2>
<p>One of the main ways dates and date-times come into your life:</p>
<p><a href="http://r4ds.had.co.nz/dates-and-times.html#creating-datetimes#from-strings" class="uri">http://r4ds.had.co.nz/dates-and-times.html#creating-datetimes#from-strings</a></p>
</div>
<div id="build-date-or-date-time-from-parts" class="section level2">
<h2><span class="header-section-number">13.6</span> Build date or date-time from parts</h2>
<p>Second most common way dates and date-times come into your life:</p>
<p><a href="http://r4ds.had.co.nz/dates-and-times.html#creating-datetimes#from-individual-components" class="uri">http://r4ds.had.co.nz/dates-and-times.html#creating-datetimes#from-individual-components</a></p>
<p>Once you have dates, you might want to edit them in a non-annoying way:</p>
<p><a href="http://r4ds.had.co.nz/dates-and-times.html#setting-components" class="uri">http://r4ds.had.co.nz/dates-and-times.html#setting-components</a></p>
</div>
<div id="get-parts-from-date-or-date-time" class="section level2">
<h2><span class="header-section-number">13.7</span> Get parts from date or date-time</h2>
<p><a href="http://r4ds.had.co.nz/dates-and-times.html#date-time-components#getting-components" class="uri">http://r4ds.had.co.nz/dates-and-times.html#date-time-components#getting-components</a></p>
</div>
<div id="arithmetic-with-date-or-date-time" class="section level2">
<h2><span class="header-section-number">13.8</span> Arithmetic with date or date-time</h2>
<p><a href="http://r4ds.had.co.nz/dates-and-times.html#time-spans" class="uri">http://r4ds.had.co.nz/dates-and-times.html#time-spans</a></p>
</div>
<div id="get-character-from-date-or-date-time" class="section level2">
<h2><span class="header-section-number">13.9</span> Get character from date or date-time</h2>
<p>Eventually you will need to print this stuff in, say, a report.</p>
<p><em>I always use <code>format()</code> but assumed lubridate had something else/better. Am I missing something here? Probably. For now, read the help: <code>?format.POSIXct</code>.</em></p>
<!--RStudio Links-->
<!--HappyGitWithR Links-->
<!--Package Links-->
<!--Shiny links-->
<!--Publications-->
<!--R Documentation-->
<!--Wikipedia Links-->
<!--Misc. Links-->
<!--chapter:end:013_date-times.Rmd-->
</div>
</div>
<div id="part-data-analysis-3" class="section level1 unnumbered">
<h1>(PART) Data analysis 3</h1>
</div>
<div id="multiple-tibbles" class="section level1">
<h1><span class="header-section-number">14</span> When one tibble is not enough</h1>
<!--Original content: https://stat545.com/block033_working-with-two-tables.html-->
<p>We’ve covered many topics on how to manipulate and reshape a single data frame:</p>
<ul>
<li>Chapter @ref(basic-data-care) - Basic care and feeding of data in R
<ul>
<li>Data frames (and tibbles) are awesome.</li>
</ul></li>
<li>Chapter @ref(dplyr-intro) - Introduction to dplyr
<ul>
<li>Filter, select, the pipe.</li>
</ul></li>
<li>Chapter @ref(dplyr-single) - dplyr functions for a single dataset
<ul>
<li>Single table verbs.</li>
</ul></li>
<li>Chapter @ref(tidy-data) - Tidy data using Lord of the Rings
<ul>
<li>Tidy data, tidyr.</li>
<li><em>This actually kicks off with a row bind operation, discussed below.</em></li>
</ul></li>
</ul>
<p>But what if your data arrives in many pieces? There are many good (and bad) reasons why this might happen. How do you get it into one big beautiful tibble? These tasks break down into 3 main classes:</p>
<ul>
<li>Bind</li>
<li>Join</li>
<li>Lookup</li>
</ul>
<div id="typology-of-data-combination-tasks" class="section level2">
<h2><span class="header-section-number">14.1</span> Typology of data combination tasks</h2>
<p><strong>Bind</strong> - This is basically smashing <del>rocks</del> tibbles together. You can smash things together row-wise (“row binding”) or column-wise (“column binding”). Why do I characterize this as rock-smashing? They’re often fairly crude operations, with lots of responsibility falling on the analyst for making sure that the whole enterprise even makes sense.</p>
<p>When row binding, you need to consider the variables in the two tibbles. Do the same variables exist in each? Are they of the same type? Different approaches for row binding have different combinations of flexibility vs rigidity around these matters.</p>
<p>When column binding, the onus is entirely on the analyst to make sure that the rows are aligned. I would avoid column binding whenever possible. If you can introduce new variables through any other, safer means, do so! By safer, I mean: use a mechanism where the row alignment is correct <strong>by definition</strong>. A proper join is the gold standard. In addition to joins, functions like <code>dplyr::mutate()</code> and <code>tidyr::separate()</code> can be very useful for forcing yourself to work inside the constraint of a tibble.</p>
<p><strong>Join</strong> - Here you designate a variable (or a combination of variables) as a <strong>key</strong>. A row in one data frame gets matched with a row in another data frame because they have the same key. You can then bring information from variables in a secondary data frame into a primary data frame based on this key-based lookup. That description is incredibly oversimplified, but that’s the basic idea.</p>
<p>A variety of row- and column-wise operations fit into this framework, which implies there are many different flavors of join. The concepts and vocabulary around joins come from the database world. The relevant functions in dplyr follow this convention and all mention <code>join</code>. The most relevant base R function is <code>merge()</code>.</p>
<p><strong>Lookup</strong> - Lookups are really just a special case of join. But it’s a special case worth making for two reasons:</p>
<ul>
<li>If you’ve ever used <code>LOOKUP()</code> and friends in Excel, you already have a mental model for this. Let’s exploit that!</li>
<li>Joins are defined in terms of two tables or data frames. But sometimes this task has a “vector” vibe. You might be creating a vector or variable. Or maybe the secondary data source is a named vector. In any case, there’s at least one vector in the mix. I call that a lookup.</li>
</ul>
<p>Let’s explore each type of operation with a few examples.</p>
<p>First, let’s load the tidyverse (and expose version information).</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb183-2"><a href="#cb183-2"></a><span class="co">#&gt; -- Attaching packages ------------------</span></span>
<span id="cb183-3"><a href="#cb183-3"></a><span class="co">#&gt; v ggplot2 3.3.2     v purrr   0.3.4</span></span>
<span id="cb183-4"><a href="#cb183-4"></a><span class="co">#&gt; v tibble  3.0.3     v dplyr   1.0.2</span></span>
<span id="cb183-5"><a href="#cb183-5"></a><span class="co">#&gt; v tidyr   1.1.2     v stringr 1.4.0</span></span>
<span id="cb183-6"><a href="#cb183-6"></a><span class="co">#&gt; v readr   1.3.1     v forcats 0.5.0</span></span>
<span id="cb183-7"><a href="#cb183-7"></a><span class="co">#&gt; -- Conflicts -- tidyverse_conflicts() --</span></span>
<span id="cb183-8"><a href="#cb183-8"></a><span class="co">#&gt; x dplyr::filter() masks stats::filter()</span></span>
<span id="cb183-9"><a href="#cb183-9"></a><span class="co">#&gt; x dplyr::lag()    masks stats::lag()</span></span></code></pre></div>
</div>
<div id="bind" class="section level2">
<h2><span class="header-section-number">14.2</span> Bind</h2>
<div id="row-binding" class="section level3">
<h3><span class="header-section-number">14.2.1</span> Row binding</h3>
<p>We used word count data from the Lord of the Rings trilogy to explore the concept of tidy data. That kicked off with a quiet, successful row bind. Let’s revisit that.</p>
<p>Here’s what a perfect row bind of three (untidy!) data frames looks like.</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1"></a>fship &lt;-<span class="st"> </span><span class="kw">tribble</span>(</span>
<span id="cb184-2"><a href="#cb184-2"></a>                         <span class="op">~</span>Film,    <span class="op">~</span>Race, <span class="op">~</span>Female, <span class="op">~</span>Male,</span>
<span id="cb184-3"><a href="#cb184-3"></a>  <span class="st">&quot;The Fellowship Of The Ring&quot;</span>,    <span class="st">&quot;Elf&quot;</span>,    <span class="dv">1229</span>,   <span class="dv">971</span>,</span>
<span id="cb184-4"><a href="#cb184-4"></a>  <span class="st">&quot;The Fellowship Of The Ring&quot;</span>, <span class="st">&quot;Hobbit&quot;</span>,      <span class="dv">14</span>,  <span class="dv">3644</span>,</span>
<span id="cb184-5"><a href="#cb184-5"></a>  <span class="st">&quot;The Fellowship Of The Ring&quot;</span>,    <span class="st">&quot;Man&quot;</span>,       <span class="dv">0</span>,  <span class="dv">1995</span></span>
<span id="cb184-6"><a href="#cb184-6"></a>)</span>
<span id="cb184-7"><a href="#cb184-7"></a>rking &lt;-<span class="st"> </span><span class="kw">tribble</span>(</span>
<span id="cb184-8"><a href="#cb184-8"></a>                         <span class="op">~</span>Film,    <span class="op">~</span>Race, <span class="op">~</span>Female, <span class="op">~</span>Male,</span>
<span id="cb184-9"><a href="#cb184-9"></a>      <span class="st">&quot;The Return Of The King&quot;</span>,    <span class="st">&quot;Elf&quot;</span>,     <span class="dv">183</span>,   <span class="dv">510</span>,</span>
<span id="cb184-10"><a href="#cb184-10"></a>      <span class="st">&quot;The Return Of The King&quot;</span>, <span class="st">&quot;Hobbit&quot;</span>,       <span class="dv">2</span>,  <span class="dv">2673</span>,</span>
<span id="cb184-11"><a href="#cb184-11"></a>      <span class="st">&quot;The Return Of The King&quot;</span>,    <span class="st">&quot;Man&quot;</span>,     <span class="dv">268</span>,  <span class="dv">2459</span></span>
<span id="cb184-12"><a href="#cb184-12"></a>)</span>
<span id="cb184-13"><a href="#cb184-13"></a>ttow &lt;-<span class="st"> </span><span class="kw">tribble</span>(</span>
<span id="cb184-14"><a href="#cb184-14"></a>                         <span class="op">~</span>Film,    <span class="op">~</span>Race, <span class="op">~</span>Female, <span class="op">~</span>Male,</span>
<span id="cb184-15"><a href="#cb184-15"></a>              <span class="st">&quot;The Two Towers&quot;</span>,    <span class="st">&quot;Elf&quot;</span>,     <span class="dv">331</span>,   <span class="dv">513</span>,</span>
<span id="cb184-16"><a href="#cb184-16"></a>              <span class="st">&quot;The Two Towers&quot;</span>, <span class="st">&quot;Hobbit&quot;</span>,       <span class="dv">0</span>,  <span class="dv">2463</span>,</span>
<span id="cb184-17"><a href="#cb184-17"></a>              <span class="st">&quot;The Two Towers&quot;</span>,    <span class="st">&quot;Man&quot;</span>,     <span class="dv">401</span>,  <span class="dv">3589</span></span>
<span id="cb184-18"><a href="#cb184-18"></a>)</span>
<span id="cb184-19"><a href="#cb184-19"></a>(lotr_untidy &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(fship, ttow, rking))</span>
<span id="cb184-20"><a href="#cb184-20"></a><span class="co">#&gt; # A tibble: 9 x 4</span></span>
<span id="cb184-21"><a href="#cb184-21"></a><span class="co">#&gt;   Film                       Race   Female  Male</span></span>
<span id="cb184-22"><a href="#cb184-22"></a><span class="co">#&gt;   &lt;chr&gt;                      &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb184-23"><a href="#cb184-23"></a><span class="co">#&gt; 1 The Fellowship Of The Ring Elf      1229   971</span></span>
<span id="cb184-24"><a href="#cb184-24"></a><span class="co">#&gt; 2 The Fellowship Of The Ring Hobbit     14  3644</span></span>
<span id="cb184-25"><a href="#cb184-25"></a><span class="co">#&gt; 3 The Fellowship Of The Ring Man         0  1995</span></span>
<span id="cb184-26"><a href="#cb184-26"></a><span class="co">#&gt; 4 The Two Towers             Elf       331   513</span></span>
<span id="cb184-27"><a href="#cb184-27"></a><span class="co">#&gt; 5 The Two Towers             Hobbit      0  2463</span></span>
<span id="cb184-28"><a href="#cb184-28"></a><span class="co">#&gt; 6 The Two Towers             Man       401  3589</span></span>
<span id="cb184-29"><a href="#cb184-29"></a><span class="co">#&gt; 7 The Return Of The King     Elf       183   510</span></span>
<span id="cb184-30"><a href="#cb184-30"></a><span class="co">#&gt; 8 The Return Of The King     Hobbit      2  2673</span></span>
<span id="cb184-31"><a href="#cb184-31"></a><span class="co">#&gt; 9 The Return Of The King     Man       268  2459</span></span></code></pre></div>
<p><code>dplyr::bind_rows()</code> works like a charm with these very row-bindable data frames! So does base <code>rbind()</code> (try it!).</p>
<p>But what if one of the data frames is somehow missing a variable? Let’s mangle one and find out.</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1"></a>ttow_no_Female &lt;-<span class="st"> </span>ttow <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">Female =</span> <span class="ot">NULL</span>)</span>
<span id="cb185-2"><a href="#cb185-2"></a><span class="kw">bind_rows</span>(fship, ttow_no_Female, rking)</span>
<span id="cb185-3"><a href="#cb185-3"></a><span class="co">#&gt; # A tibble: 9 x 4</span></span>
<span id="cb185-4"><a href="#cb185-4"></a><span class="co">#&gt;   Film                       Race   Female  Male</span></span>
<span id="cb185-5"><a href="#cb185-5"></a><span class="co">#&gt;   &lt;chr&gt;                      &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb185-6"><a href="#cb185-6"></a><span class="co">#&gt; 1 The Fellowship Of The Ring Elf      1229   971</span></span>
<span id="cb185-7"><a href="#cb185-7"></a><span class="co">#&gt; 2 The Fellowship Of The Ring Hobbit     14  3644</span></span>
<span id="cb185-8"><a href="#cb185-8"></a><span class="co">#&gt; 3 The Fellowship Of The Ring Man         0  1995</span></span>
<span id="cb185-9"><a href="#cb185-9"></a><span class="co">#&gt; 4 The Two Towers             Elf        NA   513</span></span>
<span id="cb185-10"><a href="#cb185-10"></a><span class="co">#&gt; 5 The Two Towers             Hobbit     NA  2463</span></span>
<span id="cb185-11"><a href="#cb185-11"></a><span class="co">#&gt; 6 The Two Towers             Man        NA  3589</span></span>
<span id="cb185-12"><a href="#cb185-12"></a><span class="co">#&gt; 7 The Return Of The King     Elf       183   510</span></span>
<span id="cb185-13"><a href="#cb185-13"></a><span class="co">#&gt; 8 The Return Of The King     Hobbit      2  2673</span></span>
<span id="cb185-14"><a href="#cb185-14"></a><span class="co">#&gt; 9 The Return Of The King     Man       268  2459</span></span>
<span id="cb185-15"><a href="#cb185-15"></a><span class="kw">rbind</span>(fship, ttow_no_Female, rking)</span>
<span id="cb185-16"><a href="#cb185-16"></a><span class="co">#&gt; Error in rbind(deparse.level, ...): numbers of columns of arguments do not match</span></span></code></pre></div>
<p>We see that <code>dplyr::bind_rows()</code> does the row bind and puts <code>NA</code> in for the missing values caused by the lack of <code>Female</code> data from The Two Towers. Base <code>rbind()</code> refuses to row bind in this situation.</p>
<p>I invite you to experiment with other realistic, challenging scenarios, e.g.:</p>
<ul>
<li>Change the order of variables. Does row binding match variables by name or position?</li>
<li>Row bind data frames where the variable <code>x</code> is of one type in one data frame and another type in the other. Try combinations that you think should work and some that should not. What actually happens?</li>
<li>Row bind data frames in which the factor <code>x</code> has different levels in one data frame and different levels in the other. What happens?</li>
</ul>
<p>In conclusion, row binding usually works when it should (especially with <code>dplyr::bind_rows()</code>) and usually doesn’t when it shouldn’t. The biggest risk is being aggravated.</p>
</div>
<div id="column-binding" class="section level3">
<h3><span class="header-section-number">14.2.2</span> Column binding</h3>
<p>Column binding is much more dangerous because it often “works” when it should not. It’s <strong>your job</strong> to the rows are aligned and it’s all too easy to screw this up.</p>
<p>The data in <code>gapminder</code> was originally excavated from 3 messy Excel spreadsheets: one each for life expectancy, population, and GDP per capital. Let’s relive some of the data wrangling joy and show a column bind gone wrong.</p>
<p>I create 3 separate data frames, do some evil row sorting, then column bind. There are no errors. The result <code>gapminder_garbage</code> sort of looks OK. Univariate summary statistics and exploratory plots will look OK. But I’ve created complete nonsense!</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1"></a><span class="kw">library</span>(gapminder)</span>
<span id="cb186-2"><a href="#cb186-2"></a></span>
<span id="cb186-3"><a href="#cb186-3"></a>life_exp &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span></span>
<span id="cb186-4"><a href="#cb186-4"></a><span class="st">  </span><span class="kw">select</span>(country, year, lifeExp)</span>
<span id="cb186-5"><a href="#cb186-5"></a></span>
<span id="cb186-6"><a href="#cb186-6"></a>pop &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span></span>
<span id="cb186-7"><a href="#cb186-7"></a><span class="st">  </span><span class="kw">arrange</span>(year) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb186-8"><a href="#cb186-8"></a><span class="st">  </span><span class="kw">select</span>(pop)</span>
<span id="cb186-9"><a href="#cb186-9"></a>  </span>
<span id="cb186-10"><a href="#cb186-10"></a>gdp_percap &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb186-11"><a href="#cb186-11"></a><span class="st">  </span><span class="kw">arrange</span>(pop) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb186-12"><a href="#cb186-12"></a><span class="st">  </span><span class="kw">select</span>(gdpPercap)</span>
<span id="cb186-13"><a href="#cb186-13"></a></span>
<span id="cb186-14"><a href="#cb186-14"></a>(gapminder_garbage &lt;-<span class="st"> </span><span class="kw">bind_cols</span>(life_exp, pop, gdp_percap))</span>
<span id="cb186-15"><a href="#cb186-15"></a><span class="co">#&gt; # A tibble: 1,704 x 5</span></span>
<span id="cb186-16"><a href="#cb186-16"></a><span class="co">#&gt;    country      year lifeExp      pop gdpPercap</span></span>
<span id="cb186-17"><a href="#cb186-17"></a><span class="co">#&gt;    &lt;fct&gt;       &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb186-18"><a href="#cb186-18"></a><span class="co">#&gt;  1 Afghanistan  1952    28.8  8425333      880.</span></span>
<span id="cb186-19"><a href="#cb186-19"></a><span class="co">#&gt;  2 Afghanistan  1957    30.3  1282697      861.</span></span>
<span id="cb186-20"><a href="#cb186-20"></a><span class="co">#&gt;  3 Afghanistan  1962    32.0  9279525     2670.</span></span>
<span id="cb186-21"><a href="#cb186-21"></a><span class="co">#&gt;  4 Afghanistan  1967    34.0  4232095     1072.</span></span>
<span id="cb186-22"><a href="#cb186-22"></a><span class="co">#&gt;  5 Afghanistan  1972    36.1 17876956     1385.</span></span>
<span id="cb186-23"><a href="#cb186-23"></a><span class="co">#&gt;  6 Afghanistan  1977    38.4  8691212     2865.</span></span>
<span id="cb186-24"><a href="#cb186-24"></a><span class="co">#&gt;  7 Afghanistan  1982    39.9  6927772     1533.</span></span>
<span id="cb186-25"><a href="#cb186-25"></a><span class="co">#&gt;  8 Afghanistan  1987    40.8   120447     1738.</span></span>
<span id="cb186-26"><a href="#cb186-26"></a><span class="co">#&gt;  9 Afghanistan  1992    41.7 46886859     3021.</span></span>
<span id="cb186-27"><a href="#cb186-27"></a><span class="co">#&gt; 10 Afghanistan  1997    41.8  8730405     1890.</span></span>
<span id="cb186-28"><a href="#cb186-28"></a><span class="co">#&gt; # ... with 1,694 more rows</span></span>
<span id="cb186-29"><a href="#cb186-29"></a></span>
<span id="cb186-30"><a href="#cb186-30"></a><span class="kw">summary</span>(gapminder<span class="op">$</span>lifeExp)</span>
<span id="cb186-31"><a href="#cb186-31"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb186-32"><a href="#cb186-32"></a><span class="co">#&gt;    23.6    48.2    60.7    59.5    70.8    82.6</span></span>
<span id="cb186-33"><a href="#cb186-33"></a><span class="kw">summary</span>(gapminder_garbage<span class="op">$</span>lifeExp)</span>
<span id="cb186-34"><a href="#cb186-34"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb186-35"><a href="#cb186-35"></a><span class="co">#&gt;    23.6    48.2    60.7    59.5    70.8    82.6</span></span>
<span id="cb186-36"><a href="#cb186-36"></a><span class="kw">range</span>(gapminder<span class="op">$</span>gdpPercap)</span>
<span id="cb186-37"><a href="#cb186-37"></a><span class="co">#&gt; [1]    241 113523</span></span>
<span id="cb186-38"><a href="#cb186-38"></a><span class="kw">range</span>(gapminder_garbage<span class="op">$</span>gdpPercap)</span>
<span id="cb186-39"><a href="#cb186-39"></a><span class="co">#&gt; [1]    241 113523</span></span></code></pre></div>
<p>One last cautionary tale about column binding. This one requires the use of <code>cbind()</code> and it’s why the tidyverse is generally unwilling to recycle when combining things of different length.</p>
<p>I create a tibble with most of the <code>gapminder</code> columns. I create another with the remainder, but filtered down to just one country. I am able to <code>cbind()</code> these objects! Why? Because the 12 rows for Canada divide evenly into the 1704 rows of <code>gapminder</code>. Note that <code>dplyr::bind_cols()</code> refuses to column bind here.</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1"></a>gapminder_mostly &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>pop, <span class="op">-</span>gdpPercap)</span>
<span id="cb187-2"><a href="#cb187-2"></a>gapminder_leftovers_filtered &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb187-3"><a href="#cb187-3"></a><span class="st">  </span><span class="kw">filter</span>(country <span class="op">==</span><span class="st"> &quot;Canada&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb187-4"><a href="#cb187-4"></a><span class="st">  </span><span class="kw">select</span>(pop, gdpPercap)</span>
<span id="cb187-5"><a href="#cb187-5"></a></span>
<span id="cb187-6"><a href="#cb187-6"></a>gapminder_nonsense &lt;-<span class="st"> </span><span class="kw">cbind</span>(gapminder_mostly, gapminder_leftovers_filtered)</span>
<span id="cb187-7"><a href="#cb187-7"></a><span class="kw">head</span>(gapminder_nonsense, <span class="dv">14</span>)</span>
<span id="cb187-8"><a href="#cb187-8"></a><span class="co">#&gt;        country continent year lifeExp      pop gdpPercap</span></span>
<span id="cb187-9"><a href="#cb187-9"></a><span class="co">#&gt; 1  Afghanistan      Asia 1952    28.8 14785584     11367</span></span>
<span id="cb187-10"><a href="#cb187-10"></a><span class="co">#&gt; 2  Afghanistan      Asia 1957    30.3 17010154     12490</span></span>
<span id="cb187-11"><a href="#cb187-11"></a><span class="co">#&gt; 3  Afghanistan      Asia 1962    32.0 18985849     13462</span></span>
<span id="cb187-12"><a href="#cb187-12"></a><span class="co">#&gt; 4  Afghanistan      Asia 1967    34.0 20819767     16077</span></span>
<span id="cb187-13"><a href="#cb187-13"></a><span class="co">#&gt; 5  Afghanistan      Asia 1972    36.1 22284500     18971</span></span>
<span id="cb187-14"><a href="#cb187-14"></a><span class="co">#&gt; 6  Afghanistan      Asia 1977    38.4 23796400     22091</span></span>
<span id="cb187-15"><a href="#cb187-15"></a><span class="co">#&gt; 7  Afghanistan      Asia 1982    39.9 25201900     22899</span></span>
<span id="cb187-16"><a href="#cb187-16"></a><span class="co">#&gt; 8  Afghanistan      Asia 1987    40.8 26549700     26627</span></span>
<span id="cb187-17"><a href="#cb187-17"></a><span class="co">#&gt; 9  Afghanistan      Asia 1992    41.7 28523502     26343</span></span>
<span id="cb187-18"><a href="#cb187-18"></a><span class="co">#&gt; 10 Afghanistan      Asia 1997    41.8 30305843     28955</span></span>
<span id="cb187-19"><a href="#cb187-19"></a><span class="co">#&gt; 11 Afghanistan      Asia 2002    42.1 31902268     33329</span></span>
<span id="cb187-20"><a href="#cb187-20"></a><span class="co">#&gt; 12 Afghanistan      Asia 2007    43.8 33390141     36319</span></span>
<span id="cb187-21"><a href="#cb187-21"></a><span class="co">#&gt; 13     Albania    Europe 1952    55.2 14785584     11367</span></span>
<span id="cb187-22"><a href="#cb187-22"></a><span class="co">#&gt; 14     Albania    Europe 1957    59.3 17010154     12490</span></span></code></pre></div>
<p>This data frame isn’t obviously wrong, but it is wrong. See how the Canada’s population and GDP per capita repeat for each country?</p>
<p>Bottom line: Row bind when you need to, but inspect the results re: coercion. Column bind only if you must and be extremely paranoid.</p>
</div>
</div>
<div id="joins-in-dplyr" class="section level2">
<h2><span class="header-section-number">14.3</span> Joins in dplyr</h2>
<p>Visit Chapter @ref(join-cheatsheet) to see concrete examples of all the joins implemented in dplyr, based on comic characters and publishers.</p>
<p>The most recent release of gapminder includes a new data frame, <code>country_codes</code>, with country names and ISO codes. Therefore you can also use it to practice joins.</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1"></a>gapminder <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb188-2"><a href="#cb188-2"></a><span class="st">  </span><span class="kw">select</span>(country, continent) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb188-3"><a href="#cb188-3"></a><span class="st">  </span><span class="kw">group_by</span>(country) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb188-4"><a href="#cb188-4"></a><span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb188-5"><a href="#cb188-5"></a><span class="st">  </span><span class="kw">left_join</span>(country_codes)</span>
<span id="cb188-6"><a href="#cb188-6"></a><span class="co">#&gt; Joining, by = &quot;country&quot;</span></span>
<span id="cb188-7"><a href="#cb188-7"></a><span class="co">#&gt; # A tibble: 142 x 4</span></span>
<span id="cb188-8"><a href="#cb188-8"></a><span class="co">#&gt; # Groups:   country [142]</span></span>
<span id="cb188-9"><a href="#cb188-9"></a><span class="co">#&gt;    country     continent iso_alpha iso_num</span></span>
<span id="cb188-10"><a href="#cb188-10"></a><span class="co">#&gt;    &lt;chr&gt;       &lt;fct&gt;     &lt;chr&gt;       &lt;int&gt;</span></span>
<span id="cb188-11"><a href="#cb188-11"></a><span class="co">#&gt;  1 Afghanistan Asia      AFG             4</span></span>
<span id="cb188-12"><a href="#cb188-12"></a><span class="co">#&gt;  2 Albania     Europe    ALB             8</span></span>
<span id="cb188-13"><a href="#cb188-13"></a><span class="co">#&gt;  3 Algeria     Africa    DZA            12</span></span>
<span id="cb188-14"><a href="#cb188-14"></a><span class="co">#&gt;  4 Angola      Africa    AGO            24</span></span>
<span id="cb188-15"><a href="#cb188-15"></a><span class="co">#&gt;  5 Argentina   Americas  ARG            32</span></span>
<span id="cb188-16"><a href="#cb188-16"></a><span class="co">#&gt;  6 Australia   Oceania   AUS            36</span></span>
<span id="cb188-17"><a href="#cb188-17"></a><span class="co">#&gt;  7 Austria     Europe    AUT            40</span></span>
<span id="cb188-18"><a href="#cb188-18"></a><span class="co">#&gt;  8 Bahrain     Asia      BHR            48</span></span>
<span id="cb188-19"><a href="#cb188-19"></a><span class="co">#&gt;  9 Bangladesh  Asia      BGD            50</span></span>
<span id="cb188-20"><a href="#cb188-20"></a><span class="co">#&gt; 10 Belgium     Europe    BEL            56</span></span>
<span id="cb188-21"><a href="#cb188-21"></a><span class="co">#&gt; # ... with 132 more rows</span></span></code></pre></div>
</div>
<div id="table-lookup" class="section level2">
<h2><span class="header-section-number">14.4</span> Table Lookup</h2>
<p>See Chapter @ref(lookup) for examples.</p>
<!--RStudio Links-->
<!--HappyGitWithR Links-->
<!--Package Links-->
<!--Shiny links-->
<!--Publications-->
<!--R Documentation-->
<!--Wikipedia Links-->
<!--Misc. Links-->
<!--chapter:end:014_multiple-tibbles.Rmd-->
</div>
</div>
<div id="join-cheatsheet" class="section level1">
<h1><span class="header-section-number">15</span> Join two tables</h1>
<!--Original content: https://stat545.com/bit001_dplyr-cheatsheet.html-->
<p>Join (a.k.a. merge) two tables: dplyr join cheatsheet with comic characters and publishers.</p>
<div id="why-the-cheatsheet" class="section level2">
<h2><span class="header-section-number">15.1</span> Why the cheatsheet</h2>
<p>Examples for those of us who don’t speak SQL so good. There are lots of <a href="https://www.google.com/search?q=sql+join&amp;tbm=isch">Venn diagrams re: SQL joins on the internet</a>, but I wanted R examples. Those diagrams also utterly fail to show what’s really going on vis-a-vis rows AND columns.</p>
<p>Other great places to read about joins:</p>
<ul>
<li>The dplyr vignette on <a href="https://dplyr.tidyverse.org/articles/two-table.html">Two-table verbs</a>.</li>
<li>The <a href="https://r4ds.had.co.nz/relational-data.html">Relational data chapter</a> in <a href="https://r4ds.had.co.nz">R for Data Science</a> <span class="citation">(Wickham and Grolemund <a href="#ref-wickham2016" role="doc-biblioref">2016</a>)</span>. Excellent diagrams.</li>
</ul>
</div>
<div id="the-data" class="section level2">
<h2><span class="header-section-number">15.2</span> The data</h2>
<p>Working with two small data frames: <code>superheroes</code> and <code>publishers</code>.</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1"></a><span class="kw">library</span>(tidyverse) <span class="co">## dplyr provides the join functions</span></span>
<span id="cb189-2"><a href="#cb189-2"></a></span>
<span id="cb189-3"><a href="#cb189-3"></a>superheroes &lt;-<span class="st"> </span>tibble<span class="op">::</span><span class="kw">tribble</span>(</span>
<span id="cb189-4"><a href="#cb189-4"></a>       <span class="op">~</span>name, <span class="op">~</span>alignment,  <span class="op">~</span>gender,          <span class="op">~</span>publisher,</span>
<span id="cb189-5"><a href="#cb189-5"></a>   <span class="st">&quot;Magneto&quot;</span>,      <span class="st">&quot;bad&quot;</span>,   <span class="st">&quot;male&quot;</span>,            <span class="st">&quot;Marvel&quot;</span>,</span>
<span id="cb189-6"><a href="#cb189-6"></a>     <span class="st">&quot;Storm&quot;</span>,     <span class="st">&quot;good&quot;</span>, <span class="st">&quot;female&quot;</span>,            <span class="st">&quot;Marvel&quot;</span>,</span>
<span id="cb189-7"><a href="#cb189-7"></a>  <span class="st">&quot;Mystique&quot;</span>,      <span class="st">&quot;bad&quot;</span>, <span class="st">&quot;female&quot;</span>,            <span class="st">&quot;Marvel&quot;</span>,</span>
<span id="cb189-8"><a href="#cb189-8"></a>    <span class="st">&quot;Batman&quot;</span>,     <span class="st">&quot;good&quot;</span>,   <span class="st">&quot;male&quot;</span>,                <span class="st">&quot;DC&quot;</span>,</span>
<span id="cb189-9"><a href="#cb189-9"></a>     <span class="st">&quot;Joker&quot;</span>,      <span class="st">&quot;bad&quot;</span>,   <span class="st">&quot;male&quot;</span>,                <span class="st">&quot;DC&quot;</span>,</span>
<span id="cb189-10"><a href="#cb189-10"></a>  <span class="st">&quot;Catwoman&quot;</span>,      <span class="st">&quot;bad&quot;</span>, <span class="st">&quot;female&quot;</span>,                <span class="st">&quot;DC&quot;</span>,</span>
<span id="cb189-11"><a href="#cb189-11"></a>   <span class="st">&quot;Hellboy&quot;</span>,     <span class="st">&quot;good&quot;</span>,   <span class="st">&quot;male&quot;</span>, <span class="st">&quot;Dark Horse Comics&quot;</span></span>
<span id="cb189-12"><a href="#cb189-12"></a>  )</span>
<span id="cb189-13"><a href="#cb189-13"></a></span>
<span id="cb189-14"><a href="#cb189-14"></a>publishers &lt;-<span class="st"> </span>tibble<span class="op">::</span><span class="kw">tribble</span>(</span>
<span id="cb189-15"><a href="#cb189-15"></a>  <span class="op">~</span>publisher, <span class="op">~</span>yr_founded,</span>
<span id="cb189-16"><a href="#cb189-16"></a>        <span class="st">&quot;DC&quot;</span>,       1934L,</span>
<span id="cb189-17"><a href="#cb189-17"></a>    <span class="st">&quot;Marvel&quot;</span>,       1939L,</span>
<span id="cb189-18"><a href="#cb189-18"></a>     <span class="st">&quot;Image&quot;</span>,       1992L</span>
<span id="cb189-19"><a href="#cb189-19"></a>  )</span></code></pre></div>
<p>Sorry, cheat sheet does not illustrate “multiple match” situations terribly well.</p>
<p>Sub-plot: watch the row and variable order of the join results for a healthy reminder of why it’s dangerous to rely on any of that in an analysis.</p>
</div>
<div id="inner_joinsuperheroes-publishers" class="section level2">
<h2><span class="header-section-number">15.3</span> <code>inner_join(superheroes, publishers)</code></h2>
<blockquote>
<p><code>inner_join(x, y)</code>: Return all rows from <code>x</code> where there are matching values in <code>y</code>, and all columns from <code>x</code> and <code>y</code>. If there are multiple matches between <code>x</code> and <code>y</code>, all combination of the matches are returned. This is a mutating join.</p>
</blockquote>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1"></a>(ijsp &lt;-<span class="st"> </span><span class="kw">inner_join</span>(superheroes, publishers))</span>
<span id="cb190-2"><a href="#cb190-2"></a><span class="co">#&gt; Joining, by = &quot;publisher&quot;</span></span>
<span id="cb190-3"><a href="#cb190-3"></a><span class="co">#&gt; # A tibble: 6 x 5</span></span>
<span id="cb190-4"><a href="#cb190-4"></a><span class="co">#&gt;   name     alignment gender publisher yr_founded</span></span>
<span id="cb190-5"><a href="#cb190-5"></a><span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;  &lt;chr&gt;          &lt;int&gt;</span></span>
<span id="cb190-6"><a href="#cb190-6"></a><span class="co">#&gt; 1 Magneto  bad       male   Marvel          1939</span></span>
<span id="cb190-7"><a href="#cb190-7"></a><span class="co">#&gt; 2 Storm    good      female Marvel          1939</span></span>
<span id="cb190-8"><a href="#cb190-8"></a><span class="co">#&gt; 3 Mystique bad       female Marvel          1939</span></span>
<span id="cb190-9"><a href="#cb190-9"></a><span class="co">#&gt; 4 Batman   good      male   DC              1934</span></span>
<span id="cb190-10"><a href="#cb190-10"></a><span class="co">#&gt; 5 Joker    bad       male   DC              1934</span></span>
<span id="cb190-11"><a href="#cb190-11"></a><span class="co">#&gt; 6 Catwoman bad       female DC              1934</span></span></code></pre></div>
<p>We lose Hellboy in the join because, although he appears in <code>x = superheroes</code>, his publisher Dark Horse Comics does not appear in <code>y = publishers</code>. The join result has all variables from <code>x = superheroes</code> plus <code>yr_founded</code>, from <code>y</code>.</p>
<table style="width: 100%; border: 0px;">
<tr>
<td style="width: 38%; vertical-align: top;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#lvaypigdor .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: 0;
  margin-right: auto;
  color: #333333;
  font-size: 80%;
  font-weight: normal;
  font-style: normal;
  background-color: #edc7fc;
  width: 100%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#lvaypigdor .gt_heading {
  background-color: #edc7fc;
  text-align: center;
  border-bottom-color: #edc7fc;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#lvaypigdor .gt_title {
  color: #333333;
  font-size: 90%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #edc7fc;
  border-bottom-width: 0;
}

#lvaypigdor .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #edc7fc;
  border-top-width: 0;
}

#lvaypigdor .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lvaypigdor .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#lvaypigdor .gt_col_heading {
  color: #333333;
  background-color: #edc7fc;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#lvaypigdor .gt_column_spanner_outer {
  color: #333333;
  background-color: #edc7fc;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#lvaypigdor .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#lvaypigdor .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#lvaypigdor .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#lvaypigdor .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #edc7fc;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#lvaypigdor .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #edc7fc;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#lvaypigdor .gt_from_md > :first-child {
  margin-top: 0;
}

#lvaypigdor .gt_from_md > :last-child {
  margin-bottom: 0;
}

#lvaypigdor .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#lvaypigdor .gt_stub {
  color: #333333;
  background-color: #edc7fc;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#lvaypigdor .gt_summary_row {
  color: #333333;
  background-color: #edc7fc;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#lvaypigdor .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#lvaypigdor .gt_grand_summary_row {
  color: #333333;
  background-color: #edc7fc;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#lvaypigdor .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#lvaypigdor .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#lvaypigdor .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lvaypigdor .gt_footnotes {
  color: #333333;
  background-color: #edc7fc;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#lvaypigdor .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#lvaypigdor .gt_sourcenotes {
  color: #333333;
  background-color: #edc7fc;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#lvaypigdor .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#lvaypigdor .gt_left {
  text-align: left;
}

#lvaypigdor .gt_center {
  text-align: center;
}

#lvaypigdor .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#lvaypigdor .gt_font_normal {
  font-weight: normal;
}

#lvaypigdor .gt_font_bold {
  font-weight: bold;
}

#lvaypigdor .gt_font_italic {
  font-style: italic;
}

#lvaypigdor .gt_super {
  font-size: 65%;
}

#lvaypigdor .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="lvaypigdor" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  <thead class="gt_header">
    <tr>
      <th colspan="4" class="gt_heading gt_title gt_font_normal" style>superheroes</th>
    </tr>
    <tr>
      <th colspan="4" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style></th>
    </tr>
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">name</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">alignment</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">gender</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">publisher</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_left">Magneto</td>
      <td class="gt_row gt_left">bad</td>
      <td class="gt_row gt_left">male</td>
      <td class="gt_row gt_left">Marvel</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Storm</td>
      <td class="gt_row gt_left gt_striped">good</td>
      <td class="gt_row gt_left gt_striped">female</td>
      <td class="gt_row gt_left gt_striped">Marvel</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">Mystique</td>
      <td class="gt_row gt_left">bad</td>
      <td class="gt_row gt_left">female</td>
      <td class="gt_row gt_left">Marvel</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Batman</td>
      <td class="gt_row gt_left gt_striped">good</td>
      <td class="gt_row gt_left gt_striped">male</td>
      <td class="gt_row gt_left gt_striped">DC</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">Joker</td>
      <td class="gt_row gt_left">bad</td>
      <td class="gt_row gt_left">male</td>
      <td class="gt_row gt_left">DC</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Catwoman</td>
      <td class="gt_row gt_left gt_striped">bad</td>
      <td class="gt_row gt_left gt_striped">female</td>
      <td class="gt_row gt_left gt_striped">DC</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">Hellboy</td>
      <td class="gt_row gt_left">good</td>
      <td class="gt_row gt_left">male</td>
      <td class="gt_row gt_left">Dark Horse Comics</td>
    </tr>
  </tbody>
  
  
</table></div>
</td>
<td style="width: 18%; vertical-align: top;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#oazlkphvis .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: 0;
  margin-right: auto;
  color: #333333;
  font-size: 80%;
  font-weight: normal;
  font-style: normal;
  background-color: #cce6f6;
  width: 100%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#oazlkphvis .gt_heading {
  background-color: #cce6f6;
  text-align: center;
  border-bottom-color: #cce6f6;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#oazlkphvis .gt_title {
  color: #333333;
  font-size: 90%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #cce6f6;
  border-bottom-width: 0;
}

#oazlkphvis .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #cce6f6;
  border-top-width: 0;
}

#oazlkphvis .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#oazlkphvis .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#oazlkphvis .gt_col_heading {
  color: #333333;
  background-color: #cce6f6;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#oazlkphvis .gt_column_spanner_outer {
  color: #333333;
  background-color: #cce6f6;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#oazlkphvis .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#oazlkphvis .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#oazlkphvis .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#oazlkphvis .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #cce6f6;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#oazlkphvis .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #cce6f6;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#oazlkphvis .gt_from_md > :first-child {
  margin-top: 0;
}

#oazlkphvis .gt_from_md > :last-child {
  margin-bottom: 0;
}

#oazlkphvis .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#oazlkphvis .gt_stub {
  color: #333333;
  background-color: #cce6f6;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#oazlkphvis .gt_summary_row {
  color: #333333;
  background-color: #cce6f6;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#oazlkphvis .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#oazlkphvis .gt_grand_summary_row {
  color: #333333;
  background-color: #cce6f6;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#oazlkphvis .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#oazlkphvis .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#oazlkphvis .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#oazlkphvis .gt_footnotes {
  color: #333333;
  background-color: #cce6f6;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#oazlkphvis .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#oazlkphvis .gt_sourcenotes {
  color: #333333;
  background-color: #cce6f6;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#oazlkphvis .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#oazlkphvis .gt_left {
  text-align: left;
}

#oazlkphvis .gt_center {
  text-align: center;
}

#oazlkphvis .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#oazlkphvis .gt_font_normal {
  font-weight: normal;
}

#oazlkphvis .gt_font_bold {
  font-weight: bold;
}

#oazlkphvis .gt_font_italic {
  font-style: italic;
}

#oazlkphvis .gt_super {
  font-size: 65%;
}

#oazlkphvis .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="oazlkphvis" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  <thead class="gt_header">
    <tr>
      <th colspan="2" class="gt_heading gt_title gt_font_normal" style>publishers</th>
    </tr>
    <tr>
      <th colspan="2" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style></th>
    </tr>
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">publisher</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">yr_founded</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_left">DC</td>
      <td class="gt_row gt_center">1934</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Marvel</td>
      <td class="gt_row gt_center gt_striped">1939</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">Image</td>
      <td class="gt_row gt_center">1992</td>
    </tr>
  </tbody>
  
  
</table></div>
</td>
<td style="width: 44%; vertical-align: top;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#qkrwxjsajp .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: 0;
  margin-right: auto;
  color: #333333;
  font-size: 80%;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: 100%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#qkrwxjsajp .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qkrwxjsajp .gt_title {
  color: #333333;
  font-size: 90%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#qkrwxjsajp .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#qkrwxjsajp .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qkrwxjsajp .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qkrwxjsajp .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#qkrwxjsajp .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#qkrwxjsajp .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#qkrwxjsajp .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#qkrwxjsajp .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#qkrwxjsajp .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#qkrwxjsajp .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#qkrwxjsajp .gt_from_md > :first-child {
  margin-top: 0;
}

#qkrwxjsajp .gt_from_md > :last-child {
  margin-bottom: 0;
}

#qkrwxjsajp .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#qkrwxjsajp .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#qkrwxjsajp .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qkrwxjsajp .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#qkrwxjsajp .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qkrwxjsajp .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#qkrwxjsajp .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#qkrwxjsajp .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qkrwxjsajp .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qkrwxjsajp .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#qkrwxjsajp .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qkrwxjsajp .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#qkrwxjsajp .gt_left {
  text-align: left;
}

#qkrwxjsajp .gt_center {
  text-align: center;
}

#qkrwxjsajp .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#qkrwxjsajp .gt_font_normal {
  font-weight: normal;
}

#qkrwxjsajp .gt_font_bold {
  font-weight: bold;
}

#qkrwxjsajp .gt_font_italic {
  font-style: italic;
}

#qkrwxjsajp .gt_super {
  font-size: 65%;
}

#qkrwxjsajp .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="qkrwxjsajp" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  <thead class="gt_header">
    <tr>
      <th colspan="5" class="gt_heading gt_title gt_font_normal" style>inner_join(x = superheroes, y = publishers)</th>
    </tr>
    <tr>
      <th colspan="5" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style></th>
    </tr>
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">name</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">alignment</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">gender</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">publisher</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">yr_founded</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_left">Magneto</td>
      <td class="gt_row gt_left">bad</td>
      <td class="gt_row gt_left">male</td>
      <td class="gt_row gt_left">Marvel</td>
      <td class="gt_row gt_center">1939</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Storm</td>
      <td class="gt_row gt_left gt_striped">good</td>
      <td class="gt_row gt_left gt_striped">female</td>
      <td class="gt_row gt_left gt_striped">Marvel</td>
      <td class="gt_row gt_center gt_striped">1939</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">Mystique</td>
      <td class="gt_row gt_left">bad</td>
      <td class="gt_row gt_left">female</td>
      <td class="gt_row gt_left">Marvel</td>
      <td class="gt_row gt_center">1939</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Batman</td>
      <td class="gt_row gt_left gt_striped">good</td>
      <td class="gt_row gt_left gt_striped">male</td>
      <td class="gt_row gt_left gt_striped">DC</td>
      <td class="gt_row gt_center gt_striped">1934</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">Joker</td>
      <td class="gt_row gt_left">bad</td>
      <td class="gt_row gt_left">male</td>
      <td class="gt_row gt_left">DC</td>
      <td class="gt_row gt_center">1934</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Catwoman</td>
      <td class="gt_row gt_left gt_striped">bad</td>
      <td class="gt_row gt_left gt_striped">female</td>
      <td class="gt_row gt_left gt_striped">DC</td>
      <td class="gt_row gt_center gt_striped">1934</td>
    </tr>
  </tbody>
  
  
</table></div>
</td>
</tr>
</table>
</div>
<div id="semi_joinsuperheroes-publishers" class="section level2">
<h2><span class="header-section-number">15.4</span> <code>semi_join(superheroes, publishers)</code></h2>
<blockquote>
<p><code>semi_join(x, y)</code>: Return all rows from <code>x</code> where there are matching values in <code>y</code>, keeping just columns from <code>x</code>. A semi join differs from an inner join because an inner join will return one row of <code>x</code> for each matching row of <code>y</code>, where a semi join will never duplicate rows of <code>x</code>. This is a filtering join.</p>
</blockquote>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1"></a>(sjsp &lt;-<span class="st"> </span><span class="kw">semi_join</span>(superheroes, publishers))</span>
<span id="cb191-2"><a href="#cb191-2"></a><span class="co">#&gt; Joining, by = &quot;publisher&quot;</span></span>
<span id="cb191-3"><a href="#cb191-3"></a><span class="co">#&gt; # A tibble: 6 x 4</span></span>
<span id="cb191-4"><a href="#cb191-4"></a><span class="co">#&gt;   name     alignment gender publisher</span></span>
<span id="cb191-5"><a href="#cb191-5"></a><span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;  &lt;chr&gt;    </span></span>
<span id="cb191-6"><a href="#cb191-6"></a><span class="co">#&gt; 1 Magneto  bad       male   Marvel   </span></span>
<span id="cb191-7"><a href="#cb191-7"></a><span class="co">#&gt; 2 Storm    good      female Marvel   </span></span>
<span id="cb191-8"><a href="#cb191-8"></a><span class="co">#&gt; 3 Mystique bad       female Marvel   </span></span>
<span id="cb191-9"><a href="#cb191-9"></a><span class="co">#&gt; 4 Batman   good      male   DC       </span></span>
<span id="cb191-10"><a href="#cb191-10"></a><span class="co">#&gt; 5 Joker    bad       male   DC       </span></span>
<span id="cb191-11"><a href="#cb191-11"></a><span class="co">#&gt; 6 Catwoman bad       female DC</span></span></code></pre></div>
<p>We get a similar result as with <code>inner_join()</code> but the join result contains only the variables originally found in <code>x = superheroes</code>.</p>
<table style="width: 100%; border: 0px;">
<tr>
<td style="width: 38%; vertical-align: top;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#avdjonupei .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: 0;
  margin-right: auto;
  color: #333333;
  font-size: 80%;
  font-weight: normal;
  font-style: normal;
  background-color: #edc7fc;
  width: 100%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#avdjonupei .gt_heading {
  background-color: #edc7fc;
  text-align: center;
  border-bottom-color: #edc7fc;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#avdjonupei .gt_title {
  color: #333333;
  font-size: 90%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #edc7fc;
  border-bottom-width: 0;
}

#avdjonupei .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #edc7fc;
  border-top-width: 0;
}

#avdjonupei .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#avdjonupei .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#avdjonupei .gt_col_heading {
  color: #333333;
  background-color: #edc7fc;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#avdjonupei .gt_column_spanner_outer {
  color: #333333;
  background-color: #edc7fc;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#avdjonupei .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#avdjonupei .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#avdjonupei .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#avdjonupei .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #edc7fc;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#avdjonupei .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #edc7fc;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#avdjonupei .gt_from_md > :first-child {
  margin-top: 0;
}

#avdjonupei .gt_from_md > :last-child {
  margin-bottom: 0;
}

#avdjonupei .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#avdjonupei .gt_stub {
  color: #333333;
  background-color: #edc7fc;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#avdjonupei .gt_summary_row {
  color: #333333;
  background-color: #edc7fc;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#avdjonupei .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#avdjonupei .gt_grand_summary_row {
  color: #333333;
  background-color: #edc7fc;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#avdjonupei .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#avdjonupei .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#avdjonupei .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#avdjonupei .gt_footnotes {
  color: #333333;
  background-color: #edc7fc;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#avdjonupei .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#avdjonupei .gt_sourcenotes {
  color: #333333;
  background-color: #edc7fc;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#avdjonupei .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#avdjonupei .gt_left {
  text-align: left;
}

#avdjonupei .gt_center {
  text-align: center;
}

#avdjonupei .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#avdjonupei .gt_font_normal {
  font-weight: normal;
}

#avdjonupei .gt_font_bold {
  font-weight: bold;
}

#avdjonupei .gt_font_italic {
  font-style: italic;
}

#avdjonupei .gt_super {
  font-size: 65%;
}

#avdjonupei .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="avdjonupei" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  <thead class="gt_header">
    <tr>
      <th colspan="4" class="gt_heading gt_title gt_font_normal" style>superheroes</th>
    </tr>
    <tr>
      <th colspan="4" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style></th>
    </tr>
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">name</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">alignment</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">gender</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">publisher</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_left">Magneto</td>
      <td class="gt_row gt_left">bad</td>
      <td class="gt_row gt_left">male</td>
      <td class="gt_row gt_left">Marvel</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Storm</td>
      <td class="gt_row gt_left gt_striped">good</td>
      <td class="gt_row gt_left gt_striped">female</td>
      <td class="gt_row gt_left gt_striped">Marvel</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">Mystique</td>
      <td class="gt_row gt_left">bad</td>
      <td class="gt_row gt_left">female</td>
      <td class="gt_row gt_left">Marvel</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Batman</td>
      <td class="gt_row gt_left gt_striped">good</td>
      <td class="gt_row gt_left gt_striped">male</td>
      <td class="gt_row gt_left gt_striped">DC</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">Joker</td>
      <td class="gt_row gt_left">bad</td>
      <td class="gt_row gt_left">male</td>
      <td class="gt_row gt_left">DC</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Catwoman</td>
      <td class="gt_row gt_left gt_striped">bad</td>
      <td class="gt_row gt_left gt_striped">female</td>
      <td class="gt_row gt_left gt_striped">DC</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">Hellboy</td>
      <td class="gt_row gt_left">good</td>
      <td class="gt_row gt_left">male</td>
      <td class="gt_row gt_left">Dark Horse Comics</td>
    </tr>
  </tbody>
  
  
</table></div>
</td>
<td style="width: 18%; vertical-align: top;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#jyufmgpfyq .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: 0;
  margin-right: auto;
  color: #333333;
  font-size: 80%;
  font-weight: normal;
  font-style: normal;
  background-color: #cce6f6;
  width: 100%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#jyufmgpfyq .gt_heading {
  background-color: #cce6f6;
  text-align: center;
  border-bottom-color: #cce6f6;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#jyufmgpfyq .gt_title {
  color: #333333;
  font-size: 90%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #cce6f6;
  border-bottom-width: 0;
}

#jyufmgpfyq .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #cce6f6;
  border-top-width: 0;
}

#jyufmgpfyq .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jyufmgpfyq .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#jyufmgpfyq .gt_col_heading {
  color: #333333;
  background-color: #cce6f6;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#jyufmgpfyq .gt_column_spanner_outer {
  color: #333333;
  background-color: #cce6f6;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#jyufmgpfyq .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#jyufmgpfyq .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#jyufmgpfyq .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#jyufmgpfyq .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #cce6f6;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#jyufmgpfyq .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #cce6f6;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#jyufmgpfyq .gt_from_md > :first-child {
  margin-top: 0;
}

#jyufmgpfyq .gt_from_md > :last-child {
  margin-bottom: 0;
}

#jyufmgpfyq .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#jyufmgpfyq .gt_stub {
  color: #333333;
  background-color: #cce6f6;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#jyufmgpfyq .gt_summary_row {
  color: #333333;
  background-color: #cce6f6;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#jyufmgpfyq .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#jyufmgpfyq .gt_grand_summary_row {
  color: #333333;
  background-color: #cce6f6;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#jyufmgpfyq .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#jyufmgpfyq .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#jyufmgpfyq .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jyufmgpfyq .gt_footnotes {
  color: #333333;
  background-color: #cce6f6;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#jyufmgpfyq .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#jyufmgpfyq .gt_sourcenotes {
  color: #333333;
  background-color: #cce6f6;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#jyufmgpfyq .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#jyufmgpfyq .gt_left {
  text-align: left;
}

#jyufmgpfyq .gt_center {
  text-align: center;
}

#jyufmgpfyq .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#jyufmgpfyq .gt_font_normal {
  font-weight: normal;
}

#jyufmgpfyq .gt_font_bold {
  font-weight: bold;
}

#jyufmgpfyq .gt_font_italic {
  font-style: italic;
}

#jyufmgpfyq .gt_super {
  font-size: 65%;
}

#jyufmgpfyq .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="jyufmgpfyq" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  <thead class="gt_header">
    <tr>
      <th colspan="2" class="gt_heading gt_title gt_font_normal" style>publishers</th>
    </tr>
    <tr>
      <th colspan="2" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style></th>
    </tr>
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">publisher</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">yr_founded</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_left">DC</td>
      <td class="gt_row gt_center">1934</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Marvel</td>
      <td class="gt_row gt_center gt_striped">1939</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">Image</td>
      <td class="gt_row gt_center">1992</td>
    </tr>
  </tbody>
  
  
</table></div>
</td>
<td style="width: 44%; vertical-align: top;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#efjcirylba .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: 0;
  margin-right: auto;
  color: #333333;
  font-size: 80%;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: 100%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#efjcirylba .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#efjcirylba .gt_title {
  color: #333333;
  font-size: 90%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#efjcirylba .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#efjcirylba .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#efjcirylba .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#efjcirylba .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#efjcirylba .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#efjcirylba .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#efjcirylba .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#efjcirylba .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#efjcirylba .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#efjcirylba .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#efjcirylba .gt_from_md > :first-child {
  margin-top: 0;
}

#efjcirylba .gt_from_md > :last-child {
  margin-bottom: 0;
}

#efjcirylba .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#efjcirylba .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#efjcirylba .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#efjcirylba .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#efjcirylba .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#efjcirylba .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#efjcirylba .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#efjcirylba .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#efjcirylba .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#efjcirylba .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#efjcirylba .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#efjcirylba .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#efjcirylba .gt_left {
  text-align: left;
}

#efjcirylba .gt_center {
  text-align: center;
}

#efjcirylba .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#efjcirylba .gt_font_normal {
  font-weight: normal;
}

#efjcirylba .gt_font_bold {
  font-weight: bold;
}

#efjcirylba .gt_font_italic {
  font-style: italic;
}

#efjcirylba .gt_super {
  font-size: 65%;
}

#efjcirylba .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="efjcirylba" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  <thead class="gt_header">
    <tr>
      <th colspan="4" class="gt_heading gt_title gt_font_normal" style>semi_join(x = superheroes, y = publishers)</th>
    </tr>
    <tr>
      <th colspan="4" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style></th>
    </tr>
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">name</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">alignment</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">gender</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">publisher</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_left">Magneto</td>
      <td class="gt_row gt_left">bad</td>
      <td class="gt_row gt_left">male</td>
      <td class="gt_row gt_left">Marvel</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Storm</td>
      <td class="gt_row gt_left gt_striped">good</td>
      <td class="gt_row gt_left gt_striped">female</td>
      <td class="gt_row gt_left gt_striped">Marvel</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">Mystique</td>
      <td class="gt_row gt_left">bad</td>
      <td class="gt_row gt_left">female</td>
      <td class="gt_row gt_left">Marvel</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Batman</td>
      <td class="gt_row gt_left gt_striped">good</td>
      <td class="gt_row gt_left gt_striped">male</td>
      <td class="gt_row gt_left gt_striped">DC</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">Joker</td>
      <td class="gt_row gt_left">bad</td>
      <td class="gt_row gt_left">male</td>
      <td class="gt_row gt_left">DC</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Catwoman</td>
      <td class="gt_row gt_left gt_striped">bad</td>
      <td class="gt_row gt_left gt_striped">female</td>
      <td class="gt_row gt_left gt_striped">DC</td>
    </tr>
  </tbody>
  
  
</table></div>
</td>
</tr>
</table>
</div>
<div id="left_joinsuperheroes-publishers" class="section level2">
<h2><span class="header-section-number">15.5</span> <code>left_join(superheroes, publishers)</code></h2>
<blockquote>
<p><code>left_join(x, y)</code>: Return all rows from <code>x</code>, and all columns from <code>x</code> and <code>y</code>. If there are multiple matches between <code>x</code> and <code>y</code>, all combination of the matches are returned. This is a mutating join.</p>
</blockquote>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1"></a>(ljsp &lt;-<span class="st"> </span><span class="kw">left_join</span>(superheroes, publishers))</span>
<span id="cb192-2"><a href="#cb192-2"></a><span class="co">#&gt; Joining, by = &quot;publisher&quot;</span></span>
<span id="cb192-3"><a href="#cb192-3"></a><span class="co">#&gt; # A tibble: 7 x 5</span></span>
<span id="cb192-4"><a href="#cb192-4"></a><span class="co">#&gt;   name     alignment gender publisher         yr_founded</span></span>
<span id="cb192-5"><a href="#cb192-5"></a><span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;  &lt;chr&gt;                  &lt;int&gt;</span></span>
<span id="cb192-6"><a href="#cb192-6"></a><span class="co">#&gt; 1 Magneto  bad       male   Marvel                  1939</span></span>
<span id="cb192-7"><a href="#cb192-7"></a><span class="co">#&gt; 2 Storm    good      female Marvel                  1939</span></span>
<span id="cb192-8"><a href="#cb192-8"></a><span class="co">#&gt; 3 Mystique bad       female Marvel                  1939</span></span>
<span id="cb192-9"><a href="#cb192-9"></a><span class="co">#&gt; 4 Batman   good      male   DC                      1934</span></span>
<span id="cb192-10"><a href="#cb192-10"></a><span class="co">#&gt; 5 Joker    bad       male   DC                      1934</span></span>
<span id="cb192-11"><a href="#cb192-11"></a><span class="co">#&gt; 6 Catwoman bad       female DC                      1934</span></span>
<span id="cb192-12"><a href="#cb192-12"></a><span class="co">#&gt; 7 Hellboy  good      male   Dark Horse Comics         NA</span></span></code></pre></div>
<p>We basically get <code>x = superheroes</code> back, but with the addition of variable <code>yr_founded</code>, which is unique to <code>y = publishers</code>. Hellboy, whose publisher does not appear in <code>y = publishers</code>, has an <code>NA</code> for <code>yr_founded</code>.</p>
<table style="width: 100%; border: 0px;">
<tr>
<td style="width: 38%; vertical-align: top;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#aisydhgztu .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: 0;
  margin-right: auto;
  color: #333333;
  font-size: 80%;
  font-weight: normal;
  font-style: normal;
  background-color: #edc7fc;
  width: 100%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#aisydhgztu .gt_heading {
  background-color: #edc7fc;
  text-align: center;
  border-bottom-color: #edc7fc;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#aisydhgztu .gt_title {
  color: #333333;
  font-size: 90%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #edc7fc;
  border-bottom-width: 0;
}

#aisydhgztu .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #edc7fc;
  border-top-width: 0;
}

#aisydhgztu .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#aisydhgztu .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#aisydhgztu .gt_col_heading {
  color: #333333;
  background-color: #edc7fc;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#aisydhgztu .gt_column_spanner_outer {
  color: #333333;
  background-color: #edc7fc;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#aisydhgztu .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#aisydhgztu .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#aisydhgztu .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#aisydhgztu .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #edc7fc;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#aisydhgztu .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #edc7fc;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#aisydhgztu .gt_from_md > :first-child {
  margin-top: 0;
}

#aisydhgztu .gt_from_md > :last-child {
  margin-bottom: 0;
}

#aisydhgztu .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#aisydhgztu .gt_stub {
  color: #333333;
  background-color: #edc7fc;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#aisydhgztu .gt_summary_row {
  color: #333333;
  background-color: #edc7fc;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#aisydhgztu .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#aisydhgztu .gt_grand_summary_row {
  color: #333333;
  background-color: #edc7fc;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#aisydhgztu .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#aisydhgztu .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#aisydhgztu .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#aisydhgztu .gt_footnotes {
  color: #333333;
  background-color: #edc7fc;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#aisydhgztu .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#aisydhgztu .gt_sourcenotes {
  color: #333333;
  background-color: #edc7fc;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#aisydhgztu .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#aisydhgztu .gt_left {
  text-align: left;
}

#aisydhgztu .gt_center {
  text-align: center;
}

#aisydhgztu .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#aisydhgztu .gt_font_normal {
  font-weight: normal;
}

#aisydhgztu .gt_font_bold {
  font-weight: bold;
}

#aisydhgztu .gt_font_italic {
  font-style: italic;
}

#aisydhgztu .gt_super {
  font-size: 65%;
}

#aisydhgztu .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="aisydhgztu" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  <thead class="gt_header">
    <tr>
      <th colspan="4" class="gt_heading gt_title gt_font_normal" style>superheroes</th>
    </tr>
    <tr>
      <th colspan="4" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style></th>
    </tr>
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">name</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">alignment</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">gender</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">publisher</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_left">Magneto</td>
      <td class="gt_row gt_left">bad</td>
      <td class="gt_row gt_left">male</td>
      <td class="gt_row gt_left">Marvel</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Storm</td>
      <td class="gt_row gt_left gt_striped">good</td>
      <td class="gt_row gt_left gt_striped">female</td>
      <td class="gt_row gt_left gt_striped">Marvel</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">Mystique</td>
      <td class="gt_row gt_left">bad</td>
      <td class="gt_row gt_left">female</td>
      <td class="gt_row gt_left">Marvel</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Batman</td>
      <td class="gt_row gt_left gt_striped">good</td>
      <td class="gt_row gt_left gt_striped">male</td>
      <td class="gt_row gt_left gt_striped">DC</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">Joker</td>
      <td class="gt_row gt_left">bad</td>
      <td class="gt_row gt_left">male</td>
      <td class="gt_row gt_left">DC</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Catwoman</td>
      <td class="gt_row gt_left gt_striped">bad</td>
      <td class="gt_row gt_left gt_striped">female</td>
      <td class="gt_row gt_left gt_striped">DC</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">Hellboy</td>
      <td class="gt_row gt_left">good</td>
      <td class="gt_row gt_left">male</td>
      <td class="gt_row gt_left">Dark Horse Comics</td>
    </tr>
  </tbody>
  
  
</table></div>
</td>
<td style="width: 18%; vertical-align: top;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#ayfwdidnqs .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: 0;
  margin-right: auto;
  color: #333333;
  font-size: 80%;
  font-weight: normal;
  font-style: normal;
  background-color: #cce6f6;
  width: 100%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ayfwdidnqs .gt_heading {
  background-color: #cce6f6;
  text-align: center;
  border-bottom-color: #cce6f6;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ayfwdidnqs .gt_title {
  color: #333333;
  font-size: 90%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #cce6f6;
  border-bottom-width: 0;
}

#ayfwdidnqs .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #cce6f6;
  border-top-width: 0;
}

#ayfwdidnqs .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ayfwdidnqs .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ayfwdidnqs .gt_col_heading {
  color: #333333;
  background-color: #cce6f6;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ayfwdidnqs .gt_column_spanner_outer {
  color: #333333;
  background-color: #cce6f6;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ayfwdidnqs .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ayfwdidnqs .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ayfwdidnqs .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ayfwdidnqs .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #cce6f6;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#ayfwdidnqs .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #cce6f6;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ayfwdidnqs .gt_from_md > :first-child {
  margin-top: 0;
}

#ayfwdidnqs .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ayfwdidnqs .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ayfwdidnqs .gt_stub {
  color: #333333;
  background-color: #cce6f6;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#ayfwdidnqs .gt_summary_row {
  color: #333333;
  background-color: #cce6f6;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ayfwdidnqs .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#ayfwdidnqs .gt_grand_summary_row {
  color: #333333;
  background-color: #cce6f6;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ayfwdidnqs .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ayfwdidnqs .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ayfwdidnqs .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ayfwdidnqs .gt_footnotes {
  color: #333333;
  background-color: #cce6f6;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ayfwdidnqs .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#ayfwdidnqs .gt_sourcenotes {
  color: #333333;
  background-color: #cce6f6;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ayfwdidnqs .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#ayfwdidnqs .gt_left {
  text-align: left;
}

#ayfwdidnqs .gt_center {
  text-align: center;
}

#ayfwdidnqs .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ayfwdidnqs .gt_font_normal {
  font-weight: normal;
}

#ayfwdidnqs .gt_font_bold {
  font-weight: bold;
}

#ayfwdidnqs .gt_font_italic {
  font-style: italic;
}

#ayfwdidnqs .gt_super {
  font-size: 65%;
}

#ayfwdidnqs .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="ayfwdidnqs" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  <thead class="gt_header">
    <tr>
      <th colspan="2" class="gt_heading gt_title gt_font_normal" style>publishers</th>
    </tr>
    <tr>
      <th colspan="2" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style></th>
    </tr>
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">publisher</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">yr_founded</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_left">DC</td>
      <td class="gt_row gt_center">1934</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Marvel</td>
      <td class="gt_row gt_center gt_striped">1939</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">Image</td>
      <td class="gt_row gt_center">1992</td>
    </tr>
  </tbody>
  
  
</table></div>
</td>
<td style="width: 44%; vertical-align: top;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#vdarlsoxvr .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: 0;
  margin-right: auto;
  color: #333333;
  font-size: 80%;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: 100%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#vdarlsoxvr .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vdarlsoxvr .gt_title {
  color: #333333;
  font-size: 90%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#vdarlsoxvr .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#vdarlsoxvr .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vdarlsoxvr .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vdarlsoxvr .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#vdarlsoxvr .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#vdarlsoxvr .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#vdarlsoxvr .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#vdarlsoxvr .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#vdarlsoxvr .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#vdarlsoxvr .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#vdarlsoxvr .gt_from_md > :first-child {
  margin-top: 0;
}

#vdarlsoxvr .gt_from_md > :last-child {
  margin-bottom: 0;
}

#vdarlsoxvr .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#vdarlsoxvr .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#vdarlsoxvr .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vdarlsoxvr .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#vdarlsoxvr .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vdarlsoxvr .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#vdarlsoxvr .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#vdarlsoxvr .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vdarlsoxvr .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vdarlsoxvr .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#vdarlsoxvr .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vdarlsoxvr .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#vdarlsoxvr .gt_left {
  text-align: left;
}

#vdarlsoxvr .gt_center {
  text-align: center;
}

#vdarlsoxvr .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#vdarlsoxvr .gt_font_normal {
  font-weight: normal;
}

#vdarlsoxvr .gt_font_bold {
  font-weight: bold;
}

#vdarlsoxvr .gt_font_italic {
  font-style: italic;
}

#vdarlsoxvr .gt_super {
  font-size: 65%;
}

#vdarlsoxvr .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="vdarlsoxvr" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  <thead class="gt_header">
    <tr>
      <th colspan="5" class="gt_heading gt_title gt_font_normal" style>left_join(x = superheroes, y = publishers)</th>
    </tr>
    <tr>
      <th colspan="5" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style></th>
    </tr>
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">name</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">alignment</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">gender</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">publisher</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">yr_founded</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_left">Magneto</td>
      <td class="gt_row gt_left">bad</td>
      <td class="gt_row gt_left">male</td>
      <td class="gt_row gt_left">Marvel</td>
      <td class="gt_row gt_center">1939</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Storm</td>
      <td class="gt_row gt_left gt_striped">good</td>
      <td class="gt_row gt_left gt_striped">female</td>
      <td class="gt_row gt_left gt_striped">Marvel</td>
      <td class="gt_row gt_center gt_striped">1939</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">Mystique</td>
      <td class="gt_row gt_left">bad</td>
      <td class="gt_row gt_left">female</td>
      <td class="gt_row gt_left">Marvel</td>
      <td class="gt_row gt_center">1939</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Batman</td>
      <td class="gt_row gt_left gt_striped">good</td>
      <td class="gt_row gt_left gt_striped">male</td>
      <td class="gt_row gt_left gt_striped">DC</td>
      <td class="gt_row gt_center gt_striped">1934</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">Joker</td>
      <td class="gt_row gt_left">bad</td>
      <td class="gt_row gt_left">male</td>
      <td class="gt_row gt_left">DC</td>
      <td class="gt_row gt_center">1934</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Catwoman</td>
      <td class="gt_row gt_left gt_striped">bad</td>
      <td class="gt_row gt_left gt_striped">female</td>
      <td class="gt_row gt_left gt_striped">DC</td>
      <td class="gt_row gt_center gt_striped">1934</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">Hellboy</td>
      <td class="gt_row gt_left">good</td>
      <td class="gt_row gt_left">male</td>
      <td class="gt_row gt_left">Dark Horse Comics</td>
      <td class="gt_row gt_center">NA</td>
    </tr>
  </tbody>
  
  
</table></div>
</td>
</tr>
</table>
</div>
<div id="anti_joinsuperheroes-publishers" class="section level2">
<h2><span class="header-section-number">15.6</span> <code>anti_join(superheroes, publishers)</code></h2>
<blockquote>
<p><code>anti_join(x, y)</code>: Return all rows from <code>x</code> where there are not matching values in <code>y</code>, keeping just columns from <code>x</code>. This is a filtering join.</p>
</blockquote>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1"></a>(ajsp &lt;-<span class="st"> </span><span class="kw">anti_join</span>(superheroes, publishers))</span>
<span id="cb193-2"><a href="#cb193-2"></a><span class="co">#&gt; Joining, by = &quot;publisher&quot;</span></span>
<span id="cb193-3"><a href="#cb193-3"></a><span class="co">#&gt; # A tibble: 1 x 4</span></span>
<span id="cb193-4"><a href="#cb193-4"></a><span class="co">#&gt;   name    alignment gender publisher        </span></span>
<span id="cb193-5"><a href="#cb193-5"></a><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;  &lt;chr&gt;            </span></span>
<span id="cb193-6"><a href="#cb193-6"></a><span class="co">#&gt; 1 Hellboy good      male   Dark Horse Comics</span></span></code></pre></div>
<p>We keep <strong>only</strong> Hellboy now (and do not get <code>yr_founded</code>).</p>
<table style="width: 100%; border: 0px;">
<tr>
<td style="width: 38%; vertical-align: top;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#phvygoevxm .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: 0;
  margin-right: auto;
  color: #333333;
  font-size: 80%;
  font-weight: normal;
  font-style: normal;
  background-color: #edc7fc;
  width: 100%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#phvygoevxm .gt_heading {
  background-color: #edc7fc;
  text-align: center;
  border-bottom-color: #edc7fc;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#phvygoevxm .gt_title {
  color: #333333;
  font-size: 90%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #edc7fc;
  border-bottom-width: 0;
}

#phvygoevxm .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #edc7fc;
  border-top-width: 0;
}

#phvygoevxm .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#phvygoevxm .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#phvygoevxm .gt_col_heading {
  color: #333333;
  background-color: #edc7fc;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#phvygoevxm .gt_column_spanner_outer {
  color: #333333;
  background-color: #edc7fc;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#phvygoevxm .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#phvygoevxm .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#phvygoevxm .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#phvygoevxm .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #edc7fc;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#phvygoevxm .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #edc7fc;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#phvygoevxm .gt_from_md > :first-child {
  margin-top: 0;
}

#phvygoevxm .gt_from_md > :last-child {
  margin-bottom: 0;
}

#phvygoevxm .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#phvygoevxm .gt_stub {
  color: #333333;
  background-color: #edc7fc;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#phvygoevxm .gt_summary_row {
  color: #333333;
  background-color: #edc7fc;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#phvygoevxm .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#phvygoevxm .gt_grand_summary_row {
  color: #333333;
  background-color: #edc7fc;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#phvygoevxm .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#phvygoevxm .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#phvygoevxm .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#phvygoevxm .gt_footnotes {
  color: #333333;
  background-color: #edc7fc;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#phvygoevxm .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#phvygoevxm .gt_sourcenotes {
  color: #333333;
  background-color: #edc7fc;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#phvygoevxm .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#phvygoevxm .gt_left {
  text-align: left;
}

#phvygoevxm .gt_center {
  text-align: center;
}

#phvygoevxm .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#phvygoevxm .gt_font_normal {
  font-weight: normal;
}

#phvygoevxm .gt_font_bold {
  font-weight: bold;
}

#phvygoevxm .gt_font_italic {
  font-style: italic;
}

#phvygoevxm .gt_super {
  font-size: 65%;
}

#phvygoevxm .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="phvygoevxm" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  <thead class="gt_header">
    <tr>
      <th colspan="4" class="gt_heading gt_title gt_font_normal" style>superheroes</th>
    </tr>
    <tr>
      <th colspan="4" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style></th>
    </tr>
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">name</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">alignment</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">gender</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">publisher</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_left">Magneto</td>
      <td class="gt_row gt_left">bad</td>
      <td class="gt_row gt_left">male</td>
      <td class="gt_row gt_left">Marvel</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Storm</td>
      <td class="gt_row gt_left gt_striped">good</td>
      <td class="gt_row gt_left gt_striped">female</td>
      <td class="gt_row gt_left gt_striped">Marvel</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">Mystique</td>
      <td class="gt_row gt_left">bad</td>
      <td class="gt_row gt_left">female</td>
      <td class="gt_row gt_left">Marvel</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Batman</td>
      <td class="gt_row gt_left gt_striped">good</td>
      <td class="gt_row gt_left gt_striped">male</td>
      <td class="gt_row gt_left gt_striped">DC</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">Joker</td>
      <td class="gt_row gt_left">bad</td>
      <td class="gt_row gt_left">male</td>
      <td class="gt_row gt_left">DC</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Catwoman</td>
      <td class="gt_row gt_left gt_striped">bad</td>
      <td class="gt_row gt_left gt_striped">female</td>
      <td class="gt_row gt_left gt_striped">DC</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">Hellboy</td>
      <td class="gt_row gt_left">good</td>
      <td class="gt_row gt_left">male</td>
      <td class="gt_row gt_left">Dark Horse Comics</td>
    </tr>
  </tbody>
  
  
</table></div>
</td>
<td style="width: 18%; vertical-align: top;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#iaseghhssg .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: 0;
  margin-right: auto;
  color: #333333;
  font-size: 80%;
  font-weight: normal;
  font-style: normal;
  background-color: #cce6f6;
  width: 100%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#iaseghhssg .gt_heading {
  background-color: #cce6f6;
  text-align: center;
  border-bottom-color: #cce6f6;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#iaseghhssg .gt_title {
  color: #333333;
  font-size: 90%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #cce6f6;
  border-bottom-width: 0;
}

#iaseghhssg .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #cce6f6;
  border-top-width: 0;
}

#iaseghhssg .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#iaseghhssg .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#iaseghhssg .gt_col_heading {
  color: #333333;
  background-color: #cce6f6;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#iaseghhssg .gt_column_spanner_outer {
  color: #333333;
  background-color: #cce6f6;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#iaseghhssg .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#iaseghhssg .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#iaseghhssg .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#iaseghhssg .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #cce6f6;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#iaseghhssg .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #cce6f6;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#iaseghhssg .gt_from_md > :first-child {
  margin-top: 0;
}

#iaseghhssg .gt_from_md > :last-child {
  margin-bottom: 0;
}

#iaseghhssg .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#iaseghhssg .gt_stub {
  color: #333333;
  background-color: #cce6f6;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#iaseghhssg .gt_summary_row {
  color: #333333;
  background-color: #cce6f6;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#iaseghhssg .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#iaseghhssg .gt_grand_summary_row {
  color: #333333;
  background-color: #cce6f6;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#iaseghhssg .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#iaseghhssg .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#iaseghhssg .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#iaseghhssg .gt_footnotes {
  color: #333333;
  background-color: #cce6f6;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#iaseghhssg .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#iaseghhssg .gt_sourcenotes {
  color: #333333;
  background-color: #cce6f6;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#iaseghhssg .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#iaseghhssg .gt_left {
  text-align: left;
}

#iaseghhssg .gt_center {
  text-align: center;
}

#iaseghhssg .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#iaseghhssg .gt_font_normal {
  font-weight: normal;
}

#iaseghhssg .gt_font_bold {
  font-weight: bold;
}

#iaseghhssg .gt_font_italic {
  font-style: italic;
}

#iaseghhssg .gt_super {
  font-size: 65%;
}

#iaseghhssg .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="iaseghhssg" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  <thead class="gt_header">
    <tr>
      <th colspan="2" class="gt_heading gt_title gt_font_normal" style>publishers</th>
    </tr>
    <tr>
      <th colspan="2" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style></th>
    </tr>
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">publisher</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">yr_founded</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_left">DC</td>
      <td class="gt_row gt_center">1934</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Marvel</td>
      <td class="gt_row gt_center gt_striped">1939</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">Image</td>
      <td class="gt_row gt_center">1992</td>
    </tr>
  </tbody>
  
  
</table></div>
</td>
<td style="width: 44%; vertical-align: top;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#jzhbsfdypr .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: 0;
  margin-right: auto;
  color: #333333;
  font-size: 80%;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: 100%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#jzhbsfdypr .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#jzhbsfdypr .gt_title {
  color: #333333;
  font-size: 90%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#jzhbsfdypr .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#jzhbsfdypr .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jzhbsfdypr .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#jzhbsfdypr .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#jzhbsfdypr .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#jzhbsfdypr .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#jzhbsfdypr .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#jzhbsfdypr .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#jzhbsfdypr .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#jzhbsfdypr .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#jzhbsfdypr .gt_from_md > :first-child {
  margin-top: 0;
}

#jzhbsfdypr .gt_from_md > :last-child {
  margin-bottom: 0;
}

#jzhbsfdypr .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#jzhbsfdypr .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#jzhbsfdypr .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#jzhbsfdypr .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#jzhbsfdypr .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#jzhbsfdypr .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#jzhbsfdypr .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#jzhbsfdypr .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jzhbsfdypr .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#jzhbsfdypr .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#jzhbsfdypr .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#jzhbsfdypr .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#jzhbsfdypr .gt_left {
  text-align: left;
}

#jzhbsfdypr .gt_center {
  text-align: center;
}

#jzhbsfdypr .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#jzhbsfdypr .gt_font_normal {
  font-weight: normal;
}

#jzhbsfdypr .gt_font_bold {
  font-weight: bold;
}

#jzhbsfdypr .gt_font_italic {
  font-style: italic;
}

#jzhbsfdypr .gt_super {
  font-size: 65%;
}

#jzhbsfdypr .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="jzhbsfdypr" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  <thead class="gt_header">
    <tr>
      <th colspan="4" class="gt_heading gt_title gt_font_normal" style>anti_join(x = superheroes, y = publishers)</th>
    </tr>
    <tr>
      <th colspan="4" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style></th>
    </tr>
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">name</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">alignment</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">gender</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">publisher</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_left">Hellboy</td>
      <td class="gt_row gt_left">good</td>
      <td class="gt_row gt_left">male</td>
      <td class="gt_row gt_left">Dark Horse Comics</td>
    </tr>
  </tbody>
  
  
</table></div>
</td>
</tr>
</table>
</div>
<div id="inner_joinpublishers-superheroes" class="section level2">
<h2><span class="header-section-number">15.7</span> <code>inner_join(publishers, superheroes)</code></h2>
<blockquote>
<p><code>inner_join(x, y)</code>: Return all rows from <code>x</code> where there are matching values in <code>y</code>, and all columns from <code>x</code> and <code>y</code>. If there are multiple matches between <code>x</code> and <code>y</code>, all combination of the matches are returned. This is a mutating join.</p>
</blockquote>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1"></a>(ijps &lt;-<span class="st"> </span><span class="kw">inner_join</span>(publishers, superheroes))</span>
<span id="cb194-2"><a href="#cb194-2"></a><span class="co">#&gt; Joining, by = &quot;publisher&quot;</span></span>
<span id="cb194-3"><a href="#cb194-3"></a><span class="co">#&gt; # A tibble: 6 x 5</span></span>
<span id="cb194-4"><a href="#cb194-4"></a><span class="co">#&gt;   publisher yr_founded name     alignment gender</span></span>
<span id="cb194-5"><a href="#cb194-5"></a><span class="co">#&gt;   &lt;chr&gt;          &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt; </span></span>
<span id="cb194-6"><a href="#cb194-6"></a><span class="co">#&gt; 1 DC              1934 Batman   good      male  </span></span>
<span id="cb194-7"><a href="#cb194-7"></a><span class="co">#&gt; 2 DC              1934 Joker    bad       male  </span></span>
<span id="cb194-8"><a href="#cb194-8"></a><span class="co">#&gt; 3 DC              1934 Catwoman bad       female</span></span>
<span id="cb194-9"><a href="#cb194-9"></a><span class="co">#&gt; 4 Marvel          1939 Magneto  bad       male  </span></span>
<span id="cb194-10"><a href="#cb194-10"></a><span class="co">#&gt; 5 Marvel          1939 Storm    good      female</span></span>
<span id="cb194-11"><a href="#cb194-11"></a><span class="co">#&gt; 6 Marvel          1939 Mystique bad       female</span></span></code></pre></div>
<p>In a way, this does illustrate multiple matches, if you think about it from the <code>x = publishers</code> direction. Every publisher that has a match in <code>y = superheroes</code> appears multiple times in the result, once for each match. In fact, we’re getting the same result as with <code>inner_join(superheroes, publishers)</code>, up to variable order (which you should also never rely on in an analysis).</p>
<table style="width: 100%; border: 0px;">
<tr>
<td style="width: 18%; vertical-align: top;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#osljeqtbcs .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: 0;
  margin-right: auto;
  color: #333333;
  font-size: 80%;
  font-weight: normal;
  font-style: normal;
  background-color: #cce6f6;
  width: 100%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#osljeqtbcs .gt_heading {
  background-color: #cce6f6;
  text-align: center;
  border-bottom-color: #cce6f6;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#osljeqtbcs .gt_title {
  color: #333333;
  font-size: 90%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #cce6f6;
  border-bottom-width: 0;
}

#osljeqtbcs .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #cce6f6;
  border-top-width: 0;
}

#osljeqtbcs .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#osljeqtbcs .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#osljeqtbcs .gt_col_heading {
  color: #333333;
  background-color: #cce6f6;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#osljeqtbcs .gt_column_spanner_outer {
  color: #333333;
  background-color: #cce6f6;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#osljeqtbcs .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#osljeqtbcs .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#osljeqtbcs .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#osljeqtbcs .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #cce6f6;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#osljeqtbcs .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #cce6f6;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#osljeqtbcs .gt_from_md > :first-child {
  margin-top: 0;
}

#osljeqtbcs .gt_from_md > :last-child {
  margin-bottom: 0;
}

#osljeqtbcs .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#osljeqtbcs .gt_stub {
  color: #333333;
  background-color: #cce6f6;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#osljeqtbcs .gt_summary_row {
  color: #333333;
  background-color: #cce6f6;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#osljeqtbcs .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#osljeqtbcs .gt_grand_summary_row {
  color: #333333;
  background-color: #cce6f6;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#osljeqtbcs .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#osljeqtbcs .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#osljeqtbcs .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#osljeqtbcs .gt_footnotes {
  color: #333333;
  background-color: #cce6f6;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#osljeqtbcs .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#osljeqtbcs .gt_sourcenotes {
  color: #333333;
  background-color: #cce6f6;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#osljeqtbcs .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#osljeqtbcs .gt_left {
  text-align: left;
}

#osljeqtbcs .gt_center {
  text-align: center;
}

#osljeqtbcs .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#osljeqtbcs .gt_font_normal {
  font-weight: normal;
}

#osljeqtbcs .gt_font_bold {
  font-weight: bold;
}

#osljeqtbcs .gt_font_italic {
  font-style: italic;
}

#osljeqtbcs .gt_super {
  font-size: 65%;
}

#osljeqtbcs .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="osljeqtbcs" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  <thead class="gt_header">
    <tr>
      <th colspan="2" class="gt_heading gt_title gt_font_normal" style>publishers</th>
    </tr>
    <tr>
      <th colspan="2" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style></th>
    </tr>
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">publisher</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">yr_founded</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_left">DC</td>
      <td class="gt_row gt_center">1934</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Marvel</td>
      <td class="gt_row gt_center gt_striped">1939</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">Image</td>
      <td class="gt_row gt_center">1992</td>
    </tr>
  </tbody>
  
  
</table></div>
</td>
<td style="width: 38%; vertical-align: top;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#akwdocvnav .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: 0;
  margin-right: auto;
  color: #333333;
  font-size: 80%;
  font-weight: normal;
  font-style: normal;
  background-color: #edc7fc;
  width: 100%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#akwdocvnav .gt_heading {
  background-color: #edc7fc;
  text-align: center;
  border-bottom-color: #edc7fc;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#akwdocvnav .gt_title {
  color: #333333;
  font-size: 90%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #edc7fc;
  border-bottom-width: 0;
}

#akwdocvnav .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #edc7fc;
  border-top-width: 0;
}

#akwdocvnav .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#akwdocvnav .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#akwdocvnav .gt_col_heading {
  color: #333333;
  background-color: #edc7fc;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#akwdocvnav .gt_column_spanner_outer {
  color: #333333;
  background-color: #edc7fc;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#akwdocvnav .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#akwdocvnav .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#akwdocvnav .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#akwdocvnav .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #edc7fc;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#akwdocvnav .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #edc7fc;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#akwdocvnav .gt_from_md > :first-child {
  margin-top: 0;
}

#akwdocvnav .gt_from_md > :last-child {
  margin-bottom: 0;
}

#akwdocvnav .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#akwdocvnav .gt_stub {
  color: #333333;
  background-color: #edc7fc;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#akwdocvnav .gt_summary_row {
  color: #333333;
  background-color: #edc7fc;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#akwdocvnav .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#akwdocvnav .gt_grand_summary_row {
  color: #333333;
  background-color: #edc7fc;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#akwdocvnav .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#akwdocvnav .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#akwdocvnav .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#akwdocvnav .gt_footnotes {
  color: #333333;
  background-color: #edc7fc;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#akwdocvnav .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#akwdocvnav .gt_sourcenotes {
  color: #333333;
  background-color: #edc7fc;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#akwdocvnav .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#akwdocvnav .gt_left {
  text-align: left;
}

#akwdocvnav .gt_center {
  text-align: center;
}

#akwdocvnav .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#akwdocvnav .gt_font_normal {
  font-weight: normal;
}

#akwdocvnav .gt_font_bold {
  font-weight: bold;
}

#akwdocvnav .gt_font_italic {
  font-style: italic;
}

#akwdocvnav .gt_super {
  font-size: 65%;
}

#akwdocvnav .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="akwdocvnav" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  <thead class="gt_header">
    <tr>
      <th colspan="4" class="gt_heading gt_title gt_font_normal" style>superheroes</th>
    </tr>
    <tr>
      <th colspan="4" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style></th>
    </tr>
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">name</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">alignment</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">gender</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">publisher</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_left">Magneto</td>
      <td class="gt_row gt_left">bad</td>
      <td class="gt_row gt_left">male</td>
      <td class="gt_row gt_left">Marvel</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Storm</td>
      <td class="gt_row gt_left gt_striped">good</td>
      <td class="gt_row gt_left gt_striped">female</td>
      <td class="gt_row gt_left gt_striped">Marvel</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">Mystique</td>
      <td class="gt_row gt_left">bad</td>
      <td class="gt_row gt_left">female</td>
      <td class="gt_row gt_left">Marvel</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Batman</td>
      <td class="gt_row gt_left gt_striped">good</td>
      <td class="gt_row gt_left gt_striped">male</td>
      <td class="gt_row gt_left gt_striped">DC</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">Joker</td>
      <td class="gt_row gt_left">bad</td>
      <td class="gt_row gt_left">male</td>
      <td class="gt_row gt_left">DC</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Catwoman</td>
      <td class="gt_row gt_left gt_striped">bad</td>
      <td class="gt_row gt_left gt_striped">female</td>
      <td class="gt_row gt_left gt_striped">DC</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">Hellboy</td>
      <td class="gt_row gt_left">good</td>
      <td class="gt_row gt_left">male</td>
      <td class="gt_row gt_left">Dark Horse Comics</td>
    </tr>
  </tbody>
  
  
</table></div>
</td>
<td style="width: 44%; vertical-align: top;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#sllvofzqhy .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: 0;
  margin-right: auto;
  color: #333333;
  font-size: 80%;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: 100%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#sllvofzqhy .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#sllvofzqhy .gt_title {
  color: #333333;
  font-size: 90%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#sllvofzqhy .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#sllvofzqhy .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#sllvofzqhy .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#sllvofzqhy .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#sllvofzqhy .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#sllvofzqhy .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#sllvofzqhy .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#sllvofzqhy .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#sllvofzqhy .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#sllvofzqhy .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#sllvofzqhy .gt_from_md > :first-child {
  margin-top: 0;
}

#sllvofzqhy .gt_from_md > :last-child {
  margin-bottom: 0;
}

#sllvofzqhy .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#sllvofzqhy .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#sllvofzqhy .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#sllvofzqhy .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#sllvofzqhy .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#sllvofzqhy .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#sllvofzqhy .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#sllvofzqhy .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#sllvofzqhy .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#sllvofzqhy .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#sllvofzqhy .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#sllvofzqhy .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#sllvofzqhy .gt_left {
  text-align: left;
}

#sllvofzqhy .gt_center {
  text-align: center;
}

#sllvofzqhy .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#sllvofzqhy .gt_font_normal {
  font-weight: normal;
}

#sllvofzqhy .gt_font_bold {
  font-weight: bold;
}

#sllvofzqhy .gt_font_italic {
  font-style: italic;
}

#sllvofzqhy .gt_super {
  font-size: 65%;
}

#sllvofzqhy .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="sllvofzqhy" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  <thead class="gt_header">
    <tr>
      <th colspan="5" class="gt_heading gt_title gt_font_normal" style>inner_join(x = publishers, y = superheroes)</th>
    </tr>
    <tr>
      <th colspan="5" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style></th>
    </tr>
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">publisher</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">yr_founded</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">name</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">alignment</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">gender</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_left">DC</td>
      <td class="gt_row gt_center">1934</td>
      <td class="gt_row gt_left">Batman</td>
      <td class="gt_row gt_left">good</td>
      <td class="gt_row gt_left">male</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">DC</td>
      <td class="gt_row gt_center gt_striped">1934</td>
      <td class="gt_row gt_left gt_striped">Joker</td>
      <td class="gt_row gt_left gt_striped">bad</td>
      <td class="gt_row gt_left gt_striped">male</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">DC</td>
      <td class="gt_row gt_center">1934</td>
      <td class="gt_row gt_left">Catwoman</td>
      <td class="gt_row gt_left">bad</td>
      <td class="gt_row gt_left">female</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Marvel</td>
      <td class="gt_row gt_center gt_striped">1939</td>
      <td class="gt_row gt_left gt_striped">Magneto</td>
      <td class="gt_row gt_left gt_striped">bad</td>
      <td class="gt_row gt_left gt_striped">male</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">Marvel</td>
      <td class="gt_row gt_center">1939</td>
      <td class="gt_row gt_left">Storm</td>
      <td class="gt_row gt_left">good</td>
      <td class="gt_row gt_left">female</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Marvel</td>
      <td class="gt_row gt_center gt_striped">1939</td>
      <td class="gt_row gt_left gt_striped">Mystique</td>
      <td class="gt_row gt_left gt_striped">bad</td>
      <td class="gt_row gt_left gt_striped">female</td>
    </tr>
  </tbody>
  
  
</table></div>
</td>
</tr>
</table>
</div>
<div id="semi_joinpublishers-superheroes" class="section level2">
<h2><span class="header-section-number">15.8</span> <code>semi_join(publishers, superheroes)</code></h2>
<blockquote>
<p><code>semi_join(x, y)</code>: Return all rows from <code>x</code> where there are matching values in <code>y</code>, keeping just columns from <code>x</code>. A semi join differs from an inner join because an inner join will return one row of <code>x</code> for each matching row of <code>y</code>, where a semi join will never duplicate rows of <code>x</code>. This is a filtering join.</p>
</blockquote>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1"></a>(sjps &lt;-<span class="st"> </span><span class="kw">semi_join</span>(<span class="dt">x =</span> publishers, <span class="dt">y =</span> superheroes))</span>
<span id="cb195-2"><a href="#cb195-2"></a><span class="co">#&gt; Joining, by = &quot;publisher&quot;</span></span>
<span id="cb195-3"><a href="#cb195-3"></a><span class="co">#&gt; # A tibble: 2 x 2</span></span>
<span id="cb195-4"><a href="#cb195-4"></a><span class="co">#&gt;   publisher yr_founded</span></span>
<span id="cb195-5"><a href="#cb195-5"></a><span class="co">#&gt;   &lt;chr&gt;          &lt;int&gt;</span></span>
<span id="cb195-6"><a href="#cb195-6"></a><span class="co">#&gt; 1 DC              1934</span></span>
<span id="cb195-7"><a href="#cb195-7"></a><span class="co">#&gt; 2 Marvel          1939</span></span></code></pre></div>
<p>Now the effects of switching the <code>x</code> and <code>y</code> roles is more clear. The result resembles <code>x = publishers</code>, but the publisher Image is lost, because there are no observations where <code>publisher == "Image"</code> in <code>y = superheroes</code>.</p>
<table style="width: 100%; border: 0px;">
<tr>
<td style="width: 18%; vertical-align: top;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#ibusglglwy .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: 0;
  margin-right: auto;
  color: #333333;
  font-size: 80%;
  font-weight: normal;
  font-style: normal;
  background-color: #cce6f6;
  width: 100%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ibusglglwy .gt_heading {
  background-color: #cce6f6;
  text-align: center;
  border-bottom-color: #cce6f6;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ibusglglwy .gt_title {
  color: #333333;
  font-size: 90%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #cce6f6;
  border-bottom-width: 0;
}

#ibusglglwy .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #cce6f6;
  border-top-width: 0;
}

#ibusglglwy .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ibusglglwy .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ibusglglwy .gt_col_heading {
  color: #333333;
  background-color: #cce6f6;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ibusglglwy .gt_column_spanner_outer {
  color: #333333;
  background-color: #cce6f6;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ibusglglwy .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ibusglglwy .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ibusglglwy .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ibusglglwy .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #cce6f6;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#ibusglglwy .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #cce6f6;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ibusglglwy .gt_from_md > :first-child {
  margin-top: 0;
}

#ibusglglwy .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ibusglglwy .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ibusglglwy .gt_stub {
  color: #333333;
  background-color: #cce6f6;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#ibusglglwy .gt_summary_row {
  color: #333333;
  background-color: #cce6f6;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ibusglglwy .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#ibusglglwy .gt_grand_summary_row {
  color: #333333;
  background-color: #cce6f6;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ibusglglwy .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ibusglglwy .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ibusglglwy .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ibusglglwy .gt_footnotes {
  color: #333333;
  background-color: #cce6f6;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ibusglglwy .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#ibusglglwy .gt_sourcenotes {
  color: #333333;
  background-color: #cce6f6;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ibusglglwy .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#ibusglglwy .gt_left {
  text-align: left;
}

#ibusglglwy .gt_center {
  text-align: center;
}

#ibusglglwy .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ibusglglwy .gt_font_normal {
  font-weight: normal;
}

#ibusglglwy .gt_font_bold {
  font-weight: bold;
}

#ibusglglwy .gt_font_italic {
  font-style: italic;
}

#ibusglglwy .gt_super {
  font-size: 65%;
}

#ibusglglwy .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="ibusglglwy" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  <thead class="gt_header">
    <tr>
      <th colspan="2" class="gt_heading gt_title gt_font_normal" style>publishers</th>
    </tr>
    <tr>
      <th colspan="2" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style></th>
    </tr>
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">publisher</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">yr_founded</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_left">DC</td>
      <td class="gt_row gt_center">1934</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Marvel</td>
      <td class="gt_row gt_center gt_striped">1939</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">Image</td>
      <td class="gt_row gt_center">1992</td>
    </tr>
  </tbody>
  
  
</table></div>
</td>
<td style="width: 38%; vertical-align: top;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#vphjkprnay .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: 0;
  margin-right: auto;
  color: #333333;
  font-size: 80%;
  font-weight: normal;
  font-style: normal;
  background-color: #edc7fc;
  width: 100%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#vphjkprnay .gt_heading {
  background-color: #edc7fc;
  text-align: center;
  border-bottom-color: #edc7fc;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vphjkprnay .gt_title {
  color: #333333;
  font-size: 90%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #edc7fc;
  border-bottom-width: 0;
}

#vphjkprnay .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #edc7fc;
  border-top-width: 0;
}

#vphjkprnay .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vphjkprnay .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vphjkprnay .gt_col_heading {
  color: #333333;
  background-color: #edc7fc;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#vphjkprnay .gt_column_spanner_outer {
  color: #333333;
  background-color: #edc7fc;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#vphjkprnay .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#vphjkprnay .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#vphjkprnay .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#vphjkprnay .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #edc7fc;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#vphjkprnay .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #edc7fc;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#vphjkprnay .gt_from_md > :first-child {
  margin-top: 0;
}

#vphjkprnay .gt_from_md > :last-child {
  margin-bottom: 0;
}

#vphjkprnay .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#vphjkprnay .gt_stub {
  color: #333333;
  background-color: #edc7fc;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#vphjkprnay .gt_summary_row {
  color: #333333;
  background-color: #edc7fc;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vphjkprnay .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#vphjkprnay .gt_grand_summary_row {
  color: #333333;
  background-color: #edc7fc;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vphjkprnay .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#vphjkprnay .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#vphjkprnay .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vphjkprnay .gt_footnotes {
  color: #333333;
  background-color: #edc7fc;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vphjkprnay .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#vphjkprnay .gt_sourcenotes {
  color: #333333;
  background-color: #edc7fc;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vphjkprnay .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#vphjkprnay .gt_left {
  text-align: left;
}

#vphjkprnay .gt_center {
  text-align: center;
}

#vphjkprnay .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#vphjkprnay .gt_font_normal {
  font-weight: normal;
}

#vphjkprnay .gt_font_bold {
  font-weight: bold;
}

#vphjkprnay .gt_font_italic {
  font-style: italic;
}

#vphjkprnay .gt_super {
  font-size: 65%;
}

#vphjkprnay .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="vphjkprnay" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  <thead class="gt_header">
    <tr>
      <th colspan="4" class="gt_heading gt_title gt_font_normal" style>superheroes</th>
    </tr>
    <tr>
      <th colspan="4" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style></th>
    </tr>
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">name</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">alignment</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">gender</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">publisher</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_left">Magneto</td>
      <td class="gt_row gt_left">bad</td>
      <td class="gt_row gt_left">male</td>
      <td class="gt_row gt_left">Marvel</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Storm</td>
      <td class="gt_row gt_left gt_striped">good</td>
      <td class="gt_row gt_left gt_striped">female</td>
      <td class="gt_row gt_left gt_striped">Marvel</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">Mystique</td>
      <td class="gt_row gt_left">bad</td>
      <td class="gt_row gt_left">female</td>
      <td class="gt_row gt_left">Marvel</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Batman</td>
      <td class="gt_row gt_left gt_striped">good</td>
      <td class="gt_row gt_left gt_striped">male</td>
      <td class="gt_row gt_left gt_striped">DC</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">Joker</td>
      <td class="gt_row gt_left">bad</td>
      <td class="gt_row gt_left">male</td>
      <td class="gt_row gt_left">DC</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Catwoman</td>
      <td class="gt_row gt_left gt_striped">bad</td>
      <td class="gt_row gt_left gt_striped">female</td>
      <td class="gt_row gt_left gt_striped">DC</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">Hellboy</td>
      <td class="gt_row gt_left">good</td>
      <td class="gt_row gt_left">male</td>
      <td class="gt_row gt_left">Dark Horse Comics</td>
    </tr>
  </tbody>
  
  
</table></div>
</td>
<td style="width: 44%; vertical-align: top;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#qkxmsdlfki .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: 0;
  margin-right: auto;
  color: #333333;
  font-size: 80%;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: 100%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#qkxmsdlfki .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qkxmsdlfki .gt_title {
  color: #333333;
  font-size: 90%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#qkxmsdlfki .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#qkxmsdlfki .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qkxmsdlfki .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qkxmsdlfki .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#qkxmsdlfki .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#qkxmsdlfki .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#qkxmsdlfki .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#qkxmsdlfki .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#qkxmsdlfki .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#qkxmsdlfki .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#qkxmsdlfki .gt_from_md > :first-child {
  margin-top: 0;
}

#qkxmsdlfki .gt_from_md > :last-child {
  margin-bottom: 0;
}

#qkxmsdlfki .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#qkxmsdlfki .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#qkxmsdlfki .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qkxmsdlfki .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#qkxmsdlfki .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qkxmsdlfki .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#qkxmsdlfki .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#qkxmsdlfki .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qkxmsdlfki .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qkxmsdlfki .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#qkxmsdlfki .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qkxmsdlfki .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#qkxmsdlfki .gt_left {
  text-align: left;
}

#qkxmsdlfki .gt_center {
  text-align: center;
}

#qkxmsdlfki .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#qkxmsdlfki .gt_font_normal {
  font-weight: normal;
}

#qkxmsdlfki .gt_font_bold {
  font-weight: bold;
}

#qkxmsdlfki .gt_font_italic {
  font-style: italic;
}

#qkxmsdlfki .gt_super {
  font-size: 65%;
}

#qkxmsdlfki .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="qkxmsdlfki" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  <thead class="gt_header">
    <tr>
      <th colspan="2" class="gt_heading gt_title gt_font_normal" style>semi_join(x = publishers, y = superheroes)</th>
    </tr>
    <tr>
      <th colspan="2" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style></th>
    </tr>
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">publisher</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">yr_founded</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_left">DC</td>
      <td class="gt_row gt_center">1934</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Marvel</td>
      <td class="gt_row gt_center gt_striped">1939</td>
    </tr>
  </tbody>
  
  
</table></div>
</td>
</tr>
</table>
</div>
<div id="left_joinpublishers-superheroes" class="section level2">
<h2><span class="header-section-number">15.9</span> <code>left_join(publishers, superheroes)</code></h2>
<blockquote>
<p><code>left_join(x, y)</code>: Return all rows from <code>x</code>, and all columns from <code>x</code> and <code>y</code>. If there are multiple matches between <code>x</code> and <code>y</code>, all combination of the matches are returned. This is a mutating join.</p>
</blockquote>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1"></a>(ljps &lt;-<span class="st"> </span><span class="kw">left_join</span>(publishers, superheroes))</span>
<span id="cb196-2"><a href="#cb196-2"></a><span class="co">#&gt; Joining, by = &quot;publisher&quot;</span></span>
<span id="cb196-3"><a href="#cb196-3"></a><span class="co">#&gt; # A tibble: 7 x 5</span></span>
<span id="cb196-4"><a href="#cb196-4"></a><span class="co">#&gt;   publisher yr_founded name     alignment gender</span></span>
<span id="cb196-5"><a href="#cb196-5"></a><span class="co">#&gt;   &lt;chr&gt;          &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt; </span></span>
<span id="cb196-6"><a href="#cb196-6"></a><span class="co">#&gt; 1 DC              1934 Batman   good      male  </span></span>
<span id="cb196-7"><a href="#cb196-7"></a><span class="co">#&gt; 2 DC              1934 Joker    bad       male  </span></span>
<span id="cb196-8"><a href="#cb196-8"></a><span class="co">#&gt; 3 DC              1934 Catwoman bad       female</span></span>
<span id="cb196-9"><a href="#cb196-9"></a><span class="co">#&gt; 4 Marvel          1939 Magneto  bad       male  </span></span>
<span id="cb196-10"><a href="#cb196-10"></a><span class="co">#&gt; 5 Marvel          1939 Storm    good      female</span></span>
<span id="cb196-11"><a href="#cb196-11"></a><span class="co">#&gt; 6 Marvel          1939 Mystique bad       female</span></span>
<span id="cb196-12"><a href="#cb196-12"></a><span class="co">#&gt; 7 Image           1992 &lt;NA&gt;     &lt;NA&gt;      &lt;NA&gt;</span></span></code></pre></div>
<p>We get a similar result as with <code>inner_join()</code> but the publisher Image survives in the join, even though no superheroes from Image appear in <code>y = superheroes</code>. As a result, Image has <code>NA</code>s for <code>name</code>, <code>alignment</code>, and <code>gender</code>.</p>
<table style="width: 100%; border: 0px;">
<tr>
<td style="width: 18%; vertical-align: top;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#ygzcqblvpt .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: 0;
  margin-right: auto;
  color: #333333;
  font-size: 80%;
  font-weight: normal;
  font-style: normal;
  background-color: #cce6f6;
  width: 100%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ygzcqblvpt .gt_heading {
  background-color: #cce6f6;
  text-align: center;
  border-bottom-color: #cce6f6;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ygzcqblvpt .gt_title {
  color: #333333;
  font-size: 90%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #cce6f6;
  border-bottom-width: 0;
}

#ygzcqblvpt .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #cce6f6;
  border-top-width: 0;
}

#ygzcqblvpt .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ygzcqblvpt .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ygzcqblvpt .gt_col_heading {
  color: #333333;
  background-color: #cce6f6;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ygzcqblvpt .gt_column_spanner_outer {
  color: #333333;
  background-color: #cce6f6;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ygzcqblvpt .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ygzcqblvpt .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ygzcqblvpt .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ygzcqblvpt .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #cce6f6;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#ygzcqblvpt .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #cce6f6;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ygzcqblvpt .gt_from_md > :first-child {
  margin-top: 0;
}

#ygzcqblvpt .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ygzcqblvpt .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ygzcqblvpt .gt_stub {
  color: #333333;
  background-color: #cce6f6;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#ygzcqblvpt .gt_summary_row {
  color: #333333;
  background-color: #cce6f6;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ygzcqblvpt .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#ygzcqblvpt .gt_grand_summary_row {
  color: #333333;
  background-color: #cce6f6;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ygzcqblvpt .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ygzcqblvpt .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ygzcqblvpt .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ygzcqblvpt .gt_footnotes {
  color: #333333;
  background-color: #cce6f6;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ygzcqblvpt .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#ygzcqblvpt .gt_sourcenotes {
  color: #333333;
  background-color: #cce6f6;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ygzcqblvpt .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#ygzcqblvpt .gt_left {
  text-align: left;
}

#ygzcqblvpt .gt_center {
  text-align: center;
}

#ygzcqblvpt .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ygzcqblvpt .gt_font_normal {
  font-weight: normal;
}

#ygzcqblvpt .gt_font_bold {
  font-weight: bold;
}

#ygzcqblvpt .gt_font_italic {
  font-style: italic;
}

#ygzcqblvpt .gt_super {
  font-size: 65%;
}

#ygzcqblvpt .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="ygzcqblvpt" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  <thead class="gt_header">
    <tr>
      <th colspan="2" class="gt_heading gt_title gt_font_normal" style>publishers</th>
    </tr>
    <tr>
      <th colspan="2" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style></th>
    </tr>
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">publisher</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">yr_founded</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_left">DC</td>
      <td class="gt_row gt_center">1934</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Marvel</td>
      <td class="gt_row gt_center gt_striped">1939</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">Image</td>
      <td class="gt_row gt_center">1992</td>
    </tr>
  </tbody>
  
  
</table></div>
</td>
<td style="width: 38%; vertical-align: top;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#tafzvmzhvt .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: 0;
  margin-right: auto;
  color: #333333;
  font-size: 80%;
  font-weight: normal;
  font-style: normal;
  background-color: #edc7fc;
  width: 100%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#tafzvmzhvt .gt_heading {
  background-color: #edc7fc;
  text-align: center;
  border-bottom-color: #edc7fc;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#tafzvmzhvt .gt_title {
  color: #333333;
  font-size: 90%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #edc7fc;
  border-bottom-width: 0;
}

#tafzvmzhvt .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #edc7fc;
  border-top-width: 0;
}

#tafzvmzhvt .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#tafzvmzhvt .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#tafzvmzhvt .gt_col_heading {
  color: #333333;
  background-color: #edc7fc;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#tafzvmzhvt .gt_column_spanner_outer {
  color: #333333;
  background-color: #edc7fc;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#tafzvmzhvt .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#tafzvmzhvt .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#tafzvmzhvt .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#tafzvmzhvt .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #edc7fc;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#tafzvmzhvt .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #edc7fc;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#tafzvmzhvt .gt_from_md > :first-child {
  margin-top: 0;
}

#tafzvmzhvt .gt_from_md > :last-child {
  margin-bottom: 0;
}

#tafzvmzhvt .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#tafzvmzhvt .gt_stub {
  color: #333333;
  background-color: #edc7fc;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#tafzvmzhvt .gt_summary_row {
  color: #333333;
  background-color: #edc7fc;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#tafzvmzhvt .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#tafzvmzhvt .gt_grand_summary_row {
  color: #333333;
  background-color: #edc7fc;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#tafzvmzhvt .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#tafzvmzhvt .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#tafzvmzhvt .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#tafzvmzhvt .gt_footnotes {
  color: #333333;
  background-color: #edc7fc;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#tafzvmzhvt .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#tafzvmzhvt .gt_sourcenotes {
  color: #333333;
  background-color: #edc7fc;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#tafzvmzhvt .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#tafzvmzhvt .gt_left {
  text-align: left;
}

#tafzvmzhvt .gt_center {
  text-align: center;
}

#tafzvmzhvt .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#tafzvmzhvt .gt_font_normal {
  font-weight: normal;
}

#tafzvmzhvt .gt_font_bold {
  font-weight: bold;
}

#tafzvmzhvt .gt_font_italic {
  font-style: italic;
}

#tafzvmzhvt .gt_super {
  font-size: 65%;
}

#tafzvmzhvt .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="tafzvmzhvt" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  <thead class="gt_header">
    <tr>
      <th colspan="4" class="gt_heading gt_title gt_font_normal" style>superheroes</th>
    </tr>
    <tr>
      <th colspan="4" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style></th>
    </tr>
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">name</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">alignment</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">gender</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">publisher</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_left">Magneto</td>
      <td class="gt_row gt_left">bad</td>
      <td class="gt_row gt_left">male</td>
      <td class="gt_row gt_left">Marvel</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Storm</td>
      <td class="gt_row gt_left gt_striped">good</td>
      <td class="gt_row gt_left gt_striped">female</td>
      <td class="gt_row gt_left gt_striped">Marvel</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">Mystique</td>
      <td class="gt_row gt_left">bad</td>
      <td class="gt_row gt_left">female</td>
      <td class="gt_row gt_left">Marvel</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Batman</td>
      <td class="gt_row gt_left gt_striped">good</td>
      <td class="gt_row gt_left gt_striped">male</td>
      <td class="gt_row gt_left gt_striped">DC</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">Joker</td>
      <td class="gt_row gt_left">bad</td>
      <td class="gt_row gt_left">male</td>
      <td class="gt_row gt_left">DC</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Catwoman</td>
      <td class="gt_row gt_left gt_striped">bad</td>
      <td class="gt_row gt_left gt_striped">female</td>
      <td class="gt_row gt_left gt_striped">DC</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">Hellboy</td>
      <td class="gt_row gt_left">good</td>
      <td class="gt_row gt_left">male</td>
      <td class="gt_row gt_left">Dark Horse Comics</td>
    </tr>
  </tbody>
  
  
</table></div>
</td>
<td style="width: 44%; vertical-align: top;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#frjmqfzgat .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: 0;
  margin-right: auto;
  color: #333333;
  font-size: 80%;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: 100%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#frjmqfzgat .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#frjmqfzgat .gt_title {
  color: #333333;
  font-size: 90%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#frjmqfzgat .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#frjmqfzgat .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#frjmqfzgat .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#frjmqfzgat .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#frjmqfzgat .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#frjmqfzgat .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#frjmqfzgat .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#frjmqfzgat .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#frjmqfzgat .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#frjmqfzgat .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#frjmqfzgat .gt_from_md > :first-child {
  margin-top: 0;
}

#frjmqfzgat .gt_from_md > :last-child {
  margin-bottom: 0;
}

#frjmqfzgat .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#frjmqfzgat .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#frjmqfzgat .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#frjmqfzgat .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#frjmqfzgat .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#frjmqfzgat .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#frjmqfzgat .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#frjmqfzgat .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#frjmqfzgat .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#frjmqfzgat .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#frjmqfzgat .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#frjmqfzgat .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#frjmqfzgat .gt_left {
  text-align: left;
}

#frjmqfzgat .gt_center {
  text-align: center;
}

#frjmqfzgat .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#frjmqfzgat .gt_font_normal {
  font-weight: normal;
}

#frjmqfzgat .gt_font_bold {
  font-weight: bold;
}

#frjmqfzgat .gt_font_italic {
  font-style: italic;
}

#frjmqfzgat .gt_super {
  font-size: 65%;
}

#frjmqfzgat .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="frjmqfzgat" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  <thead class="gt_header">
    <tr>
      <th colspan="5" class="gt_heading gt_title gt_font_normal" style>left_join(x = publishers, y = superheroes)</th>
    </tr>
    <tr>
      <th colspan="5" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style></th>
    </tr>
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">publisher</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">yr_founded</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">name</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">alignment</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">gender</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_left">DC</td>
      <td class="gt_row gt_center">1934</td>
      <td class="gt_row gt_left">Batman</td>
      <td class="gt_row gt_left">good</td>
      <td class="gt_row gt_left">male</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">DC</td>
      <td class="gt_row gt_center gt_striped">1934</td>
      <td class="gt_row gt_left gt_striped">Joker</td>
      <td class="gt_row gt_left gt_striped">bad</td>
      <td class="gt_row gt_left gt_striped">male</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">DC</td>
      <td class="gt_row gt_center">1934</td>
      <td class="gt_row gt_left">Catwoman</td>
      <td class="gt_row gt_left">bad</td>
      <td class="gt_row gt_left">female</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Marvel</td>
      <td class="gt_row gt_center gt_striped">1939</td>
      <td class="gt_row gt_left gt_striped">Magneto</td>
      <td class="gt_row gt_left gt_striped">bad</td>
      <td class="gt_row gt_left gt_striped">male</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">Marvel</td>
      <td class="gt_row gt_center">1939</td>
      <td class="gt_row gt_left">Storm</td>
      <td class="gt_row gt_left">good</td>
      <td class="gt_row gt_left">female</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Marvel</td>
      <td class="gt_row gt_center gt_striped">1939</td>
      <td class="gt_row gt_left gt_striped">Mystique</td>
      <td class="gt_row gt_left gt_striped">bad</td>
      <td class="gt_row gt_left gt_striped">female</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">Image</td>
      <td class="gt_row gt_center">1992</td>
      <td class="gt_row gt_left">NA</td>
      <td class="gt_row gt_left">NA</td>
      <td class="gt_row gt_left">NA</td>
    </tr>
  </tbody>
  
  
</table></div>
</td>
</tr>
</table>
</div>
<div id="anti_joinpublishers-superheroes" class="section level2">
<h2><span class="header-section-number">15.10</span> <code>anti_join(publishers, superheroes)</code></h2>
<blockquote>
<p><code>anti_join(x, y)</code>: Return all rows from <code>x</code> where there are not matching values in <code>y</code>, keeping just columns from <code>x</code>. This is a filtering join.</p>
</blockquote>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1"></a>(ajps &lt;-<span class="st"> </span><span class="kw">anti_join</span>(publishers, superheroes))</span>
<span id="cb197-2"><a href="#cb197-2"></a><span class="co">#&gt; Joining, by = &quot;publisher&quot;</span></span>
<span id="cb197-3"><a href="#cb197-3"></a><span class="co">#&gt; # A tibble: 1 x 2</span></span>
<span id="cb197-4"><a href="#cb197-4"></a><span class="co">#&gt;   publisher yr_founded</span></span>
<span id="cb197-5"><a href="#cb197-5"></a><span class="co">#&gt;   &lt;chr&gt;          &lt;int&gt;</span></span>
<span id="cb197-6"><a href="#cb197-6"></a><span class="co">#&gt; 1 Image           1992</span></span></code></pre></div>
<p>We keep <strong>only</strong> publisher Image now (and the variables found in <code>x = publishers</code>).</p>
<table style="width: 100%; border: 0px;">
<tr>
<td style="width: 18%; vertical-align: top;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#atdqdxbnfw .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: 0;
  margin-right: auto;
  color: #333333;
  font-size: 80%;
  font-weight: normal;
  font-style: normal;
  background-color: #cce6f6;
  width: 100%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#atdqdxbnfw .gt_heading {
  background-color: #cce6f6;
  text-align: center;
  border-bottom-color: #cce6f6;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#atdqdxbnfw .gt_title {
  color: #333333;
  font-size: 90%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #cce6f6;
  border-bottom-width: 0;
}

#atdqdxbnfw .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #cce6f6;
  border-top-width: 0;
}

#atdqdxbnfw .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#atdqdxbnfw .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#atdqdxbnfw .gt_col_heading {
  color: #333333;
  background-color: #cce6f6;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#atdqdxbnfw .gt_column_spanner_outer {
  color: #333333;
  background-color: #cce6f6;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#atdqdxbnfw .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#atdqdxbnfw .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#atdqdxbnfw .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#atdqdxbnfw .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #cce6f6;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#atdqdxbnfw .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #cce6f6;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#atdqdxbnfw .gt_from_md > :first-child {
  margin-top: 0;
}

#atdqdxbnfw .gt_from_md > :last-child {
  margin-bottom: 0;
}

#atdqdxbnfw .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#atdqdxbnfw .gt_stub {
  color: #333333;
  background-color: #cce6f6;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#atdqdxbnfw .gt_summary_row {
  color: #333333;
  background-color: #cce6f6;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#atdqdxbnfw .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#atdqdxbnfw .gt_grand_summary_row {
  color: #333333;
  background-color: #cce6f6;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#atdqdxbnfw .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#atdqdxbnfw .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#atdqdxbnfw .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#atdqdxbnfw .gt_footnotes {
  color: #333333;
  background-color: #cce6f6;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#atdqdxbnfw .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#atdqdxbnfw .gt_sourcenotes {
  color: #333333;
  background-color: #cce6f6;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#atdqdxbnfw .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#atdqdxbnfw .gt_left {
  text-align: left;
}

#atdqdxbnfw .gt_center {
  text-align: center;
}

#atdqdxbnfw .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#atdqdxbnfw .gt_font_normal {
  font-weight: normal;
}

#atdqdxbnfw .gt_font_bold {
  font-weight: bold;
}

#atdqdxbnfw .gt_font_italic {
  font-style: italic;
}

#atdqdxbnfw .gt_super {
  font-size: 65%;
}

#atdqdxbnfw .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="atdqdxbnfw" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  <thead class="gt_header">
    <tr>
      <th colspan="2" class="gt_heading gt_title gt_font_normal" style>publishers</th>
    </tr>
    <tr>
      <th colspan="2" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style></th>
    </tr>
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">publisher</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">yr_founded</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_left">DC</td>
      <td class="gt_row gt_center">1934</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Marvel</td>
      <td class="gt_row gt_center gt_striped">1939</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">Image</td>
      <td class="gt_row gt_center">1992</td>
    </tr>
  </tbody>
  
  
</table></div>
</td>
<td style="width: 38%; vertical-align: top;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#qqoexbhhdl .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: 0;
  margin-right: auto;
  color: #333333;
  font-size: 80%;
  font-weight: normal;
  font-style: normal;
  background-color: #edc7fc;
  width: 100%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#qqoexbhhdl .gt_heading {
  background-color: #edc7fc;
  text-align: center;
  border-bottom-color: #edc7fc;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qqoexbhhdl .gt_title {
  color: #333333;
  font-size: 90%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #edc7fc;
  border-bottom-width: 0;
}

#qqoexbhhdl .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #edc7fc;
  border-top-width: 0;
}

#qqoexbhhdl .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qqoexbhhdl .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qqoexbhhdl .gt_col_heading {
  color: #333333;
  background-color: #edc7fc;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#qqoexbhhdl .gt_column_spanner_outer {
  color: #333333;
  background-color: #edc7fc;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#qqoexbhhdl .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#qqoexbhhdl .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#qqoexbhhdl .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#qqoexbhhdl .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #edc7fc;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#qqoexbhhdl .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #edc7fc;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#qqoexbhhdl .gt_from_md > :first-child {
  margin-top: 0;
}

#qqoexbhhdl .gt_from_md > :last-child {
  margin-bottom: 0;
}

#qqoexbhhdl .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#qqoexbhhdl .gt_stub {
  color: #333333;
  background-color: #edc7fc;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#qqoexbhhdl .gt_summary_row {
  color: #333333;
  background-color: #edc7fc;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qqoexbhhdl .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#qqoexbhhdl .gt_grand_summary_row {
  color: #333333;
  background-color: #edc7fc;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qqoexbhhdl .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#qqoexbhhdl .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#qqoexbhhdl .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qqoexbhhdl .gt_footnotes {
  color: #333333;
  background-color: #edc7fc;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qqoexbhhdl .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#qqoexbhhdl .gt_sourcenotes {
  color: #333333;
  background-color: #edc7fc;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qqoexbhhdl .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#qqoexbhhdl .gt_left {
  text-align: left;
}

#qqoexbhhdl .gt_center {
  text-align: center;
}

#qqoexbhhdl .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#qqoexbhhdl .gt_font_normal {
  font-weight: normal;
}

#qqoexbhhdl .gt_font_bold {
  font-weight: bold;
}

#qqoexbhhdl .gt_font_italic {
  font-style: italic;
}

#qqoexbhhdl .gt_super {
  font-size: 65%;
}

#qqoexbhhdl .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="qqoexbhhdl" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  <thead class="gt_header">
    <tr>
      <th colspan="4" class="gt_heading gt_title gt_font_normal" style>superheroes</th>
    </tr>
    <tr>
      <th colspan="4" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style></th>
    </tr>
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">name</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">alignment</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">gender</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">publisher</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_left">Magneto</td>
      <td class="gt_row gt_left">bad</td>
      <td class="gt_row gt_left">male</td>
      <td class="gt_row gt_left">Marvel</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Storm</td>
      <td class="gt_row gt_left gt_striped">good</td>
      <td class="gt_row gt_left gt_striped">female</td>
      <td class="gt_row gt_left gt_striped">Marvel</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">Mystique</td>
      <td class="gt_row gt_left">bad</td>
      <td class="gt_row gt_left">female</td>
      <td class="gt_row gt_left">Marvel</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Batman</td>
      <td class="gt_row gt_left gt_striped">good</td>
      <td class="gt_row gt_left gt_striped">male</td>
      <td class="gt_row gt_left gt_striped">DC</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">Joker</td>
      <td class="gt_row gt_left">bad</td>
      <td class="gt_row gt_left">male</td>
      <td class="gt_row gt_left">DC</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Catwoman</td>
      <td class="gt_row gt_left gt_striped">bad</td>
      <td class="gt_row gt_left gt_striped">female</td>
      <td class="gt_row gt_left gt_striped">DC</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">Hellboy</td>
      <td class="gt_row gt_left">good</td>
      <td class="gt_row gt_left">male</td>
      <td class="gt_row gt_left">Dark Horse Comics</td>
    </tr>
  </tbody>
  
  
</table></div>
</td>
<td style="width: 44%; vertical-align: top;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#vpfiuvwgto .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: 0;
  margin-right: auto;
  color: #333333;
  font-size: 80%;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: 100%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#vpfiuvwgto .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vpfiuvwgto .gt_title {
  color: #333333;
  font-size: 90%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#vpfiuvwgto .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#vpfiuvwgto .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vpfiuvwgto .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vpfiuvwgto .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#vpfiuvwgto .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#vpfiuvwgto .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#vpfiuvwgto .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#vpfiuvwgto .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#vpfiuvwgto .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#vpfiuvwgto .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#vpfiuvwgto .gt_from_md > :first-child {
  margin-top: 0;
}

#vpfiuvwgto .gt_from_md > :last-child {
  margin-bottom: 0;
}

#vpfiuvwgto .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#vpfiuvwgto .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#vpfiuvwgto .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vpfiuvwgto .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#vpfiuvwgto .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vpfiuvwgto .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#vpfiuvwgto .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#vpfiuvwgto .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vpfiuvwgto .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vpfiuvwgto .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#vpfiuvwgto .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vpfiuvwgto .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#vpfiuvwgto .gt_left {
  text-align: left;
}

#vpfiuvwgto .gt_center {
  text-align: center;
}

#vpfiuvwgto .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#vpfiuvwgto .gt_font_normal {
  font-weight: normal;
}

#vpfiuvwgto .gt_font_bold {
  font-weight: bold;
}

#vpfiuvwgto .gt_font_italic {
  font-style: italic;
}

#vpfiuvwgto .gt_super {
  font-size: 65%;
}

#vpfiuvwgto .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="vpfiuvwgto" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  <thead class="gt_header">
    <tr>
      <th colspan="2" class="gt_heading gt_title gt_font_normal" style>anti_join(x = publishers, y = superheroes)</th>
    </tr>
    <tr>
      <th colspan="2" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style></th>
    </tr>
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">publisher</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">yr_founded</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_left">Image</td>
      <td class="gt_row gt_center">1992</td>
    </tr>
  </tbody>
  
  
</table></div>
</td>
</tr>
</table>
</div>
<div id="full_joinsuperheroes-publishers" class="section level2">
<h2><span class="header-section-number">15.11</span> <code>full_join(superheroes, publishers)</code></h2>
<blockquote>
<p><code>full_join(x, y)</code>: Return all rows and all columns from both <code>x</code> and <code>y</code>. Where there are not matching values, returns <code>NA</code> for the one missing. This is a mutating join.</p>
</blockquote>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1"></a>(fjsp &lt;-<span class="st"> </span><span class="kw">full_join</span>(superheroes, publishers))</span>
<span id="cb198-2"><a href="#cb198-2"></a><span class="co">#&gt; Joining, by = &quot;publisher&quot;</span></span>
<span id="cb198-3"><a href="#cb198-3"></a><span class="co">#&gt; # A tibble: 8 x 5</span></span>
<span id="cb198-4"><a href="#cb198-4"></a><span class="co">#&gt;   name     alignment gender publisher         yr_founded</span></span>
<span id="cb198-5"><a href="#cb198-5"></a><span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;  &lt;chr&gt;                  &lt;int&gt;</span></span>
<span id="cb198-6"><a href="#cb198-6"></a><span class="co">#&gt; 1 Magneto  bad       male   Marvel                  1939</span></span>
<span id="cb198-7"><a href="#cb198-7"></a><span class="co">#&gt; 2 Storm    good      female Marvel                  1939</span></span>
<span id="cb198-8"><a href="#cb198-8"></a><span class="co">#&gt; 3 Mystique bad       female Marvel                  1939</span></span>
<span id="cb198-9"><a href="#cb198-9"></a><span class="co">#&gt; 4 Batman   good      male   DC                      1934</span></span>
<span id="cb198-10"><a href="#cb198-10"></a><span class="co">#&gt; 5 Joker    bad       male   DC                      1934</span></span>
<span id="cb198-11"><a href="#cb198-11"></a><span class="co">#&gt; 6 Catwoman bad       female DC                      1934</span></span>
<span id="cb198-12"><a href="#cb198-12"></a><span class="co">#&gt; 7 Hellboy  good      male   Dark Horse Comics         NA</span></span>
<span id="cb198-13"><a href="#cb198-13"></a><span class="co">#&gt; 8 &lt;NA&gt;     &lt;NA&gt;      &lt;NA&gt;   Image                   1992</span></span></code></pre></div>
<p>We get all rows of <code>x = superheroes</code> plus a new row from <code>y = publishers</code>, containing the publisher Image. We get all variables from <code>x = superheroes</code> AND all variables from <code>y = publishers</code>. Any row that derives solely from one table or the other carries <code>NA</code>s in the variables found only in the other table.</p>
<table style="width: 100%; border: 0px;">
<tr>
<td style="width: 38%; vertical-align: top;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#pbjjwgzvkb .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: 0;
  margin-right: auto;
  color: #333333;
  font-size: 80%;
  font-weight: normal;
  font-style: normal;
  background-color: #edc7fc;
  width: 100%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#pbjjwgzvkb .gt_heading {
  background-color: #edc7fc;
  text-align: center;
  border-bottom-color: #edc7fc;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#pbjjwgzvkb .gt_title {
  color: #333333;
  font-size: 90%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #edc7fc;
  border-bottom-width: 0;
}

#pbjjwgzvkb .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #edc7fc;
  border-top-width: 0;
}

#pbjjwgzvkb .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#pbjjwgzvkb .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#pbjjwgzvkb .gt_col_heading {
  color: #333333;
  background-color: #edc7fc;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#pbjjwgzvkb .gt_column_spanner_outer {
  color: #333333;
  background-color: #edc7fc;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#pbjjwgzvkb .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#pbjjwgzvkb .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#pbjjwgzvkb .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#pbjjwgzvkb .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #edc7fc;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#pbjjwgzvkb .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #edc7fc;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#pbjjwgzvkb .gt_from_md > :first-child {
  margin-top: 0;
}

#pbjjwgzvkb .gt_from_md > :last-child {
  margin-bottom: 0;
}

#pbjjwgzvkb .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#pbjjwgzvkb .gt_stub {
  color: #333333;
  background-color: #edc7fc;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#pbjjwgzvkb .gt_summary_row {
  color: #333333;
  background-color: #edc7fc;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#pbjjwgzvkb .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#pbjjwgzvkb .gt_grand_summary_row {
  color: #333333;
  background-color: #edc7fc;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#pbjjwgzvkb .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#pbjjwgzvkb .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#pbjjwgzvkb .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#pbjjwgzvkb .gt_footnotes {
  color: #333333;
  background-color: #edc7fc;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#pbjjwgzvkb .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#pbjjwgzvkb .gt_sourcenotes {
  color: #333333;
  background-color: #edc7fc;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#pbjjwgzvkb .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#pbjjwgzvkb .gt_left {
  text-align: left;
}

#pbjjwgzvkb .gt_center {
  text-align: center;
}

#pbjjwgzvkb .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#pbjjwgzvkb .gt_font_normal {
  font-weight: normal;
}

#pbjjwgzvkb .gt_font_bold {
  font-weight: bold;
}

#pbjjwgzvkb .gt_font_italic {
  font-style: italic;
}

#pbjjwgzvkb .gt_super {
  font-size: 65%;
}

#pbjjwgzvkb .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="pbjjwgzvkb" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  <thead class="gt_header">
    <tr>
      <th colspan="4" class="gt_heading gt_title gt_font_normal" style>superheroes</th>
    </tr>
    <tr>
      <th colspan="4" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style></th>
    </tr>
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">name</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">alignment</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">gender</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">publisher</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_left">Magneto</td>
      <td class="gt_row gt_left">bad</td>
      <td class="gt_row gt_left">male</td>
      <td class="gt_row gt_left">Marvel</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Storm</td>
      <td class="gt_row gt_left gt_striped">good</td>
      <td class="gt_row gt_left gt_striped">female</td>
      <td class="gt_row gt_left gt_striped">Marvel</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">Mystique</td>
      <td class="gt_row gt_left">bad</td>
      <td class="gt_row gt_left">female</td>
      <td class="gt_row gt_left">Marvel</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Batman</td>
      <td class="gt_row gt_left gt_striped">good</td>
      <td class="gt_row gt_left gt_striped">male</td>
      <td class="gt_row gt_left gt_striped">DC</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">Joker</td>
      <td class="gt_row gt_left">bad</td>
      <td class="gt_row gt_left">male</td>
      <td class="gt_row gt_left">DC</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Catwoman</td>
      <td class="gt_row gt_left gt_striped">bad</td>
      <td class="gt_row gt_left gt_striped">female</td>
      <td class="gt_row gt_left gt_striped">DC</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">Hellboy</td>
      <td class="gt_row gt_left">good</td>
      <td class="gt_row gt_left">male</td>
      <td class="gt_row gt_left">Dark Horse Comics</td>
    </tr>
  </tbody>
  
  
</table></div>
</td>
<td style="width: 18%; vertical-align: top;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#wyqglhmvcr .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: 0;
  margin-right: auto;
  color: #333333;
  font-size: 80%;
  font-weight: normal;
  font-style: normal;
  background-color: #cce6f6;
  width: 100%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#wyqglhmvcr .gt_heading {
  background-color: #cce6f6;
  text-align: center;
  border-bottom-color: #cce6f6;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wyqglhmvcr .gt_title {
  color: #333333;
  font-size: 90%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #cce6f6;
  border-bottom-width: 0;
}

#wyqglhmvcr .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #cce6f6;
  border-top-width: 0;
}

#wyqglhmvcr .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wyqglhmvcr .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wyqglhmvcr .gt_col_heading {
  color: #333333;
  background-color: #cce6f6;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#wyqglhmvcr .gt_column_spanner_outer {
  color: #333333;
  background-color: #cce6f6;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#wyqglhmvcr .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#wyqglhmvcr .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#wyqglhmvcr .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#wyqglhmvcr .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #cce6f6;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#wyqglhmvcr .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #cce6f6;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#wyqglhmvcr .gt_from_md > :first-child {
  margin-top: 0;
}

#wyqglhmvcr .gt_from_md > :last-child {
  margin-bottom: 0;
}

#wyqglhmvcr .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#wyqglhmvcr .gt_stub {
  color: #333333;
  background-color: #cce6f6;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#wyqglhmvcr .gt_summary_row {
  color: #333333;
  background-color: #cce6f6;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wyqglhmvcr .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#wyqglhmvcr .gt_grand_summary_row {
  color: #333333;
  background-color: #cce6f6;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wyqglhmvcr .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#wyqglhmvcr .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#wyqglhmvcr .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wyqglhmvcr .gt_footnotes {
  color: #333333;
  background-color: #cce6f6;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wyqglhmvcr .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#wyqglhmvcr .gt_sourcenotes {
  color: #333333;
  background-color: #cce6f6;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wyqglhmvcr .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#wyqglhmvcr .gt_left {
  text-align: left;
}

#wyqglhmvcr .gt_center {
  text-align: center;
}

#wyqglhmvcr .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#wyqglhmvcr .gt_font_normal {
  font-weight: normal;
}

#wyqglhmvcr .gt_font_bold {
  font-weight: bold;
}

#wyqglhmvcr .gt_font_italic {
  font-style: italic;
}

#wyqglhmvcr .gt_super {
  font-size: 65%;
}

#wyqglhmvcr .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="wyqglhmvcr" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  <thead class="gt_header">
    <tr>
      <th colspan="2" class="gt_heading gt_title gt_font_normal" style>publishers</th>
    </tr>
    <tr>
      <th colspan="2" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style></th>
    </tr>
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">publisher</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">yr_founded</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_left">DC</td>
      <td class="gt_row gt_center">1934</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Marvel</td>
      <td class="gt_row gt_center gt_striped">1939</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">Image</td>
      <td class="gt_row gt_center">1992</td>
    </tr>
  </tbody>
  
  
</table></div>
</td>
<td style="width: 44%; vertical-align: top;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#xhjztkenjt .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: 0;
  margin-right: auto;
  color: #333333;
  font-size: 80%;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: 100%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#xhjztkenjt .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#xhjztkenjt .gt_title {
  color: #333333;
  font-size: 90%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#xhjztkenjt .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#xhjztkenjt .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xhjztkenjt .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#xhjztkenjt .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#xhjztkenjt .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 90%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#xhjztkenjt .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#xhjztkenjt .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#xhjztkenjt .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#xhjztkenjt .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#xhjztkenjt .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#xhjztkenjt .gt_from_md > :first-child {
  margin-top: 0;
}

#xhjztkenjt .gt_from_md > :last-child {
  margin-bottom: 0;
}

#xhjztkenjt .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#xhjztkenjt .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#xhjztkenjt .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#xhjztkenjt .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#xhjztkenjt .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#xhjztkenjt .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#xhjztkenjt .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#xhjztkenjt .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xhjztkenjt .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#xhjztkenjt .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#xhjztkenjt .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#xhjztkenjt .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#xhjztkenjt .gt_left {
  text-align: left;
}

#xhjztkenjt .gt_center {
  text-align: center;
}

#xhjztkenjt .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#xhjztkenjt .gt_font_normal {
  font-weight: normal;
}

#xhjztkenjt .gt_font_bold {
  font-weight: bold;
}

#xhjztkenjt .gt_font_italic {
  font-style: italic;
}

#xhjztkenjt .gt_super {
  font-size: 65%;
}

#xhjztkenjt .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="xhjztkenjt" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  <thead class="gt_header">
    <tr>
      <th colspan="5" class="gt_heading gt_title gt_font_normal" style>full_join(x = superheroes, y = publishers)</th>
    </tr>
    <tr>
      <th colspan="5" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style></th>
    </tr>
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">name</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">alignment</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">gender</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">publisher</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">yr_founded</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_left">Magneto</td>
      <td class="gt_row gt_left">bad</td>
      <td class="gt_row gt_left">male</td>
      <td class="gt_row gt_left">Marvel</td>
      <td class="gt_row gt_center">1939</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Storm</td>
      <td class="gt_row gt_left gt_striped">good</td>
      <td class="gt_row gt_left gt_striped">female</td>
      <td class="gt_row gt_left gt_striped">Marvel</td>
      <td class="gt_row gt_center gt_striped">1939</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">Mystique</td>
      <td class="gt_row gt_left">bad</td>
      <td class="gt_row gt_left">female</td>
      <td class="gt_row gt_left">Marvel</td>
      <td class="gt_row gt_center">1939</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Batman</td>
      <td class="gt_row gt_left gt_striped">good</td>
      <td class="gt_row gt_left gt_striped">male</td>
      <td class="gt_row gt_left gt_striped">DC</td>
      <td class="gt_row gt_center gt_striped">1934</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">Joker</td>
      <td class="gt_row gt_left">bad</td>
      <td class="gt_row gt_left">male</td>
      <td class="gt_row gt_left">DC</td>
      <td class="gt_row gt_center">1934</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Catwoman</td>
      <td class="gt_row gt_left gt_striped">bad</td>
      <td class="gt_row gt_left gt_striped">female</td>
      <td class="gt_row gt_left gt_striped">DC</td>
      <td class="gt_row gt_center gt_striped">1934</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">Hellboy</td>
      <td class="gt_row gt_left">good</td>
      <td class="gt_row gt_left">male</td>
      <td class="gt_row gt_left">Dark Horse Comics</td>
      <td class="gt_row gt_center">NA</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">NA</td>
      <td class="gt_row gt_left gt_striped">NA</td>
      <td class="gt_row gt_left gt_striped">NA</td>
      <td class="gt_row gt_left gt_striped">Image</td>
      <td class="gt_row gt_center gt_striped">1992</td>
    </tr>
  </tbody>
  
  
</table></div>
</td>
</tr>
</table>
<!--RStudio Links-->
<!--HappyGitWithR Links-->
<!--Package Links-->
<!--Shiny links-->
<!--Publications-->
<!--R Documentation-->
<!--Wikipedia Links-->
<!--Misc. Links-->
<!--chapter:end:015_join-tibbles.Rmd-->
</div>
</div>
<div id="lookup" class="section level1">
<h1><span class="header-section-number">16</span> Table lookup</h1>
<!--Original content: https://stat545.com/bit008_lookup.html-->
<p>I try to use <a href="#join-cheatsheet">dplyr joins</a> for most tasks that combine data from two tibbles. But sometimes you just need good old “table lookup”. Party like it’s Microsoft Excel <code>LOOKUP()</code> time!</p>
<div id="load-gapminder-and-the-tidyverse" class="section level2">
<h2><span class="header-section-number">16.1</span> Load gapminder and the tidyverse</h2>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1"></a><span class="kw">library</span>(gapminder)</span>
<span id="cb199-2"><a href="#cb199-2"></a><span class="kw">library</span>(tidyverse)</span></code></pre></div>
</div>
<div id="create-mini-gapminder" class="section level2">
<h2><span class="header-section-number">16.2</span> Create mini Gapminder</h2>
<p>Work with a tiny subset of Gapminder, <code>mini_gap</code>.</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1"></a>mini_gap &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb200-2"><a href="#cb200-2"></a><span class="st">  </span><span class="kw">filter</span>(country <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Belgium&quot;</span>, <span class="st">&quot;Canada&quot;</span>, <span class="st">&quot;United States&quot;</span>, <span class="st">&quot;Mexico&quot;</span>),</span>
<span id="cb200-3"><a href="#cb200-3"></a>         year <span class="op">&gt;</span><span class="st"> </span><span class="dv">2000</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb200-4"><a href="#cb200-4"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>pop, <span class="op">-</span>gdpPercap) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb200-5"><a href="#cb200-5"></a><span class="st">  </span><span class="kw">droplevels</span>()</span>
<span id="cb200-6"><a href="#cb200-6"></a>mini_gap</span>
<span id="cb200-7"><a href="#cb200-7"></a><span class="co">#&gt; # A tibble: 8 x 4</span></span>
<span id="cb200-8"><a href="#cb200-8"></a><span class="co">#&gt;   country       continent  year lifeExp</span></span>
<span id="cb200-9"><a href="#cb200-9"></a><span class="co">#&gt;   &lt;fct&gt;         &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;</span></span>
<span id="cb200-10"><a href="#cb200-10"></a><span class="co">#&gt; 1 Belgium       Europe     2002    78.3</span></span>
<span id="cb200-11"><a href="#cb200-11"></a><span class="co">#&gt; 2 Belgium       Europe     2007    79.4</span></span>
<span id="cb200-12"><a href="#cb200-12"></a><span class="co">#&gt; 3 Canada        Americas   2002    79.8</span></span>
<span id="cb200-13"><a href="#cb200-13"></a><span class="co">#&gt; 4 Canada        Americas   2007    80.7</span></span>
<span id="cb200-14"><a href="#cb200-14"></a><span class="co">#&gt; 5 Mexico        Americas   2002    74.9</span></span>
<span id="cb200-15"><a href="#cb200-15"></a><span class="co">#&gt; 6 Mexico        Americas   2007    76.2</span></span>
<span id="cb200-16"><a href="#cb200-16"></a><span class="co">#&gt; 7 United States Americas   2002    77.3</span></span>
<span id="cb200-17"><a href="#cb200-17"></a><span class="co">#&gt; 8 United States Americas   2007    78.2</span></span></code></pre></div>
</div>
<div id="dorky-national-food-example." class="section level2">
<h2><span class="header-section-number">16.3</span> Dorky national food example.</h2>
<p>Make a lookup table of national foods. Or at least the stereotype. Yes, I have intentionally kept Mexico in mini-Gapminder and neglected to put Mexico here.</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1"></a>food &lt;-<span class="st"> </span><span class="kw">tribble</span>(</span>
<span id="cb201-2"><a href="#cb201-2"></a>        <span class="op">~</span><span class="st"> </span>country,    <span class="op">~</span><span class="st"> </span>food,</span>
<span id="cb201-3"><a href="#cb201-3"></a>        <span class="st">&quot;Belgium&quot;</span>,  <span class="st">&quot;waffle&quot;</span>,</span>
<span id="cb201-4"><a href="#cb201-4"></a>         <span class="st">&quot;Canada&quot;</span>, <span class="st">&quot;poutine&quot;</span>,</span>
<span id="cb201-5"><a href="#cb201-5"></a>  <span class="st">&quot;United States&quot;</span>, <span class="st">&quot;Twinkie&quot;</span></span>
<span id="cb201-6"><a href="#cb201-6"></a>)</span>
<span id="cb201-7"><a href="#cb201-7"></a>food</span>
<span id="cb201-8"><a href="#cb201-8"></a><span class="co">#&gt; # A tibble: 3 x 2</span></span>
<span id="cb201-9"><a href="#cb201-9"></a><span class="co">#&gt;   country       food   </span></span>
<span id="cb201-10"><a href="#cb201-10"></a><span class="co">#&gt;   &lt;chr&gt;         &lt;chr&gt;  </span></span>
<span id="cb201-11"><a href="#cb201-11"></a><span class="co">#&gt; 1 Belgium       waffle </span></span>
<span id="cb201-12"><a href="#cb201-12"></a><span class="co">#&gt; 2 Canada        poutine</span></span>
<span id="cb201-13"><a href="#cb201-13"></a><span class="co">#&gt; 3 United States Twinkie</span></span></code></pre></div>
</div>
<div id="lookup-national-food" class="section level2">
<h2><span class="header-section-number">16.4</span> Lookup national food</h2>
<p><code>match(x, table)</code> reports where the values in the key <code>x</code> appear in the lookup variable <code>table</code>. It returns positive integers for use as indices. It assumes <code>x</code> and <code>table</code> are free-range vectors, i.e. there’s no implicit data frame on the radar here.</p>
<p>Gapminder’s <code>country</code> plays the role of the key <code>x</code>. It is replicated, i.e. non-unique, in <code>mini_gap</code>, but not in <code>food</code>, i.e. no country appears more than once <code>food$country</code>. FYI <code>match()</code> actually allows for multiple matches by only consulting the first.</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1"></a><span class="kw">match</span>(<span class="dt">x =</span> mini_gap<span class="op">$</span>country, <span class="dt">table =</span> food<span class="op">$</span>country)</span>
<span id="cb202-2"><a href="#cb202-2"></a><span class="co">#&gt; [1]  1  1  2  2 NA NA  3  3</span></span></code></pre></div>
<p>In table lookup, there is always a value variable <code>y</code> that you plan to index with the <code>match(x, table)</code> result. It often lives together with <code>table</code> in a data frame; they should certainly be the same length and synced up with respect to row order.</p>
<p>But first…</p>
<p>I get <code>x</code> and <code>table</code> backwards some non-negligible percentage of the time. So I store the match indices and index the data frame where <code>table</code> lives with it. Add <code>x</code> as a column and eyeball-o-metrically assess that all is well.</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1"></a>(indices &lt;-<span class="st"> </span><span class="kw">match</span>(<span class="dt">x =</span> mini_gap<span class="op">$</span>country, <span class="dt">table =</span> food<span class="op">$</span>country))</span>
<span id="cb203-2"><a href="#cb203-2"></a><span class="co">#&gt; [1]  1  1  2  2 NA NA  3  3</span></span>
<span id="cb203-3"><a href="#cb203-3"></a><span class="kw">add_column</span>(food[indices, ], <span class="dt">x =</span> mini_gap<span class="op">$</span>country)</span>
<span id="cb203-4"><a href="#cb203-4"></a><span class="co">#&gt; # A tibble: 8 x 3</span></span>
<span id="cb203-5"><a href="#cb203-5"></a><span class="co">#&gt;   country       food    x            </span></span>
<span id="cb203-6"><a href="#cb203-6"></a><span class="co">#&gt;   &lt;chr&gt;         &lt;chr&gt;   &lt;fct&gt;        </span></span>
<span id="cb203-7"><a href="#cb203-7"></a><span class="co">#&gt; 1 Belgium       waffle  Belgium      </span></span>
<span id="cb203-8"><a href="#cb203-8"></a><span class="co">#&gt; 2 Belgium       waffle  Belgium      </span></span>
<span id="cb203-9"><a href="#cb203-9"></a><span class="co">#&gt; 3 Canada        poutine Canada       </span></span>
<span id="cb203-10"><a href="#cb203-10"></a><span class="co">#&gt; 4 Canada        poutine Canada       </span></span>
<span id="cb203-11"><a href="#cb203-11"></a><span class="co">#&gt; 5 &lt;NA&gt;          &lt;NA&gt;    Mexico       </span></span>
<span id="cb203-12"><a href="#cb203-12"></a><span class="co">#&gt; 6 &lt;NA&gt;          &lt;NA&gt;    Mexico       </span></span>
<span id="cb203-13"><a href="#cb203-13"></a><span class="co">#&gt; 7 United States Twinkie United States</span></span>
<span id="cb203-14"><a href="#cb203-14"></a><span class="co">#&gt; 8 United States Twinkie United States</span></span></code></pre></div>
<p>Once all looks good, do the actual table lookup and, possibly, add the new info to your main table.</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1"></a>mini_gap <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb204-2"><a href="#cb204-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">food =</span> food<span class="op">$</span>food[indices])</span>
<span id="cb204-3"><a href="#cb204-3"></a><span class="co">#&gt; # A tibble: 8 x 5</span></span>
<span id="cb204-4"><a href="#cb204-4"></a><span class="co">#&gt;   country       continent  year lifeExp food   </span></span>
<span id="cb204-5"><a href="#cb204-5"></a><span class="co">#&gt;   &lt;fct&gt;         &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;  </span></span>
<span id="cb204-6"><a href="#cb204-6"></a><span class="co">#&gt; 1 Belgium       Europe     2002    78.3 waffle </span></span>
<span id="cb204-7"><a href="#cb204-7"></a><span class="co">#&gt; 2 Belgium       Europe     2007    79.4 waffle </span></span>
<span id="cb204-8"><a href="#cb204-8"></a><span class="co">#&gt; 3 Canada        Americas   2002    79.8 poutine</span></span>
<span id="cb204-9"><a href="#cb204-9"></a><span class="co">#&gt; 4 Canada        Americas   2007    80.7 poutine</span></span>
<span id="cb204-10"><a href="#cb204-10"></a><span class="co">#&gt; 5 Mexico        Americas   2002    74.9 &lt;NA&gt;   </span></span>
<span id="cb204-11"><a href="#cb204-11"></a><span class="co">#&gt; 6 Mexico        Americas   2007    76.2 &lt;NA&gt;   </span></span>
<span id="cb204-12"><a href="#cb204-12"></a><span class="co">#&gt; 7 United States Americas   2002    77.3 Twinkie</span></span>
<span id="cb204-13"><a href="#cb204-13"></a><span class="co">#&gt; 8 United States Americas   2007    78.2 Twinkie</span></span></code></pre></div>
<p>Of course, if this was really our exact task, we could have used a join!</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1"></a>mini_gap <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb205-2"><a href="#cb205-2"></a><span class="st">  </span><span class="kw">left_join</span>(food)</span>
<span id="cb205-3"><a href="#cb205-3"></a><span class="co">#&gt; Joining, by = &quot;country&quot;</span></span>
<span id="cb205-4"><a href="#cb205-4"></a><span class="co">#&gt; # A tibble: 8 x 5</span></span>
<span id="cb205-5"><a href="#cb205-5"></a><span class="co">#&gt;   country       continent  year lifeExp food   </span></span>
<span id="cb205-6"><a href="#cb205-6"></a><span class="co">#&gt;   &lt;chr&gt;         &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;  </span></span>
<span id="cb205-7"><a href="#cb205-7"></a><span class="co">#&gt; 1 Belgium       Europe     2002    78.3 waffle </span></span>
<span id="cb205-8"><a href="#cb205-8"></a><span class="co">#&gt; 2 Belgium       Europe     2007    79.4 waffle </span></span>
<span id="cb205-9"><a href="#cb205-9"></a><span class="co">#&gt; 3 Canada        Americas   2002    79.8 poutine</span></span>
<span id="cb205-10"><a href="#cb205-10"></a><span class="co">#&gt; 4 Canada        Americas   2007    80.7 poutine</span></span>
<span id="cb205-11"><a href="#cb205-11"></a><span class="co">#&gt; 5 Mexico        Americas   2002    74.9 &lt;NA&gt;   </span></span>
<span id="cb205-12"><a href="#cb205-12"></a><span class="co">#&gt; 6 Mexico        Americas   2007    76.2 &lt;NA&gt;   </span></span>
<span id="cb205-13"><a href="#cb205-13"></a><span class="co">#&gt; 7 United States Americas   2002    77.3 Twinkie</span></span>
<span id="cb205-14"><a href="#cb205-14"></a><span class="co">#&gt; 8 United States Americas   2007    78.2 Twinkie</span></span></code></pre></div>
<p>But sometimes you have a substantive reason (or psychological hangup) that makes you prefer the table look up interface.</p>
</div>
<div id="worlds-laziest-table-lookup" class="section level2">
<h2><span class="header-section-number">16.5</span> World’s laziest table lookup</h2>
<p>While I’m here, let’s demo another standard R trick that’s based on indexing by name.</p>
<p>Imagine the table you want to consult isn’t even a tibble but is, instead, a named character vector.</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1"></a>(food_vec &lt;-<span class="st"> </span><span class="kw">setNames</span>(food<span class="op">$</span>food, food<span class="op">$</span>country))</span>
<span id="cb206-2"><a href="#cb206-2"></a><span class="co">#&gt;       Belgium        Canada United States </span></span>
<span id="cb206-3"><a href="#cb206-3"></a><span class="co">#&gt;      &quot;waffle&quot;     &quot;poutine&quot;     &quot;Twinkie&quot;</span></span></code></pre></div>
<p>Another way to get the national foods for mini-Gapminder is to simply index <code>food_vec</code> with <code>mini_gap$country</code>.</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1"></a>mini_gap <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb207-2"><a href="#cb207-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">food =</span> food_vec[country])</span>
<span id="cb207-3"><a href="#cb207-3"></a><span class="co">#&gt; # A tibble: 8 x 5</span></span>
<span id="cb207-4"><a href="#cb207-4"></a><span class="co">#&gt;   country       continent  year lifeExp food   </span></span>
<span id="cb207-5"><a href="#cb207-5"></a><span class="co">#&gt;   &lt;fct&gt;         &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;  </span></span>
<span id="cb207-6"><a href="#cb207-6"></a><span class="co">#&gt; 1 Belgium       Europe     2002    78.3 waffle </span></span>
<span id="cb207-7"><a href="#cb207-7"></a><span class="co">#&gt; 2 Belgium       Europe     2007    79.4 waffle </span></span>
<span id="cb207-8"><a href="#cb207-8"></a><span class="co">#&gt; 3 Canada        Americas   2002    79.8 poutine</span></span>
<span id="cb207-9"><a href="#cb207-9"></a><span class="co">#&gt; 4 Canada        Americas   2007    80.7 poutine</span></span>
<span id="cb207-10"><a href="#cb207-10"></a><span class="co">#&gt; 5 Mexico        Americas   2002    74.9 Twinkie</span></span>
<span id="cb207-11"><a href="#cb207-11"></a><span class="co">#&gt; 6 Mexico        Americas   2007    76.2 Twinkie</span></span>
<span id="cb207-12"><a href="#cb207-12"></a><span class="co">#&gt; 7 United States Americas   2002    77.3 &lt;NA&gt;   </span></span>
<span id="cb207-13"><a href="#cb207-13"></a><span class="co">#&gt; 8 United States Americas   2007    78.2 &lt;NA&gt;</span></span></code></pre></div>
<p>HOLD ON. STOP. Twinkies aren’t the national food of Mexico!?! What went wrong?</p>
<p>Remember <code>mini_gap$country</code> is a factor. So when we use it in an indexing context, it’s integer nature is expressed. It is pure luck that we get the right foods for Belgium and Canada. Luckily the Mexico - United States situation tipped us off. Here’s what we are really indexing <code>food_vec</code> by above:</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1"></a><span class="kw">unclass</span>(mini_gap<span class="op">$</span>country)</span>
<span id="cb208-2"><a href="#cb208-2"></a><span class="co">#&gt; [1] 1 1 2 2 3 3 4 4</span></span>
<span id="cb208-3"><a href="#cb208-3"></a><span class="co">#&gt; attr(,&quot;levels&quot;)</span></span>
<span id="cb208-4"><a href="#cb208-4"></a><span class="co">#&gt; [1] &quot;Belgium&quot;       &quot;Canada&quot;        &quot;Mexico&quot;        &quot;United States&quot;</span></span></code></pre></div>
<p>To get our desired result, we need to explicitly coerce <code>mini_gap$country</code> to character.</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="#cb209-1"></a>mini_gap <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb209-2"><a href="#cb209-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">food =</span> food_vec[<span class="kw">as.character</span>(country)])</span>
<span id="cb209-3"><a href="#cb209-3"></a><span class="co">#&gt; # A tibble: 8 x 5</span></span>
<span id="cb209-4"><a href="#cb209-4"></a><span class="co">#&gt;   country       continent  year lifeExp food   </span></span>
<span id="cb209-5"><a href="#cb209-5"></a><span class="co">#&gt;   &lt;fct&gt;         &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;  </span></span>
<span id="cb209-6"><a href="#cb209-6"></a><span class="co">#&gt; 1 Belgium       Europe     2002    78.3 waffle </span></span>
<span id="cb209-7"><a href="#cb209-7"></a><span class="co">#&gt; 2 Belgium       Europe     2007    79.4 waffle </span></span>
<span id="cb209-8"><a href="#cb209-8"></a><span class="co">#&gt; 3 Canada        Americas   2002    79.8 poutine</span></span>
<span id="cb209-9"><a href="#cb209-9"></a><span class="co">#&gt; 4 Canada        Americas   2007    80.7 poutine</span></span>
<span id="cb209-10"><a href="#cb209-10"></a><span class="co">#&gt; 5 Mexico        Americas   2002    74.9 &lt;NA&gt;   </span></span>
<span id="cb209-11"><a href="#cb209-11"></a><span class="co">#&gt; 6 Mexico        Americas   2007    76.2 &lt;NA&gt;   </span></span>
<span id="cb209-12"><a href="#cb209-12"></a><span class="co">#&gt; 7 United States Americas   2002    77.3 Twinkie</span></span>
<span id="cb209-13"><a href="#cb209-13"></a><span class="co">#&gt; 8 United States Americas   2007    78.2 Twinkie</span></span></code></pre></div>
<p>When your key variable is character (and not a factor), you can skip this step.</p>
<!--RStudio Links-->
<!--HappyGitWithR Links-->
<!--Package Links-->
<!--Shiny links-->
<!--Publications-->
<!--R Documentation-->
<!--Wikipedia Links-->
<!--Misc. Links-->
<!--chapter:end:016_table-lookup.Rmd-->
</div>
</div>
<div id="part-r-as-a-programming-language" class="section level1 unnumbered">
<h1>(PART) R as a programming language</h1>
</div>
<div id="r-objects" class="section level1">
<h1><span class="header-section-number">17</span> R objects and indexing</h1>
<!--Original content: https://stat545.com/block004_basic-r-objects.html-->
<p>R objects (beyond data.frames) and indexing.</p>
<blockquote>
<p>“Rigor and clarity are not synonymous” – Larry Wasserman</p>
</blockquote>
<blockquote>
<p>“Never hesitate to sacrifice truth for clarity.” – Greg Wilson’s dad</p>
</blockquote>
<div id="vectors-are-everywhere" class="section level2">
<h2><span class="header-section-number">17.1</span> Vectors are everywhere</h2>
<p>Your garden variety R object is a vector. A single piece of info that you regard as a scalar is just a vector of length 1 and R will cheerfully let you add stuff to it. Square brackets are used for isolating elements of a vector for inspection, modification, etc. This is often called <strong>indexing</strong>. Go through the following code carefully, as it’s really rather surprising. BTW, indexing begins at 1 in R, unlike many other languages that index from 0.</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1"></a>x &lt;-<span class="st"> </span><span class="dv">3</span> <span class="op">*</span><span class="st"> </span><span class="dv">4</span></span>
<span id="cb210-2"><a href="#cb210-2"></a>x</span>
<span id="cb210-3"><a href="#cb210-3"></a><span class="co">#&gt; [1] 12</span></span>
<span id="cb210-4"><a href="#cb210-4"></a><span class="kw">is.vector</span>(x)</span>
<span id="cb210-5"><a href="#cb210-5"></a><span class="co">#&gt; [1] TRUE</span></span>
<span id="cb210-6"><a href="#cb210-6"></a><span class="kw">length</span>(x)</span>
<span id="cb210-7"><a href="#cb210-7"></a><span class="co">#&gt; [1] 1</span></span>
<span id="cb210-8"><a href="#cb210-8"></a>x[<span class="dv">2</span>] &lt;-<span class="st"> </span><span class="dv">100</span></span>
<span id="cb210-9"><a href="#cb210-9"></a>x</span>
<span id="cb210-10"><a href="#cb210-10"></a><span class="co">#&gt; [1]  12 100</span></span>
<span id="cb210-11"><a href="#cb210-11"></a>x[<span class="dv">5</span>] &lt;-<span class="st"> </span><span class="dv">3</span></span>
<span id="cb210-12"><a href="#cb210-12"></a>x</span>
<span id="cb210-13"><a href="#cb210-13"></a><span class="co">#&gt; [1]  12 100  NA  NA   3</span></span>
<span id="cb210-14"><a href="#cb210-14"></a>x[<span class="dv">11</span>]</span>
<span id="cb210-15"><a href="#cb210-15"></a><span class="co">#&gt; [1] NA</span></span>
<span id="cb210-16"><a href="#cb210-16"></a>x[<span class="dv">0</span>]</span>
<span id="cb210-17"><a href="#cb210-17"></a><span class="co">#&gt; numeric(0)</span></span></code></pre></div>
<p>R is built to work with vectors. Many operations are <em>vectorized</em>, i.e. by default they will happen component-wise when given a vector as input. Novices often don’t internalize or exploit this and they write lots of unnecessary <code>for</code> loops.</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="#cb211-1"></a>x &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">4</span></span>
<span id="cb211-2"><a href="#cb211-2"></a><span class="co">## which would you rather write and read?</span></span>
<span id="cb211-3"><a href="#cb211-3"></a><span class="co">## the vectorized version ...</span></span>
<span id="cb211-4"><a href="#cb211-4"></a>(y &lt;-<span class="st"> </span>x<span class="op">^</span><span class="dv">2</span>) </span>
<span id="cb211-5"><a href="#cb211-5"></a><span class="co">#&gt; [1]  1  4  9 16</span></span>
<span id="cb211-6"><a href="#cb211-6"></a><span class="co">## or the for loop version?</span></span>
<span id="cb211-7"><a href="#cb211-7"></a>z &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="dt">mode =</span> <span class="kw">mode</span>(x), <span class="dt">length =</span> <span class="kw">length</span>(x))</span>
<span id="cb211-8"><a href="#cb211-8"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">seq_along</span>(x)) {</span>
<span id="cb211-9"><a href="#cb211-9"></a>  z[i] &lt;-<span class="st"> </span>x[i]<span class="op">^</span><span class="dv">2</span></span>
<span id="cb211-10"><a href="#cb211-10"></a>}</span>
<span id="cb211-11"><a href="#cb211-11"></a><span class="kw">identical</span>(y, z)</span>
<span id="cb211-12"><a href="#cb211-12"></a><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>When reading function documentation, keep your eyes peeled for arguments that can be vectors. You’ll be surprised how common they are. For example, the mean and standard deviation of random normal variates can be provided as vectors.</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1"></a><span class="kw">set.seed</span>(<span class="dv">1999</span>)</span>
<span id="cb212-2"><a href="#cb212-2"></a><span class="kw">rnorm</span>(<span class="dv">5</span>, <span class="dt">mean =</span> <span class="dv">10</span><span class="op">^</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>))</span>
<span id="cb212-3"><a href="#cb212-3"></a><span class="co">#&gt; [1]     10.7    100.0   1001.2  10001.5 100000.1</span></span>
<span id="cb212-4"><a href="#cb212-4"></a><span class="kw">round</span>(<span class="kw">rnorm</span>(<span class="dv">5</span>, <span class="dt">sd =</span> <span class="dv">10</span><span class="op">^</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">4</span>)), <span class="dv">2</span>)</span>
<span id="cb212-5"><a href="#cb212-5"></a><span class="co">#&gt; [1]     0.52    -5.49  -118.56 -1147.28 11607.42</span></span></code></pre></div>
<p>This could be awesome in some settings, but dangerous in others, i.e. if you exploit this by mistake and get no warning. This is one of the reasons it’s so important to keep close tabs on your R objects: are they what you expect in terms of their flavor and length or dimensions? Check early and check often.</p>
<p>Notice that R also recycles vectors, if they are not the necessary length. You will get a warning if R suspects recycling is unintended, i.e. when one length is not an integer multiple of another, but recycling is silent if it seems like you know what you’re doing. Can be a beautiful thing when you’re doing this deliberately, but devastating when you don’t.</p>
<blockquote>
<p>Question: is there a way to turn recycling off? Not that I know of.</p>
</blockquote>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="#cb213-1"></a>(y &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)</span>
<span id="cb213-2"><a href="#cb213-2"></a><span class="co">#&gt; [1] 1 2 3</span></span>
<span id="cb213-3"><a href="#cb213-3"></a>(z &lt;-<span class="st"> </span><span class="dv">3</span><span class="op">:</span><span class="dv">7</span>)</span>
<span id="cb213-4"><a href="#cb213-4"></a><span class="co">#&gt; [1] 3 4 5 6 7</span></span>
<span id="cb213-5"><a href="#cb213-5"></a>y <span class="op">+</span><span class="st"> </span>z</span>
<span id="cb213-6"><a href="#cb213-6"></a><span class="co">#&gt; Warning in y + z: longer object length is not a multiple of shorter object</span></span>
<span id="cb213-7"><a href="#cb213-7"></a><span class="co">#&gt; length</span></span>
<span id="cb213-8"><a href="#cb213-8"></a><span class="co">#&gt; [1] 4 6 8 7 9</span></span>
<span id="cb213-9"><a href="#cb213-9"></a>(y &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)</span>
<span id="cb213-10"><a href="#cb213-10"></a><span class="co">#&gt;  [1]  1  2  3  4  5  6  7  8  9 10</span></span>
<span id="cb213-11"><a href="#cb213-11"></a>(z &lt;-<span class="st"> </span><span class="dv">3</span><span class="op">:</span><span class="dv">7</span>)</span>
<span id="cb213-12"><a href="#cb213-12"></a><span class="co">#&gt; [1] 3 4 5 6 7</span></span>
<span id="cb213-13"><a href="#cb213-13"></a>y <span class="op">+</span><span class="st"> </span>z</span>
<span id="cb213-14"><a href="#cb213-14"></a><span class="co">#&gt;  [1]  4  6  8 10 12  9 11 13 15 17</span></span></code></pre></div>
<p>The combine function <code>c()</code> is your go-to function for making vectors.</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1"></a><span class="kw">str</span>(<span class="kw">c</span>(<span class="st">&quot;hello&quot;</span>, <span class="st">&quot;world&quot;</span>))</span>
<span id="cb214-2"><a href="#cb214-2"></a><span class="co">#&gt;  chr [1:2] &quot;hello&quot; &quot;world&quot;</span></span>
<span id="cb214-3"><a href="#cb214-3"></a><span class="kw">str</span>(<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dv">100</span>, <span class="dv">150</span>))</span>
<span id="cb214-4"><a href="#cb214-4"></a><span class="co">#&gt;  num [1:5] 1 2 3 100 150</span></span></code></pre></div>
<p>Plain vanilla R objects are called “atomic vectors” and an absolute requirement is that all the bits of info they hold are of the same flavor, i.e. all numeric or logical or character. If that’s not already true upon creation, the elements will be coerced to the same flavor, using a “lowest common denominator” approach (usually character). This is another stellar opportunity for you to create an object of one flavor without meaning to do so and to remain ignorant of that for a long time. Check early, check often.</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="#cb215-1"></a>(x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;cabbage&quot;</span>, pi, <span class="ot">TRUE</span>, <span class="fl">4.3</span>))</span>
<span id="cb215-2"><a href="#cb215-2"></a><span class="co">#&gt; [1] &quot;cabbage&quot;          &quot;3.14159265358979&quot; &quot;TRUE&quot;             &quot;4.3&quot;</span></span>
<span id="cb215-3"><a href="#cb215-3"></a><span class="kw">str</span>(x)</span>
<span id="cb215-4"><a href="#cb215-4"></a><span class="co">#&gt;  chr [1:4] &quot;cabbage&quot; &quot;3.14159265358979&quot; &quot;TRUE&quot; &quot;4.3&quot;</span></span>
<span id="cb215-5"><a href="#cb215-5"></a><span class="kw">length</span>(x)</span>
<span id="cb215-6"><a href="#cb215-6"></a><span class="co">#&gt; [1] 4</span></span>
<span id="cb215-7"><a href="#cb215-7"></a><span class="kw">mode</span>(x)</span>
<span id="cb215-8"><a href="#cb215-8"></a><span class="co">#&gt; [1] &quot;character&quot;</span></span>
<span id="cb215-9"><a href="#cb215-9"></a><span class="kw">class</span>(x)</span>
<span id="cb215-10"><a href="#cb215-10"></a><span class="co">#&gt; [1] &quot;character&quot;</span></span></code></pre></div>
<p>The most important atomic vector types are:</p>
<ul>
<li><strong>logical</strong>: TRUE’s AND FALSE’s, easily coerced into 1’s and 0’s</li>
<li><strong>numeric</strong>: numbers and, yes, integers and double-precision floating point numbers are different but you can live happily for a long time without worrying about this</li>
<li><strong>character</strong></li>
</ul>
<p>Let’s create some simple vectors for more demos below.</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1"></a>n &lt;-<span class="st"> </span><span class="dv">8</span></span>
<span id="cb216-2"><a href="#cb216-2"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb216-3"><a href="#cb216-3"></a>(w &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">rnorm</span>(n), <span class="dv">2</span>)) <span class="co"># numeric floating point</span></span>
<span id="cb216-4"><a href="#cb216-4"></a><span class="co">#&gt; [1] -0.63  0.18 -0.84  1.60  0.33 -0.82  0.49  0.74</span></span>
<span id="cb216-5"><a href="#cb216-5"></a>(x &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span>n) <span class="co"># numeric integer</span></span>
<span id="cb216-6"><a href="#cb216-6"></a><span class="co">#&gt; [1] 1 2 3 4 5 6 7 8</span></span>
<span id="cb216-7"><a href="#cb216-7"></a><span class="co">## another way to accomplish by hand is x &lt;- c(1, 2, 3, 4, 5, 6, 7, 8)</span></span>
<span id="cb216-8"><a href="#cb216-8"></a>(y &lt;-<span class="st"> </span>LETTERS[<span class="dv">1</span><span class="op">:</span>n]) <span class="co"># character</span></span>
<span id="cb216-9"><a href="#cb216-9"></a><span class="co">#&gt; [1] &quot;A&quot; &quot;B&quot; &quot;C&quot; &quot;D&quot; &quot;E&quot; &quot;F&quot; &quot;G&quot; &quot;H&quot;</span></span>
<span id="cb216-10"><a href="#cb216-10"></a>(z &lt;-<span class="st"> </span><span class="kw">runif</span>(n) <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.3</span>) <span class="co"># logical</span></span>
<span id="cb216-11"><a href="#cb216-11"></a><span class="co">#&gt; [1]  TRUE  TRUE  TRUE  TRUE  TRUE FALSE  TRUE FALSE</span></span></code></pre></div>
<p>Use <code>str()</code> and any other functions you wish to inspect these objects, such as <code>length()</code>, <code>mode()</code>, <code>class()</code>, <code>is.numeric()</code>, <code>is.logical()</code>, etc. Like the <code>is.xxx()</code> family of functions, there are also <code>as.xxx()</code> functions you can experiment with.</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="#cb217-1"></a><span class="kw">str</span>(w)</span>
<span id="cb217-2"><a href="#cb217-2"></a><span class="co">#&gt;  num [1:8] -0.63 0.18 -0.84 1.6 0.33 -0.82 0.49 0.74</span></span>
<span id="cb217-3"><a href="#cb217-3"></a><span class="kw">length</span>(x)</span>
<span id="cb217-4"><a href="#cb217-4"></a><span class="co">#&gt; [1] 8</span></span>
<span id="cb217-5"><a href="#cb217-5"></a><span class="kw">is.logical</span>(y)</span>
<span id="cb217-6"><a href="#cb217-6"></a><span class="co">#&gt; [1] FALSE</span></span>
<span id="cb217-7"><a href="#cb217-7"></a><span class="kw">as.numeric</span>(z)</span>
<span id="cb217-8"><a href="#cb217-8"></a><span class="co">#&gt; [1] 1 1 1 1 1 0 1 0</span></span></code></pre></div>
</div>
<div id="indexing-a-vector" class="section level2">
<h2><span class="header-section-number">17.2</span> Indexing a vector</h2>
<p>We’ve said, and even seen, that square brackets are used to index a vector. There is great flexibility in what one can put inside the square brackets and it’s worth understanding the many options. They are all useful, just in different contexts.</p>
<p>Most common, useful ways to index a vector:</p>
<ul>
<li><strong>logical vector</strong>: keep elements associated with TRUE’s, ditch the FALSE’s</li>
<li><strong>vector of positive integers</strong>: specifying the keepers</li>
<li><strong>vector of negative integers</strong>: specifying the losers</li>
<li><strong>character vector</strong>: naming the keepers</li>
</ul>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1"></a>w</span>
<span id="cb218-2"><a href="#cb218-2"></a><span class="co">#&gt; [1] -0.63  0.18 -0.84  1.60  0.33 -0.82  0.49  0.74</span></span>
<span id="cb218-3"><a href="#cb218-3"></a><span class="kw">names</span>(w) &lt;-<span class="st"> </span>letters[<span class="kw">seq_along</span>(w)]</span>
<span id="cb218-4"><a href="#cb218-4"></a>w</span>
<span id="cb218-5"><a href="#cb218-5"></a><span class="co">#&gt;     a     b     c     d     e     f     g     h </span></span>
<span id="cb218-6"><a href="#cb218-6"></a><span class="co">#&gt; -0.63  0.18 -0.84  1.60  0.33 -0.82  0.49  0.74</span></span>
<span id="cb218-7"><a href="#cb218-7"></a>w <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span></span>
<span id="cb218-8"><a href="#cb218-8"></a><span class="co">#&gt;     a     b     c     d     e     f     g     h </span></span>
<span id="cb218-9"><a href="#cb218-9"></a><span class="co">#&gt;  TRUE FALSE  TRUE FALSE FALSE  TRUE FALSE FALSE</span></span>
<span id="cb218-10"><a href="#cb218-10"></a><span class="kw">which</span>(w <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>)</span>
<span id="cb218-11"><a href="#cb218-11"></a><span class="co">#&gt; a c f </span></span>
<span id="cb218-12"><a href="#cb218-12"></a><span class="co">#&gt; 1 3 6</span></span>
<span id="cb218-13"><a href="#cb218-13"></a>w[w <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>]</span>
<span id="cb218-14"><a href="#cb218-14"></a><span class="co">#&gt;     a     c     f </span></span>
<span id="cb218-15"><a href="#cb218-15"></a><span class="co">#&gt; -0.63 -0.84 -0.82</span></span>
<span id="cb218-16"><a href="#cb218-16"></a><span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">1</span>, <span class="dt">to =</span> <span class="kw">length</span>(w), <span class="dt">by =</span> <span class="dv">2</span>)</span>
<span id="cb218-17"><a href="#cb218-17"></a><span class="co">#&gt; [1] 1 3 5 7</span></span>
<span id="cb218-18"><a href="#cb218-18"></a>w[<span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">1</span>, <span class="dt">to =</span> <span class="kw">length</span>(w), <span class="dt">by =</span> <span class="dv">2</span>)]</span>
<span id="cb218-19"><a href="#cb218-19"></a><span class="co">#&gt;     a     c     e     g </span></span>
<span id="cb218-20"><a href="#cb218-20"></a><span class="co">#&gt; -0.63 -0.84  0.33  0.49</span></span>
<span id="cb218-21"><a href="#cb218-21"></a>w[<span class="op">-</span><span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">5</span>)]</span>
<span id="cb218-22"><a href="#cb218-22"></a><span class="co">#&gt;     a     c     d     f     g     h </span></span>
<span id="cb218-23"><a href="#cb218-23"></a><span class="co">#&gt; -0.63 -0.84  1.60 -0.82  0.49  0.74</span></span>
<span id="cb218-24"><a href="#cb218-24"></a>w[<span class="kw">c</span>(<span class="st">&#39;c&#39;</span>, <span class="st">&#39;a&#39;</span>, <span class="st">&#39;f&#39;</span>)]</span>
<span id="cb218-25"><a href="#cb218-25"></a><span class="co">#&gt;     c     a     f </span></span>
<span id="cb218-26"><a href="#cb218-26"></a><span class="co">#&gt; -0.84 -0.63 -0.82</span></span></code></pre></div>
</div>
<div id="lists-hold-just-about-anything" class="section level2">
<h2><span class="header-section-number">17.3</span> lists hold just about anything</h2>
<p>Lists are basically über-vectors in R. It’s like a vector, but with no requirement that the elements be of the same flavor. In data analysis, you won’t make lists very often, at least not consciously, but you should still know about them. Why?</p>
<ul>
<li>data.frames are lists! They are a special case where each element is an atomic vector, all having the same length.</li>
<li>many functions will return lists to you and you will want to extract goodies from them, such as the p-value for a hypothesis test or the estimated error variance in a regression model</li>
</ul>
<p>Here we repeat an assignment from above, using <code>list()</code> instead of <code>c()</code> to combine things and you’ll notice that the different flavors of the constituent parts are retained this time.</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="#cb219-1"></a><span class="co">## earlier: a &lt;- c(&quot;cabbage&quot;, pi, TRUE, 4.3)</span></span>
<span id="cb219-2"><a href="#cb219-2"></a>(a &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="st">&quot;cabbage&quot;</span>, pi, <span class="ot">TRUE</span>, <span class="fl">4.3</span>))</span>
<span id="cb219-3"><a href="#cb219-3"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb219-4"><a href="#cb219-4"></a><span class="co">#&gt; [1] &quot;cabbage&quot;</span></span>
<span id="cb219-5"><a href="#cb219-5"></a><span class="co">#&gt; </span></span>
<span id="cb219-6"><a href="#cb219-6"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb219-7"><a href="#cb219-7"></a><span class="co">#&gt; [1] 3.14</span></span>
<span id="cb219-8"><a href="#cb219-8"></a><span class="co">#&gt; </span></span>
<span id="cb219-9"><a href="#cb219-9"></a><span class="co">#&gt; [[3]]</span></span>
<span id="cb219-10"><a href="#cb219-10"></a><span class="co">#&gt; [1] TRUE</span></span>
<span id="cb219-11"><a href="#cb219-11"></a><span class="co">#&gt; </span></span>
<span id="cb219-12"><a href="#cb219-12"></a><span class="co">#&gt; [[4]]</span></span>
<span id="cb219-13"><a href="#cb219-13"></a><span class="co">#&gt; [1] 4.3</span></span>
<span id="cb219-14"><a href="#cb219-14"></a><span class="kw">str</span>(a)</span>
<span id="cb219-15"><a href="#cb219-15"></a><span class="co">#&gt; List of 4</span></span>
<span id="cb219-16"><a href="#cb219-16"></a><span class="co">#&gt;  $ : chr &quot;cabbage&quot;</span></span>
<span id="cb219-17"><a href="#cb219-17"></a><span class="co">#&gt;  $ : num 3.14</span></span>
<span id="cb219-18"><a href="#cb219-18"></a><span class="co">#&gt;  $ : logi TRUE</span></span>
<span id="cb219-19"><a href="#cb219-19"></a><span class="co">#&gt;  $ : num 4.3</span></span>
<span id="cb219-20"><a href="#cb219-20"></a><span class="kw">length</span>(a)</span>
<span id="cb219-21"><a href="#cb219-21"></a><span class="co">#&gt; [1] 4</span></span>
<span id="cb219-22"><a href="#cb219-22"></a><span class="kw">mode</span>(a)</span>
<span id="cb219-23"><a href="#cb219-23"></a><span class="co">#&gt; [1] &quot;list&quot;</span></span>
<span id="cb219-24"><a href="#cb219-24"></a><span class="kw">class</span>(a)</span>
<span id="cb219-25"><a href="#cb219-25"></a><span class="co">#&gt; [1] &quot;list&quot;</span></span></code></pre></div>
<p>List components can also have names. You can create or change names after a list already exists or this can be integrated into the initial assignment.</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="#cb220-1"></a><span class="kw">names</span>(a)</span>
<span id="cb220-2"><a href="#cb220-2"></a><span class="co">#&gt; NULL</span></span>
<span id="cb220-3"><a href="#cb220-3"></a><span class="kw">names</span>(a) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;veg&quot;</span>, <span class="st">&quot;dessert&quot;</span>, <span class="st">&quot;myAim&quot;</span>, <span class="st">&quot;number&quot;</span>)</span>
<span id="cb220-4"><a href="#cb220-4"></a>a</span>
<span id="cb220-5"><a href="#cb220-5"></a><span class="co">#&gt; $veg</span></span>
<span id="cb220-6"><a href="#cb220-6"></a><span class="co">#&gt; [1] &quot;cabbage&quot;</span></span>
<span id="cb220-7"><a href="#cb220-7"></a><span class="co">#&gt; </span></span>
<span id="cb220-8"><a href="#cb220-8"></a><span class="co">#&gt; $dessert</span></span>
<span id="cb220-9"><a href="#cb220-9"></a><span class="co">#&gt; [1] 3.14</span></span>
<span id="cb220-10"><a href="#cb220-10"></a><span class="co">#&gt; </span></span>
<span id="cb220-11"><a href="#cb220-11"></a><span class="co">#&gt; $myAim</span></span>
<span id="cb220-12"><a href="#cb220-12"></a><span class="co">#&gt; [1] TRUE</span></span>
<span id="cb220-13"><a href="#cb220-13"></a><span class="co">#&gt; </span></span>
<span id="cb220-14"><a href="#cb220-14"></a><span class="co">#&gt; $number</span></span>
<span id="cb220-15"><a href="#cb220-15"></a><span class="co">#&gt; [1] 4.3</span></span>
<span id="cb220-16"><a href="#cb220-16"></a>a &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">veg =</span> <span class="st">&quot;cabbage&quot;</span>, <span class="dt">dessert =</span> pi, <span class="dt">myAim =</span> <span class="ot">TRUE</span>, <span class="dt">number =</span> <span class="fl">4.3</span>)</span>
<span id="cb220-17"><a href="#cb220-17"></a><span class="kw">names</span>(a)</span>
<span id="cb220-18"><a href="#cb220-18"></a><span class="co">#&gt; [1] &quot;veg&quot;     &quot;dessert&quot; &quot;myAim&quot;   &quot;number&quot;</span></span></code></pre></div>
<p>Indexing a list is similar to indexing a vector but it is necessarily more complex. The fundamental issue is this: if you request a single element from the list, do you want a list of length 1 containing only that element or do you want the element itself? For the former (desired return value is a list), we use single square brackets, <code>[</code> and <code>]</code>, just like indexing a vector. For the latter (desired return value is a single element), we use a dollar sign <code>$</code>, which you’ve already used to get one variable from a data.frame, or double square brackets, <code>[[</code> and <code>]]</code>.</p>
<p>The <a href="https://r4ds.had.co.nz/vectors.html#lists-of-condiments">“pepper shaker photos” in R for Data Science</a> are a splendid visual explanation of the different ways to get stuff out of a list. Highly recommended.</p>
<blockquote>
<p>Warning: the rest of this section might make your eyes glaze over. Skip to the next section if you need to; come back later when some list is ruining your day.</p>
</blockquote>
<p>A slightly more complicated list will make our demos more educational. Now we really see that the elements can differ in flavor and length.</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="#cb221-1"></a>(a &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">veg =</span> <span class="kw">c</span>(<span class="st">&quot;cabbage&quot;</span>, <span class="st">&quot;eggplant&quot;</span>),</span>
<span id="cb221-2"><a href="#cb221-2"></a>           <span class="dt">tNum =</span> <span class="kw">c</span>(pi, <span class="kw">exp</span>(<span class="dv">1</span>), <span class="kw">sqrt</span>(<span class="dv">2</span>)),</span>
<span id="cb221-3"><a href="#cb221-3"></a>           <span class="dt">myAim =</span> <span class="ot">TRUE</span>,</span>
<span id="cb221-4"><a href="#cb221-4"></a>           <span class="dt">joeNum =</span> <span class="dv">2</span><span class="op">:</span><span class="dv">6</span>))</span>
<span id="cb221-5"><a href="#cb221-5"></a><span class="co">#&gt; $veg</span></span>
<span id="cb221-6"><a href="#cb221-6"></a><span class="co">#&gt; [1] &quot;cabbage&quot;  &quot;eggplant&quot;</span></span>
<span id="cb221-7"><a href="#cb221-7"></a><span class="co">#&gt; </span></span>
<span id="cb221-8"><a href="#cb221-8"></a><span class="co">#&gt; $tNum</span></span>
<span id="cb221-9"><a href="#cb221-9"></a><span class="co">#&gt; [1] 3.14 2.72 1.41</span></span>
<span id="cb221-10"><a href="#cb221-10"></a><span class="co">#&gt; </span></span>
<span id="cb221-11"><a href="#cb221-11"></a><span class="co">#&gt; $myAim</span></span>
<span id="cb221-12"><a href="#cb221-12"></a><span class="co">#&gt; [1] TRUE</span></span>
<span id="cb221-13"><a href="#cb221-13"></a><span class="co">#&gt; </span></span>
<span id="cb221-14"><a href="#cb221-14"></a><span class="co">#&gt; $joeNum</span></span>
<span id="cb221-15"><a href="#cb221-15"></a><span class="co">#&gt; [1] 2 3 4 5 6</span></span>
<span id="cb221-16"><a href="#cb221-16"></a><span class="kw">str</span>(a)</span>
<span id="cb221-17"><a href="#cb221-17"></a><span class="co">#&gt; List of 4</span></span>
<span id="cb221-18"><a href="#cb221-18"></a><span class="co">#&gt;  $ veg   : chr [1:2] &quot;cabbage&quot; &quot;eggplant&quot;</span></span>
<span id="cb221-19"><a href="#cb221-19"></a><span class="co">#&gt;  $ tNum  : num [1:3] 3.14 2.72 1.41</span></span>
<span id="cb221-20"><a href="#cb221-20"></a><span class="co">#&gt;  $ myAim : logi TRUE</span></span>
<span id="cb221-21"><a href="#cb221-21"></a><span class="co">#&gt;  $ joeNum: int [1:5] 2 3 4 5 6</span></span>
<span id="cb221-22"><a href="#cb221-22"></a><span class="kw">length</span>(a)</span>
<span id="cb221-23"><a href="#cb221-23"></a><span class="co">#&gt; [1] 4</span></span>
<span id="cb221-24"><a href="#cb221-24"></a><span class="kw">class</span>(a)</span>
<span id="cb221-25"><a href="#cb221-25"></a><span class="co">#&gt; [1] &quot;list&quot;</span></span>
<span id="cb221-26"><a href="#cb221-26"></a><span class="kw">mode</span>(a)</span>
<span id="cb221-27"><a href="#cb221-27"></a><span class="co">#&gt; [1] &quot;list&quot;</span></span></code></pre></div>
<p>Here’s are ways to get a single list element:</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="#cb222-1"></a>a[[<span class="dv">2</span>]] <span class="co"># index with a positive integer</span></span>
<span id="cb222-2"><a href="#cb222-2"></a><span class="co">#&gt; [1] 3.14 2.72 1.41</span></span>
<span id="cb222-3"><a href="#cb222-3"></a>a<span class="op">$</span>myAim <span class="co"># use dollar sign and element name</span></span>
<span id="cb222-4"><a href="#cb222-4"></a><span class="co">#&gt; [1] TRUE</span></span>
<span id="cb222-5"><a href="#cb222-5"></a><span class="kw">str</span>(a<span class="op">$</span>myAim) <span class="co"># we get myAim itself, a length 1 logical vector</span></span>
<span id="cb222-6"><a href="#cb222-6"></a><span class="co">#&gt;  logi TRUE</span></span>
<span id="cb222-7"><a href="#cb222-7"></a>a[[<span class="st">&quot;tNum&quot;</span>]] <span class="co"># index with length 1 character vector </span></span>
<span id="cb222-8"><a href="#cb222-8"></a><span class="co">#&gt; [1] 3.14 2.72 1.41</span></span>
<span id="cb222-9"><a href="#cb222-9"></a><span class="kw">str</span>(a[[<span class="st">&quot;tNum&quot;</span>]]) <span class="co"># we get tNum itself, a length 3 numeric vector</span></span>
<span id="cb222-10"><a href="#cb222-10"></a><span class="co">#&gt;  num [1:3] 3.14 2.72 1.41</span></span>
<span id="cb222-11"><a href="#cb222-11"></a>iWantThis &lt;-<span class="st"> &quot;joeNum&quot;</span> <span class="co"># indexing with length 1 character object</span></span>
<span id="cb222-12"><a href="#cb222-12"></a>a[[iWantThis]] <span class="co"># we get joeNum itself, a length 5 integer vector</span></span>
<span id="cb222-13"><a href="#cb222-13"></a><span class="co">#&gt; [1] 2 3 4 5 6</span></span>
<span id="cb222-14"><a href="#cb222-14"></a>a[[<span class="kw">c</span>(<span class="st">&quot;joeNum&quot;</span>, <span class="st">&quot;veg&quot;</span>)]] <span class="co"># does not work! can&#39;t get &gt; 1 elements! see below</span></span>
<span id="cb222-15"><a href="#cb222-15"></a><span class="co">#&gt; Error in a[[c(&quot;joeNum&quot;, &quot;veg&quot;)]]: subscript out of bounds</span></span></code></pre></div>
<p>A case when one must use the double bracket approach, as opposed to the dollar sign, is when the indexing object itself is an R object; we show that above.</p>
<p>What if you want more than one element? You must index vector-style with single square brackets. Note that the return value will always be a list, unlike the return value from double square brackets, even if you only request 1 element.</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="#cb223-1"></a><span class="kw">names</span>(a)</span>
<span id="cb223-2"><a href="#cb223-2"></a><span class="co">#&gt; [1] &quot;veg&quot;    &quot;tNum&quot;   &quot;myAim&quot;  &quot;joeNum&quot;</span></span>
<span id="cb223-3"><a href="#cb223-3"></a>a[<span class="kw">c</span>(<span class="st">&quot;tNum&quot;</span>, <span class="st">&quot;veg&quot;</span>)] <span class="co"># indexing by length 2 character vector</span></span>
<span id="cb223-4"><a href="#cb223-4"></a><span class="co">#&gt; $tNum</span></span>
<span id="cb223-5"><a href="#cb223-5"></a><span class="co">#&gt; [1] 3.14 2.72 1.41</span></span>
<span id="cb223-6"><a href="#cb223-6"></a><span class="co">#&gt; </span></span>
<span id="cb223-7"><a href="#cb223-7"></a><span class="co">#&gt; $veg</span></span>
<span id="cb223-8"><a href="#cb223-8"></a><span class="co">#&gt; [1] &quot;cabbage&quot;  &quot;eggplant&quot;</span></span>
<span id="cb223-9"><a href="#cb223-9"></a><span class="kw">str</span>(a[<span class="kw">c</span>(<span class="st">&quot;tNum&quot;</span>, <span class="st">&quot;veg&quot;</span>)]) <span class="co"># returns list of length 2</span></span>
<span id="cb223-10"><a href="#cb223-10"></a><span class="co">#&gt; List of 2</span></span>
<span id="cb223-11"><a href="#cb223-11"></a><span class="co">#&gt;  $ tNum: num [1:3] 3.14 2.72 1.41</span></span>
<span id="cb223-12"><a href="#cb223-12"></a><span class="co">#&gt;  $ veg : chr [1:2] &quot;cabbage&quot; &quot;eggplant&quot;</span></span>
<span id="cb223-13"><a href="#cb223-13"></a>a[<span class="st">&quot;veg&quot;</span>] <span class="co"># indexing by length 1 character vector</span></span>
<span id="cb223-14"><a href="#cb223-14"></a><span class="co">#&gt; $veg</span></span>
<span id="cb223-15"><a href="#cb223-15"></a><span class="co">#&gt; [1] &quot;cabbage&quot;  &quot;eggplant&quot;</span></span>
<span id="cb223-16"><a href="#cb223-16"></a><span class="kw">str</span>(a[<span class="st">&quot;veg&quot;</span>])<span class="co"># returns list of length 1</span></span>
<span id="cb223-17"><a href="#cb223-17"></a><span class="co">#&gt; List of 1</span></span>
<span id="cb223-18"><a href="#cb223-18"></a><span class="co">#&gt;  $ veg: chr [1:2] &quot;cabbage&quot; &quot;eggplant&quot;</span></span>
<span id="cb223-19"><a href="#cb223-19"></a><span class="kw">length</span>(a[<span class="st">&quot;veg&quot;</span>]) <span class="co"># really, it does!</span></span>
<span id="cb223-20"><a href="#cb223-20"></a><span class="co">#&gt; [1] 1</span></span>
<span id="cb223-21"><a href="#cb223-21"></a><span class="kw">length</span>(a[<span class="st">&quot;veg&quot;</span>][[<span class="dv">1</span>]]) <span class="co"># contrast with length of the veg vector itself</span></span>
<span id="cb223-22"><a href="#cb223-22"></a><span class="co">#&gt; [1] 2</span></span></code></pre></div>
</div>
<div id="creating-a-data.frame-explicitly" class="section level2">
<h2><span class="header-section-number">17.4</span> Creating a data.frame explicitly</h2>
<p>In data analysis, we often import data into data.frame via <code>read.table()</code>. But one can also construct a data.frame directly using <code>data.frame()</code>.</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="#cb224-1"></a>n &lt;-<span class="st"> </span><span class="dv">8</span></span>
<span id="cb224-2"><a href="#cb224-2"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb224-3"><a href="#cb224-3"></a>(jDat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">w =</span> <span class="kw">round</span>(<span class="kw">rnorm</span>(n), <span class="dv">2</span>),</span>
<span id="cb224-4"><a href="#cb224-4"></a>                    <span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span>n,</span>
<span id="cb224-5"><a href="#cb224-5"></a>                    <span class="dt">y =</span> <span class="kw">I</span>(LETTERS[<span class="dv">1</span><span class="op">:</span>n]),</span>
<span id="cb224-6"><a href="#cb224-6"></a>                    <span class="dt">z =</span> <span class="kw">runif</span>(n) <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.3</span>,</span>
<span id="cb224-7"><a href="#cb224-7"></a>                    <span class="dt">v =</span> <span class="kw">rep</span>(LETTERS[<span class="dv">9</span><span class="op">:</span><span class="dv">12</span>], <span class="dt">each =</span> <span class="dv">2</span>)))</span>
<span id="cb224-8"><a href="#cb224-8"></a><span class="co">#&gt;       w x y     z v</span></span>
<span id="cb224-9"><a href="#cb224-9"></a><span class="co">#&gt; 1 -0.63 1 A  TRUE I</span></span>
<span id="cb224-10"><a href="#cb224-10"></a><span class="co">#&gt; 2  0.18 2 B  TRUE I</span></span>
<span id="cb224-11"><a href="#cb224-11"></a><span class="co">#&gt; 3 -0.84 3 C  TRUE J</span></span>
<span id="cb224-12"><a href="#cb224-12"></a><span class="co">#&gt; 4  1.60 4 D  TRUE J</span></span>
<span id="cb224-13"><a href="#cb224-13"></a><span class="co">#&gt; 5  0.33 5 E  TRUE K</span></span>
<span id="cb224-14"><a href="#cb224-14"></a><span class="co">#&gt; 6 -0.82 6 F FALSE K</span></span>
<span id="cb224-15"><a href="#cb224-15"></a><span class="co">#&gt; 7  0.49 7 G  TRUE L</span></span>
<span id="cb224-16"><a href="#cb224-16"></a><span class="co">#&gt; 8  0.74 8 H FALSE L</span></span>
<span id="cb224-17"><a href="#cb224-17"></a><span class="kw">str</span>(jDat)</span>
<span id="cb224-18"><a href="#cb224-18"></a><span class="co">#&gt; &#39;data.frame&#39;:    8 obs. of  5 variables:</span></span>
<span id="cb224-19"><a href="#cb224-19"></a><span class="co">#&gt;  $ w: num  -0.63 0.18 -0.84 1.6 0.33 -0.82 0.49 0.74</span></span>
<span id="cb224-20"><a href="#cb224-20"></a><span class="co">#&gt;  $ x: int  1 2 3 4 5 6 7 8</span></span>
<span id="cb224-21"><a href="#cb224-21"></a><span class="co">#&gt;  $ y: &#39;AsIs&#39; chr  &quot;A&quot; &quot;B&quot; &quot;C&quot; &quot;D&quot; ...</span></span>
<span id="cb224-22"><a href="#cb224-22"></a><span class="co">#&gt;  $ z: logi  TRUE TRUE TRUE TRUE TRUE FALSE ...</span></span>
<span id="cb224-23"><a href="#cb224-23"></a><span class="co">#&gt;  $ v: chr  &quot;I&quot; &quot;I&quot; &quot;J&quot; &quot;J&quot; ...</span></span>
<span id="cb224-24"><a href="#cb224-24"></a><span class="kw">mode</span>(jDat)</span>
<span id="cb224-25"><a href="#cb224-25"></a><span class="co">#&gt; [1] &quot;list&quot;</span></span>
<span id="cb224-26"><a href="#cb224-26"></a><span class="kw">class</span>(jDat)</span>
<span id="cb224-27"><a href="#cb224-27"></a><span class="co">#&gt; [1] &quot;data.frame&quot;</span></span></code></pre></div>
<blockquote>
<p>Sidebar: What is <code>I()</code>, used when creating the variable <span class="math inline">\(y\)</span> in the above data.frame? Short version: it tells R to do something <em>quite literally</em>. Here we are protecting the letters from being coerced to factor. We are ensuring we get a character vector. Note we let character-to-factor conversion happen in creating the <span class="math inline">\(v\)</span> variable above. More about (foiling) R’s determination to convert character data to factor can be found <a href="#factors-boss">here</a>.</p>
</blockquote>
<p>data.frames really are lists! Double square brackets can be used to get individual variables. Single square brackets can be used to get one or more variables, returned as a data.frame (though <code>subset(..., select = ...))</code> is how I would more likely do in a data analysis).</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="#cb225-1"></a><span class="kw">is.list</span>(jDat) <span class="co"># data.frames are lists</span></span>
<span id="cb225-2"><a href="#cb225-2"></a><span class="co">#&gt; [1] TRUE</span></span>
<span id="cb225-3"><a href="#cb225-3"></a>jDat[[<span class="dv">5</span>]] <span class="co"># this works but I prefer ...</span></span>
<span id="cb225-4"><a href="#cb225-4"></a><span class="co">#&gt; [1] &quot;I&quot; &quot;I&quot; &quot;J&quot; &quot;J&quot; &quot;K&quot; &quot;K&quot; &quot;L&quot; &quot;L&quot;</span></span>
<span id="cb225-5"><a href="#cb225-5"></a>jDat<span class="op">$</span>v <span class="co"># using dollar sign and name, when possible</span></span>
<span id="cb225-6"><a href="#cb225-6"></a><span class="co">#&gt; [1] &quot;I&quot; &quot;I&quot; &quot;J&quot; &quot;J&quot; &quot;K&quot; &quot;K&quot; &quot;L&quot; &quot;L&quot;</span></span>
<span id="cb225-7"><a href="#cb225-7"></a>jDat[<span class="kw">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;z&quot;</span>)] <span class="co"># get multiple variables</span></span>
<span id="cb225-8"><a href="#cb225-8"></a><span class="co">#&gt;   x     z</span></span>
<span id="cb225-9"><a href="#cb225-9"></a><span class="co">#&gt; 1 1  TRUE</span></span>
<span id="cb225-10"><a href="#cb225-10"></a><span class="co">#&gt; 2 2  TRUE</span></span>
<span id="cb225-11"><a href="#cb225-11"></a><span class="co">#&gt; 3 3  TRUE</span></span>
<span id="cb225-12"><a href="#cb225-12"></a><span class="co">#&gt; 4 4  TRUE</span></span>
<span id="cb225-13"><a href="#cb225-13"></a><span class="co">#&gt; 5 5  TRUE</span></span>
<span id="cb225-14"><a href="#cb225-14"></a><span class="co">#&gt; 6 6 FALSE</span></span>
<span id="cb225-15"><a href="#cb225-15"></a><span class="co">#&gt; 7 7  TRUE</span></span>
<span id="cb225-16"><a href="#cb225-16"></a><span class="co">#&gt; 8 8 FALSE</span></span>
<span id="cb225-17"><a href="#cb225-17"></a><span class="kw">str</span>(jDat[<span class="kw">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;z&quot;</span>)]) <span class="co"># returns a data.frame</span></span>
<span id="cb225-18"><a href="#cb225-18"></a><span class="co">#&gt; &#39;data.frame&#39;:    8 obs. of  2 variables:</span></span>
<span id="cb225-19"><a href="#cb225-19"></a><span class="co">#&gt;  $ x: int  1 2 3 4 5 6 7 8</span></span>
<span id="cb225-20"><a href="#cb225-20"></a><span class="co">#&gt;  $ z: logi  TRUE TRUE TRUE TRUE TRUE FALSE ...</span></span>
<span id="cb225-21"><a href="#cb225-21"></a><span class="kw">identical</span>(<span class="kw">subset</span>(jDat, <span class="dt">select =</span> <span class="kw">c</span>(x, z)), jDat[<span class="kw">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;z&quot;</span>)])</span>
<span id="cb225-22"><a href="#cb225-22"></a><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<blockquote>
<p>Question: How do I make a data.frame from a list? It is an absolute requirement that the constituent vectors have the same length, although they can be of different flavors. Assuming you meet that requirement, use <code>as.data.frame()</code> to convert.</p>
</blockquote>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="#cb226-1"></a><span class="co">## note difference in the printing of a list vs. a data.frame</span></span>
<span id="cb226-2"><a href="#cb226-2"></a>(qDat &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">w =</span> <span class="kw">round</span>(<span class="kw">rnorm</span>(n), <span class="dv">2</span>),</span>
<span id="cb226-3"><a href="#cb226-3"></a>              <span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span>(n<span class="dv">-1</span>), <span class="co">## &lt;-- LOOK HERE! I MADE THIS VECTOR SHORTER!</span></span>
<span id="cb226-4"><a href="#cb226-4"></a>              <span class="dt">y =</span> <span class="kw">I</span>(LETTERS[<span class="dv">1</span><span class="op">:</span>n])))</span>
<span id="cb226-5"><a href="#cb226-5"></a><span class="co">#&gt; $w</span></span>
<span id="cb226-6"><a href="#cb226-6"></a><span class="co">#&gt; [1] -0.62 -2.21  1.12 -0.04 -0.02  0.94  0.82  0.59</span></span>
<span id="cb226-7"><a href="#cb226-7"></a><span class="co">#&gt; </span></span>
<span id="cb226-8"><a href="#cb226-8"></a><span class="co">#&gt; $x</span></span>
<span id="cb226-9"><a href="#cb226-9"></a><span class="co">#&gt; [1] 1 2 3 4 5 6 7</span></span>
<span id="cb226-10"><a href="#cb226-10"></a><span class="co">#&gt; </span></span>
<span id="cb226-11"><a href="#cb226-11"></a><span class="co">#&gt; $y</span></span>
<span id="cb226-12"><a href="#cb226-12"></a><span class="co">#&gt; [1] &quot;A&quot; &quot;B&quot; &quot;C&quot; &quot;D&quot; &quot;E&quot; &quot;F&quot; &quot;G&quot; &quot;H&quot;</span></span>
<span id="cb226-13"><a href="#cb226-13"></a><span class="kw">as.data.frame</span>(qDat) <span class="co">## does not work! elements don&#39;t have same length!</span></span>
<span id="cb226-14"><a href="#cb226-14"></a><span class="co">#&gt; Error in (function (..., row.names = NULL, check.rows = FALSE, check.names = TRUE, : arguments imply differing number of rows: 8, 7</span></span>
<span id="cb226-15"><a href="#cb226-15"></a>qDat<span class="op">$</span>x &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span>n <span class="co">## fix the short variable x</span></span>
<span id="cb226-16"><a href="#cb226-16"></a>(qDat &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(qDat)) <span class="co">## we&#39;re back in business</span></span>
<span id="cb226-17"><a href="#cb226-17"></a><span class="co">#&gt;       w x y</span></span>
<span id="cb226-18"><a href="#cb226-18"></a><span class="co">#&gt; 1 -0.62 1 A</span></span>
<span id="cb226-19"><a href="#cb226-19"></a><span class="co">#&gt; 2 -2.21 2 B</span></span>
<span id="cb226-20"><a href="#cb226-20"></a><span class="co">#&gt; 3  1.12 3 C</span></span>
<span id="cb226-21"><a href="#cb226-21"></a><span class="co">#&gt; 4 -0.04 4 D</span></span>
<span id="cb226-22"><a href="#cb226-22"></a><span class="co">#&gt; 5 -0.02 5 E</span></span>
<span id="cb226-23"><a href="#cb226-23"></a><span class="co">#&gt; 6  0.94 6 F</span></span>
<span id="cb226-24"><a href="#cb226-24"></a><span class="co">#&gt; 7  0.82 7 G</span></span>
<span id="cb226-25"><a href="#cb226-25"></a><span class="co">#&gt; 8  0.59 8 H</span></span></code></pre></div>
<p>You will encounter weirder situations in which you want to make a data.frame out of a list and there are many tricks. Ask me and we’ll beef up this section.</p>
</div>
<div id="indexing-arrays-e.g.-matrices" class="section level2">
<h2><span class="header-section-number">17.5</span> Indexing arrays, e.g. matrices</h2>
<p>Though data.frames are recommended as the default receptacle for rectangular data, there are times when one will store rectangular data as a matrix instead. A matrix is a generalization of an atomic vector and the requirement that all the elements be of the same flavor still holds. General arrays are available in R, where a matrix is an important special case having dimension 2.</p>
<p>Let’s make a simple matrix and give it decent row and column names, which we know is a good practice. You’ll see familiar or self-explanatory functions below for getting to know a matrix.</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="#cb227-1"></a><span class="co">## don&#39;t worry if the construction of this matrix confuses you; just focus on</span></span>
<span id="cb227-2"><a href="#cb227-2"></a><span class="co">## the product</span></span>
<span id="cb227-3"><a href="#cb227-3"></a>jMat &lt;-<span class="st"> </span><span class="kw">outer</span>(<span class="kw">as.character</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>), <span class="kw">as.character</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>),</span>
<span id="cb227-4"><a href="#cb227-4"></a>              <span class="cf">function</span>(x, y) {</span>
<span id="cb227-5"><a href="#cb227-5"></a>                <span class="kw">paste0</span>(<span class="st">&#39;x&#39;</span>, x, y)</span>
<span id="cb227-6"><a href="#cb227-6"></a>                })</span>
<span id="cb227-7"><a href="#cb227-7"></a>jMat</span>
<span id="cb227-8"><a href="#cb227-8"></a><span class="co">#&gt;      [,1]  [,2]  [,3]  [,4] </span></span>
<span id="cb227-9"><a href="#cb227-9"></a><span class="co">#&gt; [1,] &quot;x11&quot; &quot;x12&quot; &quot;x13&quot; &quot;x14&quot;</span></span>
<span id="cb227-10"><a href="#cb227-10"></a><span class="co">#&gt; [2,] &quot;x21&quot; &quot;x22&quot; &quot;x23&quot; &quot;x24&quot;</span></span>
<span id="cb227-11"><a href="#cb227-11"></a><span class="co">#&gt; [3,] &quot;x31&quot; &quot;x32&quot; &quot;x33&quot; &quot;x34&quot;</span></span>
<span id="cb227-12"><a href="#cb227-12"></a><span class="co">#&gt; [4,] &quot;x41&quot; &quot;x42&quot; &quot;x43&quot; &quot;x44&quot;</span></span>
<span id="cb227-13"><a href="#cb227-13"></a><span class="kw">str</span>(jMat)</span>
<span id="cb227-14"><a href="#cb227-14"></a><span class="co">#&gt;  chr [1:4, 1:4] &quot;x11&quot; &quot;x21&quot; &quot;x31&quot; &quot;x41&quot; ...</span></span>
<span id="cb227-15"><a href="#cb227-15"></a><span class="kw">class</span>(jMat)</span>
<span id="cb227-16"><a href="#cb227-16"></a><span class="co">#&gt; [1] &quot;matrix&quot; &quot;array&quot;</span></span>
<span id="cb227-17"><a href="#cb227-17"></a><span class="kw">mode</span>(jMat)</span>
<span id="cb227-18"><a href="#cb227-18"></a><span class="co">#&gt; [1] &quot;character&quot;</span></span>
<span id="cb227-19"><a href="#cb227-19"></a><span class="kw">dim</span>(jMat)</span>
<span id="cb227-20"><a href="#cb227-20"></a><span class="co">#&gt; [1] 4 4</span></span>
<span id="cb227-21"><a href="#cb227-21"></a><span class="kw">nrow</span>(jMat)</span>
<span id="cb227-22"><a href="#cb227-22"></a><span class="co">#&gt; [1] 4</span></span>
<span id="cb227-23"><a href="#cb227-23"></a><span class="kw">ncol</span>(jMat)</span>
<span id="cb227-24"><a href="#cb227-24"></a><span class="co">#&gt; [1] 4</span></span>
<span id="cb227-25"><a href="#cb227-25"></a><span class="kw">rownames</span>(jMat)</span>
<span id="cb227-26"><a href="#cb227-26"></a><span class="co">#&gt; NULL</span></span>
<span id="cb227-27"><a href="#cb227-27"></a><span class="kw">rownames</span>(jMat) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;row&quot;</span>, <span class="kw">seq_len</span>(<span class="kw">nrow</span>(jMat)))</span>
<span id="cb227-28"><a href="#cb227-28"></a><span class="kw">colnames</span>(jMat) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;col&quot;</span>, <span class="kw">seq_len</span>(<span class="kw">ncol</span>(jMat)))</span>
<span id="cb227-29"><a href="#cb227-29"></a><span class="kw">dimnames</span>(jMat) <span class="co"># also useful for assignment</span></span>
<span id="cb227-30"><a href="#cb227-30"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb227-31"><a href="#cb227-31"></a><span class="co">#&gt; [1] &quot;row1&quot; &quot;row2&quot; &quot;row3&quot; &quot;row4&quot;</span></span>
<span id="cb227-32"><a href="#cb227-32"></a><span class="co">#&gt; </span></span>
<span id="cb227-33"><a href="#cb227-33"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb227-34"><a href="#cb227-34"></a><span class="co">#&gt; [1] &quot;col1&quot; &quot;col2&quot; &quot;col3&quot; &quot;col4&quot;</span></span>
<span id="cb227-35"><a href="#cb227-35"></a>jMat</span>
<span id="cb227-36"><a href="#cb227-36"></a><span class="co">#&gt;      col1  col2  col3  col4 </span></span>
<span id="cb227-37"><a href="#cb227-37"></a><span class="co">#&gt; row1 &quot;x11&quot; &quot;x12&quot; &quot;x13&quot; &quot;x14&quot;</span></span>
<span id="cb227-38"><a href="#cb227-38"></a><span class="co">#&gt; row2 &quot;x21&quot; &quot;x22&quot; &quot;x23&quot; &quot;x24&quot;</span></span>
<span id="cb227-39"><a href="#cb227-39"></a><span class="co">#&gt; row3 &quot;x31&quot; &quot;x32&quot; &quot;x33&quot; &quot;x34&quot;</span></span>
<span id="cb227-40"><a href="#cb227-40"></a><span class="co">#&gt; row4 &quot;x41&quot; &quot;x42&quot; &quot;x43&quot; &quot;x44&quot;</span></span></code></pre></div>
<p>Indexing a matrix is very similar to indexing a vector or a list: use square brackets and index with logical, integer numeric (positive or negative), or character vectors. Combine those approaches if you like! The main new wrinkle is the use of a comma <code>,</code> to distinguish rows and columns. The <span class="math inline">\(i,j\)</span>-th element is the element at the intersection of row <span class="math inline">\(i\)</span> and column <span class="math inline">\(j\)</span> and is obtained with <code>jMat[i, j]</code>. Request an entire row or an entire column by simply leaving the associated index empty. The <code>drop =</code> argument controls whether the return value should be an atomic vector (<code>drop = TRUE</code>) or a matrix with a single row or column (<code>drop = FALSE</code>). Notice how row and column names persist and can help you stay oriented.</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1"></a>jMat[<span class="dv">2</span>, <span class="dv">3</span>]</span>
<span id="cb228-2"><a href="#cb228-2"></a><span class="co">#&gt; [1] &quot;x23&quot;</span></span>
<span id="cb228-3"><a href="#cb228-3"></a>jMat[<span class="dv">2</span>, ] <span class="co"># getting row 2</span></span>
<span id="cb228-4"><a href="#cb228-4"></a><span class="co">#&gt;  col1  col2  col3  col4 </span></span>
<span id="cb228-5"><a href="#cb228-5"></a><span class="co">#&gt; &quot;x21&quot; &quot;x22&quot; &quot;x23&quot; &quot;x24&quot;</span></span>
<span id="cb228-6"><a href="#cb228-6"></a><span class="kw">is.vector</span>(jMat[<span class="dv">2</span>, ]) <span class="co"># we get row 2 as an atomic vector</span></span>
<span id="cb228-7"><a href="#cb228-7"></a><span class="co">#&gt; [1] TRUE</span></span>
<span id="cb228-8"><a href="#cb228-8"></a>jMat[ , <span class="dv">3</span>, drop =<span class="st"> </span><span class="ot">FALSE</span>] <span class="co"># getting column 3</span></span>
<span id="cb228-9"><a href="#cb228-9"></a><span class="co">#&gt;      col3 </span></span>
<span id="cb228-10"><a href="#cb228-10"></a><span class="co">#&gt; row1 &quot;x13&quot;</span></span>
<span id="cb228-11"><a href="#cb228-11"></a><span class="co">#&gt; row2 &quot;x23&quot;</span></span>
<span id="cb228-12"><a href="#cb228-12"></a><span class="co">#&gt; row3 &quot;x33&quot;</span></span>
<span id="cb228-13"><a href="#cb228-13"></a><span class="co">#&gt; row4 &quot;x43&quot;</span></span>
<span id="cb228-14"><a href="#cb228-14"></a><span class="kw">dim</span>(jMat[ , <span class="dv">3</span>, <span class="dt">drop =</span> <span class="ot">FALSE</span>]) <span class="co"># we get column 3 as a 4 x 1 matrix</span></span>
<span id="cb228-15"><a href="#cb228-15"></a><span class="co">#&gt; [1] 4 1</span></span>
<span id="cb228-16"><a href="#cb228-16"></a>jMat[<span class="kw">c</span>(<span class="st">&quot;row1&quot;</span>, <span class="st">&quot;row4&quot;</span>), <span class="kw">c</span>(<span class="st">&quot;col2&quot;</span>, <span class="st">&quot;col3&quot;</span>)]</span>
<span id="cb228-17"><a href="#cb228-17"></a><span class="co">#&gt;      col2  col3 </span></span>
<span id="cb228-18"><a href="#cb228-18"></a><span class="co">#&gt; row1 &quot;x12&quot; &quot;x13&quot;</span></span>
<span id="cb228-19"><a href="#cb228-19"></a><span class="co">#&gt; row4 &quot;x42&quot; &quot;x43&quot;</span></span>
<span id="cb228-20"><a href="#cb228-20"></a>jMat[<span class="op">-</span><span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">3</span>), <span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="ot">FALSE</span>)] <span class="co"># wacky but possible</span></span>
<span id="cb228-21"><a href="#cb228-21"></a><span class="co">#&gt;      col1  col2 </span></span>
<span id="cb228-22"><a href="#cb228-22"></a><span class="co">#&gt; row1 &quot;x11&quot; &quot;x12&quot;</span></span>
<span id="cb228-23"><a href="#cb228-23"></a><span class="co">#&gt; row4 &quot;x41&quot; &quot;x42&quot;</span></span></code></pre></div>
<p>Under the hood, of course, matrices are just vectors with some extra facilities for indexing. R is a <a href="https://en.wikipedia.org/wiki/Row-_and_column-major_order">column-major order</a> language, in contrast to C and Python which use row-major order. What this means is that in the underlying vector storage of a matrix, the columns are stacked up one after the other. Matrices can be indexed <em>exactly</em> like a vector, i.e. with no comma <span class="math inline">\(i,j\)</span> business, like so:</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="#cb229-1"></a>jMat[<span class="dv">7</span>]</span>
<span id="cb229-2"><a href="#cb229-2"></a><span class="co">#&gt; [1] &quot;x32&quot;</span></span>
<span id="cb229-3"><a href="#cb229-3"></a>jMat</span>
<span id="cb229-4"><a href="#cb229-4"></a><span class="co">#&gt;      col1  col2  col3  col4 </span></span>
<span id="cb229-5"><a href="#cb229-5"></a><span class="co">#&gt; row1 &quot;x11&quot; &quot;x12&quot; &quot;x13&quot; &quot;x14&quot;</span></span>
<span id="cb229-6"><a href="#cb229-6"></a><span class="co">#&gt; row2 &quot;x21&quot; &quot;x22&quot; &quot;x23&quot; &quot;x24&quot;</span></span>
<span id="cb229-7"><a href="#cb229-7"></a><span class="co">#&gt; row3 &quot;x31&quot; &quot;x32&quot; &quot;x33&quot; &quot;x34&quot;</span></span>
<span id="cb229-8"><a href="#cb229-8"></a><span class="co">#&gt; row4 &quot;x41&quot; &quot;x42&quot; &quot;x43&quot; &quot;x44&quot;</span></span></code></pre></div>
<p>How to understand this: start counting in the upper left corner, move down the column, continue from the top of column 2 and you’ll land on the element “x32” when you get to 7.</p>
<p>If you have meaningful, systematic row or column names, there are many possibilities for indexing via regular expressions. Maybe we will talk about <code>grep</code> later….</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="#cb230-1"></a>jMat[<span class="dv">1</span>, <span class="kw">grepl</span>(<span class="st">&quot;[24]&quot;</span>, <span class="kw">colnames</span>(jMat))]</span>
<span id="cb230-2"><a href="#cb230-2"></a><span class="co">#&gt;  col2  col4 </span></span>
<span id="cb230-3"><a href="#cb230-3"></a><span class="co">#&gt; &quot;x12&quot; &quot;x14&quot;</span></span></code></pre></div>
<p>Note also that one can put an indexed matrix on the receiving end of an assignment operation and, as long as your replacement values have valid shape or extent, you can change the matrix.</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="#cb231-1"></a>jMat[<span class="st">&quot;row1&quot;</span>, <span class="dv">2</span><span class="op">:</span><span class="dv">3</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;HEY!&quot;</span>, <span class="st">&quot;THIS IS NUTS!&quot;</span>)</span>
<span id="cb231-2"><a href="#cb231-2"></a>jMat</span>
<span id="cb231-3"><a href="#cb231-3"></a><span class="co">#&gt;      col1  col2   col3            col4 </span></span>
<span id="cb231-4"><a href="#cb231-4"></a><span class="co">#&gt; row1 &quot;x11&quot; &quot;HEY!&quot; &quot;THIS IS NUTS!&quot; &quot;x14&quot;</span></span>
<span id="cb231-5"><a href="#cb231-5"></a><span class="co">#&gt; row2 &quot;x21&quot; &quot;x22&quot;  &quot;x23&quot;           &quot;x24&quot;</span></span>
<span id="cb231-6"><a href="#cb231-6"></a><span class="co">#&gt; row3 &quot;x31&quot; &quot;x32&quot;  &quot;x33&quot;           &quot;x34&quot;</span></span>
<span id="cb231-7"><a href="#cb231-7"></a><span class="co">#&gt; row4 &quot;x41&quot; &quot;x42&quot;  &quot;x43&quot;           &quot;x44&quot;</span></span></code></pre></div>
<p>Note that R can also work with vectors and matrices in the proper mathematical sense, i.e. perform matrix algebra. That is a separate topic. To get you started, read the help on <code>%*%</code> for matrix multiplication….</p>
</div>
<div id="creating-arrays-e.g.-matrices" class="section level2">
<h2><span class="header-section-number">17.6</span> Creating arrays, e.g. matrices</h2>
<p>There are three main ways to create a matrix. It goes without saying that the inputs must comply with the requirement that all matrix elements are the same flavor. If that’s not true, you risk an error or, worse, silent conversion to character.</p>
<ul>
<li>Filling a matrix with a vector</li>
<li>Glueing vectors together as rows or columns</li>
<li>Conversion of a data.frame</li>
</ul>
<p>Let’s demonstrate. Here we fill a matrix with a vector, explore filling by rows and giving row and columns at creation. Notice that recycling happens here too, so if the input vector is not large enough, R will recycle it.</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="#cb232-1"></a><span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">15</span>, <span class="dt">nrow =</span> <span class="dv">5</span>)</span>
<span id="cb232-2"><a href="#cb232-2"></a><span class="co">#&gt;      [,1] [,2] [,3]</span></span>
<span id="cb232-3"><a href="#cb232-3"></a><span class="co">#&gt; [1,]    1    6   11</span></span>
<span id="cb232-4"><a href="#cb232-4"></a><span class="co">#&gt; [2,]    2    7   12</span></span>
<span id="cb232-5"><a href="#cb232-5"></a><span class="co">#&gt; [3,]    3    8   13</span></span>
<span id="cb232-6"><a href="#cb232-6"></a><span class="co">#&gt; [4,]    4    9   14</span></span>
<span id="cb232-7"><a href="#cb232-7"></a><span class="co">#&gt; [5,]    5   10   15</span></span>
<span id="cb232-8"><a href="#cb232-8"></a><span class="kw">matrix</span>(<span class="st">&quot;yo!&quot;</span>, <span class="dt">nrow =</span> <span class="dv">3</span>, <span class="dt">ncol =</span> <span class="dv">6</span>)</span>
<span id="cb232-9"><a href="#cb232-9"></a><span class="co">#&gt;      [,1]  [,2]  [,3]  [,4]  [,5]  [,6] </span></span>
<span id="cb232-10"><a href="#cb232-10"></a><span class="co">#&gt; [1,] &quot;yo!&quot; &quot;yo!&quot; &quot;yo!&quot; &quot;yo!&quot; &quot;yo!&quot; &quot;yo!&quot;</span></span>
<span id="cb232-11"><a href="#cb232-11"></a><span class="co">#&gt; [2,] &quot;yo!&quot; &quot;yo!&quot; &quot;yo!&quot; &quot;yo!&quot; &quot;yo!&quot; &quot;yo!&quot;</span></span>
<span id="cb232-12"><a href="#cb232-12"></a><span class="co">#&gt; [3,] &quot;yo!&quot; &quot;yo!&quot; &quot;yo!&quot; &quot;yo!&quot; &quot;yo!&quot; &quot;yo!&quot;</span></span>
<span id="cb232-13"><a href="#cb232-13"></a><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="st">&quot;yo!&quot;</span>, <span class="st">&quot;foo?&quot;</span>), <span class="dt">nrow =</span> <span class="dv">3</span>, <span class="dt">ncol =</span> <span class="dv">6</span>)</span>
<span id="cb232-14"><a href="#cb232-14"></a><span class="co">#&gt;      [,1]   [,2]   [,3]   [,4]   [,5]   [,6]  </span></span>
<span id="cb232-15"><a href="#cb232-15"></a><span class="co">#&gt; [1,] &quot;yo!&quot;  &quot;foo?&quot; &quot;yo!&quot;  &quot;foo?&quot; &quot;yo!&quot;  &quot;foo?&quot;</span></span>
<span id="cb232-16"><a href="#cb232-16"></a><span class="co">#&gt; [2,] &quot;foo?&quot; &quot;yo!&quot;  &quot;foo?&quot; &quot;yo!&quot;  &quot;foo?&quot; &quot;yo!&quot; </span></span>
<span id="cb232-17"><a href="#cb232-17"></a><span class="co">#&gt; [3,] &quot;yo!&quot;  &quot;foo?&quot; &quot;yo!&quot;  &quot;foo?&quot; &quot;yo!&quot;  &quot;foo?&quot;</span></span>
<span id="cb232-18"><a href="#cb232-18"></a><span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">15</span>, <span class="dt">nrow =</span> <span class="dv">5</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>)</span>
<span id="cb232-19"><a href="#cb232-19"></a><span class="co">#&gt;      [,1] [,2] [,3]</span></span>
<span id="cb232-20"><a href="#cb232-20"></a><span class="co">#&gt; [1,]    1    2    3</span></span>
<span id="cb232-21"><a href="#cb232-21"></a><span class="co">#&gt; [2,]    4    5    6</span></span>
<span id="cb232-22"><a href="#cb232-22"></a><span class="co">#&gt; [3,]    7    8    9</span></span>
<span id="cb232-23"><a href="#cb232-23"></a><span class="co">#&gt; [4,]   10   11   12</span></span>
<span id="cb232-24"><a href="#cb232-24"></a><span class="co">#&gt; [5,]   13   14   15</span></span>
<span id="cb232-25"><a href="#cb232-25"></a><span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">15</span>, <span class="dt">nrow =</span> <span class="dv">5</span>,</span>
<span id="cb232-26"><a href="#cb232-26"></a>       <span class="dt">dimnames =</span> <span class="kw">list</span>(<span class="kw">paste0</span>(<span class="st">&quot;row&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>),</span>
<span id="cb232-27"><a href="#cb232-27"></a>                       <span class="kw">paste0</span>(<span class="st">&quot;col&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)))</span>
<span id="cb232-28"><a href="#cb232-28"></a><span class="co">#&gt;      col1 col2 col3</span></span>
<span id="cb232-29"><a href="#cb232-29"></a><span class="co">#&gt; row1    1    6   11</span></span>
<span id="cb232-30"><a href="#cb232-30"></a><span class="co">#&gt; row2    2    7   12</span></span>
<span id="cb232-31"><a href="#cb232-31"></a><span class="co">#&gt; row3    3    8   13</span></span>
<span id="cb232-32"><a href="#cb232-32"></a><span class="co">#&gt; row4    4    9   14</span></span>
<span id="cb232-33"><a href="#cb232-33"></a><span class="co">#&gt; row5    5   10   15</span></span></code></pre></div>
<p>Here we create a matrix by glueing vectors together. Watch the vector names propagate as row or column names.</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="#cb233-1"></a>vec1 &lt;-<span class="st"> </span><span class="dv">5</span><span class="op">:</span><span class="dv">1</span></span>
<span id="cb233-2"><a href="#cb233-2"></a>vec2 &lt;-<span class="st"> </span><span class="dv">2</span><span class="op">^</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>)</span>
<span id="cb233-3"><a href="#cb233-3"></a><span class="kw">cbind</span>(vec1, vec2)</span>
<span id="cb233-4"><a href="#cb233-4"></a><span class="co">#&gt;      vec1 vec2</span></span>
<span id="cb233-5"><a href="#cb233-5"></a><span class="co">#&gt; [1,]    5    2</span></span>
<span id="cb233-6"><a href="#cb233-6"></a><span class="co">#&gt; [2,]    4    4</span></span>
<span id="cb233-7"><a href="#cb233-7"></a><span class="co">#&gt; [3,]    3    8</span></span>
<span id="cb233-8"><a href="#cb233-8"></a><span class="co">#&gt; [4,]    2   16</span></span>
<span id="cb233-9"><a href="#cb233-9"></a><span class="co">#&gt; [5,]    1   32</span></span>
<span id="cb233-10"><a href="#cb233-10"></a><span class="kw">rbind</span>(vec1, vec2)</span>
<span id="cb233-11"><a href="#cb233-11"></a><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5]</span></span>
<span id="cb233-12"><a href="#cb233-12"></a><span class="co">#&gt; vec1    5    4    3    2    1</span></span>
<span id="cb233-13"><a href="#cb233-13"></a><span class="co">#&gt; vec2    2    4    8   16   32</span></span></code></pre></div>
<p>Here we create a matrix from a data.frame.</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="#cb234-1"></a>vecDat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">vec1 =</span> <span class="dv">5</span><span class="op">:</span><span class="dv">1</span>,</span>
<span id="cb234-2"><a href="#cb234-2"></a>                     <span class="dt">vec2 =</span> <span class="dv">2</span><span class="op">^</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>))</span>
<span id="cb234-3"><a href="#cb234-3"></a><span class="kw">str</span>(vecDat)</span>
<span id="cb234-4"><a href="#cb234-4"></a><span class="co">#&gt; &#39;data.frame&#39;:    5 obs. of  2 variables:</span></span>
<span id="cb234-5"><a href="#cb234-5"></a><span class="co">#&gt;  $ vec1: int  5 4 3 2 1</span></span>
<span id="cb234-6"><a href="#cb234-6"></a><span class="co">#&gt;  $ vec2: num  2 4 8 16 32</span></span>
<span id="cb234-7"><a href="#cb234-7"></a>vecMat &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(vecDat)</span>
<span id="cb234-8"><a href="#cb234-8"></a><span class="kw">str</span>(vecMat)</span>
<span id="cb234-9"><a href="#cb234-9"></a><span class="co">#&gt;  num [1:5, 1:2] 5 4 3 2 1 2 4 8 16 32</span></span>
<span id="cb234-10"><a href="#cb234-10"></a><span class="co">#&gt;  - attr(*, &quot;dimnames&quot;)=List of 2</span></span>
<span id="cb234-11"><a href="#cb234-11"></a><span class="co">#&gt;   ..$ : NULL</span></span>
<span id="cb234-12"><a href="#cb234-12"></a><span class="co">#&gt;   ..$ : chr [1:2] &quot;vec1&quot; &quot;vec2&quot;</span></span></code></pre></div>
<p>Here we create a matrix from a data.frame, but experience the “silently convert everything to character” fail. As an added bonus, I’m also allowing the “convert character to factor” thing to happen when we create the data.frame initially. Let this be a reminder to take control of your objects!</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="#cb235-1"></a>multiDat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">vec1 =</span> <span class="dv">5</span><span class="op">:</span><span class="dv">1</span>,</span>
<span id="cb235-2"><a href="#cb235-2"></a>                       <span class="dt">vec2 =</span> <span class="kw">paste0</span>(<span class="st">&quot;hi&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>))</span>
<span id="cb235-3"><a href="#cb235-3"></a><span class="kw">str</span>(multiDat)</span>
<span id="cb235-4"><a href="#cb235-4"></a><span class="co">#&gt; &#39;data.frame&#39;:    5 obs. of  2 variables:</span></span>
<span id="cb235-5"><a href="#cb235-5"></a><span class="co">#&gt;  $ vec1: int  5 4 3 2 1</span></span>
<span id="cb235-6"><a href="#cb235-6"></a><span class="co">#&gt;  $ vec2: chr  &quot;hi1&quot; &quot;hi2&quot; &quot;hi3&quot; &quot;hi4&quot; ...</span></span>
<span id="cb235-7"><a href="#cb235-7"></a>(multiMat &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(multiDat))</span>
<span id="cb235-8"><a href="#cb235-8"></a><span class="co">#&gt;      vec1 vec2 </span></span>
<span id="cb235-9"><a href="#cb235-9"></a><span class="co">#&gt; [1,] &quot;5&quot;  &quot;hi1&quot;</span></span>
<span id="cb235-10"><a href="#cb235-10"></a><span class="co">#&gt; [2,] &quot;4&quot;  &quot;hi2&quot;</span></span>
<span id="cb235-11"><a href="#cb235-11"></a><span class="co">#&gt; [3,] &quot;3&quot;  &quot;hi3&quot;</span></span>
<span id="cb235-12"><a href="#cb235-12"></a><span class="co">#&gt; [4,] &quot;2&quot;  &quot;hi4&quot;</span></span>
<span id="cb235-13"><a href="#cb235-13"></a><span class="co">#&gt; [5,] &quot;1&quot;  &quot;hi5&quot;</span></span>
<span id="cb235-14"><a href="#cb235-14"></a><span class="kw">str</span>(multiMat)</span>
<span id="cb235-15"><a href="#cb235-15"></a><span class="co">#&gt;  chr [1:5, 1:2] &quot;5&quot; &quot;4&quot; &quot;3&quot; &quot;2&quot; ...</span></span>
<span id="cb235-16"><a href="#cb235-16"></a><span class="co">#&gt;  - attr(*, &quot;dimnames&quot;)=List of 2</span></span>
<span id="cb235-17"><a href="#cb235-17"></a><span class="co">#&gt;   ..$ : NULL</span></span>
<span id="cb235-18"><a href="#cb235-18"></a><span class="co">#&gt;   ..$ : chr [1:2] &quot;vec1&quot; &quot;vec2&quot;</span></span></code></pre></div>
</div>
<div id="putting-it-all-togetherimplications-for-data.frames" class="section level2">
<h2><span class="header-section-number">17.7</span> Putting it all together…implications for data.frames</h2>
<p>This behind the scenes tour is still aimed at making you a better data analyst. Hopefully the slog through vectors, matrices, and lists will be redeemed by greater prowess at manipulating data.frames. Why should this be true?</p>
<ul>
<li>a data.frame is a <em>list</em></li>
<li>the list elements are the variables and they are <em>atomic vectors</em></li>
<li>data.frames are rectangular, like their matrix friends, so your intuition – and even some syntax – can be borrowed from the matrix world</li>
</ul>
<p>A data.frame is a list that quacks like a matrix.</p>
<p>Reviewing list-style indexing of a data.frame:</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="#cb236-1"></a>jDat</span>
<span id="cb236-2"><a href="#cb236-2"></a><span class="co">#&gt;       w x y     z v</span></span>
<span id="cb236-3"><a href="#cb236-3"></a><span class="co">#&gt; 1 -0.63 1 A  TRUE I</span></span>
<span id="cb236-4"><a href="#cb236-4"></a><span class="co">#&gt; 2  0.18 2 B  TRUE I</span></span>
<span id="cb236-5"><a href="#cb236-5"></a><span class="co">#&gt; 3 -0.84 3 C  TRUE J</span></span>
<span id="cb236-6"><a href="#cb236-6"></a><span class="co">#&gt; 4  1.60 4 D  TRUE J</span></span>
<span id="cb236-7"><a href="#cb236-7"></a><span class="co">#&gt; 5  0.33 5 E  TRUE K</span></span>
<span id="cb236-8"><a href="#cb236-8"></a><span class="co">#&gt; 6 -0.82 6 F FALSE K</span></span>
<span id="cb236-9"><a href="#cb236-9"></a><span class="co">#&gt; 7  0.49 7 G  TRUE L</span></span>
<span id="cb236-10"><a href="#cb236-10"></a><span class="co">#&gt; 8  0.74 8 H FALSE L</span></span>
<span id="cb236-11"><a href="#cb236-11"></a>jDat<span class="op">$</span>z</span>
<span id="cb236-12"><a href="#cb236-12"></a><span class="co">#&gt; [1]  TRUE  TRUE  TRUE  TRUE  TRUE FALSE  TRUE FALSE</span></span>
<span id="cb236-13"><a href="#cb236-13"></a>iWantThis &lt;-<span class="st"> &quot;z&quot;</span></span>
<span id="cb236-14"><a href="#cb236-14"></a>jDat[[iWantThis]]</span>
<span id="cb236-15"><a href="#cb236-15"></a><span class="co">#&gt; [1]  TRUE  TRUE  TRUE  TRUE  TRUE FALSE  TRUE FALSE</span></span>
<span id="cb236-16"><a href="#cb236-16"></a><span class="kw">str</span>(jDat[[iWantThis]]) <span class="co"># we get an atomic vector</span></span>
<span id="cb236-17"><a href="#cb236-17"></a><span class="co">#&gt;  logi [1:8] TRUE TRUE TRUE TRUE TRUE FALSE ...</span></span></code></pre></div>
<p>Reviewing vector-style indexing of a data.frame:</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="#cb237-1"></a>jDat[<span class="st">&quot;y&quot;</span>]</span>
<span id="cb237-2"><a href="#cb237-2"></a><span class="co">#&gt;   y</span></span>
<span id="cb237-3"><a href="#cb237-3"></a><span class="co">#&gt; 1 A</span></span>
<span id="cb237-4"><a href="#cb237-4"></a><span class="co">#&gt; 2 B</span></span>
<span id="cb237-5"><a href="#cb237-5"></a><span class="co">#&gt; 3 C</span></span>
<span id="cb237-6"><a href="#cb237-6"></a><span class="co">#&gt; 4 D</span></span>
<span id="cb237-7"><a href="#cb237-7"></a><span class="co">#&gt; 5 E</span></span>
<span id="cb237-8"><a href="#cb237-8"></a><span class="co">#&gt; 6 F</span></span>
<span id="cb237-9"><a href="#cb237-9"></a><span class="co">#&gt; 7 G</span></span>
<span id="cb237-10"><a href="#cb237-10"></a><span class="co">#&gt; 8 H</span></span>
<span id="cb237-11"><a href="#cb237-11"></a><span class="kw">str</span>(jDat[<span class="st">&quot;y&quot;</span>]) <span class="co"># we get a data.frame with one variable, y</span></span>
<span id="cb237-12"><a href="#cb237-12"></a><span class="co">#&gt; &#39;data.frame&#39;:    8 obs. of  1 variable:</span></span>
<span id="cb237-13"><a href="#cb237-13"></a><span class="co">#&gt;  $ y: &#39;AsIs&#39; chr  &quot;A&quot; &quot;B&quot; &quot;C&quot; &quot;D&quot; ...</span></span>
<span id="cb237-14"><a href="#cb237-14"></a>iWantThis &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;w&quot;</span>, <span class="st">&quot;v&quot;</span>)</span>
<span id="cb237-15"><a href="#cb237-15"></a>jDat[iWantThis] <span class="co"># index with a vector of variable names</span></span>
<span id="cb237-16"><a href="#cb237-16"></a><span class="co">#&gt;       w v</span></span>
<span id="cb237-17"><a href="#cb237-17"></a><span class="co">#&gt; 1 -0.63 I</span></span>
<span id="cb237-18"><a href="#cb237-18"></a><span class="co">#&gt; 2  0.18 I</span></span>
<span id="cb237-19"><a href="#cb237-19"></a><span class="co">#&gt; 3 -0.84 J</span></span>
<span id="cb237-20"><a href="#cb237-20"></a><span class="co">#&gt; 4  1.60 J</span></span>
<span id="cb237-21"><a href="#cb237-21"></a><span class="co">#&gt; 5  0.33 K</span></span>
<span id="cb237-22"><a href="#cb237-22"></a><span class="co">#&gt; 6 -0.82 K</span></span>
<span id="cb237-23"><a href="#cb237-23"></a><span class="co">#&gt; 7  0.49 L</span></span>
<span id="cb237-24"><a href="#cb237-24"></a><span class="co">#&gt; 8  0.74 L</span></span>
<span id="cb237-25"><a href="#cb237-25"></a><span class="kw">str</span>(jDat[<span class="kw">c</span>(<span class="st">&quot;w&quot;</span>, <span class="st">&quot;v&quot;</span>)])</span>
<span id="cb237-26"><a href="#cb237-26"></a><span class="co">#&gt; &#39;data.frame&#39;:    8 obs. of  2 variables:</span></span>
<span id="cb237-27"><a href="#cb237-27"></a><span class="co">#&gt;  $ w: num  -0.63 0.18 -0.84 1.6 0.33 -0.82 0.49 0.74</span></span>
<span id="cb237-28"><a href="#cb237-28"></a><span class="co">#&gt;  $ v: chr  &quot;I&quot; &quot;I&quot; &quot;J&quot; &quot;J&quot; ...</span></span>
<span id="cb237-29"><a href="#cb237-29"></a><span class="kw">str</span>(<span class="kw">subset</span>(jDat, <span class="dt">select =</span> <span class="kw">c</span>(w, v))) <span class="co"># using subset() function</span></span>
<span id="cb237-30"><a href="#cb237-30"></a><span class="co">#&gt; &#39;data.frame&#39;:    8 obs. of  2 variables:</span></span>
<span id="cb237-31"><a href="#cb237-31"></a><span class="co">#&gt;  $ w: num  -0.63 0.18 -0.84 1.6 0.33 -0.82 0.49 0.74</span></span>
<span id="cb237-32"><a href="#cb237-32"></a><span class="co">#&gt;  $ v: chr  &quot;I&quot; &quot;I&quot; &quot;J&quot; &quot;J&quot; ...</span></span></code></pre></div>
<p>Demonstrating matrix-style indexing of a data.frame:</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="#cb238-1"></a>jDat[ , <span class="st">&quot;v&quot;</span>]</span>
<span id="cb238-2"><a href="#cb238-2"></a><span class="co">#&gt; [1] &quot;I&quot; &quot;I&quot; &quot;J&quot; &quot;J&quot; &quot;K&quot; &quot;K&quot; &quot;L&quot; &quot;L&quot;</span></span>
<span id="cb238-3"><a href="#cb238-3"></a><span class="kw">str</span>(jDat[ , <span class="st">&quot;v&quot;</span>])</span>
<span id="cb238-4"><a href="#cb238-4"></a><span class="co">#&gt;  chr [1:8] &quot;I&quot; &quot;I&quot; &quot;J&quot; &quot;J&quot; ...</span></span>
<span id="cb238-5"><a href="#cb238-5"></a>jDat[ , <span class="st">&quot;v&quot;</span>, drop =<span class="st"> </span><span class="ot">FALSE</span>]</span>
<span id="cb238-6"><a href="#cb238-6"></a><span class="co">#&gt;   v</span></span>
<span id="cb238-7"><a href="#cb238-7"></a><span class="co">#&gt; 1 I</span></span>
<span id="cb238-8"><a href="#cb238-8"></a><span class="co">#&gt; 2 I</span></span>
<span id="cb238-9"><a href="#cb238-9"></a><span class="co">#&gt; 3 J</span></span>
<span id="cb238-10"><a href="#cb238-10"></a><span class="co">#&gt; 4 J</span></span>
<span id="cb238-11"><a href="#cb238-11"></a><span class="co">#&gt; 5 K</span></span>
<span id="cb238-12"><a href="#cb238-12"></a><span class="co">#&gt; 6 K</span></span>
<span id="cb238-13"><a href="#cb238-13"></a><span class="co">#&gt; 7 L</span></span>
<span id="cb238-14"><a href="#cb238-14"></a><span class="co">#&gt; 8 L</span></span>
<span id="cb238-15"><a href="#cb238-15"></a><span class="kw">str</span>(jDat[ , <span class="st">&quot;v&quot;</span>, <span class="dt">drop =</span> <span class="ot">FALSE</span>])</span>
<span id="cb238-16"><a href="#cb238-16"></a><span class="co">#&gt; &#39;data.frame&#39;:    8 obs. of  1 variable:</span></span>
<span id="cb238-17"><a href="#cb238-17"></a><span class="co">#&gt;  $ v: chr  &quot;I&quot; &quot;I&quot; &quot;J&quot; &quot;J&quot; ...</span></span>
<span id="cb238-18"><a href="#cb238-18"></a>jDat[<span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">7</span>), <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">4</span>)] <span class="co"># awful and arbitrary but syntax works</span></span>
<span id="cb238-19"><a href="#cb238-19"></a><span class="co">#&gt;      w    z</span></span>
<span id="cb238-20"><a href="#cb238-20"></a><span class="co">#&gt; 2 0.18 TRUE</span></span>
<span id="cb238-21"><a href="#cb238-21"></a><span class="co">#&gt; 4 1.60 TRUE</span></span>
<span id="cb238-22"><a href="#cb238-22"></a><span class="co">#&gt; 7 0.49 TRUE</span></span>
<span id="cb238-23"><a href="#cb238-23"></a>jDat[jDat<span class="op">$</span>z, ]</span>
<span id="cb238-24"><a href="#cb238-24"></a><span class="co">#&gt;       w x y    z v</span></span>
<span id="cb238-25"><a href="#cb238-25"></a><span class="co">#&gt; 1 -0.63 1 A TRUE I</span></span>
<span id="cb238-26"><a href="#cb238-26"></a><span class="co">#&gt; 2  0.18 2 B TRUE I</span></span>
<span id="cb238-27"><a href="#cb238-27"></a><span class="co">#&gt; 3 -0.84 3 C TRUE J</span></span>
<span id="cb238-28"><a href="#cb238-28"></a><span class="co">#&gt; 4  1.60 4 D TRUE J</span></span>
<span id="cb238-29"><a href="#cb238-29"></a><span class="co">#&gt; 5  0.33 5 E TRUE K</span></span>
<span id="cb238-30"><a href="#cb238-30"></a><span class="co">#&gt; 7  0.49 7 G TRUE L</span></span>
<span id="cb238-31"><a href="#cb238-31"></a><span class="kw">subset</span>(jDat, <span class="dt">subset =</span> z)</span>
<span id="cb238-32"><a href="#cb238-32"></a><span class="co">#&gt;       w x y    z v</span></span>
<span id="cb238-33"><a href="#cb238-33"></a><span class="co">#&gt; 1 -0.63 1 A TRUE I</span></span>
<span id="cb238-34"><a href="#cb238-34"></a><span class="co">#&gt; 2  0.18 2 B TRUE I</span></span>
<span id="cb238-35"><a href="#cb238-35"></a><span class="co">#&gt; 3 -0.84 3 C TRUE J</span></span>
<span id="cb238-36"><a href="#cb238-36"></a><span class="co">#&gt; 4  1.60 4 D TRUE J</span></span>
<span id="cb238-37"><a href="#cb238-37"></a><span class="co">#&gt; 5  0.33 5 E TRUE K</span></span>
<span id="cb238-38"><a href="#cb238-38"></a><span class="co">#&gt; 7  0.49 7 G TRUE L</span></span></code></pre></div>
</div>
<div id="table-of-atomic-r-object-flavors" class="section level2">
<h2><span class="header-section-number">17.8</span> Table of atomic R object flavors</h2>
<blockquote>
<p>This table will be hideous unless Pandoc is used to compile.</p>
</blockquote>
<table style="width:72%;">
<colgroup>
<col width="16%" />
<col width="22%" />
<col width="16%" />
<col width="16%" />
</colgroup>
<thead>
<tr class="header">
<th>“flavor”</th>
<th>type reported
by typeof()</th>
<th>mode()</th>
<th>class()</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>character</td>
<td>character</td>
<td>character</td>
<td>character</td>
</tr>
<tr class="even">
<td>logical</td>
<td>logical</td>
<td>logical</td>
<td>logical</td>
</tr>
<tr class="odd">
<td>numeric</td>
<td>integer
or double</td>
<td>numeric</td>
<td>integer
or double</td>
</tr>
<tr class="even">
<td>factor</td>
<td>integer</td>
<td>numeric</td>
<td>factor</td>
</tr>
</tbody>
</table>
<blockquote>
<p>This should be legible no matter what.</p>
</blockquote>
<pre><code>+-----------+---------------+-----------+-----------+
| &quot;flavor&quot;  | type reported | mode()    | class()   |
|           | by typeof()   |           |           |
+===========+===============+===========+===========+
| character | character     | character | character |
+-----------+---------------+-----------+-----------+
| logical   | logical       | logical   | logical   |
+-----------+---------------+-----------+-----------+
| numeric   | integer       | numeric   | integer   |
|           | or double     |           | or double |
+-----------+---------------+-----------+-----------+
| factor    | integer       | numeric   | factor    |
+-----------+---------------+-----------+-----------+</code></pre>
<p>Thinking about objects according to the flavors above will work fairly well for most purposes most of the time, at least when you’re first getting started. Notice that most rows in the table are quite homogeneous, i.e. a logical vector is a logical vector is a logical vector. But the row pertaining to factors is an exception, which highlights the special nature of factors. (for more, go <a href="#factors-boss">here</a>).</p>
<!--JB:
> JB note to self. Possible TO ADD but probably belongs in separate tutorial on changing and adding to data.frames: cbind and rbind with data.frames, transform(). do.call() tricks for data.frames. adding/removing variables to/from data.frames. Does this belong in earlier tutorial on the care and feeding of a data.frame? Fits in well with subset(), after all.
-->
<!--RStudio Links-->
<!--HappyGitWithR Links-->
<!--Package Links-->
<!--Shiny links-->
<!--Publications-->
<!--R Documentation-->
<!--Wikipedia Links-->
<!--Misc. Links-->
<!--chapter:end:017_r-objects-indexing.Rmd-->
</div>
</div>
<div id="functions-part1" class="section level1">
<h1><span class="header-section-number">18</span> Write your own R functions, part 1</h1>
<!--Original content: https://stat545.com/block011_write-your-own-function-01.html-->
<div id="what-and-why" class="section level2">
<h2><span class="header-section-number">18.1</span> What and why?</h2>
<p>My goal here is to reveal the <strong>process</strong> a long-time useR employs for writing functions. I also want to illustrate why the process is the way it is. Merely looking at the finished product, e.g. source code for R packages, can be extremely deceiving. Reality is generally much uglier … but more interesting!</p>
<p>Why are we covering this now, smack in the middle of data aggregation? Powerful machines like dplyr, purrr, and the built-in “apply” family of functions, are ready and waiting to apply your purpose-built functions to various bits of your data. If you can express your analytical wishes in a function, these tools will give you great power.</p>
</div>
<div id="load-the-gapminder-data" class="section level2">
<h2><span class="header-section-number">18.2</span> Load the Gapminder data</h2>
<p>As usual, load gapminder.</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="#cb240-1"></a><span class="kw">library</span>(gapminder)</span>
<span id="cb240-2"><a href="#cb240-2"></a><span class="kw">str</span>(gapminder)</span>
<span id="cb240-3"><a href="#cb240-3"></a><span class="co">#&gt; tibble [1,704 x 6] (S3: tbl_df/tbl/data.frame)</span></span>
<span id="cb240-4"><a href="#cb240-4"></a><span class="co">#&gt;  $ country  : Factor w/ 142 levels &quot;Afghanistan&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span id="cb240-5"><a href="#cb240-5"></a><span class="co">#&gt;  $ continent: Factor w/ 5 levels &quot;Africa&quot;,&quot;Americas&quot;,..: 3 3 3 3 3 3 3 3 3 3 ...</span></span>
<span id="cb240-6"><a href="#cb240-6"></a><span class="co">#&gt;  $ year     : int [1:1704] 1952 1957 1962 1967 1972 1977 1982 1987 1992 1997 ...</span></span>
<span id="cb240-7"><a href="#cb240-7"></a><span class="co">#&gt;  $ lifeExp  : num [1:1704] 28.8 30.3 32 34 36.1 ...</span></span>
<span id="cb240-8"><a href="#cb240-8"></a><span class="co">#&gt;  $ pop      : int [1:1704] 8425333 9240934 10267083 11537966 13079460 14880372..</span></span>
<span id="cb240-9"><a href="#cb240-9"></a><span class="co">#&gt;  $ gdpPercap: num [1:1704] 779 821 853 836 740 ...</span></span></code></pre></div>
</div>
<div id="max---min" class="section level2">
<h2><span class="header-section-number">18.3</span> Max - min</h2>
<p>Say you’ve got a numeric vector, and you want to compute the difference between its max and min. <code>lifeExp</code> or <code>pop</code> or <code>gdpPercap</code> are great examples of a typical input. You can imagine wanting to get this statistic after we slice up the Gapminder data by year, country, continent, or combinations thereof.</p>
</div>
<div id="get-something-that-works" class="section level2">
<h2><span class="header-section-number">18.4</span> Get something that works</h2>
<p>First, develop some working code for interactive use, using a representative input. I’ll use Gapminder’s life expectancy variable.</p>
<p>R functions that will be useful: <code>min()</code>, <code>max()</code>, <code>range()</code>. (<strong>Read their documentation:</strong> <a href="https://rdrr.io/r/base/Extremes.html">here</a> and <a href="https://rdrr.io/r/base/range.html">here</a>)</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="#cb241-1"></a><span class="co">## get to know the functions mentioned above</span></span>
<span id="cb241-2"><a href="#cb241-2"></a><span class="kw">min</span>(gapminder<span class="op">$</span>lifeExp)</span>
<span id="cb241-3"><a href="#cb241-3"></a><span class="co">#&gt; [1] 23.6</span></span>
<span id="cb241-4"><a href="#cb241-4"></a><span class="kw">max</span>(gapminder<span class="op">$</span>lifeExp)</span>
<span id="cb241-5"><a href="#cb241-5"></a><span class="co">#&gt; [1] 82.6</span></span>
<span id="cb241-6"><a href="#cb241-6"></a><span class="kw">range</span>(gapminder<span class="op">$</span>lifeExp)</span>
<span id="cb241-7"><a href="#cb241-7"></a><span class="co">#&gt; [1] 23.6 82.6</span></span>
<span id="cb241-8"><a href="#cb241-8"></a></span>
<span id="cb241-9"><a href="#cb241-9"></a><span class="co">## some natural solutions</span></span>
<span id="cb241-10"><a href="#cb241-10"></a><span class="kw">max</span>(gapminder<span class="op">$</span>lifeExp) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(gapminder<span class="op">$</span>lifeExp)</span>
<span id="cb241-11"><a href="#cb241-11"></a><span class="co">#&gt; [1] 59</span></span>
<span id="cb241-12"><a href="#cb241-12"></a><span class="kw">with</span>(gapminder, <span class="kw">max</span>(lifeExp) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(lifeExp))</span>
<span id="cb241-13"><a href="#cb241-13"></a><span class="co">#&gt; [1] 59</span></span>
<span id="cb241-14"><a href="#cb241-14"></a><span class="kw">range</span>(gapminder<span class="op">$</span>lifeExp)[<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span><span class="kw">range</span>(gapminder<span class="op">$</span>lifeExp)[<span class="dv">1</span>]</span>
<span id="cb241-15"><a href="#cb241-15"></a><span class="co">#&gt; [1] 59</span></span>
<span id="cb241-16"><a href="#cb241-16"></a><span class="kw">with</span>(gapminder, <span class="kw">range</span>(lifeExp)[<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span><span class="kw">range</span>(lifeExp)[<span class="dv">1</span>])</span>
<span id="cb241-17"><a href="#cb241-17"></a><span class="co">#&gt; [1] 59</span></span>
<span id="cb241-18"><a href="#cb241-18"></a><span class="kw">diff</span>(<span class="kw">range</span>(gapminder<span class="op">$</span>lifeExp))</span>
<span id="cb241-19"><a href="#cb241-19"></a><span class="co">#&gt; [1] 59</span></span></code></pre></div>
<p>Internalize this “answer” because our informal testing relies on you noticing departures from this.</p>
<div id="skateboard-perfectly-formed-rear-view-mirror" class="section level3">
<h3><span class="header-section-number">18.4.1</span> Skateboard &gt;&gt; perfectly formed rear-view mirror</h3>
<p>This image <a href="https://blog.fastmonkeys.com/?utm_content=bufferc2d6e&amp;utm_medium=social&amp;utm_source=twitter.com&amp;utm_campaign=buffer">widely attributed to the Spotify development team</a> conveys an important point.</p>
<div class="figure">
<img src="img/spotify-howtobuildmvp.jpg" alt="From [Your ultimate guide to Minimum Viable Product (+great examples)](https://blog.fastmonkeys.com/2014/06/18/minimum-viable-product-your-ultimate-guide-to-mvp-great-examples/)" width="60%" />
<p class="caption">
(#fig:spotify-howtobuildmvp)From <a href="https://blog.fastmonkeys.com/2014/06/18/minimum-viable-product-your-ultimate-guide-to-mvp-great-examples/">Your ultimate guide to Minimum Viable Product (+great examples)</a>
</p>
</div>
<p>Build that skateboard before you build the car or some fancy car part. A limited-but-functioning thing is very useful. It also keeps the spirits high.</p>
<p>This is related to the valuable <a href="http://c2.com/cgi/wiki?TelescopeRule">Telescope Rule</a>:</p>
<blockquote>
<p>It is faster to make a four-inch mirror then a six-inch mirror than to make a six-inch mirror.</p>
</blockquote>
</div>
</div>
<div id="turn-the-working-interactive-code-into-a-function" class="section level2">
<h2><span class="header-section-number">18.5</span> Turn the working interactive code into a function</h2>
<p>Add NO new functionality! Just write your very first R function.</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="#cb242-1"></a>max_minus_min &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">max</span>(x) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(x)</span>
<span id="cb242-2"><a href="#cb242-2"></a><span class="kw">max_minus_min</span>(gapminder<span class="op">$</span>lifeExp)</span>
<span id="cb242-3"><a href="#cb242-3"></a><span class="co">#&gt; [1] 59</span></span></code></pre></div>
<p>Check that you’re getting the same answer as you did with your interactive code. Test it eyeball-o-metrically at this point.</p>
</div>
<div id="test-your-function" class="section level2">
<h2><span class="header-section-number">18.6</span> Test your function</h2>
<div id="test-on-new-inputs" class="section level3">
<h3><span class="header-section-number">18.6.1</span> Test on new inputs</h3>
<p>Pick some new artificial inputs where you know (at least approximately) what your function should return.</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="#cb243-1"></a><span class="kw">max_minus_min</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)</span>
<span id="cb243-2"><a href="#cb243-2"></a><span class="co">#&gt; [1] 9</span></span>
<span id="cb243-3"><a href="#cb243-3"></a><span class="kw">max_minus_min</span>(<span class="kw">runif</span>(<span class="dv">1000</span>))</span>
<span id="cb243-4"><a href="#cb243-4"></a><span class="co">#&gt; [1] 0.999</span></span></code></pre></div>
<p>I know that 10 minus 1 is 9. I know that random uniform [0, 1] variates will be between 0 and 1. Therefore max - min should be less than 1. If I take LOTS of them, max - min should be pretty close to 1.</p>
<p>It is intentional that I tested on integer input as well as floating point. Likewise, I like to use valid-but-random data for this sort of check.</p>
</div>
<div id="test-on-real-data-but-different-real-data" class="section level3">
<h3><span class="header-section-number">18.6.2</span> Test on real data but <em>different</em> real data</h3>
<p>Back to the real world now. Two other quantitative variables are lying around: <code>gdpPercap</code> and <code>pop</code>. Let’s have a go.</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="#cb244-1"></a><span class="kw">max_minus_min</span>(gapminder<span class="op">$</span>gdpPercap)</span>
<span id="cb244-2"><a href="#cb244-2"></a><span class="co">#&gt; [1] 113282</span></span>
<span id="cb244-3"><a href="#cb244-3"></a><span class="kw">max_minus_min</span>(gapminder<span class="op">$</span>pop)</span>
<span id="cb244-4"><a href="#cb244-4"></a><span class="co">#&gt; [1] 1318623085</span></span></code></pre></div>
<p>Either check these results “by hand” or apply the “does that even make sense?” test.</p>
</div>
<div id="test-on-weird-stuff" class="section level3">
<h3><span class="header-section-number">18.6.3</span> Test on weird stuff</h3>
<p>Now we try to break our function. Don’t get truly diabolical (yet). Just make the kind of mistakes you can imagine making at 2am when, 3 years from now, you rediscover this useful function you wrote. Give your function inputs it’s not expecting.</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="#cb245-1"></a><span class="kw">max_minus_min</span>(gapminder) <span class="co">## hey sometimes things &quot;just work&quot; on data.frames!</span></span>
<span id="cb245-2"><a href="#cb245-2"></a><span class="co">#&gt; Error in FUN(X[[i]], ...): only defined on a data frame with all numeric variables</span></span>
<span id="cb245-3"><a href="#cb245-3"></a><span class="kw">max_minus_min</span>(gapminder<span class="op">$</span>country) <span class="co">## factors are kind of like integer vectors, no?</span></span>
<span id="cb245-4"><a href="#cb245-4"></a><span class="co">#&gt; Error in Summary.factor(structure(c(1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, : &#39;max&#39; not meaningful for factors</span></span>
<span id="cb245-5"><a href="#cb245-5"></a><span class="kw">max_minus_min</span>(<span class="st">&quot;eggplants are purple&quot;</span>) <span class="co">## i have no excuse for this one</span></span>
<span id="cb245-6"><a href="#cb245-6"></a><span class="co">#&gt; Error in max(x) - min(x): non-numeric argument to binary operator</span></span></code></pre></div>
<p>How happy are you with those error messages? You must imagine that some entire <strong>script</strong> has failed and that you were hoping to just <code>source()</code> it without re-reading it. If a colleague or future you encountered these errors, do you run screaming from the room? How hard is it to pinpoint the usage problem?</p>
</div>
<div id="i-will-scare-you-now" class="section level3">
<h3><span class="header-section-number">18.6.4</span> I will scare you now</h3>
<p>Here are some great examples STAT545 students devised during class where the function <strong>should break but it does not.</strong></p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="#cb246-1"></a><span class="kw">max_minus_min</span>(gapminder[<span class="kw">c</span>(<span class="st">&#39;lifeExp&#39;</span>, <span class="st">&#39;gdpPercap&#39;</span>, <span class="st">&#39;pop&#39;</span>)])</span>
<span id="cb246-2"><a href="#cb246-2"></a><span class="co">#&gt; [1] 1.32e+09</span></span>
<span id="cb246-3"><a href="#cb246-3"></a><span class="kw">max_minus_min</span>(<span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="ot">TRUE</span>, <span class="ot">TRUE</span>))</span>
<span id="cb246-4"><a href="#cb246-4"></a><span class="co">#&gt; [1] 1</span></span></code></pre></div>
<p>In both cases, R’s eagerness to make sense of our requests is unfortunately successful. In the first case, a data.frame containing just the quantitative variables is eventually coerced into numeric vector. We can compute max minus min, even though it makes absolutely no sense at all. In the second case, a logical vector is converted to zeroes and ones, which might merit an error or at least a warning.</p>
</div>
</div>
<div id="check-the-validity-of-arguments" class="section level2">
<h2><span class="header-section-number">18.7</span> Check the validity of arguments</h2>
<p>For functions that will be used again – which is not all of them! – it is good to check the validity of arguments. This implements a rule from <a href="http://www.faqs.org/docs/artu/ch01s06.html">the Unix philosophy</a>:</p>
<blockquote>
<p>Rule of Repair: When you must fail, fail noisily and as soon as possible.</p>
</blockquote>
<div id="stop-if-not" class="section level3">
<h3><span class="header-section-number">18.7.1</span> stop if not</h3>
<p><code>stopifnot()</code> is the entry level solution. I use it here to make sure the input <code>x</code> is a numeric vector.</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="#cb247-1"></a>mmm &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</span>
<span id="cb247-2"><a href="#cb247-2"></a>  <span class="kw">stopifnot</span>(<span class="kw">is.numeric</span>(x))</span>
<span id="cb247-3"><a href="#cb247-3"></a>  <span class="kw">max</span>(x) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(x)</span>
<span id="cb247-4"><a href="#cb247-4"></a>}</span>
<span id="cb247-5"><a href="#cb247-5"></a><span class="kw">mmm</span>(gapminder)</span>
<span id="cb247-6"><a href="#cb247-6"></a><span class="co">#&gt; Error in mmm(gapminder): is.numeric(x) is not TRUE</span></span>
<span id="cb247-7"><a href="#cb247-7"></a><span class="kw">mmm</span>(gapminder<span class="op">$</span>country)</span>
<span id="cb247-8"><a href="#cb247-8"></a><span class="co">#&gt; Error in mmm(gapminder$country): is.numeric(x) is not TRUE</span></span>
<span id="cb247-9"><a href="#cb247-9"></a><span class="kw">mmm</span>(<span class="st">&quot;eggplants are purple&quot;</span>)</span>
<span id="cb247-10"><a href="#cb247-10"></a><span class="co">#&gt; Error in mmm(&quot;eggplants are purple&quot;): is.numeric(x) is not TRUE</span></span>
<span id="cb247-11"><a href="#cb247-11"></a><span class="kw">mmm</span>(gapminder[<span class="kw">c</span>(<span class="st">&#39;lifeExp&#39;</span>, <span class="st">&#39;gdpPercap&#39;</span>, <span class="st">&#39;pop&#39;</span>)])</span>
<span id="cb247-12"><a href="#cb247-12"></a><span class="co">#&gt; Error in mmm(gapminder[c(&quot;lifeExp&quot;, &quot;gdpPercap&quot;, &quot;pop&quot;)]): is.numeric(x) is not TRUE</span></span>
<span id="cb247-13"><a href="#cb247-13"></a><span class="kw">mmm</span>(<span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="ot">TRUE</span>, <span class="ot">TRUE</span>))</span>
<span id="cb247-14"><a href="#cb247-14"></a><span class="co">#&gt; Error in mmm(c(TRUE, TRUE, FALSE, TRUE, TRUE)): is.numeric(x) is not TRUE</span></span></code></pre></div>
<p>And we see that it catches all of the self-inflicted damage we would like to avoid.</p>
</div>
<div id="if-then-stop" class="section level3">
<h3><span class="header-section-number">18.7.2</span> if then stop</h3>
<p><code>stopifnot()</code> doesn’t provide a very good error message. The next approach is very widely used. Put your validity check inside an <code>if()</code> statement and call <code>stop()</code> yourself, with a custom error message, in the body.</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="#cb248-1"></a>mmm2 &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</span>
<span id="cb248-2"><a href="#cb248-2"></a>  <span class="cf">if</span>(<span class="op">!</span><span class="kw">is.numeric</span>(x)) {</span>
<span id="cb248-3"><a href="#cb248-3"></a>    <span class="kw">stop</span>(<span class="st">&#39;I am so sorry, but this function only works for numeric input!</span><span class="ch">\n</span><span class="st">&#39;</span>,</span>
<span id="cb248-4"><a href="#cb248-4"></a>         <span class="st">&#39;You have provided an object of class: &#39;</span>, <span class="kw">class</span>(x)[<span class="dv">1</span>])</span>
<span id="cb248-5"><a href="#cb248-5"></a>  }</span>
<span id="cb248-6"><a href="#cb248-6"></a>  <span class="kw">max</span>(x) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(x)</span>
<span id="cb248-7"><a href="#cb248-7"></a>}</span>
<span id="cb248-8"><a href="#cb248-8"></a><span class="kw">mmm2</span>(gapminder)</span>
<span id="cb248-9"><a href="#cb248-9"></a><span class="co">#&gt; Error in mmm2(gapminder): I am so sorry, but this function only works for numeric input!</span></span>
<span id="cb248-10"><a href="#cb248-10"></a><span class="co">#&gt; You have provided an object of class: tbl_df</span></span></code></pre></div>
<p>In addition to a gratuitous apology, the error raised also contains two more pieces of helpful info:</p>
<ul>
<li><em>Which</em> function threw the error.</li>
<li>Hints on how to fix things: expected class of input vs actual class.</li>
</ul>
<p>If it is easy to do so, I highly recommend this template: “you gave me THIS, but I need THAT”.</p>
<p>The tidyverse style guide has a very useful <a href="https://style.tidyverse.org/error-messages.html">chapter on how to construct error messages</a>.</p>
</div>
<div id="sidebar-non-programming-uses-for-assertions" class="section level3">
<h3><span class="header-section-number">18.7.3</span> Sidebar: non-programming uses for assertions</h3>
<p>Another good use of this pattern is to leave checks behind in data analytical scripts. Consider our repetitive use of Gapminder in this course. Every time we load it, we inspect it, hoping to see the usual stuff. If we were loading from file (vs. a stable data package), we might want to formalize our expectations about the number of rows and columns, the names and flavors of the variables, etc. This would alert us if the data suddenly changed, which can be a useful wake-up call in scripts that you re-run <em>ad nauseam</em> on auto-pilot or non-interactively.</p>
</div>
</div>
<div id="wrap-up-and-whats-next" class="section level2">
<h2><span class="header-section-number">18.8</span> Wrap-up and what’s next?</h2>
<p>Here’s the function we’ve written so far:</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="#cb249-1"></a>mmm2</span>
<span id="cb249-2"><a href="#cb249-2"></a><span class="co">#&gt; function(x) {</span></span>
<span id="cb249-3"><a href="#cb249-3"></a><span class="co">#&gt;   if(!is.numeric(x)) {</span></span>
<span id="cb249-4"><a href="#cb249-4"></a><span class="co">#&gt;     stop(&#39;I am so sorry, but this function only works for numeric input!\n&#39;,</span></span>
<span id="cb249-5"><a href="#cb249-5"></a><span class="co">#&gt;          &#39;You have provided an object of class: &#39;, class(x)[1])</span></span>
<span id="cb249-6"><a href="#cb249-6"></a><span class="co">#&gt;   }</span></span>
<span id="cb249-7"><a href="#cb249-7"></a><span class="co">#&gt;   max(x) - min(x)</span></span>
<span id="cb249-8"><a href="#cb249-8"></a><span class="co">#&gt; }</span></span></code></pre></div>
<p>What we’ve accomplished:</p>
<ul>
<li>We’ve written our first function.</li>
<li>We are checking the validity of its input, argument <code>x</code>.</li>
<li>We’ve done a good amount of informal testing.</li>
</ul>
<p>Where to next? In <a href="#functions-part2">part 2</a> we generalize this function to take differences in other quantiles and learn how to set default values for arguments.</p>
</div>
<div id="resources-6" class="section level2">
<h2><span class="header-section-number">18.9</span> Resources</h2>
<p>Packages for runtime assertions (the last 3 seem to be under more active development than <code>assertthat</code>):</p>
<ul>
<li>assertthat on <a href="https://CRAN.R-project.org/package=assertthat">CRAN</a> and <a href="https://github.com/hadley/assertthat">GitHub</a> - <em>the Hadleyverse option</em></li>
<li>ensurer on <a href="https://CRAN.R-project.org/package=ensurer">CRAN</a> and <a href="https://github.com/smbache/ensurer">GitHub</a> - <em>general purpose, pipe-friendly</em></li>
<li>assertr on <a href="https://CRAN.R-project.org/package=assertr">CRAN</a> and <a href="https://github.com/ropensci/assertr">GitHub</a> - <em>explicitly data pipeline oriented</em></li>
<li>assertive on <a href="https://CRAN.R-project.org/package=assertive">CRAN</a> and <a href="https://bitbucket.org/richierocks/assertive/src/master/">Bitbucket</a> - <em>rich set of built-in functions</em></li>
</ul>
<p>Hadley Wickham’s book <a href="http://adv-r.had.co.nz">Advanced R</a> <span class="citation">(<a href="#ref-wickham2015a" role="doc-biblioref">2015</a>)</span>:</p>
<ul>
<li>Section on <a href="http://adv-r.had.co.nz/Exceptions-Debugging.html#defensive-programming">defensive programming</a></li>
</ul>
<!--RStudio Links-->
<!--HappyGitWithR Links-->
<!--Package Links-->
<!--Shiny links-->
<!--Publications-->
<!--R Documentation-->
<!--Wikipedia Links-->
<!--Misc. Links-->
<!--chapter:end:018_functions-part1.Rmd-->
</div>
</div>
<div id="functions-part2" class="section level1">
<h1><span class="header-section-number">19</span> Write your own R functions, part 2</h1>
<!--Original content: https://stat545.com/block011_write-your-own-function-02.html-->
<div id="where-were-we-where-are-we-going" class="section level2">
<h2><span class="header-section-number">19.1</span> Where were we? Where are we going?</h2>
<p>In <a href="#functions-part1">part 1</a> we wrote our first R function to compute the difference between the max and min of a numeric vector. We checked the validity of the function’s only argument and, informally, we verified that it worked pretty well.</p>
<p>In this part, we generalize this function, learn more technical details about R functions, and set default values for some arguments.</p>
</div>
<div id="load-the-gapminder-data-1" class="section level2">
<h2><span class="header-section-number">19.2</span> Load the Gapminder data</h2>
<p>As usual, load gapminder.</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="#cb250-1"></a><span class="kw">library</span>(gapminder)</span></code></pre></div>
</div>
<div id="restore-our-max-minus-min-function" class="section level2">
<h2><span class="header-section-number">19.3</span> Restore our max minus min function</h2>
<p>Let’s keep our previous function around as a baseline.</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="#cb251-1"></a>mmm &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</span>
<span id="cb251-2"><a href="#cb251-2"></a>  <span class="kw">stopifnot</span>(<span class="kw">is.numeric</span>(x))</span>
<span id="cb251-3"><a href="#cb251-3"></a>  <span class="kw">max</span>(x) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(x)</span>
<span id="cb251-4"><a href="#cb251-4"></a>}</span></code></pre></div>
</div>
<div id="generalize-our-function-to-other-quantiles" class="section level2">
<h2><span class="header-section-number">19.4</span> Generalize our function to other quantiles</h2>
<p>The max and the min are special cases of a <strong>quantile</strong>. Here are other special cases you may have heard of:</p>
<ul>
<li>median = 0.5 quantile</li>
<li>1st quartile = 0.25 quantile</li>
<li>3rd quartile = 0.75 quantile</li>
</ul>
<p>If you’re familiar with <a href="https://en.wikipedia.org/wiki/Box_plot">box plots</a>, the rectangle typically runs from the 1st quartile to the 3rd quartile, with a line at the median.</p>
<p>If <span class="math inline">\(q\)</span> is the <span class="math inline">\(p\)</span>-th quantile of a set of <span class="math inline">\(n\)</span> observations, what does that mean? Approximately <span class="math inline">\(pn\)</span> of the observations are less than <span class="math inline">\(q\)</span> and <span class="math inline">\((1 - p)n\)</span> are greater than <span class="math inline">\(q\)</span>. Yeah, you need to worry about rounding to an integer and less/greater than or equal to, but these details aren’t critical here.</p>
<p>Let’s generalize our function to take the difference between any two quantiles. We can still consider the max and min, if we like, but we’re not limited to that.</p>
</div>
<div id="get-something-that-works-again" class="section level2">
<h2><span class="header-section-number">19.5</span> Get something that works, again</h2>
<p>The eventual inputs to our new function will be the data <code>x</code> and two probabilities.</p>
<p>First, play around with the <code>quantile()</code> function. Convince yourself you know how to use it, for example, by cross-checking your results with other built-in functions.</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="#cb252-1"></a><span class="kw">quantile</span>(gapminder<span class="op">$</span>lifeExp)</span>
<span id="cb252-2"><a href="#cb252-2"></a><span class="co">#&gt;   0%  25%  50%  75% 100% </span></span>
<span id="cb252-3"><a href="#cb252-3"></a><span class="co">#&gt; 23.6 48.2 60.7 70.8 82.6</span></span>
<span id="cb252-4"><a href="#cb252-4"></a><span class="kw">quantile</span>(gapminder<span class="op">$</span>lifeExp, <span class="dt">probs =</span> <span class="fl">0.5</span>)</span>
<span id="cb252-5"><a href="#cb252-5"></a><span class="co">#&gt;  50% </span></span>
<span id="cb252-6"><a href="#cb252-6"></a><span class="co">#&gt; 60.7</span></span>
<span id="cb252-7"><a href="#cb252-7"></a><span class="kw">median</span>(gapminder<span class="op">$</span>lifeExp)</span>
<span id="cb252-8"><a href="#cb252-8"></a><span class="co">#&gt; [1] 60.7</span></span>
<span id="cb252-9"><a href="#cb252-9"></a><span class="kw">quantile</span>(gapminder<span class="op">$</span>lifeExp, <span class="dt">probs =</span> <span class="kw">c</span>(<span class="fl">0.25</span>, <span class="fl">0.75</span>))</span>
<span id="cb252-10"><a href="#cb252-10"></a><span class="co">#&gt;  25%  75% </span></span>
<span id="cb252-11"><a href="#cb252-11"></a><span class="co">#&gt; 48.2 70.8</span></span>
<span id="cb252-12"><a href="#cb252-12"></a><span class="kw">boxplot</span>(gapminder<span class="op">$</span>lifeExp, <span class="dt">plot =</span> <span class="ot">FALSE</span>)<span class="op">$</span>stats</span>
<span id="cb252-13"><a href="#cb252-13"></a><span class="co">#&gt;      [,1]</span></span>
<span id="cb252-14"><a href="#cb252-14"></a><span class="co">#&gt; [1,] 23.6</span></span>
<span id="cb252-15"><a href="#cb252-15"></a><span class="co">#&gt; [2,] 48.2</span></span>
<span id="cb252-16"><a href="#cb252-16"></a><span class="co">#&gt; [3,] 60.7</span></span>
<span id="cb252-17"><a href="#cb252-17"></a><span class="co">#&gt; [4,] 70.8</span></span>
<span id="cb252-18"><a href="#cb252-18"></a><span class="co">#&gt; [5,] 82.6</span></span></code></pre></div>
<p>Now write a code snippet that takes the difference between two quantiles.</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="#cb253-1"></a>the_probs &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.25</span>, <span class="fl">0.75</span>)</span>
<span id="cb253-2"><a href="#cb253-2"></a>the_quantiles &lt;-<span class="st"> </span><span class="kw">quantile</span>(gapminder<span class="op">$</span>lifeExp, <span class="dt">probs =</span> the_probs)</span>
<span id="cb253-3"><a href="#cb253-3"></a><span class="kw">max</span>(the_quantiles) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(the_quantiles)</span>
<span id="cb253-4"><a href="#cb253-4"></a><span class="co">#&gt; [1] 22.6</span></span></code></pre></div>
</div>
<div id="turn-the-working-interactive-code-into-a-function-again" class="section level2">
<h2><span class="header-section-number">19.6</span> Turn the working interactive code into a function, again</h2>
<p>I’ll use <code>qdiff</code> as the base of our function’s name. I copy the overall structure from our previous “max minus min” work but replace the guts of the function with the more general code we just developed.</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="#cb254-1"></a>qdiff1 &lt;-<span class="st"> </span><span class="cf">function</span>(x, probs) {</span>
<span id="cb254-2"><a href="#cb254-2"></a>  <span class="kw">stopifnot</span>(<span class="kw">is.numeric</span>(x))</span>
<span id="cb254-3"><a href="#cb254-3"></a>  the_quantiles &lt;-<span class="st"> </span><span class="kw">quantile</span>(<span class="dt">x =</span> x, <span class="dt">probs =</span> probs)</span>
<span id="cb254-4"><a href="#cb254-4"></a>  <span class="kw">max</span>(the_quantiles) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(the_quantiles)</span>
<span id="cb254-5"><a href="#cb254-5"></a>}</span>
<span id="cb254-6"><a href="#cb254-6"></a><span class="kw">qdiff1</span>(gapminder<span class="op">$</span>lifeExp, <span class="dt">probs =</span> <span class="kw">c</span>(<span class="fl">0.25</span>, <span class="fl">0.75</span>))</span>
<span id="cb254-7"><a href="#cb254-7"></a><span class="co">#&gt; [1] 22.6</span></span>
<span id="cb254-8"><a href="#cb254-8"></a><span class="kw">IQR</span>(gapminder<span class="op">$</span>lifeExp) <span class="co"># hey, we&#39;ve reinvented IQR</span></span>
<span id="cb254-9"><a href="#cb254-9"></a><span class="co">#&gt; [1] 22.6</span></span>
<span id="cb254-10"><a href="#cb254-10"></a><span class="kw">qdiff1</span>(gapminder<span class="op">$</span>lifeExp, <span class="dt">probs =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb254-11"><a href="#cb254-11"></a><span class="co">#&gt; [1] 59</span></span>
<span id="cb254-12"><a href="#cb254-12"></a><span class="kw">mmm</span>(gapminder<span class="op">$</span>lifeExp)</span>
<span id="cb254-13"><a href="#cb254-13"></a><span class="co">#&gt; [1] 59</span></span></code></pre></div>
<p>Again we do some informal tests against familiar results and external implementations.</p>
</div>
<div id="argument-names-freedom-and-conventions" class="section level2">
<h2><span class="header-section-number">19.7</span> Argument names: freedom and conventions</h2>
<p>I want you to understand the importance of argument names.</p>
<p>I can name my arguments almost anything I like. Proof:</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="#cb255-1"></a>qdiff2 &lt;-<span class="st"> </span><span class="cf">function</span>(zeus, hera) {</span>
<span id="cb255-2"><a href="#cb255-2"></a>  <span class="kw">stopifnot</span>(<span class="kw">is.numeric</span>(zeus))</span>
<span id="cb255-3"><a href="#cb255-3"></a>  the_quantiles &lt;-<span class="st"> </span><span class="kw">quantile</span>(<span class="dt">x =</span> zeus, <span class="dt">probs =</span> hera)</span>
<span id="cb255-4"><a href="#cb255-4"></a>  <span class="kw">max</span>(the_quantiles) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(the_quantiles)</span>
<span id="cb255-5"><a href="#cb255-5"></a>}</span>
<span id="cb255-6"><a href="#cb255-6"></a><span class="kw">qdiff2</span>(<span class="dt">zeus =</span> gapminder<span class="op">$</span>lifeExp, <span class="dt">hera =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>)</span>
<span id="cb255-7"><a href="#cb255-7"></a><span class="co">#&gt; [1] 59</span></span></code></pre></div>
<p>While I can name my arguments after Greek gods, it’s usually a bad idea. Take all opportunities to make things more self-explanatory via meaningful names.</p>
<p>If you are going to pass the arguments of your function as arguments of a built-in function, consider copying the argument names. Unless you have a good reason to do your own thing (some argument names are bad!), be consistent with the existing function. Again, the reason is to reduce your cognitive load. This is what I’ve been doing all along and now you know why:</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="#cb256-1"></a>qdiff1</span>
<span id="cb256-2"><a href="#cb256-2"></a><span class="co">#&gt; function(x, probs) {</span></span>
<span id="cb256-3"><a href="#cb256-3"></a><span class="co">#&gt;   stopifnot(is.numeric(x))</span></span>
<span id="cb256-4"><a href="#cb256-4"></a><span class="co">#&gt;   the_quantiles &lt;- quantile(x = x, probs = probs)</span></span>
<span id="cb256-5"><a href="#cb256-5"></a><span class="co">#&gt;   max(the_quantiles) - min(the_quantiles)</span></span>
<span id="cb256-6"><a href="#cb256-6"></a><span class="co">#&gt; }</span></span>
<span id="cb256-7"><a href="#cb256-7"></a><span class="co">#&gt; &lt;bytecode: 0x000000001aee0b68&gt;</span></span></code></pre></div>
<p>We took this detour so you could see there is no <em>structural</em> relationship between my arguments (<code>x</code> and <code>probs</code>) and those of <code>quantile()</code> (also <code>x</code> and <code>probs</code>). The similarity or equivalence of the names <strong>accomplishes nothing</strong> as far as R is concerned; it is solely for the benefit of humans reading, writing, and using the code. Which is very important!</p>
</div>
<div id="what-a-function-returns" class="section level2">
<h2><span class="header-section-number">19.8</span> What a function returns</h2>
<p>By this point, I expect someone will have asked about the last line in my function’s body. Look above for a reminder of the function’s definition.</p>
<p>By default, a function returns the result of the last line of the body. I am just letting that happen with the line <code>max(the_quantiles) - min(the_quantiles)</code>. However, there is an explicit function for this: <code>return()</code>. I could just as easily make this the last line of my function’s body:</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="#cb257-1"></a><span class="kw">return</span>(<span class="kw">max</span>(the_quantiles) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(the_quantiles))</span></code></pre></div>
<p>You absolutely must use <code>return()</code> if you want to return early based on some condition, i.e. before execution gets to the last line of the body. Otherwise, you can decide your own conventions about when you use <code>return()</code> and when you don’t.</p>
</div>
<div id="default-values-freedom-to-not-specify-the-arguments" class="section level2">
<h2><span class="header-section-number">19.9</span> Default values: freedom to NOT specify the arguments</h2>
<p>What happens if we call our function but neglect to specify the probabilities?</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="#cb258-1"></a><span class="kw">qdiff1</span>(gapminder<span class="op">$</span>lifeExp)</span>
<span id="cb258-2"><a href="#cb258-2"></a><span class="co">#&gt; Error in quantile(x = x, probs = probs): argument &quot;probs&quot; is missing, with no default</span></span></code></pre></div>
<p>Oops! At the moment, this causes a fatal error. It can be nice to provide some reasonable default values for certain arguments. In our case, it would be crazy to specify a default value for the primary input <code>x</code>, but very kind to specify a default for <code>probs</code>.</p>
<p>We started by focusing on the max and the min, so I think those make reasonable defaults. Here’s how to specify that in a function definition.</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="#cb259-1"></a>qdiff3 &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">probs =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) {</span>
<span id="cb259-2"><a href="#cb259-2"></a>  <span class="kw">stopifnot</span>(<span class="kw">is.numeric</span>(x))</span>
<span id="cb259-3"><a href="#cb259-3"></a>  the_quantiles &lt;-<span class="st"> </span><span class="kw">quantile</span>(x, probs)</span>
<span id="cb259-4"><a href="#cb259-4"></a>  <span class="kw">max</span>(the_quantiles) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(the_quantiles)</span>
<span id="cb259-5"><a href="#cb259-5"></a>}</span></code></pre></div>
<p>Again we check how the function works, in old examples and new, specifying the <code>probs</code> argument and not.</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="#cb260-1"></a><span class="kw">qdiff3</span>(gapminder<span class="op">$</span>lifeExp)</span>
<span id="cb260-2"><a href="#cb260-2"></a><span class="co">#&gt; [1] 59</span></span>
<span id="cb260-3"><a href="#cb260-3"></a><span class="kw">mmm</span>(gapminder<span class="op">$</span>lifeExp)</span>
<span id="cb260-4"><a href="#cb260-4"></a><span class="co">#&gt; [1] 59</span></span>
<span id="cb260-5"><a href="#cb260-5"></a><span class="kw">qdiff3</span>(gapminder<span class="op">$</span>lifeExp, <span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>))</span>
<span id="cb260-6"><a href="#cb260-6"></a><span class="co">#&gt; [1] 33.6</span></span></code></pre></div>
</div>
<div id="check-the-validity-of-arguments-again" class="section level2">
<h2><span class="header-section-number">19.10</span> Check the validity of arguments, again</h2>
<p><strong>Exercise:</strong> upgrade our argument validity checks in light of the new argument <code>probs</code>.</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="#cb261-1"></a><span class="co">## problems identified during class</span></span>
<span id="cb261-2"><a href="#cb261-2"></a><span class="co">## we&#39;re not checking that probs is numeric</span></span>
<span id="cb261-3"><a href="#cb261-3"></a><span class="co">## we&#39;re not checking that probs is length 2</span></span>
<span id="cb261-4"><a href="#cb261-4"></a><span class="co">## we&#39;re not checking that probs are in [0,1]</span></span></code></pre></div>
</div>
<div id="wrap-up-and-whats-next-1" class="section level2">
<h2><span class="header-section-number">19.11</span> Wrap-up and what’s next?</h2>
<p>Here’s the function we’ve written so far:</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="#cb262-1"></a>qdiff3</span>
<span id="cb262-2"><a href="#cb262-2"></a><span class="co">#&gt; function(x, probs = c(0, 1)) {</span></span>
<span id="cb262-3"><a href="#cb262-3"></a><span class="co">#&gt;   stopifnot(is.numeric(x))</span></span>
<span id="cb262-4"><a href="#cb262-4"></a><span class="co">#&gt;   the_quantiles &lt;- quantile(x, probs)</span></span>
<span id="cb262-5"><a href="#cb262-5"></a><span class="co">#&gt;   max(the_quantiles) - min(the_quantiles)</span></span>
<span id="cb262-6"><a href="#cb262-6"></a><span class="co">#&gt; }</span></span>
<span id="cb262-7"><a href="#cb262-7"></a><span class="co">#&gt; &lt;bytecode: 0x000000001bcab388&gt;</span></span></code></pre></div>
<p>What we’ve accomplished:</p>
<ul>
<li>We’ve generalized our first function to take a difference between arbitrary quantiles.</li>
<li>We’ve specified default values for the probabilities that set the quantiles.</li>
</ul>
<p>Where to next? In <a href="#functions-part3">part 3</a> we tackle <code>NA</code>s, the special <code>...</code> argument, and formal unit testing.</p>
</div>
<div id="resources-7" class="section level2">
<h2><span class="header-section-number">19.12</span> Resources</h2>
<p>Hadley Wickham’s book <a href="http://adv-r.had.co.nz">Advanced R</a> <span class="citation">(<a href="#ref-wickham2015a" role="doc-biblioref">2015</a>)</span>:</p>
<ul>
<li>Section on <a href="http://adv-r.had.co.nz/Functions.html#function-arguments">function arguments</a></li>
<li>Section on <a href="http://adv-r.had.co.nz/Functions.html#return-values">return values</a></li>
</ul>
<!--RStudio Links-->
<!--HappyGitWithR Links-->
<!--Package Links-->
<!--Shiny links-->
<!--Publications-->
<!--R Documentation-->
<!--Wikipedia Links-->
<!--Misc. Links-->
<!--chapter:end:019_functions-part2.Rmd-->
</div>
</div>
<div id="functions-part3" class="section level1">
<h1><span class="header-section-number">20</span> Write your own R functions, part 3</h1>
<!--Original content: https://stat545.com/block011_write-your-own-function-03.html-->
<div id="where-were-we-where-are-we-going-1" class="section level2">
<h2><span class="header-section-number">20.1</span> Where were we? Where are we going?</h2>
<p>In <a href="#functions-part2">part 2</a> we generalized our first R function so it could take the difference between any two quantiles of a numeric vector. We also set default values for the underlying probabilities, so that, by default, we compute the max minus the min.</p>
<p>In this part, we tackle <code>NA</code>s, the special argument <code>...</code> and formal testing.</p>
</div>
<div id="load-the-gapminder-data-2" class="section level2">
<h2><span class="header-section-number">20.2</span> Load the Gapminder data</h2>
<p>As usual, load gapminder.</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="#cb263-1"></a><span class="kw">library</span>(gapminder)</span></code></pre></div>
</div>
<div id="restore-our-max-minus-min-function-1" class="section level2">
<h2><span class="header-section-number">20.3</span> Restore our max minus min function</h2>
<p>Let’s keep our previous function around as a baseline.</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="#cb264-1"></a>qdiff3 &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">probs =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) {</span>
<span id="cb264-2"><a href="#cb264-2"></a>  <span class="kw">stopifnot</span>(<span class="kw">is.numeric</span>(x))</span>
<span id="cb264-3"><a href="#cb264-3"></a>  the_quantiles &lt;-<span class="st"> </span><span class="kw">quantile</span>(x, probs)</span>
<span id="cb264-4"><a href="#cb264-4"></a>  <span class="kw">max</span>(the_quantiles) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(the_quantiles)</span>
<span id="cb264-5"><a href="#cb264-5"></a>}</span></code></pre></div>
</div>
<div id="be-proactive-about-nas" class="section level2">
<h2><span class="header-section-number">20.4</span> Be proactive about <code>NA</code>s</h2>
<p>I am being gentle by letting you practice with the Gapminder data. In real life, missing data will make your life a living hell. If you are lucky, it will be properly indicated by the special value <code>NA</code>, but don’t hold your breath. Many built-in R functions have an <code>na.rm =</code> argument through which you can specify how you want to handle <code>NA</code>s. Typically the default value is <code>na.rm = FALSE</code> and typical default behavior is to either let <code>NA</code>s propagate or to raise an error. Let’s see how <code>quantile()</code> handles <code>NA</code>s:</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="#cb265-1"></a>z &lt;-<span class="st"> </span>gapminder<span class="op">$</span>lifeExp</span>
<span id="cb265-2"><a href="#cb265-2"></a>z[<span class="dv">3</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb265-3"><a href="#cb265-3"></a><span class="kw">quantile</span>(gapminder<span class="op">$</span>lifeExp)</span>
<span id="cb265-4"><a href="#cb265-4"></a><span class="co">#&gt;   0%  25%  50%  75% 100% </span></span>
<span id="cb265-5"><a href="#cb265-5"></a><span class="co">#&gt; 23.6 48.2 60.7 70.8 82.6</span></span>
<span id="cb265-6"><a href="#cb265-6"></a><span class="kw">quantile</span>(z)</span>
<span id="cb265-7"><a href="#cb265-7"></a><span class="co">#&gt; Error in quantile.default(z): missing values and NaN&#39;s not allowed if &#39;na.rm&#39; is FALSE</span></span>
<span id="cb265-8"><a href="#cb265-8"></a><span class="kw">quantile</span>(z, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span>
<span id="cb265-9"><a href="#cb265-9"></a><span class="co">#&gt;   0%  25%  50%  75% 100% </span></span>
<span id="cb265-10"><a href="#cb265-10"></a><span class="co">#&gt; 23.6 48.2 60.8 70.8 82.6</span></span></code></pre></div>
<p>So <code>quantile()</code> simply will not operate in the presence of <code>NA</code>s unless <code>na.rm = TRUE</code>. How shall we modify our function?</p>
<p>If we wanted to hardwire <code>na.rm = TRUE</code>, we could. Focus on our call to <code>quantile()</code> inside our function definition.</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="#cb266-1"></a>qdiff4 &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">probs =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) {</span>
<span id="cb266-2"><a href="#cb266-2"></a>  <span class="kw">stopifnot</span>(<span class="kw">is.numeric</span>(x))</span>
<span id="cb266-3"><a href="#cb266-3"></a>  the_quantiles &lt;-<span class="st"> </span><span class="kw">quantile</span>(x, probs, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span>
<span id="cb266-4"><a href="#cb266-4"></a>  <span class="kw">max</span>(the_quantiles) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(the_quantiles)</span>
<span id="cb266-5"><a href="#cb266-5"></a>}</span>
<span id="cb266-6"><a href="#cb266-6"></a><span class="kw">qdiff4</span>(gapminder<span class="op">$</span>lifeExp)</span>
<span id="cb266-7"><a href="#cb266-7"></a><span class="co">#&gt; [1] 59</span></span>
<span id="cb266-8"><a href="#cb266-8"></a><span class="kw">qdiff4</span>(z)</span>
<span id="cb266-9"><a href="#cb266-9"></a><span class="co">#&gt; [1] 59</span></span></code></pre></div>
<p>This works but it is dangerous to invert the default behavior of a well-known built-in function and to provide the user with no way to override this.</p>
<p>We could add an <code>na.rm =</code> argument to our own function. We might even enforce our preferred default – but at least we’re giving the user a way to control the behavior around <code>NA</code>s.</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="#cb267-1"></a>qdiff5 &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">probs =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) {</span>
<span id="cb267-2"><a href="#cb267-2"></a>  <span class="kw">stopifnot</span>(<span class="kw">is.numeric</span>(x))</span>
<span id="cb267-3"><a href="#cb267-3"></a>  the_quantiles &lt;-<span class="st"> </span><span class="kw">quantile</span>(x, probs, <span class="dt">na.rm =</span> na.rm)</span>
<span id="cb267-4"><a href="#cb267-4"></a>  <span class="kw">max</span>(the_quantiles) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(the_quantiles)</span>
<span id="cb267-5"><a href="#cb267-5"></a>}</span>
<span id="cb267-6"><a href="#cb267-6"></a><span class="kw">qdiff5</span>(gapminder<span class="op">$</span>lifeExp)</span>
<span id="cb267-7"><a href="#cb267-7"></a><span class="co">#&gt; [1] 59</span></span>
<span id="cb267-8"><a href="#cb267-8"></a><span class="kw">qdiff5</span>(z)</span>
<span id="cb267-9"><a href="#cb267-9"></a><span class="co">#&gt; [1] 59</span></span>
<span id="cb267-10"><a href="#cb267-10"></a><span class="kw">qdiff5</span>(z, <span class="dt">na.rm =</span> <span class="ot">FALSE</span>)</span>
<span id="cb267-11"><a href="#cb267-11"></a><span class="co">#&gt; Error in quantile.default(x, probs, na.rm = na.rm): missing values and NaN&#39;s not allowed if &#39;na.rm&#39; is FALSE</span></span></code></pre></div>
</div>
<div id="the-useful-but-mysterious-...-argument" class="section level2">
<h2><span class="header-section-number">20.5</span> The useful but mysterious <code>...</code> argument</h2>
<p>You probably could have lived a long and happy life without knowing there are at least 9 different algorithms for computing quantiles. <a href="https://rdrr.io/r/stats/quantile.html">Go read about the <code>type</code> argument</a> of <code>quantile()</code>. TLDR: If a quantile is not unambiguously equal to an observed data point, you must somehow average two data points. You can weight this average different ways, depending on the rest of the data, and <code>type =</code> controls this.</p>
<p>Let’s say we want to give the user of our function the ability to specify how the quantiles are computed, but we want to accomplish with as little fuss as possible. In fact, we don’t even want to clutter our function’s interface with this! This calls for the very special <code>...</code> argument. In English, this set of three dots is frequently called an “ellipsis”.</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="#cb268-1"></a>qdiff6 &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">probs =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>, ...) {</span>
<span id="cb268-2"><a href="#cb268-2"></a>  the_quantiles &lt;-<span class="st"> </span><span class="kw">quantile</span>(<span class="dt">x =</span> x, <span class="dt">probs =</span> probs, <span class="dt">na.rm =</span> na.rm, ...)</span>
<span id="cb268-3"><a href="#cb268-3"></a>  <span class="kw">max</span>(the_quantiles) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(the_quantiles)</span>
<span id="cb268-4"><a href="#cb268-4"></a>}</span></code></pre></div>
<p>The practical significance of the <code>type =</code> argument is virtually nonexistent, so we can’t demo with the Gapminder data. Thanks to <a href="https://twitter.com/wrathematics">@wrathematics</a>, here’s a small example where we can (barely) detect a difference due to <code>type</code>.</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="#cb269-1"></a><span class="kw">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb269-2"><a href="#cb269-2"></a>z &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">10</span>)</span>
<span id="cb269-3"><a href="#cb269-3"></a><span class="kw">quantile</span>(z, <span class="dt">type =</span> <span class="dv">1</span>)</span>
<span id="cb269-4"><a href="#cb269-4"></a><span class="co">#&gt;     0%    25%    50%    75%   100% </span></span>
<span id="cb269-5"><a href="#cb269-5"></a><span class="co">#&gt; -2.346 -0.890 -0.564  0.429  1.084</span></span>
<span id="cb269-6"><a href="#cb269-6"></a><span class="kw">quantile</span>(z, <span class="dt">type =</span> <span class="dv">4</span>)</span>
<span id="cb269-7"><a href="#cb269-7"></a><span class="co">#&gt;     0%    25%    50%    75%   100% </span></span>
<span id="cb269-8"><a href="#cb269-8"></a><span class="co">#&gt; -2.346 -1.049 -0.564  0.353  1.084</span></span>
<span id="cb269-9"><a href="#cb269-9"></a><span class="kw">all.equal</span>(<span class="kw">quantile</span>(z, <span class="dt">type =</span> <span class="dv">1</span>), <span class="kw">quantile</span>(z, <span class="dt">type =</span> <span class="dv">4</span>))</span>
<span id="cb269-10"><a href="#cb269-10"></a><span class="co">#&gt; [1] &quot;Mean relative difference: 0.178&quot;</span></span></code></pre></div>
<p>Now we can call our function, requesting that quantiles be computed in different ways.</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="#cb270-1"></a><span class="kw">qdiff6</span>(z, <span class="dt">probs =</span> <span class="kw">c</span>(<span class="fl">0.25</span>, <span class="fl">0.75</span>), <span class="dt">type =</span> <span class="dv">1</span>)</span>
<span id="cb270-2"><a href="#cb270-2"></a><span class="co">#&gt; [1] 1.32</span></span>
<span id="cb270-3"><a href="#cb270-3"></a><span class="kw">qdiff6</span>(z, <span class="dt">probs =</span> <span class="kw">c</span>(<span class="fl">0.25</span>, <span class="fl">0.75</span>), <span class="dt">type =</span> <span class="dv">4</span>)</span>
<span id="cb270-4"><a href="#cb270-4"></a><span class="co">#&gt; [1] 1.4</span></span></code></pre></div>
<p>While the difference may be subtle, <strong>it’s there</strong>. Marvel at the fact that we have passed <code>type = 1</code> through to <code>quantile()</code> <em>even though it was not a formal argument of our own function</em>.</p>
<p>The special argument <code>...</code> is very useful when you want the ability to pass arbitrary arguments down to another function, but without constantly expanding the formal arguments to your function. This leaves you with a less cluttered function definition and gives you future flexibility to specify these arguments only when you need to.</p>
<p>You will also encounter the <code>...</code> argument in many built-in functions – read up on <a href="https://rdrr.io/r/base/c.html"><code>c()</code></a> or <a href="https://rdrr.io/r/base/list.html"><code>list()</code></a> – and now you have a better sense of what it means. It is not a breezy “and so on and so forth.”</p>
<p>There are also downsides to <code>...</code>, so use it with intention. In a package, you will have to work harder to create truly informative documentation for your user. Also, the quiet, absorbent properties of <code>...</code> mean it can sometimes silently swallow other named arguments, when the user has a typo in the name. Depending on whether or how this fails, it can be a little tricky to find out what went wrong.</p>
<p>The <a href="https://ellipsis.r-lib.org">ellipsis package</a> provides tools that help package developers use <code>...</code> more safely. The in-progress tidyverse principles guide provides further guidance on the design of functions that take <code>...</code> in <a href="https://principles.tidyverse.org/dots-position.html">Data, dots, details</a>.</p>
</div>
<div id="use-testthat-for-formal-unit-tests" class="section level2">
<h2><span class="header-section-number">20.6</span> Use testthat for formal unit tests</h2>
<p>Until now, we’ve relied on informal tests of our evolving function. If you are going to use a function a lot, especially if it is part of a package, it is wise to use formal unit tests.</p>
<p>The <a href="https://testthat.r-lib.org">testthat</a> package (<a href="https://CRAN.R-project.org/package=testthat">CRAN</a>; <a href="https://github.com/r-lib/testthat">GitHub</a>) provides excellent facilities for this, with a distinct emphasis on automated unit testing of entire packages. However, we can take it out for a test drive even with our one measly function.</p>
<p>We will construct a test with <code>test_that()</code> and, within it, we put one or more <em>expectations</em> that check actual against expected results. You simply harden your informal, interactive tests into formal unit tests. Here are some examples of tests and indicative expectations.</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="#cb271-1"></a><span class="kw">library</span>(testthat)</span>
<span id="cb271-2"><a href="#cb271-2"></a></span>
<span id="cb271-3"><a href="#cb271-3"></a><span class="kw">test_that</span>(<span class="st">&#39;invalid args are detected&#39;</span>, {</span>
<span id="cb271-4"><a href="#cb271-4"></a>  <span class="kw">expect_error</span>(<span class="kw">qdiff6</span>(<span class="st">&quot;eggplants are purple&quot;</span>))</span>
<span id="cb271-5"><a href="#cb271-5"></a>  <span class="kw">expect_error</span>(<span class="kw">qdiff6</span>(iris))</span>
<span id="cb271-6"><a href="#cb271-6"></a>})</span>
<span id="cb271-7"><a href="#cb271-7"></a></span>
<span id="cb271-8"><a href="#cb271-8"></a><span class="kw">test_that</span>(<span class="st">&#39;NA handling works&#39;</span>, {</span>
<span id="cb271-9"><a href="#cb271-9"></a>  <span class="kw">expect_error</span>(<span class="kw">qdiff6</span>(<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="ot">NA</span>), <span class="dt">na.rm =</span> <span class="ot">FALSE</span>))</span>
<span id="cb271-10"><a href="#cb271-10"></a>  <span class="kw">expect_equal</span>(<span class="kw">qdiff6</span>(<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="ot">NA</span>)), <span class="dv">4</span>)</span>
<span id="cb271-11"><a href="#cb271-11"></a>})</span></code></pre></div>
<p>No news is good news! Let’s see what test failure would look like. Let’s revert to a version of our function that does no <code>NA</code> handling, then test for proper <code>NA</code> handling. We can watch it fail.</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="#cb272-1"></a>qdiff_no_NA &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">probs =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) {</span>
<span id="cb272-2"><a href="#cb272-2"></a>  the_quantiles &lt;-<span class="st"> </span><span class="kw">quantile</span>(<span class="dt">x =</span> x, <span class="dt">probs =</span> probs)</span>
<span id="cb272-3"><a href="#cb272-3"></a>  <span class="kw">max</span>(the_quantiles) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(the_quantiles)</span>
<span id="cb272-4"><a href="#cb272-4"></a>}</span>
<span id="cb272-5"><a href="#cb272-5"></a></span>
<span id="cb272-6"><a href="#cb272-6"></a><span class="kw">test_that</span>(<span class="st">&#39;NA handling works&#39;</span>, {</span>
<span id="cb272-7"><a href="#cb272-7"></a>  <span class="kw">expect_that</span>(<span class="kw">qdiff_no_NA</span>(<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="ot">NA</span>)), <span class="kw">equals</span>(<span class="dv">4</span>))</span>
<span id="cb272-8"><a href="#cb272-8"></a>})</span></code></pre></div>
<p>Similar to the advice to use assertions in data analytical scripts, I recommend you use unit tests to monitor the behavior of functions you (or others) will use often. If your tests cover the function’s important behavior, then you can edit the internals freely. You’ll rest easy in the knowledge that, if you broke anything important, the tests will fail and alert you to the problem. A function that is important enough for unit tests probably also belongs in a package, where there are obvious mechanisms for running the tests as part of overall package checks.</p>
<!--JB:

## other content

match.arg()

defaulting to NULL then checking is.null() and take it from there

-->
</div>
<div id="resources-8" class="section level2">
<h2><span class="header-section-number">20.7</span> Resources</h2>
<ul>
<li>Hadley Wickham’s book <a href="http://adv-r.had.co.nz">Advanced R</a> <span class="citation">(<a href="#ref-wickham2015a" role="doc-biblioref">2015</a>)</span>
<ul>
<li>Section on <a href="http://adv-r.had.co.nz/Functions.html#function-arguments">function arguments</a></li>
</ul></li>
<li>Unit testing with testthat
<ul>
<li>On <a href="https://CRAN.R-project.org/package=testthat">CRAN</a>, development on <a href="https://github.com/r-lib/testthat">GitHub</a>, main <a href="https://testthat.r-lib.org">webpage</a></li>
</ul></li>
<li>Wickham and Bryan’s <a href="https://r-pkgs.org/index.html">R Packages</a> book <span class="citation">(in progress)</span>
<ul>
<li><a href="https://r-pkgs.org/tests.html">Testing chapter</a></li>
</ul></li>
<li>Wickham’s <a href="https://journal.r-project.org/archive/2011-1/RJournal_2011-1_Wickham.pdf">testthat: Get Started with Testing</a> article in The R Journal <span class="citation">(<a href="#ref-wickham2011b" role="doc-biblioref">2011</a><a href="#ref-wickham2011b" role="doc-biblioref">a</a>)</span>. Maybe this is completely superseded by the newer chapter above? Be aware that parts could be out of date, but I recall it was a helpful read.</li>
</ul>
<!--RStudio Links-->
<!--HappyGitWithR Links-->
<!--Package Links-->
<!--Shiny links-->
<!--Publications-->
<!--R Documentation-->
<!--Wikipedia Links-->
<!--Misc. Links-->
<!--chapter:end:020_functions-part3.Rmd-->
</div>
</div>
<div id="functions-practicum" class="section level1">
<h1><span class="header-section-number">21</span> Function-writing practicum</h1>
<!--Original content: https://stat545.com/block012_function-regress-lifeexp-on-year.html-->
<div id="overview-1" class="section level2">
<h2><span class="header-section-number">21.1</span> Overview</h2>
<p>We recently learned how to write our own R functions (<a href="#functions-part1">part 1</a>, <a href="#functions-part2">part 2</a>, <a href="#functions-part3">part 3</a>).</p>
<p>Now we use that knowledge to write another useful function, within the context of the Gapminder data:</p>
<ul>
<li>Input: a data.frame that contains (at least) a life expectancy variable <code>lifeExp</code> and a variable for year <code>year</code></li>
<li>Output: a vector of estimated intercept and slope, from a linear regression of <code>lifeExp</code> on <code>year</code></li>
</ul>
<p>The ultimate goal is to apply this function to the Gapminder data for a specific country. We will eventually scale up to <em>all</em> countries using external machinery, e.g., the <code>dplyr::group_by()</code> + <code>dplyr::do()</code>.</p>
</div>
<div id="load-the-gapminder-data-3" class="section level2">
<h2><span class="header-section-number">21.2</span> Load the Gapminder data</h2>
<p>As usual, load gapminder. Load ggplot2 because we’ll make some plots and load dplyr too.</p>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="#cb273-1"></a><span class="kw">library</span>(gapminder)</span>
<span id="cb273-2"><a href="#cb273-2"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb273-3"><a href="#cb273-3"></a><span class="kw">library</span>(dplyr)</span></code></pre></div>
</div>
<div id="get-data-to-practice-with" class="section level2">
<h2><span class="header-section-number">21.3</span> Get data to practice with</h2>
<p>I extract the data for one country in order to develop some working code interactively.</p>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="#cb274-1"></a>j_country &lt;-<span class="st"> &quot;France&quot;</span> <span class="co"># pick, but do not hard wire, an example</span></span>
<span id="cb274-2"><a href="#cb274-2"></a>(j_dat &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb274-3"><a href="#cb274-3"></a><span class="st">  </span><span class="kw">filter</span>(country <span class="op">==</span><span class="st"> </span>j_country))</span>
<span id="cb274-4"><a href="#cb274-4"></a><span class="co">#&gt; # A tibble: 12 x 6</span></span>
<span id="cb274-5"><a href="#cb274-5"></a><span class="co">#&gt;    country continent  year lifeExp      pop gdpPercap</span></span>
<span id="cb274-6"><a href="#cb274-6"></a><span class="co">#&gt;    &lt;fct&gt;   &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb274-7"><a href="#cb274-7"></a><span class="co">#&gt;  1 France  Europe     1952    67.4 42459667     7030.</span></span>
<span id="cb274-8"><a href="#cb274-8"></a><span class="co">#&gt;  2 France  Europe     1957    68.9 44310863     8663.</span></span>
<span id="cb274-9"><a href="#cb274-9"></a><span class="co">#&gt;  3 France  Europe     1962    70.5 47124000    10560.</span></span>
<span id="cb274-10"><a href="#cb274-10"></a><span class="co">#&gt;  4 France  Europe     1967    71.6 49569000    13000.</span></span>
<span id="cb274-11"><a href="#cb274-11"></a><span class="co">#&gt;  5 France  Europe     1972    72.4 51732000    16107.</span></span>
<span id="cb274-12"><a href="#cb274-12"></a><span class="co">#&gt;  6 France  Europe     1977    73.8 53165019    18293.</span></span>
<span id="cb274-13"><a href="#cb274-13"></a><span class="co">#&gt;  7 France  Europe     1982    74.9 54433565    20294.</span></span>
<span id="cb274-14"><a href="#cb274-14"></a><span class="co">#&gt;  8 France  Europe     1987    76.3 55630100    22066.</span></span>
<span id="cb274-15"><a href="#cb274-15"></a><span class="co">#&gt;  9 France  Europe     1992    77.5 57374179    24704.</span></span>
<span id="cb274-16"><a href="#cb274-16"></a><span class="co">#&gt; 10 France  Europe     1997    78.6 58623428    25890.</span></span>
<span id="cb274-17"><a href="#cb274-17"></a><span class="co">#&gt; 11 France  Europe     2002    79.6 59925035    28926.</span></span>
<span id="cb274-18"><a href="#cb274-18"></a><span class="co">#&gt; 12 France  Europe     2007    80.7 61083916    30470.</span></span></code></pre></div>
<p>Always always always plot the data. Yes, even now.</p>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="#cb275-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(j_dat, <span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> lifeExp))</span>
<span id="cb275-2"><a href="#cb275-2"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">se =</span> <span class="ot">FALSE</span>)</span>
<span id="cb275-3"><a href="#cb275-3"></a><span class="co">#&gt; `geom_smooth()` using formula &#39;y ~ x&#39;</span></span></code></pre></div>
<p><img src="021_functions-practicum_files/figure-html/first-example-scatterplot-1.png" width="672" /></p>
</div>
<div id="get-some-code-that-works" class="section level2">
<h2><span class="header-section-number">21.4</span> Get some code that works</h2>
<p>Fit the regression:</p>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="#cb276-1"></a>j_fit &lt;-<span class="st"> </span><span class="kw">lm</span>(lifeExp <span class="op">~</span><span class="st"> </span>year, j_dat)</span>
<span id="cb276-2"><a href="#cb276-2"></a><span class="kw">coef</span>(j_fit)</span>
<span id="cb276-3"><a href="#cb276-3"></a><span class="co">#&gt; (Intercept)        year </span></span>
<span id="cb276-4"><a href="#cb276-4"></a><span class="co">#&gt;    -397.765       0.239</span></span></code></pre></div>
<p>Whoa, check out that crazy intercept! Apparently the life expectancy in France around year 0 A.D. was minus 400 years! Never forget to sanity check a model. In this case, a reparametrization is in order. I think it makes more sense for the intercept to correspond to life expectancy in 1952, the earliest date in our dataset. Estimate the intercept eye-ball-o-metrically from the plot and confirm that we’ve got something sane and interpretable now.</p>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="#cb277-1"></a>j_fit &lt;-<span class="st"> </span><span class="kw">lm</span>(lifeExp <span class="op">~</span><span class="st"> </span><span class="kw">I</span>(year <span class="op">-</span><span class="st"> </span><span class="dv">1952</span>), j_dat)</span>
<span id="cb277-2"><a href="#cb277-2"></a><span class="kw">coef</span>(j_fit)</span>
<span id="cb277-3"><a href="#cb277-3"></a><span class="co">#&gt;    (Intercept) I(year - 1952) </span></span>
<span id="cb277-4"><a href="#cb277-4"></a><span class="co">#&gt;         67.790          0.239</span></span></code></pre></div>
<div id="sidebar-regression-stuff" class="section level3">
<h3><span class="header-section-number">21.4.1</span> Sidebar: regression stuff</h3>
<p>There are two things above that might prompt questions.</p>
<p>First, how did I know to get the estimated coefficients from a fitted model via <code>coef()</code>? Years of experience. But how might a novice learn such things? Read <a href="https://rdrr.io/r/stats/lm.html">the documentation for <code>lm()</code></a>, in this case. The “See also” section advises us about many functions that can operate on fitted linear model objects, including, but by no means limited to, <code>coef()</code>. Read <a href="https://rdrr.io/r/stats/coef.html">the documentation on <code>coef()</code></a> too.</p>
<p>Second, what am I doing here: <code>lm(lifeExp ~ I(year - 1952))</code>? I want the intercept to correspond to 1952 and an easy way to accomplish that is to create a new predictor on the fly: year minus 1952. The way I achieve that in the model formula, <code>I(year - 1952)</code>, uses the <code>I()</code> function which “inhibits interpretation/conversion of objects”. By protecting the expression <code>year - 1952</code>, I ensure it is interpreted in the obvious arithmetical way.</p>
</div>
</div>
<div id="turn-working-code-into-a-function" class="section level2">
<h2><span class="header-section-number">21.5</span> Turn working code into a function</h2>
<p>Create the basic definition of a function and drop your working code inside. Add arguments and edit the inner code to match. Apply it to the practice data. Do you get the same result as before?</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="#cb278-1"></a>le_lin_fit &lt;-<span class="st"> </span><span class="cf">function</span>(dat, <span class="dt">offset =</span> <span class="dv">1952</span>) {</span>
<span id="cb278-2"><a href="#cb278-2"></a>  the_fit &lt;-<span class="st"> </span><span class="kw">lm</span>(lifeExp <span class="op">~</span><span class="st"> </span><span class="kw">I</span>(year <span class="op">-</span><span class="st"> </span>offset), dat)</span>
<span id="cb278-3"><a href="#cb278-3"></a>  <span class="kw">coef</span>(the_fit)</span>
<span id="cb278-4"><a href="#cb278-4"></a>}</span>
<span id="cb278-5"><a href="#cb278-5"></a><span class="kw">le_lin_fit</span>(j_dat)</span>
<span id="cb278-6"><a href="#cb278-6"></a><span class="co">#&gt;      (Intercept) I(year - offset) </span></span>
<span id="cb278-7"><a href="#cb278-7"></a><span class="co">#&gt;           67.790            0.239</span></span></code></pre></div>
<p>I had to decide how to handle the offset. Given that I will scale this up to many countries, which, in theory, might have data for different dates, I chose to set a default of 1952. Strategies that compute the offset from data, either the main Gapminder dataset or the excerpt passed to this function, are also reasonable to consider.</p>
<p>I loathe the names on this return value. This is not my first rodeo and I know that, downstream, these will contaminate variable names and factor levels and show up in public places like plots and tables. Fix names early!</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="#cb279-1"></a>le_lin_fit &lt;-<span class="st"> </span><span class="cf">function</span>(dat, <span class="dt">offset =</span> <span class="dv">1952</span>) {</span>
<span id="cb279-2"><a href="#cb279-2"></a>  the_fit &lt;-<span class="st"> </span><span class="kw">lm</span>(lifeExp <span class="op">~</span><span class="st"> </span><span class="kw">I</span>(year <span class="op">-</span><span class="st"> </span>offset), dat)</span>
<span id="cb279-3"><a href="#cb279-3"></a>  <span class="kw">setNames</span>(<span class="kw">coef</span>(the_fit), <span class="kw">c</span>(<span class="st">&quot;intercept&quot;</span>, <span class="st">&quot;slope&quot;</span>))</span>
<span id="cb279-4"><a href="#cb279-4"></a>}</span>
<span id="cb279-5"><a href="#cb279-5"></a><span class="kw">le_lin_fit</span>(j_dat)</span>
<span id="cb279-6"><a href="#cb279-6"></a><span class="co">#&gt; intercept     slope </span></span>
<span id="cb279-7"><a href="#cb279-7"></a><span class="co">#&gt;    67.790     0.239</span></span></code></pre></div>
<p>Much better!</p>
</div>
<div id="test-on-other-data-and-in-a-clean-workspace" class="section level2">
<h2><span class="header-section-number">21.6</span> Test on other data and in a clean workspace</h2>
<p>It’s always good to rotate through examples during development. The most common error this will help you catch is when you accidentally hard-wire your example into your function. If you’re paying attention to your informal tests, you will find it creepy that your function returns <strong>exactly the same results</strong> regardless which input data you give it. This actually happened to me while I was writing this document, I kid you not! I had left <code>j_fit</code> inside the call to <code>coef()</code>, instead of switching it to <code>the_fit</code>. How did I catch that error? I saw the fitted line below, which clearly did not have an intercept in the late 60s and a positive slope, as my first example did. Figures are a mighty weapon in the fight against nonsense. I don’t trust analyses that have few/no figures.</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="#cb280-1"></a>j_country &lt;-<span class="st"> &quot;Zimbabwe&quot;</span></span>
<span id="cb280-2"><a href="#cb280-2"></a>(j_dat &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(country <span class="op">==</span><span class="st"> </span>j_country))</span>
<span id="cb280-3"><a href="#cb280-3"></a><span class="co">#&gt; # A tibble: 12 x 6</span></span>
<span id="cb280-4"><a href="#cb280-4"></a><span class="co">#&gt;    country  continent  year lifeExp      pop gdpPercap</span></span>
<span id="cb280-5"><a href="#cb280-5"></a><span class="co">#&gt;    &lt;fct&gt;    &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb280-6"><a href="#cb280-6"></a><span class="co">#&gt;  1 Zimbabwe Africa     1952    48.5  3080907      407.</span></span>
<span id="cb280-7"><a href="#cb280-7"></a><span class="co">#&gt;  2 Zimbabwe Africa     1957    50.5  3646340      519.</span></span>
<span id="cb280-8"><a href="#cb280-8"></a><span class="co">#&gt;  3 Zimbabwe Africa     1962    52.4  4277736      527.</span></span>
<span id="cb280-9"><a href="#cb280-9"></a><span class="co">#&gt;  4 Zimbabwe Africa     1967    54.0  4995432      570.</span></span>
<span id="cb280-10"><a href="#cb280-10"></a><span class="co">#&gt;  5 Zimbabwe Africa     1972    55.6  5861135      799.</span></span>
<span id="cb280-11"><a href="#cb280-11"></a><span class="co">#&gt;  6 Zimbabwe Africa     1977    57.7  6642107      686.</span></span>
<span id="cb280-12"><a href="#cb280-12"></a><span class="co">#&gt;  7 Zimbabwe Africa     1982    60.4  7636524      789.</span></span>
<span id="cb280-13"><a href="#cb280-13"></a><span class="co">#&gt;  8 Zimbabwe Africa     1987    62.4  9216418      706.</span></span>
<span id="cb280-14"><a href="#cb280-14"></a><span class="co">#&gt;  9 Zimbabwe Africa     1992    60.4 10704340      693.</span></span>
<span id="cb280-15"><a href="#cb280-15"></a><span class="co">#&gt; 10 Zimbabwe Africa     1997    46.8 11404948      792.</span></span>
<span id="cb280-16"><a href="#cb280-16"></a><span class="co">#&gt; 11 Zimbabwe Africa     2002    40.0 11926563      672.</span></span>
<span id="cb280-17"><a href="#cb280-17"></a><span class="co">#&gt; 12 Zimbabwe Africa     2007    43.5 12311143      470.</span></span>
<span id="cb280-18"><a href="#cb280-18"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(j_dat, <span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> lifeExp))</span>
<span id="cb280-19"><a href="#cb280-19"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">se =</span> <span class="ot">FALSE</span>)</span>
<span id="cb280-20"><a href="#cb280-20"></a><span class="co">#&gt; `geom_smooth()` using formula &#39;y ~ x&#39;</span></span></code></pre></div>
<p><img src="021_functions-practicum_files/figure-html/second-example-scatterplot-1.png" width="672" /></p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="#cb281-1"></a><span class="kw">le_lin_fit</span>(j_dat)</span>
<span id="cb281-2"><a href="#cb281-2"></a><span class="co">#&gt; intercept     slope </span></span>
<span id="cb281-3"><a href="#cb281-3"></a><span class="co">#&gt;    55.221    -0.093</span></span></code></pre></div>
<p>The linear fit is comically bad, but yes I believe the visual line and the regression results match up.</p>
<p>It’s also a good idea to clean out the workspace, rerun the minimum amount of code, and retest your function. This will help you catch another common mistake: accidentally relying on objects that were lying around in the workspace during development but that are not actually defined in your function nor passed as formal arguments.</p>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="#cb282-1"></a><span class="kw">rm</span>(<span class="dt">list =</span> <span class="kw">ls</span>())</span>
<span id="cb282-2"><a href="#cb282-2"></a>le_lin_fit &lt;-<span class="st"> </span><span class="cf">function</span>(dat, <span class="dt">offset =</span> <span class="dv">1952</span>) {</span>
<span id="cb282-3"><a href="#cb282-3"></a>  the_fit &lt;-<span class="st"> </span><span class="kw">lm</span>(lifeExp <span class="op">~</span><span class="st"> </span><span class="kw">I</span>(year <span class="op">-</span><span class="st"> </span>offset), dat)</span>
<span id="cb282-4"><a href="#cb282-4"></a>  <span class="kw">setNames</span>(<span class="kw">coef</span>(the_fit), <span class="kw">c</span>(<span class="st">&quot;intercept&quot;</span>, <span class="st">&quot;slope&quot;</span>))</span>
<span id="cb282-5"><a href="#cb282-5"></a>}</span>
<span id="cb282-6"><a href="#cb282-6"></a><span class="kw">le_lin_fit</span>(gapminder <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(country <span class="op">==</span><span class="st"> &quot;Zimbabwe&quot;</span>))</span>
<span id="cb282-7"><a href="#cb282-7"></a><span class="co">#&gt; intercept     slope </span></span>
<span id="cb282-8"><a href="#cb282-8"></a><span class="co">#&gt;    55.221    -0.093</span></span></code></pre></div>
</div>
<div id="are-we-there-yet" class="section level2">
<h2><span class="header-section-number">21.7</span> Are we there yet?</h2>
<p>Yes.</p>
<p>Given how I plan to use this function, I don’t feel the need to put it under formal unit tests or put in argument validity checks.</p>
<!--RStudio Links-->
<!--HappyGitWithR Links-->
<!--Package Links-->
<!--Shiny links-->
<!--Publications-->
<!--R Documentation-->
<!--Wikipedia Links-->
<!--Misc. Links-->
<!--chapter:end:021_functions-practicum.Rmd-->
</div>
</div>
<div id="part-all-the-graph-things" class="section level1 unnumbered">
<h1>(PART) All the graph things</h1>
</div>
<div id="graphics-overview" class="section level1 unnumbered">
<h1>Overview</h1>
<!--Original content: https://stat545.com/graph00_index.html-->
<p>We work on visualization throughout the course. Here are the bits in rough order of presentation.</p>
<ul>
<li>Chapter @ref(graphics-slides) - R graphics landscape slides
<ul>
<li>Why we prefer ggplot2 over base R graphics or lattice</li>
<li>The underappreciated importance of data frames, tidy data, and factor management to graphics</li>
<li>Basic jargon of ggplot2</li>
</ul></li>
<li>Chapter @ref(ggplot2-tutorial) - Learning ggplot2 by using it
<ul>
<li>My <a href="https://github.com/jennybc/ggplot2-tutorial">ggplot2 tutorial</a> gives indicative code and all resulting figures</li>
<li>Scatterplots, stripplots, distributions, bars, themes, managing a color scheme, bubble and line plots</li>
</ul></li>
<li>Chapter @ref(effective-graphs) - Do’s and don’ts of making effective graphs
<ul>
<li>Effective = easy for audience to decode numerical info</li>
<li>Our ability to decode position along common axis &gt;&gt; area, angle, color, etc.</li>
</ul></li>
<li>Colors
<ul>
<li>Chapter @ref(colors) - Using colors in R</li>
<li>Chapter @ref(qualitative-colors) Taking control of qualitative colors in ggplot2</li>
</ul></li>
<li>Practical pro tips, i.e. a return to mechanics
<ul>
<li>Chapter @ref(secrets) - Secrets of happy graphing life: data.frames! tidy data! factors!</li>
<li>Chapter @ref(save-figs) - Writing figures to file</li>
<li>Chapter @ref(multiple-plots) - Multiple plots on a page</li>
</ul></li>
</ul>
<!--TODO: The R Graph Catalog link and the ugrad.stat.ubc.ca link are both broken. Find a replacement? Currently links all point to github repo-->
<!--JB:
* The [R Graph Catalog](http://shiny.stat.ubc.ca/r-graph-catalog/) presents a visual, clickable index of 100+ figures
    - mostly from Naomi Robbins' book ["Creating More Effective Graphs"](http://www.amazon.com/Creating-Effective-Graphs-Naomi-Robbins/dp/0985911123)
    - see figure and the exact ggplot2 code to produce it, side-by-side
    - code for all figures and app itself is on [GitHub](https://github.com/jennybc/r-graph-catalog)
* underappreciated basics: density plots, high-volume scatterplots good stuff here: http://www.ugrad.stat.ubc.ca/~stat540/seminars/seminar03_graphics-ggplot2.html
-->
</div>
<div id="graphics-slides" class="section level1">
<h1><span class="header-section-number">22</span> R graphics landscape</h1>
<script async class="speakerdeck-embed" data-id="f5ebca79660c4c3eb05b5bfbe1018545" data-ratio="1.33333333333333" src="//speakerdeck.com/assets/embed.js"></script>
<div style="margin-bottom:5px">
<strong> <a href="https://speakerdeck.com/jennybc/ggplot2-tutorial" title="hello ggplot2" target="_blank">hello ggplot2!</a> </strong> from <strong><a href="https://speakerdeck.com/jennybc" target="_blank">Jennifer Bryan</a></strong>
</div>
<!--RStudio Links-->
<!--HappyGitWithR Links-->
<!--Package Links-->
<!--Shiny links-->
<!--Publications-->
<!--R Documentation-->
<!--Wikipedia Links-->
<!--Misc. Links-->
<!--chapter:end:022_r-graphics.Rmd-->
</div>
<div id="ggplot2-tutorial" class="section level1">
<h1><span class="header-section-number">23</span> ggplot2 tutorial</h1>
<p><a href="https://github.com/jennybc/ggplot2-tutorial">ggplot2 tutorial</a>, heavy on code and examples.</p>
<!--RStudio Links-->
<!--HappyGitWithR Links-->
<!--Package Links-->
<!--Shiny links-->
<!--Publications-->
<!--R Documentation-->
<!--Wikipedia Links-->
<!--Misc. Links-->
<!--chapter:end:023_ggplot2.Rmd-->
</div>
<div id="effective-graphs" class="section level1">
<h1><span class="header-section-number">24</span> Do’s and don’ts of making effective graphics</h1>
<!--Original content: https://stat545.com/block015_graph-dos-donts.html-->
<!--JB:
*In 2015, this was mercifully replaced by a [guest lecture from UBC colleague Tamara Munzner](http://stat545-ubc.github.io/cm014_viz-design-munzner.html). The content below would be better with links to specific figures from Naomi Robbins' book, but the Shiny app does not make that possible. Or perhaps I should just embed my versions of them.*
-->
<div id="goal-create-more-effective-graphs" class="section level2">
<h2><span class="header-section-number">24.1</span> Goal: create more effective graphs</h2>
<p>According to Naomi Robbins, effective graphs “improve understanding of data”. They do not confuse or mislead.</p>
<p>To paraphrase: Most of us use a computer to write but we would never characterize a Nobel prize winning writer as being highly skilled with Microsoft Word. Similarly, advanced ggplot2 skills won’t necessarily lead to effective communication of numerical data. You have to master the <strong>principles of effective graphs</strong> in addition to the mechanics.</p>
<blockquote>
<p>One graph is more effective than another if its quantitative information can be decoded more quickly or more easily by most observers.</p>
</blockquote>
<p>When I’m lost in data and struggling to make a figure, I repeat this mantra distilled from Gelman, et al. <span class="citation">(<a href="#ref-gelman2002" role="doc-biblioref">2002</a>)</span>:</p>
<ul>
<li>Facilitate comparisons</li>
<li>Reveal trends</li>
</ul>
<p><em>CMEG = Naomi Robbins’ book <a href="https://www.amazon.com/Creating-Effective-Graphs-Naomi-Robbins/dp/0985911123">“Creating More Effective Graphs”</a> <span class="citation">(<a href="#ref-robbins2012" role="doc-biblioref">2012</a>)</span>; visual catalog of figures via the <a href="https://github.com/jennybc/r-graph-catalog">R Graph Catalog</a></em></p>
</div>
<div id="no-nos" class="section level2">
<h2><span class="header-section-number">24.2</span> No no’s</h2>
<div id="pie-charts" class="section level3">
<h3><span class="header-section-number">24.2.1</span> Pie charts</h3>
<p>The <a href="https://www.google.com/search?q=pie+charts+suck">most loathed graph of all</a> and yet surprisingly common. Give your average person a bunch of numbers that add up to one and they want to make a pie chart. Why? My hypothesis is it goes back to all the pies and pizzas referenced when kids learn to work with fractions.</p>
<p>Why do the pros hate pie charts? They are awful because they encode quantitative information in angles and areas, which are very hard for humans to judge. Skeptical? Read on.</p>
<p>Examples from CMEG and the <a href="https://github.com/jennybc/r-graph-catalog">R Graph Catalog</a>:</p>
<ul>
<li>Try to place the wedges in order from largest to smallest based on the pie chart in Fig 1.1. Now do same using the dot plot in Fig 1.2. Which figure made this task easier? Which presentation of this data improves your understanding of the data? Reflect on the same info presented as a table, Fig 1.3.</li>
<li>Try to decode the data from the pie chart in Fig 2.2. Now do the same using the dot plot in Fig 2.3.</li>
</ul>
<p>We are best able to make comparisons via position of objects along a common scale, which is why these simple dot plots are so much more effective than the pie charts.</p>
</div>
<div id="more-pie-charts" class="section level3">
<h3><span class="header-section-number">24.2.2</span> More pie charts</h3>
<p>Tufte, as quoted by Robbins: “the only worse design than a pie chart is several of them.”</p>
<ul>
<li>“Problem 2: pie charts are worse at showing trends” from <a href="https://www.richardhollins.com/blog/why-pie-charts-suck/">Three reasons that pie charts suck</a> shows a series of 3 pie charts versus a line chart.</li>
<li>Rob Hyndman nominated a 3 pie chart series as <a href="https://robjhyndman.com/hyndsight/worst-figure/">the worst figure</a>, which has the added horror of cross-hatching. Sorry, no before and after here.</li>
</ul>
</div>
<div id="stacked-and-group-bar-charts" class="section level3">
<h3><span class="header-section-number">24.2.3</span> Stacked and group bar charts</h3>
<p>The average person, if told they should not make a pie chart, might then take that bunch of numbers for different categories and make a stacked bar chart. Especially if they have a a series of such numbers. But this is also a very difficult graph to decode.</p>
<ul>
<li>Fig 8.11 from CMEG (not in the Catalog) presents a series of 4 pie charts, showing various nations’ share of world car production from 1977 to 1980. The same data is presented as a stacked bar chart in Fig 8.12. How easy is it to figure out which countries are gaining and losing share? Now take a look at the faceted line chart in Fig 8.13. BOOM!</li>
</ul>
<p>Stacked bar charts are difficult to decode because we need a common baseline to judge changes in length. So the trend for the category on the “ground floor” is easy to see but trends for those stuck in the middle are hard to see.</p>
<ul>
<li>Fig 5.1 shows petroleum stocks held by various countries over time as a stacked bar chart. Again it’s easy to see the trend for the US, which sits on the “ground floor,” but who knows what’s going on with other countries. Fig 5.2 and 5.3 show alternative presentations that are much more effective.</li>
</ul>
<p>Grouped bar charts also make it hard to see trends.</p>
<ul>
<li>Fig 8.1 shows high, average, and low prices for gold over time as a stacked bar chart. The same info is presented differently in Fig 8.2, to much better effect.</li>
</ul>
<p>Grouped bar charts are difficult because it’s hard to make comparisons between things that aren’t adjacent or at least very near each other.</p>
</div>
<div id="self-contradiction" class="section level3">
<h3><span class="header-section-number">24.2.4</span> Self-contradiction</h3>
<p>When your text (especially the caption!) and the figure contradict each other, it undermines the reader’s trust in everything you present. You can dramatically reduce your ability to shoot yourself in the foot this way by using an integrated reporting approach, such as R Markdown. If figures are made from live R code in chunks and numbers are inserted via live inline R code, the two cannot diverge.</p>
<p>Barring that, my advice is to proofread like a maniac.</p>
</div>
<div id="using-microsoft-excel-to-obscure-your-data-and-annoy-your-readers" class="section level3">
<h3><span class="header-section-number">24.2.5</span> Using Microsoft Excel to obscure your data and annoy your readers</h3>
<p>We will look through this section (slides 1 - 36) of Karl Broman’s excellent talk How to Display Data Badly (see <a href="#effective-graphs-resources">Resources</a> for links).</p>
</div>
</div>
<div id="do-make-the-data-stand-out" class="section level2">
<h2><span class="header-section-number">24.3</span> Do: make the data stand out</h2>
<p>This animation created by Darkhorse Analytics illustrates how communication can be greatly enhanced by eliminating clutter and de-emphasizing supporting elements. Every aspect of a figure should be there on a “need to have it” basis.</p>
<div class="figure">
<img src="img/less-is-more-darkhorse-analytics.gif" alt="From  [Data Looks Better Naked](https://www.darkhorseanalytics.com/blog/data-looks-better-naked) by Darkhorse Analytics"  />
<p class="caption">
(#fig:unnamed-chunk-2)From <a href="https://www.darkhorseanalytics.com/blog/data-looks-better-naked">Data Looks Better Naked</a> by Darkhorse Analytics
</p>
</div>
<p>In CMEG, Figs 6.2 vs 6.3 make much the same point, i.e. stripping the figure way down is a huge improvement. Figs 5.4 and 5.5 are both decent graphs but using dots (Fig 5.5) instead of bars (Fig 5.4) improves the data:ink ratio.</p>
</div>
<div id="do-spare-your-reader-from-mental-gymnastics" class="section level2">
<h2><span class="header-section-number">24.4</span> Do: spare your reader from mental gymnastics</h2>
<p>If you’re going to talk about the difference between this and that, then please go ahead a plot the difference between this and that! Sure, it might be nice to plot this and that, on their own, but don’t stop there. <em>You’ve got a computer. And software.</em> Use them to do annoying arithmetic for your reader.</p>
<ul>
<li>Figs 2.14 and 2.15 show imports to England and exports from England from long ago. But if you are interested in the balance of trade, imports - exports, then plot that! It’s very hard to do this well in your head.</li>
<li>Fig 2.16 show the function <span class="math inline">\(y = \frac{1}{x^2}\)</span> and the same function shifted vertically by a constant. But the figure is incredibly deceptive, underscoring how bad we are at taking differences.</li>
<li>Figs 8.3, 8.4, 8.5, 8.6 show the time taken for subjects to do annoying things, like set the clock on their VCR, with two different sets of instructions. The original graph spread this out over 10 small bar charts, but the next 3 graphs present more direct looks at the improvement offered by revised instructions.</li>
</ul>
</div>
<div id="do-use-position-along-a-common-scale" class="section level2">
<h2><span class="header-section-number">24.5</span> Do: use position along a common scale</h2>
<p>We are best able to make comparisons if items are positioned along a common scale. Design your graphs to take advantage of this.</p>
<p>We have a harder time with area, volume, length of non-adjacent things, length without a common baseline, angle, color, and shape.</p>
<ul>
<li>Fig 2.18 shows a poorly ordered bubble plot that depicts population of various cities. It’s really hard to order the cities by population, until you look at the clean dot plot in Fig 2.19.</li>
<li>Figs 6.24 and 6.25 encode numbers in the area of rectangles and triangles, respectively, when a simple bar chart or dotplot would have been better.</li>
</ul>
</div>
<div id="do-take-control-of-aspect-ratio" class="section level2">
<h2><span class="header-section-number">24.6</span> Do: take control of aspect ratio</h2>
<p>We can see differences in angles when they’re around 45 degrees. But as they get steeper, our ability to compare goes down quickly. You control the angles of line segments in your graphs by controlling the <em>aspect ratio</em>. Pick the ratio so that the “average line segment” is around 45 degrees, a.k.a. banking to 45.</p>
<ul>
<li>Fig 7.1 shows how a proper aspect ratio makes it easier to see that the sunspot data rises much faster than it falls.</li>
</ul>
</div>
<div id="do-think-about-including-zero" class="section level2">
<h2><span class="header-section-number">24.7</span> Do: think about including zero</h2>
<p>There is no global rule about whether axis limits must be chosen to include zero. It depends.</p>
<p>Robbins proposes you always include it in bar charts, but use your judgement with, e.g., line charts or dot plots.</p>
<p>Figs 7.3, 7.4, and 7.5 explore the inclusion of zero.</p>
</div>
<div id="do-choose-the-scale-with-intention" class="section level2">
<h2><span class="header-section-number">24.8</span> Do: choose the scale with intention</h2>
<p>Logarithmically transformed scales are useful when:</p>
<ul>
<li>It makes sense to think of changes on a multiplicative scale, instead of additive.
<ul>
<li>example: gene expression ratios are naturally viewed on the log 2 scale, where 0 represents a ratio of 1 and equal expression and -1 and 1 represent ratios of 1/2 and 2, respectively</li>
</ul></li>
<li>The data are skewed</li>
</ul>
<p>Figs 7.7 and 7.8 show a skewed dataset before and after log transformation. We are also used to logging the <code>gdpPercap</code> variable in the Gapminder data, for the same reasons.</p>
<p>How about presenting two scales for the same axis?</p>
<ul>
<li>It is OK to present tick marks in different “units,” i.e. temperature in Fahrenheit vs. Celsius (Fig 7.16) or GDP per capita in raw dollars versus on the log 10 scale. However, this is not easy to do in ggplot2!</li>
<li>It is NOT OK to present two entirely different scales, just so you can squeeze two different variables onto the same plot.
<ul>
<li>Figs 7.17 and 7.18 explore how deceptive this can be.</li>
</ul></li>
<li>Even if variables are technically reported in the same units, it might make a better graph to use facets and choose axis limits accordingly.
<ul>
<li>Figs 7.19 and 7.21 show the importance of faceting when looking at levels of blood lipids.</li>
</ul></li>
</ul>
</div>
<div id="do-connect-the-dots-with-care" class="section level2">
<h2><span class="header-section-number">24.9</span> Do: connect the dots with care</h2>
<p>Consider two quantitative variables, where the x-axis is time or something similar. There are many legitimate ways to present such data. In ggplot2 jargon, there are many relevant geoms.</p>
<ul>
<li>Fig 4.17 shows a single time series presented 4 different ways, each serving a different purpose.</li>
<li>Fig 4.21 presents another line graph, showing used car price against mileage of car. Connecting these dots allows buyers and sellers to determine fair value, even if a specific car’s mileage is not in the dataset.</li>
</ul>
<p>Beware connecting the dots when the x axis represents an unordered categorical variable.</p>
<ul>
<li>Figs 4.22, 4.23, and 4.24 depict mountain heights for different continents. The connecting line can be misleading here. What it the graph were targeted at an audience that speaks a different language? Even alphabetical is not a well-defined ordering. Unless sorting on size, best to avoid connecting these dots (and even then one must be careful).</li>
</ul>
</div>
<div id="do-convey-groups-clearly" class="section level2">
<h2><span class="header-section-number">24.10</span> Do: convey groups clearly</h2>
<p>Consider two quantitative variables, plus a third categorical variable. How to encode the factor?</p>
<p>If superposing, you have shape, filled-ness, and color at your disposal.</p>
<ul>
<li>Figs 6.6 and 6.7 explore using these singly or, often better, in combination.</li>
</ul>
<p>It is often better to avoid superposition and, instead, to put the groups into different facets.</p>
<ul>
<li>Fig 6.8 revisits the data from Figs 6.6 and 6.7, but using faceting. Gridlines can be very helpful to facilitate comparisons across facets.</li>
<li>Figs 6.9 and 6.10 make this point for line charts.</li>
</ul>
<div id="a-tour-of-the-dos" class="section level3">
<h3><span class="header-section-number">24.10.1</span> A tour of the Do’s</h3>
<p>We will look through another section (slides 48 - 62) of Karl Broman’s excellent talk How to Display Data Badly (see <a href="#effective-graphs-resources">Resources</a> for links).</p>
</div>
</div>
<div id="effective-graphs-resources" class="section level2">
<h2><span class="header-section-number">24.11</span> Resources</h2>
<p><a href="https://www.amazon.com/Creating-Effective-Graphs-Naomi-Robbins/dp/0985911123">“Creating More Effective Graphs”</a> by <a href="http://www.nbr-graphs.com">Naomi Robbins</a> <span class="citation">(<a href="#ref-robbins2012" role="doc-biblioref">2012</a>)</span>.</p>
<p>The <a href="https://github.com/jennybc/r-graph-catalog">R Graph Catalog</a> presents the figures from <a href="https://www.amazon.com/Creating-Effective-Graphs-Naomi-Robbins/dp/0985911123">“Creating More Effective Graphs”</a> as a visual quilt. Click on a figure to see the ggplot2 code that makes it.</p>
<p>Karl Broman’s talk “How to display data badly”</p>
<ul>
<li>Home on GitHub: <a href="https://github.com/kbroman/Talk_Graphs" class="uri">https://github.com/kbroman/Talk_Graphs</a><br />
</li>
<li>The version I showed is the <a href="https://www.biostat.wisc.edu/~kbroman/presentations/IowaState2013/graphs_combined.pdf">combined PDF from the iowastate2013 branch</a></li>
</ul>
<p><a href="https://ggplot2.tidyverse.org">ggplot2</a> written by <a href="https://hadley.github.io">Hadley Wickham</a>.</p>
<p><a href="https://github.com/wch">Winston Chang’s</a> book <a href="http://shop.oreilly.com/product/0636920023135.do">“R Graphics Cookbook”</a> <span class="citation">(<a href="#ref-chang2013" role="doc-biblioref">2013</a>)</span> and the <a href="http://www.cookbook-r.com/Graphs/">Graphs section</a> of his <a href="http://www.cookbook-r.com">Cookbook for R website</a>.</p>
<p>Chapter @ref(ggplot2-tutorial) - my <a href="https://github.com/jennybc/ggplot2-tutorial">ggplot2 tutorial</a>.</p>
<p>Gelman et al.’s <a href="https://www.jstor.org/stable/3087382?seq=1#page_scan_tab_contents">“Let’s Practice What We Preach”</a> in The American Statistician <span class="citation">(<a href="#ref-gelman2002" role="doc-biblioref">2002</a>)</span>.</p>
<!--JB:
### Distribution one quantitative variable

stripplot (+ summary stats, jittering) Fig 4.1, 4.8
histogram Fig 4.6
densityplot
boxplot
combinations of the above

### Two quantitative variables

scatterplot + regression line / smooth
high volume scatterplots
-->
<!--RStudio Links-->
<!--HappyGitWithR Links-->
<!--Package Links-->
<!--Shiny links-->
<!--Publications-->
<!--R Documentation-->
<!--Wikipedia Links-->
<!--Misc. Links-->
<!--chapter:end:024_effective-graphs.Rmd-->
</div>
</div>
<div id="colors" class="section level1">
<h1><span class="header-section-number">25</span> Using colors in R</h1>
<!--Original content: https://stat545.com/block018_colors.html-->
<!--TODO: The link below is broken. Found it listed [here](https://www.showmeshiny.com/r-graph-catalog/) which links this [repo](https://github.com/jennybc/r-graph-catalog) as the source code

[R Graph Catalog](http://shiny.stat.ubc.ca/r-graph-catalog/), a visual, clickable index of 100+ figures + ggplot2 code to make them

Note that I SKIPPED THE R GRAPH CATALOG LINK
-->
<div id="load-dplyr-and-gapminder-2" class="section level2">
<h2><span class="header-section-number">25.1</span> Load dplyr and gapminder</h2>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="#cb283-1"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb283-2"><a href="#cb283-2"></a><span class="kw">library</span>(gapminder)</span></code></pre></div>
</div>
<div id="change-the-default-plotting-symbol-to-a-solid-circle" class="section level2">
<h2><span class="header-section-number">25.2</span> Change the default plotting symbol to a solid circle</h2>
<p>The color demos below will be more effective if the default plotting symbol is a solid circle. We limit ourselves to base R graphics in this tutorial, therefore we use <code>par()</code>, the function that queries and sets base R graphical parameters. In an interactive session or in a plain R script, do this:</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="#cb284-1"></a><span class="co">## how to change the plot symbol in a simple, non-knitr setting</span></span>
<span id="cb284-2"><a href="#cb284-2"></a>opar &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="dt">pch =</span> <span class="dv">19</span>)</span></code></pre></div>
<p>Technically, you don’t need to make the assignment, but it’s a good practice. We’re killing two birds with one stone:</p>
<ol style="list-style-type: decimal">
<li>Changing the default plotting symbol to a filled circle, which has code 19 in R. (Below I link to some samplers showing all the plotting symbols, FYI.)</li>
<li>Storing the pre-existing and, in this case, default graphical parameters in <code>opar</code>.</li>
</ol>
<p>When you change a graphical parameter via <code>par()</code>, the original values are returned and we’re capturing them via assignment to <code>opar</code>. At the very bottom of this tutorial, we use <code>opar</code> to restore the original state.</p>
<p>Big picture, it is best practice to restore the original, default state of hidden things that affect an R session. This is polite if you plan to inflict your code on others. Even if you live on an R desert island, this practice will prevent you from creating maddening little puzzles for yourself to solve in the middle of the night before a deadline.</p>
<p>Because of the way figures are handled by knitr, it is more complicated to change the default plotting symbol throughout an R Markdown document. To see how I’ve done it, check out a hidden chunk around here in the <a href="https://github.com/rstudio-education/stat545/blob/master/25_colors.Rmd">source of this page</a>.</p>
</div>
<div id="basic-color-specification-and-the-default-palette" class="section level2">
<h2><span class="header-section-number">25.3</span> Basic color specification and the default palette</h2>
<p>I need a small well-behaved excerpt from the Gapminder data for demonstration purposes. I randomly draw 8 countries, keep their data from 2007, and sort the rows based on GDP per capita. Meet <code>jdat</code>.</p>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="#cb285-1"></a>jdat</span>
<span id="cb285-2"><a href="#cb285-2"></a><span class="co">#&gt; # A tibble: 8 x 6</span></span>
<span id="cb285-3"><a href="#cb285-3"></a><span class="co">#&gt;   country                  continent  year lifeExp        pop gdpPercap</span></span>
<span id="cb285-4"><a href="#cb285-4"></a><span class="co">#&gt;   &lt;fct&gt;                    &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;      &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb285-5"><a href="#cb285-5"></a><span class="co">#&gt; 1 Central African Republic Africa     2007    44.7    4369038      706.</span></span>
<span id="cb285-6"><a href="#cb285-6"></a><span class="co">#&gt; 2 Guinea                   Africa     2007    56.0    9947814      943.</span></span>
<span id="cb285-7"><a href="#cb285-7"></a><span class="co">#&gt; 3 Cote d&#39;Ivoire            Africa     2007    48.3   18013409     1545.</span></span>
<span id="cb285-8"><a href="#cb285-8"></a><span class="co">#&gt; 4 India                    Asia       2007    64.7 1110396331     2452.</span></span>
<span id="cb285-9"><a href="#cb285-9"></a><span class="co">#&gt; 5 Pakistan                 Asia       2007    65.5  169270617     2606.</span></span>
<span id="cb285-10"><a href="#cb285-10"></a><span class="co">#&gt; 6 South Africa             Africa     2007    49.3   43997828     9270.</span></span>
<span id="cb285-11"><a href="#cb285-11"></a><span class="co">#&gt; 7 Costa Rica               Americas   2007    78.8    4133884     9645.</span></span>
<span id="cb285-12"><a href="#cb285-12"></a><span class="co">#&gt; 8 Panama                   Americas   2007    75.5    3242173     9809.</span></span></code></pre></div>
<p>A simple scatterplot, using <code>plot()</code> from the base package <code>graphics</code>.</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="#cb286-1"></a>j_xlim &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">460</span>, <span class="dv">60000</span>)</span>
<span id="cb286-2"><a href="#cb286-2"></a>j_ylim &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">47</span>, <span class="dv">82</span>)</span>
<span id="cb286-3"><a href="#cb286-3"></a><span class="kw">plot</span>(lifeExp <span class="op">~</span><span class="st"> </span>gdpPercap, jdat, <span class="dt">log =</span> <span class="st">&#39;x&#39;</span>, <span class="dt">xlim =</span> j_xlim, <span class="dt">ylim =</span> j_ylim,</span>
<span id="cb286-4"><a href="#cb286-4"></a>     <span class="dt">main =</span> <span class="st">&quot;Start your engines ...&quot;</span>)</span></code></pre></div>
<p><img src="025_colors_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>You can specify color explicitly by name by supplying a character vector with one or more color names (more on those soon). If you need a color for 8 points and you input fewer, recycling will kick in. Here’s what happens when you specify one or two colors via the <code>col =</code> argument of <code>plot()</code>.</p>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="#cb287-1"></a><span class="kw">plot</span>(lifeExp <span class="op">~</span><span class="st"> </span>gdpPercap, jdat, <span class="dt">log =</span> <span class="st">&#39;x&#39;</span>, <span class="dt">xlim =</span> j_xlim, <span class="dt">ylim =</span> j_ylim,</span>
<span id="cb287-2"><a href="#cb287-2"></a>     <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">main =</span> <span class="st">&#39;col = &quot;red&quot;&#39;</span>)</span>
<span id="cb287-3"><a href="#cb287-3"></a><span class="kw">plot</span>(lifeExp <span class="op">~</span><span class="st"> </span>gdpPercap, jdat, <span class="dt">log =</span> <span class="st">&#39;x&#39;</span>, <span class="dt">xlim =</span> j_xlim, <span class="dt">ylim =</span> j_ylim,</span>
<span id="cb287-4"><a href="#cb287-4"></a>     <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;orange&quot;</span>), <span class="dt">main =</span> <span class="st">&#39;col = c(&quot;blue&quot;, &quot;orange&quot;)&#39;</span>)</span></code></pre></div>
<p><img src="025_colors_files/figure-html/unnamed-chunk-8-1.png" width="50%" /><img src="025_colors_files/figure-html/unnamed-chunk-8-2.png" width="50%" /></p>
<p>You can specify color explicitly with a small positive integer, which is interpreted as indexing into the current palette, which can be inspected via <code>palette()</code>. I’ve added these integers and the color names as labels to the figures below. The default palette contains 8 colors, which is why we’re looking at data from eight countries. The default palette is ugly.</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="#cb288-1"></a><span class="kw">plot</span>(lifeExp <span class="op">~</span><span class="st"> </span>gdpPercap, jdat, <span class="dt">log =</span> <span class="st">&#39;x&#39;</span>, <span class="dt">xlim =</span> j_xlim, <span class="dt">ylim =</span> j_ylim,</span>
<span id="cb288-2"><a href="#cb288-2"></a>     <span class="dt">col =</span> <span class="dv">1</span><span class="op">:</span>n_c, <span class="dt">main =</span> <span class="kw">paste0</span>(<span class="st">&#39;col = 1:&#39;</span>, n_c))</span>
<span id="cb288-3"><a href="#cb288-3"></a><span class="kw">with</span>(jdat, <span class="kw">text</span>(<span class="dt">x =</span> gdpPercap, <span class="dt">y =</span> lifeExp, <span class="dt">pos =</span> <span class="dv">1</span>))</span>
<span id="cb288-4"><a href="#cb288-4"></a><span class="kw">plot</span>(lifeExp <span class="op">~</span><span class="st"> </span>gdpPercap, jdat, <span class="dt">log =</span> <span class="st">&#39;x&#39;</span>, <span class="dt">xlim =</span> j_xlim, <span class="dt">ylim =</span> j_ylim,</span>
<span id="cb288-5"><a href="#cb288-5"></a>     <span class="dt">col =</span> <span class="dv">1</span><span class="op">:</span>n_c, <span class="dt">main =</span> <span class="st">&#39;the default palette()&#39;</span>)</span>
<span id="cb288-6"><a href="#cb288-6"></a><span class="kw">with</span>(jdat, <span class="kw">text</span>(<span class="dt">x =</span> gdpPercap, <span class="dt">y =</span> lifeExp, <span class="dt">labels =</span> <span class="kw">palette</span>(),</span>
<span id="cb288-7"><a href="#cb288-7"></a>                <span class="dt">pos =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">1</span>), <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">2</span>))))     </span></code></pre></div>
<p><img src="025_colors_files/figure-html/unnamed-chunk-9-1.png" width="50%" /><img src="025_colors_files/figure-html/unnamed-chunk-9-2.png" width="50%" /></p>
<p>You can provide your own vector of colors instead. I am intentionally modelling best practice here too: if you’re going to use custom colors, store them as an object in exactly one place, and use that object in plot calls, legend-making, etc. This makes it much easier to fiddle with your custom colors, which few of us can resist.</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="#cb289-1"></a>j_colors &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;chartreuse3&#39;</span>, <span class="st">&#39;cornflowerblue&#39;</span>, <span class="st">&#39;darkgoldenrod1&#39;</span>, <span class="st">&#39;peachpuff3&#39;</span>,</span>
<span id="cb289-2"><a href="#cb289-2"></a>             <span class="st">&#39;mediumorchid2&#39;</span>, <span class="st">&#39;turquoise3&#39;</span>, <span class="st">&#39;wheat4&#39;</span>, <span class="st">&#39;slategray2&#39;</span>)</span>
<span id="cb289-3"><a href="#cb289-3"></a><span class="kw">plot</span>(lifeExp <span class="op">~</span><span class="st"> </span>gdpPercap, jdat, <span class="dt">log =</span> <span class="st">&#39;x&#39;</span>, <span class="dt">xlim =</span> j_xlim, <span class="dt">ylim =</span> j_ylim,</span>
<span id="cb289-4"><a href="#cb289-4"></a>     <span class="dt">col =</span> j_colors, <span class="dt">main =</span> <span class="st">&#39;custom colors!&#39;</span>)</span>
<span id="cb289-5"><a href="#cb289-5"></a><span class="kw">with</span>(jdat, <span class="kw">text</span>(<span class="dt">x =</span> gdpPercap, <span class="dt">y =</span> lifeExp, <span class="dt">labels =</span> j_colors,</span>
<span id="cb289-6"><a href="#cb289-6"></a>                <span class="dt">pos =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">1</span>), <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">2</span>)))) </span></code></pre></div>
<p><img src="025_colors_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
</div>
<div id="what-colors-are-available-ditto-for-symbols-and-line-types" class="section level2">
<h2><span class="header-section-number">25.4</span> What colors are available? Ditto for symbols and line types</h2>
<p>Who would have guessed that R knows about “peachpuff3”? To see the names of all 657 the built-in colors, use <code>colors()</code>.</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="#cb290-1"></a><span class="kw">head</span>(<span class="kw">colors</span>())</span>
<span id="cb290-2"><a href="#cb290-2"></a><span class="co">#&gt; [1] &quot;white&quot;         &quot;aliceblue&quot;     &quot;antiquewhite&quot;  &quot;antiquewhite1&quot;</span></span>
<span id="cb290-3"><a href="#cb290-3"></a><span class="co">#&gt; [5] &quot;antiquewhite2&quot; &quot;antiquewhite3&quot;</span></span>
<span id="cb290-4"><a href="#cb290-4"></a><span class="kw">tail</span>(<span class="kw">colors</span>())</span>
<span id="cb290-5"><a href="#cb290-5"></a><span class="co">#&gt; [1] &quot;yellow&quot;      &quot;yellow1&quot;     &quot;yellow2&quot;     &quot;yellow3&quot;     &quot;yellow4&quot;    </span></span>
<span id="cb290-6"><a href="#cb290-6"></a><span class="co">#&gt; [6] &quot;yellowgreen&quot;</span></span></code></pre></div>
<p>But it’s much more exciting to see the colors displayed! Lots of people have tackled this – for colors, plotting symbols, line types – and put their work on the internet. Some examples:</p>
<ul>
<li>I put color names <a href="img/r.col.white.bkgd.pdf">on a white background</a> and <a href="img/r.col.black.bkgd.pdf">on black</a> <em>(sorry, these are PDFs)</em></li>
<li>I printed <a href="img/r.pch.pdf">the first 30 plotting symbols</a> (presumably using code found elsewhere or in documentation? can’t remember whom to credit) <em>(sorry, it’s a PDF)</em></li>
<li>In <a href="https://www.stat.auckland.ac.nz/~paul/RGraphics/chapter3.html">Chapter 3 of R Graphics 1st edition</a> <span class="citation">(<a href="#ref-murrell2005" role="doc-biblioref">2005</a>)</span>, Paul Murrell shows predefined and custom line types in <a href="https://www.stat.auckland.ac.nz/~paul/RGraphics/custombase-lty.png">Figure 3.6</a> and plotting symbols in <a href="https://www.stat.auckland.ac.nz/~paul/RGraphics/custombase-datasymbols.png">Figure 3.10</a>.</li>
</ul>
<!--TODO: The link below is broken, replace with something similar?
  * Earl F. Glynn offers [an excellent resource](http://research.stowers-institute.org/efg/R/Color/Chart/) on R's built-in named colors.
-->
</div>
<div id="rcolorbrewer" class="section level2">
<h2><span class="header-section-number">25.5</span> RColorBrewer</h2>
<p>Most of us are pretty lousy at choosing colors and it’s easy to spend too much time fiddling with them. <a href="https://en.wikipedia.org/wiki/Cynthia_Brewer">Cynthia Brewer</a>, a geographer and color specialist, has created sets of colors for print and the web and they are available in the add-on package <a href="https://CRAN.R-project.org/package=RColorBrewer">RColorBrewer</a>. You will need to install and load this package to use.</p>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="#cb291-1"></a><span class="co"># install.packages(&quot;RColorBrewer&quot;)</span></span>
<span id="cb291-2"><a href="#cb291-2"></a><span class="kw">library</span>(RColorBrewer)</span></code></pre></div>
<p>Let’s look at all the associated palettes.</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="#cb292-1"></a><span class="kw">display.brewer.all</span>()</span></code></pre></div>
<p><img src="025_colors_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>They fall into three classes. From top to bottom, they are</p>
<ul>
<li><strong>sequential</strong>: great for low-to-high things where one extreme is exciting and the other is boring, like (transformations of) p-values and correlations (caveat: here I’m assuming the only exciting correlations you’re likely to see are positive, i.e. near 1)</li>
<li><strong>qualitative</strong>: great for non-ordered categorical things – such as your typical factor, like country or continent. Note the special case “Paired” palette; example where that’s useful: a non-experimental factor (e.g. type of wheat) and a binary experimental factor (e.g. untreated vs. treated).</li>
<li><strong>diverging</strong>: great for things that range from “extreme and negative” to “extreme and positive”, going through “non extreme and boring” along the way, such as t-statistics and z-scores and signed correlations</li>
</ul>
<p>You can view a single RColorBrewer palette by specifying its name:</p>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="#cb293-1"></a><span class="kw">display.brewer.pal</span>(<span class="dt">n =</span> <span class="dv">8</span>, <span class="dt">name =</span> <span class="st">&#39;Dark2&#39;</span>)</span></code></pre></div>
<p><img src="025_colors_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<p>The package is, frankly, rather clunky, as evidenced by the requirement to specify <code>n</code> above. Sorry folks, you’ll just have to cope.</p>
<p>Here we revisit specifying custom colors as we did above, but using a palette from RColorBrewer instead of our artisanal “peachpuff3” work of art. As before, I display the colors themselves but you’ll see we’re not getting the friendly names you’ve seen before, which brings us to our next topic.</p>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="#cb294-1"></a>j_brew_colors &lt;-<span class="st"> </span><span class="kw">brewer.pal</span>(<span class="dt">n =</span> <span class="dv">8</span>, <span class="dt">name =</span> <span class="st">&quot;Dark2&quot;</span>)</span>
<span id="cb294-2"><a href="#cb294-2"></a><span class="kw">plot</span>(lifeExp <span class="op">~</span><span class="st"> </span>gdpPercap, jdat, <span class="dt">log =</span> <span class="st">&#39;x&#39;</span>, <span class="dt">xlim =</span> j_xlim, <span class="dt">ylim =</span> j_ylim,</span>
<span id="cb294-3"><a href="#cb294-3"></a>     <span class="dt">col =</span> j_brew_colors, <span class="dt">main =</span> <span class="st">&#39;Dark2 qualitative palette from RColorBrewer&#39;</span>)</span>
<span id="cb294-4"><a href="#cb294-4"></a><span class="kw">with</span>(jdat, <span class="kw">text</span>(<span class="dt">x =</span> gdpPercap, <span class="dt">y =</span> lifeExp, <span class="dt">labels =</span> j_brew_colors,</span>
<span id="cb294-5"><a href="#cb294-5"></a>                <span class="dt">pos =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">1</span>), <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">2</span>)))) </span></code></pre></div>
<p><img src="025_colors_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
</div>
<div id="viridis" class="section level2">
<h2><span class="header-section-number">25.6</span> viridis</h2>
<p>In 2015 Stéfan van der Walt and Nathaniel Smith designed new color maps for matplotlib and <a href="https://www.youtube.com/watch?v=xAoljeRJ3lU&amp;feature=youtu.be">presented them in a talk at SciPy 2015</a>. The viridis R package provides four new palettes for use in R: on <a href="https://CRAN.R-project.org/package=viridis">CRAN</a> with development on <a href="https://github.com/sjmgarnier/viridis">GitHub</a>. From DESCRIPTION:</p>
<blockquote>
<p>These color maps are designed in such a way that they will analytically be perfectly perceptually-uniform, both in regular form and also when converted to black-and-white. They are also designed to be perceived by readers with the most common form of color blindness (all color maps in this package) and color vision deficiency (‘cividis’ only).</p>
</blockquote>
<p>I encourage you to install viridis and read <a href="https://cran.r-project.org/web/packages/viridis/vignettes/intro-to-viridis.html">the vignette</a>. It is easy to use these palettes in ggplot2 via <code>scale_color_viridis()</code> and <code>scale_fill_viridis()</code>. Taking control of color palettes in ggplot2 is covered elsewhere (see Chapter @ref(qualitative-colors).</p>
<p>Here are two examples that show the viridis palettes:</p>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="#cb295-1"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb295-2"><a href="#cb295-2"></a><span class="kw">library</span>(viridis)</span>
<span id="cb295-3"><a href="#cb295-3"></a><span class="kw">ggplot</span>(<span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="kw">rnorm</span>(<span class="dv">10000</span>), <span class="dt">y =</span> <span class="kw">rnorm</span>(<span class="dv">10000</span>)), <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y)) <span class="op">+</span></span>
<span id="cb295-4"><a href="#cb295-4"></a><span class="st">  </span><span class="kw">geom_hex</span>() <span class="op">+</span><span class="st"> </span><span class="kw">coord_fixed</span>() <span class="op">+</span></span>
<span id="cb295-5"><a href="#cb295-5"></a><span class="st">  </span><span class="kw">scale_fill_viridis</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>()</span></code></pre></div>
<p><img src="025_colors_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<div class="figure">
<img src="img/viridis-sample2.png" alt="From [https://github.com/sjmgarnier/viridis](https://github.com/sjmgarnier/viridis)"  />
<p class="caption">
(#fig:unnamed-chunk-17)From <a href="https://github.com/sjmgarnier/viridis">https://github.com/sjmgarnier/viridis</a>
</p>
</div>
</div>
<div id="hexadecimal-rgb-color-specification" class="section level2">
<h2><span class="header-section-number">25.7</span> Hexadecimal RGB color specification</h2>
<p>Instead of small positive integers and Crayola-style names, a more general and machine-readable approach to color specification is as hexadecimal triplets. Here is how the RColorBrewer Dark2 palette is actually stored:</p>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="#cb296-1"></a><span class="kw">brewer.pal</span>(<span class="dt">n =</span> <span class="dv">8</span>, <span class="dt">name =</span> <span class="st">&quot;Dark2&quot;</span>)</span>
<span id="cb296-2"><a href="#cb296-2"></a><span class="co">#&gt; [1] &quot;#1B9E77&quot; &quot;#D95F02&quot; &quot;#7570B3&quot; &quot;#E7298A&quot; &quot;#66A61E&quot; &quot;#E6AB02&quot; &quot;#A6761D&quot;</span></span>
<span id="cb296-3"><a href="#cb296-3"></a><span class="co">#&gt; [8] &quot;#666666&quot;</span></span></code></pre></div>
<p>The leading <code>#</code> is just there by convention. Parse the hexadecimal string like so: <code>#rrggbb</code>, where <code>rr</code>, <code>gg</code>, and <code>bb</code> refer to color intensity in the red, green, and blue channels, respectively. Each is specified as a two-digit base 16 number, which is the meaning of “hexadecimal” (or “hex” for short).</p>
<p>Here’s a table relating base 16 numbers to the beloved base 10 system.</p>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#yydyoplrpq .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#yydyoplrpq .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#yydyoplrpq .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#yydyoplrpq .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#yydyoplrpq .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#yydyoplrpq .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#yydyoplrpq .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#yydyoplrpq .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#yydyoplrpq .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#yydyoplrpq .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#yydyoplrpq .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#yydyoplrpq .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#yydyoplrpq .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#yydyoplrpq .gt_from_md > :first-child {
  margin-top: 0;
}

#yydyoplrpq .gt_from_md > :last-child {
  margin-bottom: 0;
}

#yydyoplrpq .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#yydyoplrpq .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#yydyoplrpq .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#yydyoplrpq .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#yydyoplrpq .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#yydyoplrpq .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#yydyoplrpq .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#yydyoplrpq .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#yydyoplrpq .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#yydyoplrpq .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#yydyoplrpq .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#yydyoplrpq .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#yydyoplrpq .gt_left {
  text-align: left;
}

#yydyoplrpq .gt_center {
  text-align: center;
}

#yydyoplrpq .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#yydyoplrpq .gt_font_normal {
  font-weight: normal;
}

#yydyoplrpq .gt_font_bold {
  font-weight: bold;
}

#yydyoplrpq .gt_font_italic {
  font-style: italic;
}

#yydyoplrpq .gt_super {
  font-size: 65%;
}

#yydyoplrpq .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="yydyoplrpq" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1"></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">1</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">2</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">3</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">4</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">5</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">6</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">7</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">8</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">9</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">10</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">11</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">12</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">13</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">14</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">15</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">16</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_left gt_stub">hex</td>
      <td class="gt_row gt_left">0</td>
      <td class="gt_row gt_left">1</td>
      <td class="gt_row gt_left">2</td>
      <td class="gt_row gt_left">3</td>
      <td class="gt_row gt_left">4</td>
      <td class="gt_row gt_left">5</td>
      <td class="gt_row gt_left">6</td>
      <td class="gt_row gt_left">7</td>
      <td class="gt_row gt_left">8</td>
      <td class="gt_row gt_left">9</td>
      <td class="gt_row gt_left">A</td>
      <td class="gt_row gt_left">B</td>
      <td class="gt_row gt_left">C</td>
      <td class="gt_row gt_left">D</td>
      <td class="gt_row gt_left">E</td>
      <td class="gt_row gt_left">F</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_stub">decimal</td>
      <td class="gt_row gt_left">0</td>
      <td class="gt_row gt_left">1</td>
      <td class="gt_row gt_left">2</td>
      <td class="gt_row gt_left">3</td>
      <td class="gt_row gt_left">4</td>
      <td class="gt_row gt_left">5</td>
      <td class="gt_row gt_left">6</td>
      <td class="gt_row gt_left">7</td>
      <td class="gt_row gt_left">8</td>
      <td class="gt_row gt_left">9</td>
      <td class="gt_row gt_left">10</td>
      <td class="gt_row gt_left">11</td>
      <td class="gt_row gt_left">12</td>
      <td class="gt_row gt_left">13</td>
      <td class="gt_row gt_left">14</td>
      <td class="gt_row gt_left">15</td>
    </tr>
  </tbody>
  
  
</table></div>
<p><strong>Example:</strong> the first color in the palette is specified as “#1B9E77”, so the intensity in the green channel is 9E. What does that mean?
<span class="math display">\[
9E = 9 * 16^1 + 14 * 16^0 = 9 * 16 + 14 = 158
\]</span>
Note that the lowest possible channel intensity is <code>00</code> = 0 and the highest is <code>FF</code> = 255.</p>
<p>Important special cases that help you stay oriented. Here are the saturated RGB colors, red, blue, and green:</p>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#uacqlwcxlm .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#uacqlwcxlm .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#uacqlwcxlm .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#uacqlwcxlm .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#uacqlwcxlm .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#uacqlwcxlm .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#uacqlwcxlm .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#uacqlwcxlm .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#uacqlwcxlm .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#uacqlwcxlm .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#uacqlwcxlm .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#uacqlwcxlm .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#uacqlwcxlm .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#uacqlwcxlm .gt_from_md > :first-child {
  margin-top: 0;
}

#uacqlwcxlm .gt_from_md > :last-child {
  margin-bottom: 0;
}

#uacqlwcxlm .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#uacqlwcxlm .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#uacqlwcxlm .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#uacqlwcxlm .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#uacqlwcxlm .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#uacqlwcxlm .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#uacqlwcxlm .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#uacqlwcxlm .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#uacqlwcxlm .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#uacqlwcxlm .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#uacqlwcxlm .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#uacqlwcxlm .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#uacqlwcxlm .gt_left {
  text-align: left;
}

#uacqlwcxlm .gt_center {
  text-align: center;
}

#uacqlwcxlm .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#uacqlwcxlm .gt_font_normal {
  font-weight: normal;
}

#uacqlwcxlm .gt_font_bold {
  font-weight: bold;
}

#uacqlwcxlm .gt_font_italic {
  font-style: italic;
}

#uacqlwcxlm .gt_super {
  font-size: 65%;
}

#uacqlwcxlm .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="uacqlwcxlm" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">color_name</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">hex</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">red</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">green</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">blue</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_left gt_stub">blue</td>
      <td class="gt_row gt_left" style="color: white; background-color: #0000FF;">#0000FF</td>
      <td class="gt_row gt_right" style="color: white; background-color: #0000FF;">0</td>
      <td class="gt_row gt_right" style="color: white; background-color: #0000FF;">0</td>
      <td class="gt_row gt_right" style="color: white; background-color: #0000FF;">255</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_stub">green</td>
      <td class="gt_row gt_left" style="color: white; background-color: #00FF00;">#00FF00</td>
      <td class="gt_row gt_right" style="color: white; background-color: #00FF00;">0</td>
      <td class="gt_row gt_right" style="color: white; background-color: #00FF00;">255</td>
      <td class="gt_row gt_right" style="color: white; background-color: #00FF00;">0</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_stub">red</td>
      <td class="gt_row gt_left" style="color: white; background-color: #FF0000;">#FF0000</td>
      <td class="gt_row gt_right" style="color: white; background-color: #FF0000;">255</td>
      <td class="gt_row gt_right" style="color: white; background-color: #FF0000;">0</td>
      <td class="gt_row gt_right" style="color: white; background-color: #FF0000;">0</td>
    </tr>
  </tbody>
  
  
</table></div>
<p>Here are shades of gray:</p>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#gmlroblcts .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#gmlroblcts .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#gmlroblcts .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#gmlroblcts .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#gmlroblcts .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gmlroblcts .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#gmlroblcts .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#gmlroblcts .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: bold;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#gmlroblcts .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#gmlroblcts .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#gmlroblcts .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#gmlroblcts .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#gmlroblcts .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#gmlroblcts .gt_from_md > :first-child {
  margin-top: 0;
}

#gmlroblcts .gt_from_md > :last-child {
  margin-bottom: 0;
}

#gmlroblcts .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#gmlroblcts .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#gmlroblcts .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#gmlroblcts .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#gmlroblcts .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#gmlroblcts .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#gmlroblcts .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#gmlroblcts .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gmlroblcts .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#gmlroblcts .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#gmlroblcts .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#gmlroblcts .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#gmlroblcts .gt_left {
  text-align: left;
}

#gmlroblcts .gt_center {
  text-align: center;
}

#gmlroblcts .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#gmlroblcts .gt_font_normal {
  font-weight: normal;
}

#gmlroblcts .gt_font_bold {
  font-weight: bold;
}

#gmlroblcts .gt_font_italic {
  font-style: italic;
}

#gmlroblcts .gt_super {
  font-size: 65%;
}

#gmlroblcts .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="gmlroblcts" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">color_name</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">hex</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">red</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">green</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">blue</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_left gt_stub">white, gray100</td>
      <td class="gt_row gt_left" style="background-color: #FFFFFF;">#FFFFFF</td>
      <td class="gt_row gt_right" style="background-color: #FFFFFF;">255</td>
      <td class="gt_row gt_right" style="background-color: #FFFFFF;">255</td>
      <td class="gt_row gt_right" style="background-color: #FFFFFF;">255</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_stub">gray67</td>
      <td class="gt_row gt_left" style="color: white; background-color: #ABABAB;">#ABABAB</td>
      <td class="gt_row gt_right" style="color: white; background-color: #ABABAB;">171</td>
      <td class="gt_row gt_right" style="color: white; background-color: #ABABAB;">171</td>
      <td class="gt_row gt_right" style="color: white; background-color: #ABABAB;">171</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_stub">gray33</td>
      <td class="gt_row gt_left" style="color: white; background-color: #545454;">#545454</td>
      <td class="gt_row gt_right" style="color: white; background-color: #545454;">84</td>
      <td class="gt_row gt_right" style="color: white; background-color: #545454;">84</td>
      <td class="gt_row gt_right" style="color: white; background-color: #545454;">84</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_stub">black, gray0</td>
      <td class="gt_row gt_left" style="color: white; background-color: #000000;">#000000</td>
      <td class="gt_row gt_right" style="color: white; background-color: #000000;">0</td>
      <td class="gt_row gt_right" style="color: white; background-color: #000000;">0</td>
      <td class="gt_row gt_right" style="color: white; background-color: #000000;">0</td>
    </tr>
  </tbody>
  
  
</table></div>
<p>Note that everywhere you see “gray” above, you will get the same results if you substitute “grey”. We see that white corresponds to maximum intensity in all channels and black to the minimum.</p>
<p>To review, here are the ways to specify colors in R:</p>
<ul>
<li>a <em>positive integer</em>, used to index into the current color palette (queried or manipulated via <code>palette()</code>)</li>
<li>a <em>color name</em> among those found in <code>colors()</code></li>
<li>a <em>hexadecimal string</em>; in addition to a hexadecimal triple, in some contexts this can be extended to a hexadecimal quadruple with the fourth channel referring to alpha transparency</li>
</ul>
<p>Here are some functions to read up on if you want to learn more – don’t forget to mine the “See Also” section of the help to expand your horizons: <code>rgb()</code>, <code>col2rgb()</code>, <code>convertColor()</code>.</p>
</div>
<div id="alternatives-to-the-rgb-color-model-especially-hcl" class="section level2">
<h2><span class="header-section-number">25.8</span> Alternatives to the RGB color model, especially HCL</h2>
<p>The RGB color space or model is by no means the only or best one. It’s natural for describing colors for display on a computer screen but some really important color picking tasks are hard to execute in this model. For example, it’s not obvious how to construct a qualitative palette where the colors are easy for humans to distinguish, but are also perceptually comparable to one other. Appreciate this: we can use RGB to describe colors to the computer <strong>but we don’t have to use it as the space where we construct color systems</strong>.</p>
<p>Color models generally have three dimensions, as RGB does, due to the physiological reality that humans have three different receptors in the retina. (<a href="https://manyworldstheory.com/2013/01/15/my-favorite-rgb-color/">Here is an informative blog post</a> on RGB and the human visual system.) The closer a color model’s dimensions correspond to distinct qualities people can perceive, the more useful it is. This correspondence facilitates the deliberate construction of palettes and paths through color space with specific properties. RGB lacks this concordance with human perception. Just because you have photoreceptors that detect red, green, and blue light, it doesn’t mean that your <em>perceptual experience</em> of color breaks down that way. Do you experience the color yellow as a mix of red and green light? No, of course not, but that’s the physiological reality. An RGB alternative you may have encountered is the Hue-Saturation-Value (HSV) model. Unfortunately, it is also quite problematic for color picking, due to its dimensions being confounded with each other.</p>
<p>What are the good perceptually-based color models? CIELUV and CIELAB are two well-known examples. We will focus on a variant of CIELUV, namely the Hue-Chroma-Luminance (HCL) model. It is written up nicely for an R audience in Zeileis et al.’s <a href="https://eeecon.uibk.ac.at/~zeileis/papers/Zeileis+Hornik+Murrell-2009.pdf">“Escaping RGBland: Selecting Colors for Statistical Graphs”</a> in <a href="https://doi.org/10.1016/j.csda.2008.11.033">Computational Statistics &amp; Data Analysis</a> <span class="citation">(<a href="#ref-zeileis2009" role="doc-biblioref">2009</a>)</span>. There is a companion R package colorspace, which will help you to explore and exploit the HCL color model. Finally, this color model is fully embraced in ggplot2 (as are the RColorBrewer palettes).</p>
<p>Here’s what I can tell you about the HCL model’s three dimensions:</p>
<ul>
<li><strong>Hue</strong> is what you usually think of when you think “what color is that?” It’s the easy one! It is given as an angle, going from 0 to 360, so imagine a rainbow donut.</li>
<li><strong>Chroma</strong> refers to colorfullness, i.e. how pure or vivid a color is. The more something seems mixed with gray, the lower its chromaticity. The lowest possible value is 0, which corresponds to actual gray. The maximum value varies with luminance.</li>
<li><strong>Luminance</strong> is related to brightness, lightness, intensity, and value. Low luminance means dark and indeed black has luminance 0. High luminance means light and white has luminance 1.</li>
</ul>
<p>Full disclosure: I have a hard time really grasping and distinguishing chroma and luminance. As we point out above, they are not entirely independent, which speaks to the weird shape of the 3 dimensional HCL space.</p>
<p>This figure in Wickham’s <a href="https://ggplot2-book.org/index.html">ggplot2: Elegant Graphics for Data Analysis</a> <span class="citation">(<a href="#ref-wickham2009" role="doc-biblioref">2009</a>)</span> book is helpful for understanding the HCL color space:</p>
<div class="figure">
<img src="img/ggplot2book-fig6.6.png" alt="From [ggplot2: Elegant Graphics for Data Analysis](https://ggplot2-book.org/index.html) by Hadley Wickham [-@wickham2009]"  />
<p class="caption">
(#fig:unnamed-chunk-19)From <a href="https://ggplot2-book.org/index.html">ggplot2: Elegant Graphics for Data Analysis</a> by Hadley Wickham <span class="citation">(<a href="#ref-wickham2009" role="doc-biblioref">2009</a>)</span>
</p>
</div>
<p>Paraphrasing Wickham: Each facet or panel depicts a slice through HCL space for a specific luminance, going from low to high. The extreme luminance values of 0 and 100 are omitted because they would, respectively, be a single black point and a single white point. Within a slice, the centre has chroma 0, which corresponds to a shade of grey. As you move toward the slice’s edge, chroma increases and the color gets more pure and intense. Hue is mapped to angle.</p>
<p>A valuable contribution of the colorspace package is that it provides functions to create color palettes traversing color space in a rational way. In contrast, the palettes offered by RColorBrewer, though well-crafted, are unfortunately fixed.</p>
<p>Here is an article that uses compelling examples to advocate for perceptually based color systems and to demonstrate the importance of signalling where zero is in colorspace:</p>
<ul>
<li><a href="https://www.google.com/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=2&amp;cad=rja&amp;uact=8&amp;ved=2ahUKEwi0xYqJ8JbjAhWNvp4KHViYDxsQFjABegQIABAC&amp;url=https%3A%2F%2Fwww.researchgate.net%2Fprofile%2FAhmed_Elhattab2%2Fpost%2FPlease_suggest_some_good_3D_plot_tool_Software_for_surface_plot%2Fattachment%2F5c05ba35cfe4a7645506948e%2FAS%253A699894335557644%25401543879221725%2Fdownload%2FWhy%2BShould%2BEngineers%2Band%2BScientists%2BBe%2BWorried%2BAbout%2BColor_.pdf&amp;usg=AOvVaw1qwjjGMd7h_z6TLUjzu7Nb">“Why Should Engineers and Scientists Be Worried About Color?”</a> <span class="citation">(Rogowitz and Treinish <a href="#ref-rogowitz1996" role="doc-biblioref">1996</a>)</span></li>
</ul>
<!--TODO: Insert/recreate some visuals from the Zeileis et al. paper or from the colorspace vignette. Show actual usage! -->
</div>
<div id="accommodating-color-blindness" class="section level2">
<h2><span class="header-section-number">25.9</span> Accommodating color blindness</h2>
<p>The dichromat package (<a href="https://CRAN.R-project.org/package=dichromat">on CRAN</a>) will help you select a color scheme that will be effective for color blind readers.</p>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="#cb297-1"></a><span class="co"># install.packages(&quot;dichromat&quot;)</span></span>
<span id="cb297-2"><a href="#cb297-2"></a><span class="kw">library</span>(dichromat)</span></code></pre></div>
<p>This <code>colorschemes</code> list contains <code>length(colorschemes)</code> color schemes “suitable for people with deficient or anomalous red-green vision”:</p>
<div class="figure">
<img src="025_colors_files/figure-html/dichromat-colorschemes-1.png" alt="Color schemes &quot;suitable for people with deficient or anomalous red-green vision&quot;" width="672" />
<p class="caption">
(#fig:dichromat-colorschemes)Color schemes “suitable for people with deficient or anomalous red-green vision”
</p>
</div>
<p>What else does the dichromat package offer? The <code>dichromat()</code> function transforms colors to approximate the effect of different forms of color blindness, allowing you to assess the performance of a candidate scheme. The command <code>data("dalton")</code> will make two objects available which represent a 256-color palette as it would appear with normal vision, with two types of red-green color blindness, and with green-blue color blindness.</p>
</div>
<div id="clean-up-1" class="section level2">
<h2><span class="header-section-number">25.10</span> Clean up</h2>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="#cb298-1"></a><span class="co">## NOT RUN</span></span>
<span id="cb298-2"><a href="#cb298-2"></a><span class="co">## execute this if you followed my code for</span></span>
<span id="cb298-3"><a href="#cb298-3"></a><span class="co">## changing the default plot symbol in a simple, non-knitr setting</span></span>
<span id="cb298-4"><a href="#cb298-4"></a><span class="co">## reversing the effects of this: opar &lt;- par(pch = 19)</span></span>
<span id="cb298-5"><a href="#cb298-5"></a><span class="kw">par</span>(opar)</span></code></pre></div>
</div>
<div id="resources-9" class="section level2">
<h2><span class="header-section-number">25.11</span> Resources</h2>
<ul>
<li>Zeileis et al.’s <a href="https://eeecon.uibk.ac.at/~zeileis/papers/Zeileis+Hornik+Murrell-2009.pdf">“Escaping RGBland: Selecting Colors for Statistical Graphs”</a> in <a href="https://doi.org/10.1016/j.csda.2008.11.033">Computational Statistics &amp; Data Analysis</a> <span class="citation">(<a href="#ref-zeileis2009" role="doc-biblioref">2009</a>)</span>.</li>
<li><a href="https://cran.r-project.org/web/packages/colorspace/vignettes/hcl-colors.pdf">Vignette</a> for the <a href="https://CRAN.R-project.org/package=colorspace">colorspace</a> package.</li>
<li>Earl F. Glynn (Stowers Institute for Medical Research):
<ul>
<li><a href="https://web.archive.org/web/20121022044903/http://research.stowers-institute.org/efg/R/Color/Chart/">Excellent resources</a> for named colors, i.e. the ones available via <code>colors()</code>.</li>
<li>Informative talk <a href="https://www.uv.es/conesa/CursoR/material/UsingColorInR.pdf">“Using Color in R”</a>, though features some questionable <em>use</em> of color itself.</li>
</ul></li>
<li>Blog post <a href="https://manyworldstheory.com/2013/01/15/my-favorite-rgb-color/">My favorite RGB color</a> on the Many World Theory blog.</li>
<li>Wickham’s <a href="https://www.springer.com/gp/book/9780387981413">ggplot2: Elegant Graphics for Data Analysis</a> <span class="citation">(<a href="#ref-wickham2009" role="doc-biblioref">2009</a>)</span>.
<ul>
<li><a href="https://docs.ggplot2.org/current/">Online docs (nice!)</a></li>
<li><a href="https://ggplot2.tidyverse.org">Package webpage</a></li>
<li>ggplot2 on <a href="https://CRAN.R-project.org/package=ggplot2">CRAN</a> and <a href="https://github.com/tidyverse/ggplot2">GitHub</a></li>
<li>Section 6.4.3 Colour</li>
</ul></li>
<li><a href="https://www.google.com/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=2&amp;cad=rja&amp;uact=8&amp;ved=2ahUKEwi0xYqJ8JbjAhWNvp4KHViYDxsQFjABegQIABAC&amp;url=https%3A%2F%2Fwww.researchgate.net%2Fprofile%2FAhmed_Elhattab2%2Fpost%2FPlease_suggest_some_good_3D_plot_tool_Software_for_surface_plot%2Fattachment%2F5c05ba35cfe4a7645506948e%2FAS%253A699894335557644%25401543879221725%2Fdownload%2FWhy%2BShould%2BEngineers%2Band%2BScientists%2BBe%2BWorried%2BAbout%2BColor_.pdf&amp;usg=AOvVaw1qwjjGMd7h_z6TLUjzu7Nb">“Why Should Engineers and Scientists Be Worried About Color?”</a> by Bernice E. Rogowitz and Lloyd A. Treinish of IBM Research <span class="citation">(<a href="#ref-rogowitz1996" role="doc-biblioref">1996</a>)</span>, h/t <a href="https://twitter.com/EdwardTufte">@EdwardTufte</a>.</li>
</ul>
<!--RStudio Links-->
<!--HappyGitWithR Links-->
<!--Package Links-->
<!--Shiny links-->
<!--Publications-->
<!--R Documentation-->
<!--Wikipedia Links-->
<!--Misc. Links-->
<!--chapter:end:025_colors.Rmd-->
</div>
</div>
<div id="qualitative-colors" class="section level1">
<h1><span class="header-section-number">26</span> Taking control of qualitative colors in ggplot</h1>
<!--Original content: https://stat545.com/block019_enforce-color-scheme.html-->
<div id="load-packages-and-prepare-the-gapminder-data" class="section level2">
<h2><span class="header-section-number">26.1</span> Load packages and prepare the Gapminder data</h2>
<p>Load the ggplot and dplyr packages and bring in the usual Gapminder data but drop Oceania, which only has two countries.</p>
<p>We also sort the country factor based on population and then sort the data as well. Why? In the bubble plots below, we don’t want large countries to hide small countries. This is a case where, sadly, the row order of the data truly affects the visual output.</p>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="#cb299-1"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb299-2"><a href="#cb299-2"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb299-3"><a href="#cb299-3"></a><span class="kw">library</span>(gapminder)</span>
<span id="cb299-4"><a href="#cb299-4"></a></span>
<span id="cb299-5"><a href="#cb299-5"></a>jdat &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb299-6"><a href="#cb299-6"></a><span class="st">  </span><span class="kw">filter</span>(continent <span class="op">!=</span><span class="st"> &quot;Oceania&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb299-7"><a href="#cb299-7"></a><span class="st">  </span><span class="kw">droplevels</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb299-8"><a href="#cb299-8"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">country =</span> <span class="kw">reorder</span>(country, <span class="dv">-1</span> <span class="op">*</span><span class="st"> </span>pop)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb299-9"><a href="#cb299-9"></a><span class="st">  </span><span class="kw">arrange</span>(year, country)  </span></code></pre></div>
</div>
<div id="take-control-of-the-size-and-color-of-points" class="section level2">
<h2><span class="header-section-number">26.2</span> Take control of the size and color of points</h2>
<p>Let’s use ggplot to move towards the classic Gapminder bubble chart. Crawl then walk then run.</p>
<p>First, make a simple scatterplot for a single year.</p>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="#cb300-1"></a>j_year &lt;-<span class="st"> </span><span class="dv">2007</span></span>
<span id="cb300-2"><a href="#cb300-2"></a></span>
<span id="cb300-3"><a href="#cb300-3"></a>q &lt;-<span class="st"> </span>jdat <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb300-4"><a href="#cb300-4"></a><span class="st">  </span><span class="kw">filter</span>(year <span class="op">==</span><span class="st"> </span>j_year) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb300-5"><a href="#cb300-5"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> gdpPercap, <span class="dt">y =</span> lifeExp)) <span class="op">+</span></span>
<span id="cb300-6"><a href="#cb300-6"></a><span class="st">  </span><span class="kw">scale_x_log10</span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">230</span>, <span class="dv">63000</span>))</span>
<span id="cb300-7"><a href="#cb300-7"></a></span>
<span id="cb300-8"><a href="#cb300-8"></a>q <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</span></code></pre></div>
<p><img src="026_qualitative-colors_files/figure-html/scatterplot-1.png" width="672" /></p>
<p>Take control of the plotting symbol, its size, and its color. Use obnoxious settings so that success versus failure is completely obvious. Now is not the time for the delicate operation of inserting your fancy color scheme. Be bold!</p>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="#cb301-1"></a><span class="co">## do I have control of size and fill color? YES!</span></span>
<span id="cb301-2"><a href="#cb301-2"></a>q <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">pch =</span> <span class="dv">21</span>, <span class="dt">size =</span> <span class="dv">8</span>, <span class="dt">fill =</span> <span class="kw">I</span>(<span class="st">&quot;darkorchid1&quot;</span>))</span></code></pre></div>
<p><img src="026_qualitative-colors_files/figure-html/scatterplot-obnoxious-points-1.png" width="672" /></p>
</div>
<div id="circle-area-population" class="section level2">
<h2><span class="header-section-number">26.3</span> Circle area = population</h2>
<p>We want the size of the circle to reflect population. I have two complaints with my first attempt: the circles are still too small for my taste and I don’t want the size legend. So in my second attempt, I suppress the legend with <code>show.legend = FALSE</code> and I increase the range of sizes by explicitly setting the range for the scale that maps <code>pop</code> into circle size.</p>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="#cb302-1"></a>q <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">size =</span> pop), <span class="dt">pch =</span> <span class="dv">21</span>)</span>
<span id="cb302-2"><a href="#cb302-2"></a>(r &lt;-<span class="st"> </span>q <span class="op">+</span></span>
<span id="cb302-3"><a href="#cb302-3"></a><span class="st">   </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">size =</span> pop), <span class="dt">pch =</span> <span class="dv">21</span>, <span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb302-4"><a href="#cb302-4"></a><span class="st">   </span><span class="kw">scale_size_continuous</span>(<span class="dt">range =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">40</span>)))</span></code></pre></div>
<p><img src="026_qualitative-colors_files/figure-html/scatterplot-population-area-1.png" width="50%" /><img src="026_qualitative-colors_files/figure-html/scatterplot-population-area-2.png" width="50%" /></p>
</div>
<div id="circle-fill-color-determined-by-a-factor" class="section level2">
<h2><span class="header-section-number">26.4</span> Circle fill color determined by a factor</h2>
<p>Now I use <code>aes()</code> to map a factor to color. For the moment, I settle for the <code>continent</code> factor and for the automatic color scheme. I also facet by continent. Why? Because it will be helpful below for checking my progress on using my custom color scheme. Since all the countries, say, in Europe, are some shade of green, if the continent facets have circles of many colors, I’ll know something’s wrong.</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="#cb303-1"></a>(r &lt;-<span class="st"> </span>r <span class="op">+</span><span class="st"> </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>continent) <span class="op">+</span><span class="st"> </span><span class="kw">ylim</span>(<span class="kw">c</span>(<span class="dv">39</span>, <span class="dv">87</span>)))</span>
<span id="cb303-2"><a href="#cb303-2"></a>r <span class="op">+</span><span class="st"> </span><span class="kw">aes</span>(<span class="dt">fill =</span> continent)</span></code></pre></div>
<p><img src="026_qualitative-colors_files/figure-html/scatterplot-continent-fill-1.png" width="50%" /><img src="026_qualitative-colors_files/figure-html/scatterplot-continent-fill-2.png" width="50%" /></p>
</div>
<div id="get-the-color-scheme-for-the-countries" class="section level2">
<h2><span class="header-section-number">26.5</span> Get the color scheme for the countries</h2>
<p>The gapminder package comes with color palettes for the continents and the individual countries. For example, here’s the country color scheme:</p>
<div class="figure">
<img src="img/gapminder-color-scheme-ggplot2.png" alt="From [https://github.com/jennybc/gapminder](https://github.com/jennybc/gapminder)"  />
<p class="caption">
(#fig:unnamed-chunk-3)From <a href="https://github.com/jennybc/gapminder">https://github.com/jennybc/gapminder</a>
</p>
</div>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb304-1"><a href="#cb304-1"></a><span class="kw">str</span>(country_colors)</span>
<span id="cb304-2"><a href="#cb304-2"></a><span class="co">#&gt;  Named chr [1:142] &quot;#7F3B08&quot; &quot;#833D07&quot; &quot;#873F07&quot; &quot;#8B4107&quot; ...</span></span>
<span id="cb304-3"><a href="#cb304-3"></a><span class="co">#&gt;  - attr(*, &quot;names&quot;)= chr [1:142] &quot;Nigeria&quot; &quot;Egypt&quot; &quot;Ethiopia&quot; &quot;Congo, Dem. Re&quot;..</span></span>
<span id="cb304-4"><a href="#cb304-4"></a><span class="kw">head</span>(country_colors)</span>
<span id="cb304-5"><a href="#cb304-5"></a><span class="co">#&gt;          Nigeria            Egypt         Ethiopia Congo, Dem. Rep. </span></span>
<span id="cb304-6"><a href="#cb304-6"></a><span class="co">#&gt;        &quot;#7F3B08&quot;        &quot;#833D07&quot;        &quot;#873F07&quot;        &quot;#8B4107&quot; </span></span>
<span id="cb304-7"><a href="#cb304-7"></a><span class="co">#&gt;     South Africa            Sudan </span></span>
<span id="cb304-8"><a href="#cb304-8"></a><span class="co">#&gt;        &quot;#8F4407&quot;        &quot;#934607&quot;</span></span></code></pre></div>
<p><code>country_colors</code> is a named character vector, with one element per country, holding the RGB hex strings encoding the color scheme.</p>
<p><strong>Note:</strong> The order of <code>country_colors</code> is not alphabetical. The countries are actually sorted by size (in which particular year, I don’t recall) within continent, reflecting the logic by which the scheme was created. No problem. Ideally, nothing in your analysis should depend on row order, although that’s not always possible in reality.</p>
</div>
<div id="prepare-the-color-scheme-for-use-with-ggplot" class="section level2">
<h2><span class="header-section-number">26.6</span> Prepare the color scheme for use with ggplot</h2>
<p>In a <a href="https://vita.had.co.nz/papers/layered-grammar.html">grammar of graphics</a>, a <strong>scale</strong> controls the mapping from a variable in the data to an aesthetic <span class="citation">(Wickham <a href="#ref-wickham2010" role="doc-biblioref">2010</a>)</span>. So far we’ve let the coloring / filling scale be determined automatically by <code>ggplot2.</code> But to use our custom color scheme, we need to take control of the mapping of the <code>country</code> factor into fill color in <code>geom_point()</code>.</p>
<p>We will use <code>scale_fill_manual()</code>, a member of a family of functions for customization of the discrete scales. The main argument is <code>values =</code>, which is a vector of aesthetic values – fill colors, in our case. If this vector has names, they will be consulted during the mapping. This is incredibly useful! This is why <code>country_colors</code> does <strong>exactly that</strong>. This saves us from any worry about the order of levels of the <code>country</code> factor, the row order of the data, or exactly which countries are being plotted.</p>
</div>
<div id="make-the-ggplot-bubble-chart" class="section level2">
<h2><span class="header-section-number">26.7</span> Make the ggplot bubble chart</h2>
<p>This is deceptively simple at this point. Like many things, it looks really easy, once we figure everything out! The last two bits we add are to use <code>aes()</code> to specify that the country should be mapped to color and to use <code>scale_fill_manual()</code> to specify our custom color scheme.</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="#cb305-1"></a>r <span class="op">+</span><span class="st"> </span><span class="kw">aes</span>(<span class="dt">fill =</span> country) <span class="op">+</span><span class="st"> </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> country_colors)</span></code></pre></div>
<p><img src="026_qualitative-colors_files/figure-html/scatterplot-country-fill-1.png" width="672" /></p>
</div>
<div id="all-together-now" class="section level2">
<h2><span class="header-section-number">26.8</span> All together now</h2>
<p>The complete code to make the plot.</p>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="#cb306-1"></a>j_year &lt;-<span class="st"> </span><span class="dv">2007</span></span>
<span id="cb306-2"><a href="#cb306-2"></a>jdat <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb306-3"><a href="#cb306-3"></a><span class="st">  </span><span class="kw">filter</span>(year <span class="op">==</span><span class="st"> </span>j_year) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb306-4"><a href="#cb306-4"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> gdpPercap, <span class="dt">y =</span> lifeExp, <span class="dt">fill =</span> country)) <span class="op">+</span></span>
<span id="cb306-5"><a href="#cb306-5"></a><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> country_colors) <span class="op">+</span></span>
<span id="cb306-6"><a href="#cb306-6"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>continent) <span class="op">+</span></span>
<span id="cb306-7"><a href="#cb306-7"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">size =</span> pop), <span class="dt">pch =</span> <span class="dv">21</span>, <span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb306-8"><a href="#cb306-8"></a><span class="st">  </span><span class="kw">scale_x_log10</span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">230</span>, <span class="dv">63000</span>)) <span class="op">+</span></span>
<span id="cb306-9"><a href="#cb306-9"></a><span class="st">  </span><span class="kw">scale_size_continuous</span>(<span class="dt">range =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">40</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">ylim</span>(<span class="kw">c</span>(<span class="dv">39</span>, <span class="dv">87</span>))</span></code></pre></div>
<p><img src="026_qualitative-colors_files/figure-html/scatterplot-country-fill-final-1.png" width="672" /></p>
<!--RStudio Links-->
<!--HappyGitWithR Links-->
<!--Package Links-->
<!--Shiny links-->
<!--Publications-->
<!--R Documentation-->
<!--Wikipedia Links-->
<!--Misc. Links-->
<!--chapter:end:026_qualitative-colors.Rmd-->
</div>
</div>
<div id="secrets" class="section level1">
<h1><span class="header-section-number">27</span> Secrets of a happy graphing life</h1>
<!--Original content: https://stat545.com/block016_secrets-happy-graphing.html-->
<div id="load-gapminder-and-the-tidyverse-1" class="section level2">
<h2><span class="header-section-number">27.1</span> Load gapminder and the tidyverse</h2>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="#cb307-1"></a><span class="kw">library</span>(gapminder)</span>
<span id="cb307-2"><a href="#cb307-2"></a><span class="kw">library</span>(tidyverse)</span></code></pre></div>
</div>
<div id="hidden-data-wrangling-problems" class="section level2">
<h2><span class="header-section-number">27.2</span> Hidden data wrangling problems</h2>
<p>If you are struggling to make a figure, don’t assume it’s a problem between you and ggplot2. Stop and ask yourself which of these rules you are breaking:</p>
<ul>
<li>Keep stuff in data frames</li>
<li>Keep your data frames <em>tidy</em>; be willing to reshape your data often</li>
<li>Use factors and be the boss of them</li>
</ul>
<p>In my experience, the vast majority of graphing agony is due to insufficient data wrangling. Tackle your latent data storage and manipulation problems and your graphing problem often melts away.</p>
</div>
<div id="keep-stuff-in-data-frames" class="section level2">
<h2><span class="header-section-number">27.3</span> Keep stuff in data frames</h2>
<p>I see a fair amount of student code where variables are <em>copied out</em> of a data frame, to exist as stand-alone objects in the workspace.</p>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="#cb308-1"></a>life_exp &lt;-<span class="st"> </span>gapminder<span class="op">$</span>lifeExp</span>
<span id="cb308-2"><a href="#cb308-2"></a>year &lt;-<span class="st"> </span>gapminder<span class="op">$</span>year</span></code></pre></div>
<!--TODO: This is no longer true, needs to be updated-->
<p>Problem is, ggplot2 has an incredibly strong preference for variables in data frames; it is virtually a requirement for the main data frame underpinning a plot.</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb309-1"><a href="#cb309-1"></a><span class="kw">ggplot</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> life_exp)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_jitter</span>()</span></code></pre></div>
<p><img src="027_secrets-happy-graphics_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p><strong>Just leave the variables in place and pass the associated data frame!</strong> This advice applies to base and lattice graphics as well. It is not specific to ggplot2.</p>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="#cb310-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> gapminder, <span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> life_exp)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_jitter</span>()</span></code></pre></div>
<p><img src="027_secrets-happy-graphics_files/figure-html/data-in-situ-1.png" width="672" /></p>
<p>What if we wanted to filter the data by country, continent, or year? This is much easier to do safely if all affected variables live together in a data frame, not as individual objects that can get “out of sync.”</p>
<p>Don’t write-off ggplot2 as a highly opinionated outlier! In fact, keeping data in data frames and computing and visualizing it <em>in situ</em> are widely regarded as best practices. The option to pass a data frame via <code>data =</code> is a common feature of many high-use R functions, e.g. <code>lm()</code>, <code>aggregate()</code>, <code>plot()</code>, and <code>t.test()</code>, so make this your default <em>modus operandi</em>.</p>
<div id="explicit-data-frame-creation-via-tibbletibble-and-tibbletribble" class="section level3">
<h3><span class="header-section-number">27.3.1</span> Explicit data frame creation via <code>tibble::tibble()</code> and <code>tibble::tribble()</code></h3>
<p>If your data is already lying around and it’s <strong>not</strong> in a data frame, ask yourself “why not?”. Did you create those variables? Maybe you should have created them in a data frame in the first place! The <code>tibble()</code> function is an improved version of the built-in <code>data.frame()</code>, which makes it possible to define one variable in terms of another and which won’t turn character data into factor. If constructing tiny tibbles “by hand”, <code>tribble()</code> can be an even handier function, in which your code will be laid out like the table you are creating. These functions should remove the most common excuses for data frame procrastination and avoidance.</p>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="#cb311-1"></a>my_dat &lt;-</span>
<span id="cb311-2"><a href="#cb311-2"></a><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,</span>
<span id="cb311-3"><a href="#cb311-3"></a>         <span class="dt">y =</span> x <span class="op">^</span><span class="st"> </span><span class="dv">2</span>,</span>
<span id="cb311-4"><a href="#cb311-4"></a>         <span class="dt">text =</span> <span class="kw">c</span>(<span class="st">&quot;alpha&quot;</span>, <span class="st">&quot;beta&quot;</span>, <span class="st">&quot;gamma&quot;</span>, <span class="st">&quot;delta&quot;</span>, <span class="st">&quot;epsilon&quot;</span>))</span>
<span id="cb311-5"><a href="#cb311-5"></a><span class="co">## if you&#39;re truly &quot;hand coding&quot;, tribble() is an alternative</span></span>
<span id="cb311-6"><a href="#cb311-6"></a>my_dat &lt;-<span class="st"> </span><span class="kw">tribble</span>(</span>
<span id="cb311-7"><a href="#cb311-7"></a>  <span class="op">~</span><span class="st"> </span>x, <span class="op">~</span><span class="st"> </span>y,    <span class="op">~</span><span class="st"> </span>text,</span>
<span id="cb311-8"><a href="#cb311-8"></a>    <span class="dv">1</span>,   <span class="dv">1</span>,   <span class="st">&quot;alpha&quot;</span>,</span>
<span id="cb311-9"><a href="#cb311-9"></a>    <span class="dv">2</span>,   <span class="dv">4</span>,    <span class="st">&quot;beta&quot;</span>,</span>
<span id="cb311-10"><a href="#cb311-10"></a>    <span class="dv">3</span>,   <span class="dv">9</span>,   <span class="st">&quot;gamma&quot;</span>,</span>
<span id="cb311-11"><a href="#cb311-11"></a>    <span class="dv">4</span>,  <span class="dv">16</span>,   <span class="st">&quot;delta&quot;</span>,</span>
<span id="cb311-12"><a href="#cb311-12"></a>    <span class="dv">5</span>,  <span class="dv">25</span>, <span class="st">&quot;epsilon&quot;</span></span>
<span id="cb311-13"><a href="#cb311-13"></a>)</span>
<span id="cb311-14"><a href="#cb311-14"></a><span class="kw">str</span>(my_dat)</span>
<span id="cb311-15"><a href="#cb311-15"></a><span class="co">#&gt; tibble [5 x 3] (S3: tbl_df/tbl/data.frame)</span></span>
<span id="cb311-16"><a href="#cb311-16"></a><span class="co">#&gt;  $ x   : num [1:5] 1 2 3 4 5</span></span>
<span id="cb311-17"><a href="#cb311-17"></a><span class="co">#&gt;  $ y   : num [1:5] 1 4 9 16 25</span></span>
<span id="cb311-18"><a href="#cb311-18"></a><span class="co">#&gt;  $ text: chr [1:5] &quot;alpha&quot; &quot;beta&quot; &quot;gamma&quot; &quot;delta&quot; ...</span></span>
<span id="cb311-19"><a href="#cb311-19"></a><span class="kw">ggplot</span>(my_dat, <span class="kw">aes</span>(x, y)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> text))</span></code></pre></div>
<p><img src="027_secrets-happy-graphics_files/figure-html/data_frame-love-1.png" width="672" /></p>
<p>Together with <code>dplyr::mutate()</code>, which adds new variables to a data frame, this gives you the tools to work within data frames whenever you’re handling related variables of the same length.</p>
</div>
<div id="sidebar-with" class="section level3">
<h3><span class="header-section-number">27.3.2</span> Sidebar: <code>with()</code></h3>
<p>Sadly, not all functions offer a <code>data =</code> argument. Take <code>cor()</code>, for example, which computes correlation. This does <strong>not</strong> work:</p>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="#cb312-1"></a><span class="kw">cor</span>(year, lifeExp, <span class="dt">data =</span> gapminder)</span>
<span id="cb312-2"><a href="#cb312-2"></a><span class="co">#&gt; Error in cor(year, lifeExp, data = gapminder): unused argument (data = gapminder)</span></span></code></pre></div>
<p>Sure, you can always just repeat the data frame name like so:</p>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb313-1"><a href="#cb313-1"></a><span class="kw">cor</span>(gapminder<span class="op">$</span>year, gapminder<span class="op">$</span>lifeExp)</span>
<span id="cb313-2"><a href="#cb313-2"></a><span class="co">#&gt; [1] 0.436</span></span></code></pre></div>
<p>but people hate typing. I suspect subconscious dread of repeatedly typing <code>gapminder</code> is what motivates those who copy variables into stand-alone objects in the workspace.</p>
<p>The <code>with()</code> function is a better workaround. Provide the data frame as the first argument. The second argument is an expression that will be evaluated in a special environment. It could be a single command or a multi-line snippet of code. What’s special is that you can refer to variables in the data frame by name.</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="#cb314-1"></a><span class="kw">with</span>(gapminder,</span>
<span id="cb314-2"><a href="#cb314-2"></a>     <span class="kw">cor</span>(year, lifeExp))</span>
<span id="cb314-3"><a href="#cb314-3"></a><span class="co">#&gt; [1] 0.436</span></span></code></pre></div>
<p>If you use the magrittr package, another option is to use the <code>%$%</code> operator to expose the variables inside a data frame for further computation:</p>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="#cb315-1"></a><span class="kw">library</span>(magrittr)</span>
<span id="cb315-2"><a href="#cb315-2"></a>gapminder <span class="op">%$%</span></span>
<span id="cb315-3"><a href="#cb315-3"></a><span class="st">  </span><span class="kw">cor</span>(year, lifeExp)</span>
<span id="cb315-4"><a href="#cb315-4"></a><span class="co">#&gt; [1] 0.436</span></span></code></pre></div>
</div>
</div>
<div id="tidying-and-reshaping" class="section level2">
<h2><span class="header-section-number">27.4</span> Tidying and reshaping</h2>
<p>This is an entire topic covered elsewhere:</p>
<p>Chapter @ref(tidy-data) - <a href="https://github.com/jennybc/lotr-tidy#readme">Tidy data using Lord of the Rings</a></p>
</div>
<div id="factor-management" class="section level2">
<h2><span class="header-section-number">27.5</span> Factor management</h2>
<p>This is an entire topic covered elsewhere:</p>
<p>Chapter @ref(factors-boss) - <a href="#factors-boss">Be the boss of your factors</a></p>
</div>
<div id="worked-example" class="section level2">
<h2><span class="header-section-number">27.6</span> Worked example</h2>
<p>Inspired by this question from a student when we first started using ggplot2: How can I focus in on country, Japan for example, and plot all the quantitative variables against year?</p>
<p>Your first instinct might be to filter the Gapminder data for Japan and then loop over the variables, creating separate plots which need to be glued together. And, indeed, this can be done. But in my opinion, the data reshaping route is more “R native” given our current ecosystem, than the loop way.</p>
<div id="reshape-your-data" class="section level3">
<h3><span class="header-section-number">27.6.1</span> Reshape your data</h3>
<p>We filter the Gapminder data and keep only Japan. Then we use <code>tidyr::gather()</code> to <em>gather</em> up the variables <code>pop</code>, <code>lifeExp</code>, and <code>gdpPercap</code> into a single <code>value</code> variable, with a companion variable <code>key</code>.</p>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="#cb316-1"></a>japan_dat &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span></span>
<span id="cb316-2"><a href="#cb316-2"></a><span class="st">  </span><span class="kw">filter</span>(country <span class="op">==</span><span class="st"> &quot;Japan&quot;</span>)</span>
<span id="cb316-3"><a href="#cb316-3"></a>japan_tidy &lt;-<span class="st"> </span>japan_dat <span class="op">%&gt;%</span></span>
<span id="cb316-4"><a href="#cb316-4"></a><span class="st">  </span><span class="kw">gather</span>(<span class="dt">key =</span> var, <span class="dt">value =</span> value, pop, lifeExp, gdpPercap)</span>
<span id="cb316-5"><a href="#cb316-5"></a><span class="kw">dim</span>(japan_dat)</span>
<span id="cb316-6"><a href="#cb316-6"></a><span class="co">#&gt; [1] 12  6</span></span>
<span id="cb316-7"><a href="#cb316-7"></a><span class="kw">dim</span>(japan_tidy)</span>
<span id="cb316-8"><a href="#cb316-8"></a><span class="co">#&gt; [1] 36  5</span></span></code></pre></div>
<p>The filtered <code>japan_dat</code> has 12 rows. Since we are gathering or stacking three variables in <code>japan_tidy</code>, it makes sense to see three times as many rows, namely 36 in the reshaped result.</p>
</div>
<div id="iterate-over-the-variables-via-faceting" class="section level3">
<h3><span class="header-section-number">27.6.2</span> Iterate over the variables via faceting</h3>
<p>Now that we have the data we need in a tidy data frame, with a proper factor representing the variables we want to “iterate” over, we just have to facet.</p>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="#cb317-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(japan_tidy, <span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> value)) <span class="op">+</span></span>
<span id="cb317-2"><a href="#cb317-2"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>var, <span class="dt">scales=</span><span class="st">&quot;free_y&quot;</span>)</span>
<span id="cb317-3"><a href="#cb317-3"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb317-4"><a href="#cb317-4"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">1950</span>, <span class="dv">2011</span>, <span class="dv">15</span>))</span></code></pre></div>
<p><img src="027_secrets-happy-graphics_files/figure-html/japan-1.png" width="672" /></p>
</div>
<div id="recap-1" class="section level3">
<h3><span class="header-section-number">27.6.3</span> Recap</h3>
<p>Here’s the minimal code to produce our Japan example.</p>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="#cb318-1"></a>japan_tidy &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span></span>
<span id="cb318-2"><a href="#cb318-2"></a><span class="st">  </span><span class="kw">filter</span>(country <span class="op">==</span><span class="st"> &quot;Japan&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb318-3"><a href="#cb318-3"></a><span class="st">  </span><span class="kw">gather</span>(<span class="dt">key =</span> var, <span class="dt">value =</span> value, pop, lifeExp, gdpPercap)</span>
<span id="cb318-4"><a href="#cb318-4"></a><span class="kw">ggplot</span>(japan_tidy, <span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> value)) <span class="op">+</span></span>
<span id="cb318-5"><a href="#cb318-5"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>var, <span class="dt">scales=</span><span class="st">&quot;free_y&quot;</span>) <span class="op">+</span></span>
<span id="cb318-6"><a href="#cb318-6"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb318-7"><a href="#cb318-7"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">1950</span>, <span class="dv">2011</span>, <span class="dv">15</span>))</span></code></pre></div>
<p>This snippet demonstrates the payoffs from the rules we laid out at the start:</p>
<ul>
<li>We isolate the Japan data into its own <strong>data frame</strong>.</li>
<li>We <strong>reshape</strong> the data. We gather three columns into one, because we want to depict them via position along the y-axis in the plot.</li>
<li>We use a <strong>factor</strong> to distinguish the observations that belong in each mini-plot, which then becomes a simple application of faceting.</li>
<li>This is an example of expedient data reshaping. I don’t actually believe that <code>gdpPercap</code>, <code>lifeExp</code>, and <code>pop</code> naturally belong together in one variable. But gathering them was by far the easiest way to get this plot.</li>
</ul>
<!--RStudio Links-->
<!--HappyGitWithR Links-->
<!--Package Links-->
<!--Shiny links-->
<!--Publications-->
<!--R Documentation-->
<!--Wikipedia Links-->
<!--Misc. Links-->
<!--chapter:end:027_secrets-happy-graphics.Rmd-->
</div>
</div>
</div>
<div id="save-figs" class="section level1">
<h1><span class="header-section-number">28</span> Writing figures to file</h1>
<!--Original content: https://stat545.com/block017_write-figure-to-file.html-->
<p>It is not always appropriate or sufficient for figures to exist <em>only</em> inside a dynamic report, such as an R Markdown document. You should know how to write key figures to file for downstream use in a variety of settings.</p>
<p>During development, you need the immediate feedback from seeing your figures appear in a screen device, such as the RStudio Plots pane. Once you’re satisfied, make sure you have all of the commands to produce the figure saved in an R script. You want <em>everything</em>, nachos to cheesecake: data import, any necessary manipulation, then plotting.</p>
<p>Now what? How do you preserve the figure in a file?</p>
<div id="step-away-from-the-mouse" class="section level2">
<h2><span class="header-section-number">28.1</span> Step away from the mouse</h2>
<p><em>Do not</em> succumb to the temptation of a mouse-based process. If might feel handy at the time, but you will regret it. This establishes no link between the source code and the figure product. So when – not if – you need to remake the figure with a different color scheme or aspect ratio or graphics device, you will struggle to dig up the proper source code. Use one of the methods below to avoid this predicament.</p>
</div>
<div id="good-names-are-like-breadcrumbs" class="section level2">
<h2><span class="header-section-number">28.2</span> Good names are like breadcrumbs</h2>
<p>If you save figure-making code in a source file and you give figure files machine-readable, self-documenting names, your future self will be able to find its way back to this code.</p>
<p>Hypothetical: a <a href="https://imgur.com/ewmBeQG">zombie project</a> comes back to life and your collaborator presents you with <a href="https://twitter.com/JohnDCook/status/522377493417033728">a figure you made 18 months ago</a>. Can you remake <code>fig08_scatterplot-lifeExp-vs-year.pdf</code> as a TIFF and with smooth regression? Fun times!</p>
<p>This filename offers several properties to help you find the code that produced it:</p>
<ul>
<li><p><strong>Human-readability</strong>: It’s helpful to know you’re searching for a scatterplot and maybe which variables are important. It gives important context for your personal archaeological dig.</p></li>
<li><p><strong>Specificity</strong>: Note how specific and descriptive the name of this figure file is; we didn’t settle for the generic <code>fig08.pdf</code> or <code>scatterplot.pdf</code>. This makes the name at least somewhat unique, which will help you search your home directory for files containing part or all of this filename.</p></li>
<li><p><strong>Machine-readability</strong>: Every modern OS provides a way to search your hard drive for a file with a specific name or containing a specific string. This will be easier if the name contains no spaces, punctuation, or other funny stuff. If you use conventional extensions, you can even narrow the search to files ending in <code>.R</code> or <code>.Rmd</code>.</p></li>
</ul>
<p>All of these human practices will help you zero in on the R code you need, so you can modify, re-run, and reuse.</p>
</div>
<div id="graphics-devices" class="section level2">
<h2><span class="header-section-number">28.3</span> Graphics devices</h2>
<p>Read the <a href="https://rdrr.io/r/grDevices/Devices.html">R help for <code>Devices</code></a> to learn about graphics devices in general and which are available on your system (<em>obviously requires that you read your local help</em>).</p>
<p>It is very important to understand the difference between <a href="https://en.wikipedia.org/wiki/Vector_graphics">vector graphics</a> and <a href="https://en.wikipedia.org/wiki/Raster_graphics">raster graphics</a>. Vector graphics are represented in terms of shapes and lines, whereas raster graphics are pixel-based.</p>
<ul>
<li><strong>Vector</strong> examples: PDF, postscript, SVG
<ul>
<li>Pros: re-size gracefully, good for print. SVG is where the web is heading, though we are not necessarily quite there yet.</li>
</ul></li>
<li><strong>Raster</strong> examples: PNG, JPEG, BMP, GIF
<ul>
<li>Cons: look awful “blown up” … in fact, look awful quite frequently</li>
<li>Pros: play very nicely with Microsoft Office products and the web. Files can be blessedly small!</li>
</ul></li>
</ul>
<p>Tough love: you will not be able to pick vector or raster or a single device and use it all the time. You must think about your downstream use cases and plan accordingly. It is entirely possible that you should save key figures <strong>in more than one format</strong> for maximum flexibility in the future. Worst case, if you obey the rules given here, you can always remake the figure to save in a new format.</p>
<p>FWIW most of my figures exist as <code>pdf()</code>, <code>png()</code>, or both. Although it is not true yet, SVG will hopefully become the new standard, offering the resizability of vector graphics but with web-friendliness as well.</p>
<p>Here are two good posts from the <a href="https://blog.revolutionanalytics.com">Revolutions Analytics blog</a> with tips for saving figures to file:</p>
<ul>
<li><a href="https://blog.revolutionanalytics.com/2009/01/10-tips-for-making-your-r-graphics-look-their-best.html">10 tips for making your R graphics look their best</a></li>
<li><a href="https://blog.revolutionanalytics.com/2011/07/r-svg-graphics.html">High-quality R graphics on the Web with SVG</a></li>
</ul>
</div>
<div id="write-figures-to-file-with-ggsave" class="section level2">
<h2><span class="header-section-number">28.4</span> Write figures to file with <code>ggsave()</code></h2>
<p>If you are using ggplot2, write figures to file with <a href="https://rdrr.io/cran/ggplot2/man/ggsave.html"><code>ggsave()</code></a>.</p>
<p>If you are staring at a plot you just made on your screen, you can call <code>ggsave()</code>, specifying only a filename:</p>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="#cb319-1"></a><span class="kw">ggsave</span>(<span class="st">&quot;my-awesome-graph.png&quot;</span>)</span></code></pre></div>
<p>It makes a sensible decision about everything else. In particular, as long as you use a conventional extension, it will guess what type of graphics file you want. If you need control over, e.g., width, height, or dpi, roll up your sleeves and <a href="https://rdrr.io/cran/ggplot2/man/ggsave.html">use the arguments</a>.</p>
<div id="passing-a-plot-object-to-ggsave" class="section level3">
<h3><span class="header-section-number">28.4.1</span> Passing a plot object to <code>ggsave()</code></h3>
<p>After the filename, the most common argument you will provide is <code>plot =</code>, which is the second argument by position. If you’ve been building up a plot with the typical ggplot2 workflow, you will pass the resulting object to <code>ggsave()</code>. <strong>Example:</strong></p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="#cb320-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(gapminder, <span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> lifeExp)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_jitter</span>()</span>
<span id="cb320-2"><a href="#cb320-2"></a><span class="co"># during development, you will uncomment next line to print p to screen</span></span>
<span id="cb320-3"><a href="#cb320-3"></a><span class="co"># p</span></span>
<span id="cb320-4"><a href="#cb320-4"></a><span class="kw">ggsave</span>(<span class="st">&quot;fig-io-practice.png&quot;</span>, p)</span></code></pre></div>
<p>See below for gotchas and FAQs when making figures in a non-interactive setting!</p>
</div>
<div id="scaling" class="section level3">
<h3><span class="header-section-number">28.4.2</span> Scaling</h3>
<p>Figures need to be prepared differently for a presentation versus a poster versus a manuscript. You need to fiddle with the size of text, such as the title and axis labels, relative to the entire plot area. There are at least two ways to do this, with slightly different effects and workflows.</p>
<p><strong>Via the <code>scale =</code> argument to <code>ggsave()</code></strong>: This actually changes the physical size of the plot, but as an interesting side effect, it changes the relative size of the title and axis labels. Therefore, tweaking this can be a quick-and-dirty way to get different versions of a figure appropriate for a presentation versus a poster versus a manuscript. You can still insert the figure downstream with a different physical size, though you may need to adjust the dpi accordingly on the front end. When <code>scale &lt; 1</code>, various plot elements will be bigger relative to the plotting area; when <code>scale &gt; 1</code>, these elements will be smaller. YMMV but <code>scale = 0.8</code> often works well for posters and slides. Figure @ref(fig:exaggerated-scale) shows two versions of a figure, with exaggerated values of <code>scale</code>, to illustrate its effect.</p>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb321-1"><a href="#cb321-1"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb321-2"><a href="#cb321-2"></a><span class="kw">library</span>(gapminder)</span>
<span id="cb321-3"><a href="#cb321-3"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(gapminder, <span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> lifeExp)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_jitter</span>()</span></code></pre></div>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="#cb322-1"></a>p1 &lt;-<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;scale = 0.6&quot;</span>)</span>
<span id="cb322-2"><a href="#cb322-2"></a>p2 &lt;-<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;scale = 2&quot;</span>)</span>
<span id="cb322-3"><a href="#cb322-3"></a></span>
<span id="cb322-4"><a href="#cb322-4"></a><span class="kw">ggsave</span>(<span class="st">&quot;img/fig-io-practice-scale-0.6.png&quot;</span>, p1, <span class="dt">scale =</span> <span class="fl">0.6</span>)</span>
<span id="cb322-5"><a href="#cb322-5"></a><span class="co">#&gt; Saving 4.2 x 3 in image</span></span>
<span id="cb322-6"><a href="#cb322-6"></a><span class="kw">ggsave</span>(<span class="st">&quot;img/fig-io-practice-scale-2.png&quot;</span>, p2, <span class="dt">scale =</span> <span class="dv">2</span>)</span>
<span id="cb322-7"><a href="#cb322-7"></a><span class="co">#&gt; Saving 14 x 10 in image</span></span></code></pre></div>
<div class="figure">
<img src="img/figures-io-p1.png" alt="Two versions of a figure with exaggerated values of `scale`" width="50%" /><img src="img/figures-io-p2.png" alt="Two versions of a figure with exaggerated values of `scale`" width="50%" />
<p class="caption">
(#fig:exaggerated-scale)Two versions of a figure with exaggerated values of <code>scale</code>
</p>
</div>
<p><strong>Via the <code>base_size</code> of the active theme</strong>: The <code>base_size</code> of the <a href="https://ggplot2.tidyverse.org/reference/ggtheme.html#arguments">theme</a> refers to the base font size. This is NOT a theme element that can be modified via <code>ggplot(...) + theme(...)</code>. Rather, it’s an argument to various functions that set theme elements. Therefore, to get the desired effect you need to create a complete theme, specifying the desired <code>base_size</code>. By setting <code>base size &lt; 12</code>, the default value, you shrink text elements and by setting <code>base_size &gt; 12</code>, you make them larger. Figure @ref(fig:exaggerated-base-size) shows two versions of a figure, with exaggerated values of <code>base_size</code>, to illustrate its effect.</p>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb323-1"><a href="#cb323-1"></a>p3 &lt;-<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;base_size = 20&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_grey</span>(<span class="dt">base_size =</span> <span class="dv">20</span>)</span>
<span id="cb323-2"><a href="#cb323-2"></a>p4 &lt;-<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;base_size = 3&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_grey</span>(<span class="dt">base_size =</span> <span class="dv">3</span>)</span>
<span id="cb323-3"><a href="#cb323-3"></a></span>
<span id="cb323-4"><a href="#cb323-4"></a><span class="kw">ggsave</span>(<span class="st">&quot;img/fig-io-practice-base-size-20.png&quot;</span>, p3)</span>
<span id="cb323-5"><a href="#cb323-5"></a><span class="co">#&gt; Saving 7 x 5 in image</span></span>
<span id="cb323-6"><a href="#cb323-6"></a><span class="kw">ggsave</span>(<span class="st">&quot;img/fig-io-practice-base-size-3.png&quot;</span>, p4)</span>
<span id="cb323-7"><a href="#cb323-7"></a><span class="co">#&gt; Saving 7 x 5 in image</span></span></code></pre></div>
<div class="figure">
<img src="img/figures-io-p3.png" alt="Two versions of a figure with exaggerated values of `base_size`" width="50%" /><img src="img/figures-io-p4.png" alt="Two versions of a figure with exaggerated values of `base_size`" width="50%" />
<p class="caption">
(#fig:exaggerated-base-size)Two versions of a figure with exaggerated values of <code>base_size</code>
</p>
</div>
<p><em>Thanks to <a href="https://twitter.com/cashoes_">Casey Shannon</a> for tips about <code>scale =</code> and this <a href="http://zevross.com/blog/2014/08/04/beautiful-plotting-in-r-a-ggplot2-cheatsheet-3/">cheatsheet from Zev Ross</a> for tips about <code>base_size</code>.</em></p>
</div>
</div>
<div id="write-non-ggplot2-figures-to-file" class="section level2">
<h2><span class="header-section-number">28.5</span> Write non-ggplot2 figures to file</h2>
<p>Recall that <code>ggsave()</code> is recommended if you’re using ggplot2. But if you’re using base graphics or lattice, here’s generic advice for writing figures to file. To be clear, this <em>also</em> works for ggplot2 graphs, but I can’t think of any good reasons to NOT use <code>ggsave()</code>.</p>
<p>Edit your source code in the following way: precede the figure-making code by opening a graphics device and follow it with a command that closes the device. Here’s an example:</p>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="#cb324-1"></a><span class="kw">pdf</span>(<span class="st">&quot;test-fig-proper.pdf&quot;</span>)    <span class="co"># starts writing a PDF to file</span></span>
<span id="cb324-2"><a href="#cb324-2"></a><span class="kw">plot</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)                    <span class="co"># makes the actual plot</span></span>
<span id="cb324-3"><a href="#cb324-3"></a><span class="kw">dev.off</span>()                     <span class="co"># closes the PDF file</span></span>
<span id="cb324-4"><a href="#cb324-4"></a><span class="co">#&gt; png </span></span>
<span id="cb324-5"><a href="#cb324-5"></a><span class="co">#&gt;   2</span></span></code></pre></div>
<p>You will see that there’s a new file in the working directory:</p>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="#cb325-1"></a><span class="kw">list.files</span>(<span class="dt">pattern =</span> <span class="st">&quot;^test-fig*&quot;</span>)</span>
<span id="cb325-2"><a href="#cb325-2"></a><span class="co">#&gt; [1] &quot;test-fig-proper.pdf&quot;</span></span></code></pre></div>
<p>If you run this code interactively, don’t be surprised when you don’t see the figure appear in your screen device. While you’re sending graphics output to, e.g. the <code>pdf()</code> device, you’ll be “flying blind”, which is why it’s important to work out the graphics commands in advance. This is like using <code>sink()</code>, which diverts the output you’d normally see in R Console.</p>
<p>Read the <a href="https://rdrr.io/r/grDevices/Devices.html">R help for <code>Devices</code></a> to learn about graphics devices in general and which are available on your system (<em>obviously requires that you read your local help</em>). If you need control over, e.g., width, height, or dpi, roll up your sleeves and use the arguments to the graphics device function you are using. There are many.</p>
<p>If you are staring at a plot you just made on your screen, here’s a handy short cut for writing a figure to file:</p>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="#cb326-1"></a><span class="kw">plot</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)    <span class="co"># makes the actual plot</span></span></code></pre></div>
<p><img src="028_saving-figures_files/figure-html/dev-print-demo-1.png" width="672" /></p>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="#cb327-1"></a><span class="kw">dev.print</span>(pdf, <span class="st">&quot;test-fig-quick-dirty.pdf&quot;</span>)    <span class="co"># copies the plot to a the PDF file</span></span>
<span id="cb327-2"><a href="#cb327-2"></a><span class="co">#&gt; png </span></span>
<span id="cb327-3"><a href="#cb327-3"></a><span class="co">#&gt;   2</span></span></code></pre></div>
<p>You will see there’s now another new file in the working directory:</p>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="#cb328-1"></a><span class="kw">list.files</span>(<span class="dt">pattern =</span> <span class="st">&quot;^test-fig*&quot;</span>)</span>
<span id="cb328-2"><a href="#cb328-2"></a><span class="co">#&gt; [1] &quot;test-fig-proper.pdf&quot;      &quot;test-fig-quick-dirty.pdf&quot;</span></span></code></pre></div>
<p>The appeal of this method is that you will literally copy the figure in front of your eyeballs to file, which is pleasingly immediate. There’s also less code to repeatedly (de-)comment as you run and re-run the script during development.</p>
<p>Why is this method improper? Various aspects of a figure – such as font size – are determined by the target graphics device and its physical size. Therefore, it is best practice to open your desired graphics device explicitly, using any necessary arguments to control height, width, fonts, etc. Make your plot. And close the device. But for lots of everyday plots the <code>dev.print()</code> method works just fine.</p>
<p>If you call up the help file for <a href="https://rdrr.io/r/grDevices/dev.html"><code>dev.off()</code>, <code>dev.print()</code>, and friends</a>, you can learn about many other functions for controlling graphics devices.</p>
</div>
<div id="preemptive-answers-to-some-faqs" class="section level2">
<h2><span class="header-section-number">28.6</span> Preemptive answers to some FAQs</h2>
<div id="despair-over-non-existent-or-empty-figures" class="section level3">
<h3><span class="header-section-number">28.6.1</span> Despair over non-existent or empty figures</h3>
<p>Certain workflows are suited to interactive development and will break when played back non-interactively or at arm’s length. Wake up and pay attention when you cross these lines:</p>
<ul>
<li>You package graph-producing code into a function or put it inside a loop or other iterative machine.</li>
<li>You run an R script non-interactively, e.g. via <code>source()</code>, <code>Rscript</code>, or <code>R CMD batch</code>.</li>
</ul>
<p><strong>Basic issue</strong>: When working interactively, if you inspect the plot object <code>p</code> by entering <code>p</code> at the command line, the plot gets printed to screen. You’re actually enjoying the result of <code>print(p)</code>, but it’s easy to not realize this. To get the same result from code run non-interactively, you will need to call <code>print()</code> explicitly yourself.</p>
<p>Here I wrap plotting commands inside a function. The function on the left will fail to produce a PNG, whereas the function on the right will produce a good PNG. Both assume the Gapminder data is present as <code>gapminder</code> and that ggplot2 has been loaded.</p>
<table>
<tr>
<td valign="top">
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="#cb329-1"></a><span class="co">## implicit print --&gt; no PNG</span></span>
<span id="cb329-2"><a href="#cb329-2"></a>f_despair &lt;-<span class="st"> </span><span class="cf">function</span>() {</span>
<span id="cb329-3"><a href="#cb329-3"></a>  <span class="kw">png</span>(<span class="st">&quot;test-fig-despair.png&quot;</span>)</span>
<span id="cb329-4"><a href="#cb329-4"></a>  p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(gapminder,</span>
<span id="cb329-5"><a href="#cb329-5"></a>     <span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> lifeExp))</span>
<span id="cb329-6"><a href="#cb329-6"></a>  p <span class="op">+</span><span class="st"> </span><span class="kw">geom_jitter</span>()</span>
<span id="cb329-7"><a href="#cb329-7"></a>  <span class="kw">dev.off</span>()    </span>
<span id="cb329-8"><a href="#cb329-8"></a>}</span>
<span id="cb329-9"><a href="#cb329-9"></a><span class="kw">f_despair</span>()</span></code></pre></div>
</td>
<td valign="top">
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="#cb330-1"></a><span class="co">## explicit print --&gt; good PNG</span></span>
<span id="cb330-2"><a href="#cb330-2"></a>f_joy &lt;-<span class="st"> </span><span class="cf">function</span>() {</span>
<span id="cb330-3"><a href="#cb330-3"></a>  <span class="kw">png</span>(<span class="st">&quot;test-fig-joy.png&quot;</span>)</span>
<span id="cb330-4"><a href="#cb330-4"></a>  p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(gapminder,</span>
<span id="cb330-5"><a href="#cb330-5"></a>     <span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> lifeExp))</span>
<span id="cb330-6"><a href="#cb330-6"></a>  p &lt;-<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_jitter</span>()</span>
<span id="cb330-7"><a href="#cb330-7"></a>  <span class="kw">print</span>(p) <span class="co">## &lt;-- VERY IMPORTANT!!!</span></span>
<span id="cb330-8"><a href="#cb330-8"></a>  <span class="kw">dev.off</span>()    </span>
<span id="cb330-9"><a href="#cb330-9"></a>}</span>
<span id="cb330-10"><a href="#cb330-10"></a><span class="kw">f_joy</span>() </span></code></pre></div>
</td>
</tr>
</table>
<p>Other versions of this fiasco result in a figure file that is, frustratingly, empty. If you expect a figure, but it’s missing or empty, <strong>remember to print the plot explicitly.</strong></p>
<p>It is worth noting here that the <code>ggsave()</code> workflow is not vulnerable to this gotcha, which is yet another reason to prefer it when using ggplot2.</p>
<p>Some relevant threads on stackoverflow:</p>
<ul>
<li><a href="https://stackoverflow.com/questions/9206110/using-png-function-not-working-when-called-within-a-function">Using png not working when called within a function</a></li>
<li><a href="https://stackoverflow.com/questions/6675066/ggplots-qplot-does-not-execute-on-sourcing">ggplot’s qplot does not execute on sourcing</a></li>
<li><a href="https://stackoverflow.com/questions/7034647/save-ggplot-within-a-function">Save ggplot within a function</a></li>
</ul>
</div>
<div id="mysterious-empty-rplots.pdf-file" class="section level3">
<h3><span class="header-section-number">28.6.2</span> Mysterious empty <code>Rplots.pdf</code> file</h3>
<p><em>Note: <a href="https://github.com/tidyverse/ggplot2/issues/1326">This has been fixed as of ggplot2 v2.0.0</a>. Hallelujah! I will leave this here for a while, since old versions of a package like ggplot2 linger around for months and years.</em></p>
<p>When creating and writing figures from R running non-interactively, you can inadvertently trigger a request to query the active graphics device. For example, <code>ggsave()</code> might try to ascertain the physical size of the current device. But when running non-interactively there is often no such device available, which can lead to the unexpected creation of <code>Rplots.pdf</code> so this request can be fulfilled.</p>
<p>I don’t know of a reliable way to suppress this behavior uniformly and I just peacefully coexist with <code>Rplots.pdf</code> when this happens. That is, I just delete it.</p>
<p>Some relevant threads on stackoverflow:</p>
<ul>
<li><a href="https://stackoverflow.com/questions/17348359/how-to-stop-r-from-creating-empty-rplots-pdf-file-when-using-ggsave-and-rscript">How to stop R from creating empty Rplots.pdf file when using ggsave and Rscript</a></li>
</ul>
</div>
</div>
<div id="chunk-name-determines-figure-file-name" class="section level2">
<h2><span class="header-section-number">28.7</span> Chunk name determines figure file name</h2>
<p>Coming full circle, we return to the topic of figures produced via an R chunk in an R Markdown file. If you are writing <a href="#r-markdown-step3">GitHub-flavored markdown or keeping the intermediate markdown</a>, your figures will also be saved to file. Rendering <code>foo.Rmd</code> will leave behind <code>foo.md</code>, maybe <code>foo.html</code>, and a directory <code>foo_files</code>, containing any figures created in the document. By default, they will have meaningless names, like <code>unnamed-chunk-7.png</code>. This makes it difficult to find specific figures, e.g. for unplanned use in another setting. However, if you name an R chunk, this name will be baked into the figure file name.</p>
<!--JB: the "live" version of the chunk I include verbatim below -->
<p><strong>Example:</strong> here’s an R chunk called <code>scatterplot-lifeExp-vs-year</code>:</p>
<pre><code>```{r scatterplot-lifeExp-vs-year}
p &lt;- ggplot(gapminder, aes(x = year, y = lifeExp)) + geom_jitter()
p
```</code></pre>
<p>And it will lead to the creation of a suitably named figure file (you may see other figures produced in the document as well):</p>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="#cb332-1"></a>book_figs &lt;-<span class="st"> </span>fs<span class="op">::</span><span class="kw">path</span>(<span class="st">&quot;_bookdown_files&quot;</span>, <span class="st">&quot;stat545_files&quot;</span>, <span class="st">&quot;figure-html&quot;</span>)</span>
<span id="cb332-2"><a href="#cb332-2"></a>fs<span class="op">::</span><span class="kw">dir_ls</span>(book_figs, <span class="dt">regexp =</span> <span class="st">&quot;scatterplot-lifeExp&quot;</span>)</span></code></pre></div>
<p>If you have concrete plans to use a figure elsewhere, you should probably write it to file using an explicit method described above. But the chunk-naming trick is a nice way to avoid that work, while maintaining flexibility for the future.</p>
</div>
<div id="clean-up-2" class="section level2">
<h2><span class="header-section-number">28.8</span> Clean up</h2>
<p>Let’s delete the temp files we’ve created.</p>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="#cb333-1"></a><span class="kw">library</span>(fs)</span>
<span id="cb333-2"><a href="#cb333-2"></a><span class="kw">file_delete</span>(<span class="kw">dir_ls</span>(<span class="kw">path</span>(<span class="st">&quot;img&quot;</span>), <span class="dt">regexp =</span> <span class="st">&quot;fig-io-practice&quot;</span>))</span>
<span id="cb333-3"><a href="#cb333-3"></a><span class="kw">file_delete</span>(<span class="kw">dir_ls</span>(<span class="st">&quot;.&quot;</span>, <span class="dt">regexp =</span> <span class="st">&quot;test-fig&quot;</span>))</span></code></pre></div>
<!--RStudio Links-->
<!--HappyGitWithR Links-->
<!--Package Links-->
<!--Shiny links-->
<!--Publications-->
<!--R Documentation-->
<!--Wikipedia Links-->
<!--Misc. Links-->
<!--chapter:end:028_saving-figures.Rmd-->
</div>
</div>
<div id="multiple-plots" class="section level1">
<h1><span class="header-section-number">29</span> Multiple plots on a page</h1>
<!--Original content: https://stat545.com/block020_multiple-plots-on-a-page.html-->
<!--TODO: add patchwork package here?-->
<div id="faceting-is-not-a-panacea" class="section level2">
<h2><span class="header-section-number">29.1</span> Faceting is not a panacea</h2>
<p>Faceting is useful for constructing an array of similar plots where each panel corresponds to a level of a factor or a combination of levels from multiple factors. Pragmatic reshaping can make lots of graphing problems have this “look”. But this does not cover the entire spectrum of multi-plot needs in the real world. Sometimes you need to get more than one plot on a virtual page and the plots are rather disconnected. How do you do that?</p>
</div>
<div id="meet-the-gridextra-package" class="section level2">
<h2><span class="header-section-number">29.2</span> Meet the gridExtra package</h2>
<p>Under the hood, ggplot2 uses the grid package to create figures. The gridExtra packages provides some extra goodies and we will draw on them to place multiple ggplot2 plots on a single virtual page.</p>
<p>You may need to install gridExtra and you will certainly need to load it.</p>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb334-1"><a href="#cb334-1"></a><span class="co"># install.packages(&quot;gridExtra&quot;)</span></span>
<span id="cb334-2"><a href="#cb334-2"></a><span class="kw">library</span>(gridExtra)</span></code></pre></div>
</div>
<div id="load-gapminder-and-ggplot2" class="section level2">
<h2><span class="header-section-number">29.3</span> Load gapminder and ggplot2</h2>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="#cb335-1"></a><span class="kw">library</span>(gapminder)</span>
<span id="cb335-2"><a href="#cb335-2"></a><span class="kw">library</span>(ggplot2)</span></code></pre></div>
</div>
<div id="use-the-arrangegrob-function-and-friends" class="section level2">
<h2><span class="header-section-number">29.4</span> Use the <code>arrangeGrob()</code> function and friends</h2>
<p>Store the constituent plots to plot objects and then pass them to <code>grid.arrange()</code> or <code>arrangeGrob()</code>.</p>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="#cb336-1"></a>p_dens &lt;-<span class="st"> </span><span class="kw">ggplot</span>(gapminder, <span class="kw">aes</span>(<span class="dt">x =</span> gdpPercap)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_density</span>() <span class="op">+</span><span class="st"> </span><span class="kw">scale_x_log10</span>() <span class="op">+</span></span>
<span id="cb336-2"><a href="#cb336-2"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb336-3"><a href="#cb336-3"></a>        <span class="dt">axis.ticks =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb336-4"><a href="#cb336-4"></a>        <span class="dt">axis.title.x =</span> <span class="kw">element_blank</span>())</span>
<span id="cb336-5"><a href="#cb336-5"></a>p_scatter &lt;-<span class="st"> </span><span class="kw">ggplot</span>(gapminder, <span class="kw">aes</span>(<span class="dt">x =</span> gdpPercap, <span class="dt">y =</span> lifeExp)) <span class="op">+</span></span>
<span id="cb336-6"><a href="#cb336-6"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">scale_x_log10</span>()</span>
<span id="cb336-7"><a href="#cb336-7"></a><span class="co">#p_both &lt;- arrangeGrob(p_dens, p_scatter, nrow = 2, heights = c(0.35, 0.65))</span></span>
<span id="cb336-8"><a href="#cb336-8"></a><span class="co">#print(p_both)</span></span>
<span id="cb336-9"><a href="#cb336-9"></a><span class="kw">grid.arrange</span>(p_dens, p_scatter, <span class="dt">nrow =</span> <span class="dv">2</span>, <span class="dt">heights =</span> <span class="kw">c</span>(<span class="fl">0.35</span>, <span class="fl">0.65</span>))</span></code></pre></div>
<p><img src="029_multiple-plots_files/figure-html/arrangeGrob-demo-1.png" width="672" /></p>
<p>You can find other examples of this workflow in the <a href="https://github.com/jennybc/r-graph-catalog">R Graph Catalog</a>.</p>
</div>
<div id="use-the-multiplot-function" class="section level2">
<h2><span class="header-section-number">29.5</span> Use the <code>multiplot()</code> function</h2>
<p>In the <a href="http://www.cookbook-r.com/Graphs/Multiple_graphs_on_one_page_(ggplot2)/">Graphs</a> chapter of his <a href="http://www.cookbook-r.com">Cookbook for R</a>, Winston Chang uses the grid package to define the <code>multiplot()</code> function:</p>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="#cb337-1"></a><span class="co"># Multiple plot function</span></span>
<span id="cb337-2"><a href="#cb337-2"></a><span class="co">#</span></span>
<span id="cb337-3"><a href="#cb337-3"></a><span class="co"># ggplot objects can be passed in ..., or to plotlist (as a list of ggplot objects)</span></span>
<span id="cb337-4"><a href="#cb337-4"></a><span class="co"># - cols:   Number of columns in layout</span></span>
<span id="cb337-5"><a href="#cb337-5"></a><span class="co"># - layout: A matrix specifying the layout. If present, &#39;cols&#39; is ignored.</span></span>
<span id="cb337-6"><a href="#cb337-6"></a><span class="co">#</span></span>
<span id="cb337-7"><a href="#cb337-7"></a><span class="co"># If the layout is something like matrix(c(1,2,3,3), nrow=2, byrow=TRUE),</span></span>
<span id="cb337-8"><a href="#cb337-8"></a><span class="co"># then plot 1 will go in the upper left, 2 will go in the upper right, and</span></span>
<span id="cb337-9"><a href="#cb337-9"></a><span class="co"># 3 will go all the way across the bottom.</span></span>
<span id="cb337-10"><a href="#cb337-10"></a><span class="co">#</span></span>
<span id="cb337-11"><a href="#cb337-11"></a>multiplot &lt;-<span class="st"> </span><span class="cf">function</span>(..., <span class="dt">plotlist=</span><span class="ot">NULL</span>, file, <span class="dt">cols=</span><span class="dv">1</span>, <span class="dt">layout=</span><span class="ot">NULL</span>) {</span>
<span id="cb337-12"><a href="#cb337-12"></a>  <span class="kw">require</span>(grid)</span>
<span id="cb337-13"><a href="#cb337-13"></a></span>
<span id="cb337-14"><a href="#cb337-14"></a>  <span class="co"># Make a list from the ... arguments and plotlist</span></span>
<span id="cb337-15"><a href="#cb337-15"></a>  plots &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">list</span>(...), plotlist)</span>
<span id="cb337-16"><a href="#cb337-16"></a></span>
<span id="cb337-17"><a href="#cb337-17"></a>  numPlots =<span class="st"> </span><span class="kw">length</span>(plots)</span>
<span id="cb337-18"><a href="#cb337-18"></a></span>
<span id="cb337-19"><a href="#cb337-19"></a>  <span class="co"># If layout is NULL, then use &#39;cols&#39; to determine layout</span></span>
<span id="cb337-20"><a href="#cb337-20"></a>  <span class="cf">if</span> (<span class="kw">is.null</span>(layout)) {</span>
<span id="cb337-21"><a href="#cb337-21"></a>    <span class="co"># Make the panel</span></span>
<span id="cb337-22"><a href="#cb337-22"></a>    <span class="co"># ncol: Number of columns of plots</span></span>
<span id="cb337-23"><a href="#cb337-23"></a>    <span class="co"># nrow: Number of rows needed, calculated from # of cols</span></span>
<span id="cb337-24"><a href="#cb337-24"></a>    layout &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">seq</span>(<span class="dv">1</span>, cols <span class="op">*</span><span class="st"> </span><span class="kw">ceiling</span>(numPlots<span class="op">/</span>cols)),</span>
<span id="cb337-25"><a href="#cb337-25"></a>                    <span class="dt">ncol =</span> cols, <span class="dt">nrow =</span> <span class="kw">ceiling</span>(numPlots<span class="op">/</span>cols))</span>
<span id="cb337-26"><a href="#cb337-26"></a>  }</span>
<span id="cb337-27"><a href="#cb337-27"></a></span>
<span id="cb337-28"><a href="#cb337-28"></a> <span class="cf">if</span> (numPlots<span class="op">==</span><span class="dv">1</span>) {</span>
<span id="cb337-29"><a href="#cb337-29"></a>    <span class="kw">print</span>(plots[[<span class="dv">1</span>]])</span>
<span id="cb337-30"><a href="#cb337-30"></a></span>
<span id="cb337-31"><a href="#cb337-31"></a>  } <span class="cf">else</span> {</span>
<span id="cb337-32"><a href="#cb337-32"></a>    <span class="co"># Set up the page</span></span>
<span id="cb337-33"><a href="#cb337-33"></a>    <span class="kw">grid.newpage</span>()</span>
<span id="cb337-34"><a href="#cb337-34"></a>    <span class="kw">pushViewport</span>(<span class="kw">viewport</span>(<span class="dt">layout =</span> <span class="kw">grid.layout</span>(<span class="kw">nrow</span>(layout), <span class="kw">ncol</span>(layout))))</span>
<span id="cb337-35"><a href="#cb337-35"></a></span>
<span id="cb337-36"><a href="#cb337-36"></a>    <span class="co"># Make each plot, in the correct location</span></span>
<span id="cb337-37"><a href="#cb337-37"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>numPlots) {</span>
<span id="cb337-38"><a href="#cb337-38"></a>      <span class="co"># Get the i,j matrix positions of the regions that contain this subplot</span></span>
<span id="cb337-39"><a href="#cb337-39"></a>      matchidx &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">which</span>(layout <span class="op">==</span><span class="st"> </span>i, <span class="dt">arr.ind =</span> <span class="ot">TRUE</span>))</span>
<span id="cb337-40"><a href="#cb337-40"></a></span>
<span id="cb337-41"><a href="#cb337-41"></a>      <span class="kw">print</span>(plots[[i]], <span class="dt">vp =</span> <span class="kw">viewport</span>(<span class="dt">layout.pos.row =</span> matchidx<span class="op">$</span>row,</span>
<span id="cb337-42"><a href="#cb337-42"></a>                                      <span class="dt">layout.pos.col =</span> matchidx<span class="op">$</span>col))</span>
<span id="cb337-43"><a href="#cb337-43"></a>    }</span>
<span id="cb337-44"><a href="#cb337-44"></a>  }</span>
<span id="cb337-45"><a href="#cb337-45"></a>}</span></code></pre></div>
<p>Assuming that the plot objects <code>p1</code>, <code>p2</code>, <code>p3</code>, and <code>p4</code> are pre-defined, call the function like this:</p>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="#cb338-1"></a><span class="kw">multiplot</span>(p1, p2, p3, p4, <span class="dt">cols =</span> <span class="dv">2</span>)</span></code></pre></div>
<p>Visit <a href="http://www.cookbook-r.com/Graphs/Multiple_graphs_on_one_page_(ggplot2)/">Multiple graphs on one page (ggplot2)</a> to see a complete worked example.</p>
</div>
<div id="use-the-cowplot-package" class="section level2">
<h2><span class="header-section-number">29.6</span> Use the cowplot package</h2>
<p>The cowplot package (<a href="https://CRAN.R-project.org/package=cowplot">CRAN</a>; <a href="https://github.com/wilkelab/cowplot">GitHub</a>) does (at least) two things:</p>
<ul>
<li>Provides a publication-ready theme for ggplot2.</li>
<li>Helps combine multiple plots into one figure.</li>
</ul>
<p>Check out <a href="https://cran.r-project.org/web/packages/cowplot/vignettes/introduction.html">the vignette</a> to see it in action.</p>
<!--RStudio Links-->
<!--HappyGitWithR Links-->
<!--Package Links-->
<!--Shiny links-->
<!--Publications-->
<!--R Documentation-->
<!--Wikipedia Links-->
<!--Misc. Links-->
<!--chapter:end:029_multiple-plots.Rmd-->
</div>
</div>
<div id="part-all-the-package-things" class="section level1 unnumbered">
<h1>(PART) All the package things</h1>
</div>
<div id="package-overview" class="section level1 unnumbered">
<h1>Overview</h1>
<!--Original content: https://stat545.com/packages00_index.html-->
<ul>
<li>Chapter @ref(package-slides) - Writing your first R package slides
<ul>
<li>What is an R package?</li>
<li>What is a library?</li>
<li>Why make an R package?</li>
<li>How <code>devtools</code> creates a happy workflow.</li>
</ul></li>
<li>Chapter @ref(system-prep) - Prepare your system for package development
<ul>
<li>Although we’ll build a very simple package, we’re still going to use the most modern and powerful tools for R package development. In theory, this could eventually involve compiling C/C++ code, which means you need what’s called a <em>build environment</em>. See Chapter @ref(system-prep) for help preparing your system.</li>
</ul></li>
<li>Chapter @ref(package-from-scratch) - Write your own R Package
<ul>
<li>A guided walk-through of creating a small package from scratch.</li>
</ul></li>
</ul>
<div id="resources-10" class="section level2 unnumbered">
<h2>Resources</h2>
<ul>
<li><a href="https://r-pkgs.org/index.html">R Packages</a> book: the second edition is under development by Hadley Wickham and Jennifer Bryan.</li>
<li><a href="https://cran.r-project.org/doc/manuals/r-release/R-exts.html">Writing R Extensions</a>, the One True Official Document on creating R packages.</li>
</ul>
<!--RStudio Links-->
<!--HappyGitWithR Links-->
<!--Package Links-->
<!--Shiny links-->
<!--Publications-->
<!--R Documentation-->
<!--Wikipedia Links-->
<!--Misc. Links-->
<!--chapter:end:030_package-overview.Rmd-->
</div>
</div>
<div id="package-slides" class="section level1">
<h1><span class="header-section-number">30</span> Write your first R package</h1>
<script async class="speakerdeck-embed" data-id="2f5adff04cb5013256c03a03dde42de4" data-ratio="1.33333333333333" src="//speakerdeck.com/assets/embed.js"></script>
<div style="margin-bottom:5px">
<strong> <a href="https://speakerdeck.com/jennybc/ubc-stat545-2015-writing-your-first-r-package" title="UBC STAT545 2015 Writing your first R package" target="_blank">UBC STAT545 2015 Writing your first R package</a> </strong> from <strong><a href="https://speakerdeck.com/jennybc" target="_blank">Jennifer Bryan</a></strong>
</div>
<!--chapter:end:031_write-package.Rmd-->
</div>
<div id="system-prep" class="section level1">
<h1><span class="header-section-number">31</span> System preparation for package development</h1>
<!--Original content: https://stat545.com/packages01_system-prep.html-->
<p>Although we’ll build a very simple package, we’ll use the most modern and powerful tools for R package development. In theory, this could eventually involve compiling C/C++ code, which means you need what’s called a <em>build environment</em>.</p>
<div id="update-r-and-rstudio" class="section level2">
<h2><span class="header-section-number">31.1</span> Update R and RStudio</h2>
<p>Embarking on your career as an R package developer is an important milestone. Why not celebrate by updating R and RStudio? This is something we recommended early and we recommend doing it often. Go back to Chapter @ref(install) for reminders on the process. <strong>DO IT NOW. We are not very interested in solving problems that stem from running outdated versions of R and RStudio.</strong></p>
<p><em>2016-11 FYI: Jenny is running R version 3.3.1 (2016-06-21) Bug in Your Hair and RStudio 1.0.44 at the time of writing.</em></p>
</div>
<div id="install-devtools-from-cran" class="section level2">
<h2><span class="header-section-number">31.2</span> Install <code>devtools</code> from CRAN</h2>
<p>We use the <code>devtools</code> package to help us develop our R package. Do this:</p>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="#cb339-1"></a><span class="kw">install.packages</span>(<span class="st">&quot;devtools&quot;</span>)</span>
<span id="cb339-2"><a href="#cb339-2"></a><span class="kw">library</span>(devtools)</span></code></pre></div>
</div>
<div id="windows-system-prep" class="section level2">
<h2><span class="header-section-number">31.3</span> Windows: system prep</h2>
<p>You will probably get an immediate warning from devtools, complaining that you need Rtools in order to build R packages.</p>
<p>You <em>can ignore</em> this and successfully develop an R package that consists solely of R code. Such as our toy package.</p>
<p>However, we recommend you install Rtools, so you can take full advantage of devtools. Soon, you will want to use <code>devtools::install_github()</code> to install R packages from GitHub, instead of CRAN. You will inevitably need to build a package that includes C/C++ code, which <em>will require</em> Rtools.</p>
<p>Rtools is <strong>NOT an R package</strong> but is rather <a href="https://cran.r-project.org/bin/windows/Rtools/">“a collection of resources for building packages for R under Microsoft Windows, or for building R itself”</a>.</p>
<p>Go here and do what it says:</p>
<p><a href="https://cran.r-project.org/bin/windows/Rtools/" class="uri">https://cran.r-project.org/bin/windows/Rtools/</a></p>
<p>During the installation of Rtools you will get to a window asking you to “Select Additional Tasks”. <strong>It is important that you make sure to select the box for “Edit the system PATH”</strong>.</p>
<p><em>Are we going to recommend making sure Git Bash is NOT on <code>PATH</code>? See <a href="https://github.com/STAT545-UBC/Discussion/issues/230#issuecomment-155236031">#230</a>.</em></p>
<div class="figure">
<img src="img/rtools-install.png" alt="Rtools installation" width="65%" />
<p class="caption">
(#fig:unnamed-chunk-2)Rtools installation
</p>
</div>
<p>After installing Rtools, restart RStudio, then do:</p>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="#cb340-1"></a><span class="kw">library</span>(devtools)</span>
<span id="cb340-2"><a href="#cb340-2"></a><span class="kw">find_rtools</span>()</span></code></pre></div>
<p>Hopefully you will simply see a message saying <code>TRUE</code>, indicating that Rtools is properly installed. But if there was a problem, you will see a longer message with next steps.</p>
</div>
<div id="macos-system-prep" class="section level2">
<h2><span class="header-section-number">31.4</span> macOS: system prep</h2>
<p>You will not get an <em>immediate</em> warning from <code>devtools</code> that you need to install anything. But before you can build R package with compiled code, you will also need to install more software. Pick one of the following:</p>
<ul>
<li>Minimalist approach (what I do): Install Xcode Command Line Tools.
<ul>
<li>In the shell: <code>xcode-select --install</code></li>
</ul></li>
<li>Install the current release of full Xcode from the Mac App Store. WAY more stuff than you need but advantage is App Store convenience.</li>
<li>Get older or beta releases of Xcode from <a href="https://developer.apple.com/support/xcode/" class="uri">https://developer.apple.com/support/xcode/</a>.</li>
</ul>
</div>
<div id="linux-system-prep" class="section level2">
<h2><span class="header-section-number">31.5</span> Linux: system prep</h2>
<p><em>We’ve never had this section but <a href="https://www.rstudio.com/products/rpackages/devtools/">RStudio’s <code>devtools</code> guide</a> and <a href="https://r-pkgs.org/intro.html#linux">R Packages</a> both say the <code>r-devel</code> or <code>r-base-dev</code> package is required. What gives?</em></p>
</div>
<div id="check-system-prep" class="section level2">
<h2><span class="header-section-number">31.6</span> Check system prep</h2>
<p><code>devtools</code> offers a diagnostic function to check if your system is ready.</p>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb341-1"><a href="#cb341-1"></a><span class="kw">library</span>(devtools)</span>
<span id="cb341-2"><a href="#cb341-2"></a><span class="kw">has_devel</span>()</span></code></pre></div>
<p>Hopefully you see <code>TRUE</code>!</p>
</div>
<div id="r-packages-to-help-you-build-yet-more-r-packages" class="section level2">
<h2><span class="header-section-number">31.7</span> R packages to help you build yet more R packages</h2>
<p>Install more packages. If you already have them, update them.</p>
<ul>
<li>knitr</li>
<li>roxygen2</li>
<li>testthat</li>
</ul>
<p><em>2016-11 FYI: Jenny is running these versions of these packages at the time of writing.</em></p>
<pre><code>#&gt;    package *     version       date                              source
#&gt; 1 devtools * 1.12.0.9000 2016-11-23                               local
#&gt; 2    knitr *      1.14.2 2016-09-07        Github (yihui/knitr@f02600d)
#&gt; 3 roxygen2 *  5.0.1.9000 2016-10-23 Github (klutometis/roxygen@9ffbad0)
#&gt; 4 testthat *  1.0.2.9000 2016-09-09    Github (hadley/testthat@46d15da)</code></pre>
<p>How to check which version of a specific package you’ve got installed:</p>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb343-1"><a href="#cb343-1"></a><span class="kw">packageVersion</span>(<span class="st">&quot;devtools&quot;</span>)</span></code></pre></div>
<p>How to install a package and all it’s dependencies:</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="#cb344-1"></a><span class="kw">install.packages</span>(<span class="st">&quot;devtools&quot;</span>, <span class="dt">dependencies =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p>See how profound your problem with out-of-date packages is:</p>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="#cb345-1"></a><span class="kw">old.packages</span>()</span></code></pre></div>
<p>Update one package:</p>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb346-1"><a href="#cb346-1"></a><span class="kw">update.packages</span>(<span class="st">&quot;knitr&quot;</span>)</span></code></pre></div>
<p>Just update everything:</p>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb347-1"><a href="#cb347-1"></a><span class="kw">update.packages</span>(<span class="dt">ask =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p><strong>CAVEAT:</strong> The above examples will only consult your default library and default CRAN mirror. If you want to target a non-default library, use function arguments to say so. Packages that you have installed from GitHub? You’ll need to check the current-ness of your version and perform upgrades yourself.</p>
</div>
<div id="optional-install-devtools-from-github" class="section level2">
<h2><span class="header-section-number">31.8</span> Optional: install <code>devtools</code> from GitHub</h2>
<p>We aren’t using bleeding edge features of <code>devtools</code>, but you could upgrade to the development version of <code>devtools</code> at this point.</p>
<p>macOS and Linux users have it easy. Do this:</p>
<div class="sourceCode" id="cb348"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb348-1"><a href="#cb348-1"></a>devtools<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;r-lib/devtools&quot;</span>)</span></code></pre></div>
<p>For Windows instructions, see the <a href="https://github.com/r-lib/devtools"><code>devtools</code> README</a>.</p>
<!--RStudio Links-->
<!--HappyGitWithR Links-->
<!--Package Links-->
<!--Shiny links-->
<!--Publications-->
<!--R Documentation-->
<!--Wikipedia Links-->
<!--Misc. Links-->
<!--chapter:end:032_system-prep-packages.Rmd-->
</div>
</div>
<div id="package-from-scratch" class="section level1">
<h1><span class="header-section-number">32</span> Write your own R package</h1>
<!--Original content: https://stat545.com/packages06_foofactors-package.html-->
<p><em>The content that originally lived here now appears as the <a href="https://r-pkgs.org/whole-game.html">The Whole Game</a> in the under-development 2nd edition of the <a href="https://r-pkgs.org/index.html">R Packages</a> book.</em></p>
<!--chapter:end:033_create-package.Rmd-->
</div>
<div id="part-all-the-automation-things" class="section level1 unnumbered">
<h1>(PART) All the automation things</h1>
</div>
<div id="automation-overview" class="section level1 unnumbered">
<h1>Overview</h1>
<!--Original content: https://stat545.com/automation00_index.html-->
<!--TODO: All this section of website is specific to make - want to skip in favor of more WTF style workflows?-->
<p>Although we spend a lot of time working with data interactively, this sort of hands-on babysitting is not always appropriate. We have a philosophy of “source is real” in this class and that philosophy can be implemented on a grander scale. Just as we save R code in a script so we can replay analytical steps, we can also record how a series of scripts and commands work together to produce a set of analytical results. This is what we mean by automating data analysis or building an analytical pipeline.</p>
<ul>
<li>Chapter @ref(automation-slides) - Why and how we automate data analyses + examples</li>
<li>Chapter @ref(make-windows) - <code>make</code>: special considerations for Windows
<ul>
<li><em>2015-11-17 NOTE: since we have already set up a build environment for R packages, it is my hope that everyone has <code>make</code>. These instructions were from 2014, when we did everything in a different order. Cross your fingers and ignore!</em></li>
<li>(If you are running macOS or Linux, <code>make</code> should already be installed.)</li>
</ul></li>
<li>Chapter @ref(make-test-drive) - Test drive <code>make</code> and RStudio
<ul>
<li>Walk before you run! Prove that <code>make</code> is actually installed and that it can be found and executed from the <a href="https://happygitwithr.com/shell.html">shell</a> and from RStudio. It is also important to tell RStudio to NOT substitute spaces for tabs when editing a <code>Makefile</code> (applies to any text editor).</li>
</ul></li>
<li>Chapter @ref(automating-pipeline) - Hands-on activity
<ul>
<li>This fully developed example shows you:
<ul>
<li>How to run an R script non-interactively</li>
<li>How to use <code>make</code>…
<ul>
<li>To record which files are inputs vs intermediates vs outputs</li>
<li>To capture how scripts and commands convert inputs to outputs</li>
<li>To re-run parts of an analysis that are out-of-date</li>
</ul></li>
<li>The intersection of R and <code>make</code>, i.e. how to…
<ul>
<li>Run snippets of R code</li>
<li>Run an entire R script</li>
<li>Render an R Markdown document (or R script)</li>
</ul></li>
<li>The interface between RStudio and <code>make</code></li>
<li>How to use <code>make</code> from the <a href="https://happygitwithr.com/shell.html">shell</a></li>
<li>How Git facilitates the process of building a pipeline</li>
</ul></li>
<li><em>2015-11-19 Andrew MacDonald translated the above into a pipeline for the <a href="https://github.com/richfitz/remake"><code>remake</code> package</a> from Rich Fitzjohn: see <a href="https://gist.github.com/aammd/72a5b98356893c001001">this gist</a>.</em></li>
</ul></li>
<li>Chapter @ref(example-pipelines) - Three more toy pipelines, using the Lord of the Rings data</li>
</ul>
<div id="resources-11" class="section level2 unnumbered">
<h2>Resources</h2>
<!--TODO: Link for Karl Broman's "Tools for Reproducible Research" course goes to a list of his courses instead, need to track down actual course-->
<ul>
<li><a href="https://xkcd.com/1319/">xkcd comic on automation</a>. ‘Automating’ comes from the roots ‘auto-’ meaning ‘self-’, and ‘mating’, meaning ‘screwing’.</li>
<li>Karl Broman covers <a href="https://www.gnu.org/software/make/">GNU Make</a> in his course <a href="https://kbroman.org/Tools4RR/pages/schedule.html">Tools for Reproducible Research</a>.</li>
<li>Karl Broman also wrote <a href="https://kbroman.org/minimal_make/">minimal make: a minimal tutorial on make</a>, aimed at stats / data science types.</li>
<li><a href="https://web.archive.org/web/20160306042959/http://www.bendmorris.com/2013/09/using-make-for-reproducible-scientific.html">Using Make for reproducible scientific analyses</a>, blog post by Ben Morris.</li>
<li>Software Carpentry’s <a href="https://web.archive.org/web/20150110211213/http://software-carpentry.org/v4/make/index.html">Slides on <code>Make</code></a>.</li>
<li>Zachary M. Jones wrote <a href="http://zmjones.com/make/">GNU Make for Reproducible Data Analysis</a>.</li>
<li><a href="https://adamlaiacano.tumblr.com/post/45356689519/keeping-tabs-on-your-data-analysis-workflow">Keeping tabs on your data analysis workflow</a>, blog post by Adam Laiacano.</li>
<li>Mike Bostock, of D3.js and New York Times fame, explains <a href="https://bost.ocks.org/mike/make/">Why Use Make</a>: “it’s about the benefits of capturing workflows via a file-based dependency-tracking build system”.</li>
<li><a href="https://paulbutler.org/2012/make-for-data-scientists/">Make for Data Scientists</a>, blog post by Paul Butler, who also made a <a href="https://www.facebook.com/notes/facebook-engineering/visualizing-friendships/469716398919">beautiful map of Facebook connections</a> using R.</li>
<li>Other, more modern data-oriented alternatives to <code>make</code>:
<ul>
<li><a href="https://github.com/Factual/drake">Drake</a>, a kind of “make for data”</li>
<li><a href="https://www.nextflow.io">Nextflow</a> for “data-driven computational pipelines”</li>
<li><a href="https://github.com/richfitz/remake"><code>remake</code></a>, “Make-like declarative workflows in R”</li>
</ul></li>
<li><a href="http://shop.oreilly.com/product/9780596006105.do">Managing Projects with GNU Make, 3rd Edition</a> by Robert Mecklenburg <span class="citation">(<a href="#ref-mecklenburg2009" role="doc-biblioref">2009</a>)</span> is a fantastic book but, sadly, is very focused on compiling software.</li>
<li><a href="http://dirk.eddelbuettel.com/code/littler.html"><code>littler</code></a> is an R package maintained by Dirk Eddelbuettel that “provides the <code>r</code> program, a simplified command-line interface for GNU R.”</li>
</ul>
</div>
</div>
<div id="automation-slides" class="section level1">
<h1><span class="header-section-number">33</span> Why and how we automate data analyses + examples</h1>
<!--Original content: https://stat545.com/automation01_slides/index.html-->
<!--TODO: Link currently leads to https://STAT545-UBC.github.io/STAT545-UBC.github.io/, wasn't able to get slides in supporting-docs/automation01_slides to render-->
<p>See <a href="https://github.com/STAT545-UBC/STAT545-UBC-original-website/blob/master/automation01_slides/slides.md">“Automating data analysis pipelines” slides</a> by Shaun Jackman and Jenny Bryan.</p>
</div>
<div id="make-windows" class="section level1">
<h1><span class="header-section-number">34</span> <code>make</code>: special considerations for Windows</h1>
<!--Original content: https://stat545.com/automation02_windows.html-->
<!--Original authors: Shaun Jackman, Dean Attali, Jenny Bryan-->
<p><em>2015-11-17 NOTE: This year we made R packages before we used <code>make</code> The hope is, therefore, that the <code>make</code> that ships with Rtools is all we need. So hopefully we can ignore this?</em></p>
<div id="install-make-on-microsoft-windows" class="section level2">
<h2><span class="header-section-number">34.1</span> Install <code>make</code> on Microsoft Windows</h2>
<p>We are still working out the best way to install <code>make</code> on Windows. Our current best recommendation is to install <em>msysGit</em>, which includes <code>make</code> as well as <code>git</code> and <code>bash</code>.</p>
<p>Download and <a href="https://github.com/msysgit/msysgit/releases/download/Git-1.9.4-preview20140929/msysGit-netinstall-1.9.4-preview20140929.exe">install msysGit</a>. The two software packages <a href="https://github.com/msysgit/msysgit">msysGit</a> and <a href="http://msysgit.github.io/">Git for Windows</a> are related. Both install <code>git</code> and <code>bash</code>, but only <em>msysGit</em> installs <code>make</code>. The programs installed by <em>msysGit</em> are found by default in <code>C:\msysGit\bin</code>. Here is the <a href="https://github.com/msysgit/msysgit/tree/master/bin">complete list</a> of programs included with <em>msysGit</em>. For this activity, RStudio needs to be able to find in your <code>PATH</code> environment variable the program <code>make</code>, the <a href="https://happygitwithr.com/shell.html">shell</a> <code>bash</code>, other utilities like <code>rm</code> and <code>cp</code>, and <code>Rscript</code>.</p>
<p>Here is another alternative for installing <code>make</code> alone:</p>
<ul>
<li>Go to the <a href="http://gnuwin32.sourceforge.net/packages/make.htm">Make for Windows</a> web site.</li>
<li>Download the <a href="http://gnuwin32.sourceforge.net/downlinks/make.php">Setup program</a>.</li>
<li>Install the file you just downloaded and copy to your clipboard the directory in which it is being installed.
<ul>
<li>FYI: The default directory is <code>C:\Program Files (x86)\GnuWin32\</code></li>
</ul></li>
<li>You now have <code>make</code> installed, but you need to tell Windows where to find the program. This is called <a href="https://www.google.ca/webhp?sourceid=chrome-instant&amp;ion=1&amp;espv=2&amp;ie=UTF-8#q=windows%20update%20path%20variable">updating your <code>PATH</code></a>. You will want to update the <code>PATH</code> to include the <code>bin</code> directory of the newly installed program.</li>
</ul>
</div>
<div id="update-your-path" class="section level2">
<h2><span class="header-section-number">34.2</span> Update your <code>PATH</code></h2>
<p>If you installed Make for Windows (as opposed to the <code>make</code> that comes with Git for Windows), you still need to update your <code>PATH</code>.</p>
<p>These are the steps on Windows 7 (we don’t have such a write-up yet for Windows 8 – feel free to send one!):</p>
<ul>
<li>Click on the Windows logo.</li>
<li>Right click on <em>Computer</em>.</li>
<li>Select <em>Properties</em>.</li>
<li>Select <em>Advanced System Settings</em>.</li>
<li>Select <em>Environment variables</em>.</li>
<li>Select the line that has the <code>PATH</code> variable. You may have to scroll down to find it.</li>
<li>Select <em>Edit</em>.</li>
<li>Go to the end of the line and add a semicolon <code>;</code>, followed by the path where the program was installed, followed by <code>\bin</code>.
<ul>
<li>Typical example of what one might add: <code>;C:\Program Files (x86)\GnuWin32\bin</code></li>
</ul></li>
<li>Click Okay and close all the windows that you opened.</li>
<li>Quit RStudio and open it again.</li>
<li>You should now be able to use <code>make</code> from RStudio and the command line.</li>
</ul>
</div>
<div id="issues-we-are-still-clarifying" class="section level2">
<h2><span class="header-section-number">34.3</span> Issues we are still clarifying</h2>
<p>See <a href="https://github.com/STAT545-UBC/Discussion/issues/58">issue 58</a> for what seems to be the most comprehensive statement of the Windows situation.</p>
<p>What are the tricky bits?</p>
<ul>
<li>Getting the same <code>Makefile</code> to “work” via RStudio’s Build buttons/menus and in the <a href="https://happygitwithr.com/shell.html">shell</a>. And, for that matter, which <a href="https://happygitwithr.com/shell.html">shell</a>? Git Bash or ???</li>
<li>Ensuring <code>make</code>, <code>Rscript</code>, <code>pandoc</code>, <code>rm</code>, etc. can be found = updating <code>PATH</code>.</li>
<li>Getting <code>make</code> to use the correct <a href="https://happygitwithr.com/shell.html">shell</a>.
<ul>
<li>See <a href="https://github.com/STAT545-UBC/Discussion/issues/54">issue 54</a> on the Discussion repo.</li>
</ul></li>
</ul>
</div>
</div>
<div id="make-test-drive" class="section level1">
<h1><span class="header-section-number">35</span> Automation: test drive <code>make</code></h1>
<!--Original content: https://stat545.com/automation03_make-test-drive.html-->
<!--Original authors: Shaun Jackman, Jenny Bryan-->
<p>Before we use <code>make</code> for real work, we want to prove beyond a shadow of a doubt that it’s installed and findable from RStudio and/or the <a href="https://happygitwithr.com/shell.html">shell</a>.</p>
<div id="create-a-temporary-rstudio-project" class="section level2">
<h2><span class="header-section-number">35.1</span> Create a temporary RStudio project</h2>
<p>You can delete this project after this test drive, so don’t sweat too much about what you name it or where you put it.</p>
<ul>
<li>Create an RStudio project: <em>File &gt; New Project</em></li>
<li>Create a new text file: <em>File &gt; New File &gt; Text File</em></li>
<li>We are about to write our first <code>Makefile</code>!</li>
</ul>
<p>But first …</p>
</div>
<div id="disable-insert-spaces-for-tab" class="section level2">
<h2><span class="header-section-number">35.2</span> Disable “insert spaces for tab”</h2>
<p>Tabs are very meaningful in <code>Makefiles</code>, so it’s important to make sure your text editor is not “helpfully” but silently converting tabs to spaces.</p>
<p>Here’s how to disable this in RStudio.</p>
<ul>
<li>Global setting: <em>Tools &gt; Global Options… &gt; Code &gt; Editing</em>. Make sure “Insert spaces for tab” is <strong>unchecked</strong>.</li>
<li>Project-specific setting: <em>Tools &gt; Project Options… &gt; Code Editing</em>. Make sure “Insert spaces for tab” is <strong>unchecked</strong>.</li>
</ul>
<p>RStudio can reveal information about the whitespace in a file: <em>RStudio &gt; Preferences… &gt; Code &gt; Display &gt;</em> “Show whitespace characters”. When in doubt, make darn sure your <code>Makefile</code> is indented with tabs and not spaces!</p>
</div>
<div id="write-a-toy-makefile" class="section level2">
<h2><span class="header-section-number">35.3</span> Write a toy <code>Makefile</code></h2>
<p>Type or paste this into your new text file. Make sure the indentation before <code>@echo</code> is always a tab! Save as <code>Makefile</code>:</p>
<div class="sourceCode" id="cb349"><pre class="sourceCode makefile"><code class="sourceCode makefile"><span id="cb349-1"><a href="#cb349-1"></a><span class="dv">all:</span></span>
<span id="cb349-2"><a href="#cb349-2"></a>    <span class="ch">@</span><span class="fu">echo Build all</span></span>
<span id="cb349-3"><a href="#cb349-3"></a></span>
<span id="cb349-4"><a href="#cb349-4"></a><span class="dv">clean:</span></span>
<span id="cb349-5"><a href="#cb349-5"></a>    <span class="ch">@</span><span class="fu">echo Clean all</span></span></code></pre></div>
</div>
<div id="configure-this-rstudio-project-to-use-make" class="section level2">
<h2><span class="header-section-number">35.4</span> Configure this RStudio project to use <code>make</code></h2>
<p>Select <em>Build &gt; Configure Build Tools… &gt; Build Tools &gt; Project build tools &gt; Makefile</em>.</p>
<p>This will make a new tab and buttons and menus available in RStudio, usually in the upper right-hand pane, similar to the Git stuff.</p>
</div>
<div id="run-make-via-rstudio" class="section level2">
<h2><span class="header-section-number">35.5</span> Run <code>make</code> via RStudio</h2>
<p>Select <em>Build &gt; Build All</em> (the hammer icon).</p>
<p>The result and any error messages should appear under the <em>Build</em> tab.</p>
<p>Hopefully you will see this:</p>
<div class="sourceCode" id="cb350"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb350-1"><a href="#cb350-1"></a><span class="ex">Build</span> all</span></code></pre></div>
<p>If you see something like this:</p>
<div class="sourceCode" id="cb351"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb351-1"><a href="#cb351-1"></a><span class="ex">Makefile</span>:2: *** missing separator.  Stop.</span></code></pre></div>
<p>you probably have spaces instead of tabs as indentation. Fix that and try again.</p>
<p>RStudio offers these buttons or menu items to run things from your <code>Makefile</code>:</p>
<ul>
<li><em>Build All</em> - runs <code>make all</code>, as we just saw</li>
<li><em>Clean All</em> - runs <code>make clean</code></li>
<li><em>Clean and Rebuild</em> - runs <code>make clean all</code></li>
</ul>
<p>For these menu items to work, your <code>Makefile</code> needs to have targets named <code>all</code> and <code>clean</code>. These non-file targets are called phony targets.</p>
<p>You should be able to select <em>Build &gt; More &gt; Clean All</em> and get this:</p>
<div class="sourceCode" id="cb352"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb352-1"><a href="#cb352-1"></a><span class="ex">Clean</span> all</span></code></pre></div>
<p>You should be able to select <em>Build &gt; More &gt; Clean and Rebuild</em> and get this:</p>
<div class="sourceCode" id="cb353"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb353-1"><a href="#cb353-1"></a><span class="ex">Clean</span> all</span>
<span id="cb353-2"><a href="#cb353-2"></a><span class="ex">Build</span> all</span></code></pre></div>
<p>This proves that <code>make</code> is installed and working from RStudio.</p>
</div>
<div id="run-make-from-the-shell" class="section level2">
<h2><span class="header-section-number">35.6</span> Run <code>make</code> from the shell</h2>
<p>RStudio only provides access to a very limited bit of <code>make</code> – it’s even more limited than the RStudio Git client. In the long run, it’s important to be able to run <code>make</code> from the <a href="https://happygitwithr.com/shell.html">shell</a>.</p>
<ul>
<li><p>Select <em>Tools &gt; Shell</em></p></li>
<li><p>Run</p>
<div class="sourceCode" id="cb354"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb354-1"><a href="#cb354-1"></a><span class="fu">make</span> clean</span>
<span id="cb354-2"><a href="#cb354-2"></a><span class="fu">make</span> all</span>
<span id="cb354-3"><a href="#cb354-3"></a><span class="fu">make</span> clean all</span></code></pre></div></li>
</ul>
<p>You should be seeing similar output as you saw in the Build tab of RStudio.</p>
<p>If you are not, are you getting the error message that’s characteristic of a “spaces instead of tabs” problem? Or does it look more like <code>make</code> or other commands aren’t being found? If the latter, go back to the <a href="#make-windows">Windows installation page</a> or reach out to the course staff.</p>
</div>
</div>
<div id="automating-pipeline" class="section level1">
<h1><span class="header-section-number">36</span> Automating data-analysis pipelines</h1>
<!--Original content: https://stat545.com/automation04_make-activity.html-->
<!--Original authors: Shaun Jackman and Jenny Bryan-->
<p>The goal of this activity is to create a pipeline that will…</p>
<ul>
<li>Obtain a large file of English words.</li>
<li>Calculate a histogram of word lengths.</li>
<li>Determine the most common word length.</li>
<li>Generate a figure of this histogram.</li>
<li>Render a R Markdown report in HTML and PDF.</li>
</ul>
<p>You will automate this pipeline using <code>make</code>!</p>
<div id="dependency-graph-of-the-pipeline" class="section level2">
<h2><span class="header-section-number">36.1</span> Dependency graph of the pipeline</h2>
<!--TO DO (JB): remake the figure to say words.txt not words.tsv and the new words downloading strategy -->
<div class="figure">
<img src="supporting-docs/automation01_slides/images/activity.png" alt="Dependency graph of the pipeline" width="50%" />
<p class="caption">
(#fig:unnamed-chunk-2)Dependency graph of the pipeline
</p>
</div>
</div>
<div id="set-up-a-new-rstudio-project-and-git-repo" class="section level2">
<h2><span class="header-section-number">36.2</span> Set up a new RStudio project (and Git repo)</h2>
<p>In RStudio: <em>File &gt; New Project &gt; New Directory &gt; Empty Project.</em> If you’re a Git user, we strongly encourage you to click on “Create a git repository.”</p>
<p>This project will be useful as a reference in the future, so give it an informative name and location. If you’re a GitHub user, you may want to push it there as well.</p>
<p>Git(Hub) users: from here on out, we assume you will be committing at regular intervals. At key points, we explicitly prompt you to commit.</p>
<p><em>Git folks:</em> commit now.</p>
</div>
<div id="sample-project-and-git-repository" class="section level2">
<h2><span class="header-section-number">36.3</span> Sample project and Git repository</h2>
<p>We walked through this activity ourselves and <a href="https://github.com/STAT545-UBC/make-activity">this Git repo</a> reflects how our project evolved.</p>
<p>The project is set up for use with <code>make</code> at <a href="https://github.com/STAT545-UBC/make-activity/tree/5d282f87ec3fd46d13b500be51a74c9df146d283">this commit</a>.</p>
</div>
<div id="create-the-makefile" class="section level2">
<h2><span class="header-section-number">36.4</span> Create the <code>Makefile</code></h2>
<p>In RStudio: <em>File &gt; New File &gt; Text File.</em> Save it with the name <code>Makefile</code>. Keep adding the rules we write below to this file, saving regularly.</p>
<p>Once you’ve saved the file with the name <code>Makefile</code>, RStudio should indent with tabs instead of spaces. I recommend you display whitespace in order to visually confirm this: <em>RStudio &gt; Preferences &gt; Code &gt; Display &gt; Display whitespace characters</em>. A more extreme measure is to set project or global preferences to NOT replace tabs with spaces, but this will wreak havoc elsewhere.</p>
<p>You also want RStudio to recognize the presence of the <code>Makefile</code>. Pick one:</p>
<ul>
<li>Set Project Build Tools to <code>Makefile</code></li>
<li>Quit and relaunch</li>
</ul>
<p>You should see a “Build” tab now in the same pane as “Environment”, “History”, and, if applicable, “Git”.</p>
<p><em>Git folks:</em> commit now.</p>
</div>
<div id="get-the-dictionary-of-words" class="section level2">
<h2><span class="header-section-number">36.5</span> Get the dictionary of words</h2>
<p>Depending on your OS and mood, you can get the file of English words by copying a local file or downloading from the internet.</p>
<div id="download-the-dictionary" class="section level3">
<h3><span class="header-section-number">36.5.1</span> Download the dictionary</h3>
<p>Our first <code>Makefile</code> rule will download the dictionary <code>words.txt</code>. The command of this rule is a one-line R script, so instead of putting the R script in a separate file, we’ll include the command directly in the <code>Makefile</code>, since it’s so short. <em>Sure, we could download a file without using R at all but humor us: this is a tutorial about <code>make</code> and R!</em></p>
<div class="sourceCode" id="cb355"><pre class="sourceCode makefile"><code class="sourceCode makefile"><span id="cb355-1"><a href="#cb355-1"></a><span class="dv">words.txt:</span></span>
<span id="cb355-2"><a href="#cb355-2"></a>    Rscript -e <span class="st">&#39;download.file(&quot;https://svnweb.freebsd.org/base/head/share/dict/web2?view=co&quot;, destfile = &quot;words.txt&quot;, quiet = TRUE)&#39;</span></span></code></pre></div>
<p><strong>Suggested workflow:</strong></p>
<ul>
<li><em>Git folks:</em> commit anything new/modified. Start with a clean working tree.</li>
<li>Submit the above <code>download.file()</code> command in the R Console to make sure it works.</li>
<li>Inspect the downloaded words file any way you know how; make sure it’s not garbage. Size should be about 2.4MB.</li>
<li>Delete <code>words.txt</code>.</li>
<li>Put the above rule into your <code>Makefile</code>. From the <a href="https://happygitwithr.com/shell.html">shell</a>, enter <code>make words.txt</code> to verify rule works. Reinspect the words file.</li>
<li><em>Git folks:</em> commit <code>Makefile</code> and <code>words.txt</code>.</li>
</ul>
<p>See the sample project at this point in <a href="https://github.com/STAT545-UBC/make-activity/tree/c30ecc9c890a2f2261eb94118997f0774012eeb8">this commit</a>.</p>
</div>
<div id="copy-the-dictionary" class="section level3">
<h3><span class="header-section-number">36.5.2</span> Copy the dictionary</h3>
<p>On Mac or Linux systems, rather than download the dictionary, we can simply copy the file <code>/usr/share/dict/words</code> that comes with the operating system. In this alternative rule, we use the <a href="https://happygitwithr.com/shell.html">shell</a> command <code>cp</code> to copy the file.</p>
<div class="sourceCode" id="cb356"><pre class="sourceCode makefile"><code class="sourceCode makefile"><span id="cb356-1"><a href="#cb356-1"></a><span class="dv">words.txt:</span><span class="dt"> /usr/share/dict/words</span></span>
<span id="cb356-2"><a href="#cb356-2"></a>    cp /usr/share/dict/words words.txt</span></code></pre></div>
<p>This rule copies the input file <code>/usr/share/dict/words</code> to create the output file <code>words.txt</code>. We then repeat these file names in the command rule, which is redundant and leaves us vulnerable to typos. <code>make</code> offers many automatic variables, so the revised rule below uses <code>$&lt;</code> and <code>$@</code> to represent the input file and output file, respectively.</p>
<div class="sourceCode" id="cb357"><pre class="sourceCode makefile"><code class="sourceCode makefile"><span id="cb357-1"><a href="#cb357-1"></a><span class="dv">words.txt:</span><span class="dt"> /usr/share/dict/words</span></span>
<span id="cb357-2"><a href="#cb357-2"></a>    cp <span class="ch">$&lt;</span> <span class="ch">$@</span></span></code></pre></div>
<p><strong>Suggested workflow:</strong></p>
<ul>
<li><em>Git folks:</em> commit anything new/modified. Start with a clean working tree.</li>
<li>Remove <code>words.txt</code> if you succeeded with the download approach.</li>
<li>Submit the above <code>cp</code> command in the <a href="https://happygitwithr.com/shell.html">shell</a> to make sure it works.</li>
<li>Inspect the copied words file any way you know how; make sure it’s not garbage. Size should be about 2.4MB.</li>
<li>Delete <code>words.txt</code>.</li>
<li>Put the above rule into your <code>Makefile</code>. From the <a href="https://happygitwithr.com/shell.html">shell</a>, enter <code>make words.txt</code> to verify rule works. Reinspect the words file.</li>
<li><em>Git folks:</em> look at the diff. You should see how your <code>words.txt</code> rule has changed and you might also see some differences between the local and remote words files. Interesting! Commit <code>Makefile</code> and <code>words.txt</code>.</li>
</ul>
<p>See the sample project at this point in <a href="https://github.com/STAT545-UBC/make-activity/tree/1131791548e0c5bbc5104eebb19710ed435146e3">this commit</a>.</p>
</div>
</div>
<div id="create-rules-for-all-and-clean" class="section level2">
<h2><span class="header-section-number">36.6</span> Create rules for all and clean</h2>
<p>It would be nice to execute our <code>make</code> rules from RStudio. So it’s urgent that we create phony targets <code>all</code> and <code>clean</code>, which are the only targets accessible from RStudio. These targets are phony in the sense that they do not specify an actual file to be made, rather they just make it easy to trigger a certain action. <code>all</code> and <code>clean</code> are phony targets that appear in most <code>Makefiles</code>, which is why RStudio makes it easy to access them from the IDE.</p>
<p>Edit your <code>Makefile</code> to look like this (where your <code>words.txt</code> rule can be the copy or download version):</p>
<div class="sourceCode" id="cb358"><pre class="sourceCode makefile"><code class="sourceCode makefile"><span id="cb358-1"><a href="#cb358-1"></a><span class="dv">all:</span><span class="dt"> words.txt</span></span>
<span id="cb358-2"><a href="#cb358-2"></a></span>
<span id="cb358-3"><a href="#cb358-3"></a><span class="dv">clean:</span></span>
<span id="cb358-4"><a href="#cb358-4"></a>    rm -f words.txt</span>
<span id="cb358-5"><a href="#cb358-5"></a></span>
<span id="cb358-6"><a href="#cb358-6"></a><span class="dv">words.txt:</span><span class="dt"> /usr/share/dict/words</span></span>
<span id="cb358-7"><a href="#cb358-7"></a>    cp /usr/share/dict/words words.txt</span></code></pre></div>
<p>Since our only output so far is <code>words.txt</code>, that’s what we associate with the <code>all</code> target. Likewise, the only product we can re-make so far is <code>words.txt</code>, so it’s the only thing we delete via <code>clean</code>.</p>
<p><strong>Suggested workflow:</strong></p>
<ul>
<li>Use <code>make clean</code> from the shell and/or <em>RStudio &gt; Build &gt; More &gt; Clean All</em> to delete <code>words.txt</code>.
<ul>
<li>Does it go away?</li>
<li><em>Git folks:</em> does the deletion of this file show up in your Git tab?</li>
</ul></li>
<li>Use <code>make all</code> from the shell and/or <em>RStudio &gt; Build &gt; Build All</em> to get <code>words.txt</code> back.
<ul>
<li>Does it come back?</li>
<li><em>Git folks:</em> does the restoration of <code>words.txt</code> cause it to drop off your radar as a changed/deleted file? See how this stuff all works together?</li>
</ul></li>
<li><em>Git folks:</em> Commit.</li>
</ul>
<p>See the sample project at this point in <a href="https://github.com/STAT545-UBC/make-activity/tree/9e1a556adc602ffce91b5c8edccd223237080c54">this commit</a>.</p>
</div>
<div id="create-a-table-of-word-lengths" class="section level2">
<h2><span class="header-section-number">36.7</span> Create a table of word lengths</h2>
<p>This rule will read the list of words and generate a table of word length frequency, stored in a tab-separated-values (TSV) file. This R script is a little longer, so we’ll put it in its own file, named <code>histogram.r</code>. If either the script <code>histogram.r</code> or the data file <code>words.txt</code> were to change, we’d need to rerun this command to get up-to-date results, so both files are dependencies of this rule. The input-file variable <code>$&lt;</code> refers to the <em>first</em> dependency, <code>histogram.r</code>.</p>
<div class="sourceCode" id="cb359"><pre class="sourceCode makefile"><code class="sourceCode makefile"><span id="cb359-1"><a href="#cb359-1"></a><span class="dv">histogram.tsv:</span><span class="dt"> histogram.r words.txt</span></span>
<span id="cb359-2"><a href="#cb359-2"></a>    Rscript <span class="ch">$&lt;</span></span></code></pre></div>
<p>FYI: <code>Rscript</code> allows you to execute R scripts from the <a href="https://happygitwithr.com/shell.html">shell</a>. It is a more modern replacement for <code>R CMD BATCH</code> (don’t worry if you’ve never heard of that).</p>
<p>Create the R script <code>histogram.r</code> that reads the list of words from <code>words.txt</code> and writes the table of word length frequency to <code>histogram.tsv</code>. It should be a tab-delimited TSV file with a header and two columns, named <code>Length</code> and <code>Freq</code>. Hint: you can accomplish this task using four functions: <code>readLines</code>, <code>nchar</code>, <code>table</code> and <code>write.table</code>. Here’s <a href="https://raw.githubusercontent.com/STAT545-UBC/STAT545-UBC.github.io/master/automation10_holding-area/activity/histogram.r">one solution</a>, but try not to peek until you’ve attempted this task yourself.</p>
<p><strong>Suggested workflow:</strong></p>
<ul>
<li>Develop your <code>histogram.r</code> script interactively. Make sure it works when you step through it line-by-line. Debugging only gets harder once you’re running entire scripts at arm’s length via <code>make</code>!</li>
<li>Remove <code>histogram.tsv</code>. Clean out the workspace and restart R. Run <code>histogram.r</code> via <code>source()</code> or using RStudio’s Source button. Make sure it works!</li>
<li>Add the <code>histogram.tsv</code> rule to your <code>Makefile</code>.</li>
<li>Remove <code>histogram.tsv</code> and regenerate it via <code>make histogram.tsv</code> from the <a href="https://happygitwithr.com/shell.html">shell</a>.</li>
<li><em>Git folks:</em> Commit.</li>
</ul>
<p>See the sample project at this point in <a href="https://github.com/STAT545-UBC/make-activity/tree/889e01a3d610e900c7e58ebd32a0506c61543fd9">this commit</a>.</p>
</div>
<div id="update-rules-for-all-and-clean" class="section level2">
<h2><span class="header-section-number">36.8</span> Update rules for all and clean</h2>
<p>The new output <code>histogram.tsv</code> can replace <code>words.txt</code> as our most definitive output. So it will go in the <code>all</code> rule. Likewise, we should add <code>histogram.tsv</code> to the <code>clean</code> rule. Edit your <code>all</code> and <code>clean</code> rules to look like this:</p>
<div class="sourceCode" id="cb360"><pre class="sourceCode makefile"><code class="sourceCode makefile"><span id="cb360-1"><a href="#cb360-1"></a><span class="dv">all:</span><span class="dt"> histogram.tsv</span></span>
<span id="cb360-2"><a href="#cb360-2"></a></span>
<span id="cb360-3"><a href="#cb360-3"></a><span class="dv">clean:</span></span>
<span id="cb360-4"><a href="#cb360-4"></a>    rm -f words.txt histogram.tsv</span></code></pre></div>
<p><strong>Suggested workflow:</strong></p>
<ul>
<li>Use <code>make clean</code> from the shell and/or <em>RStudio &gt; Build &gt; More &gt; Clean All</em>.
<ul>
<li>Do <code>words.txt</code> and <code>histogram.tsv</code> go away?</li>
<li><em>Git folks:</em> does the deletion of these files show up in your Git tab?</li>
</ul></li>
<li>Use <code>make all</code> from the shell and/or <em>RStudio &gt; Build &gt; Build All</em> to get <code>words.txt</code> back.
<ul>
<li>Does it come back?</li>
<li><em>Git folks:</em> does the restoration of the files cause them to drop off your radar as changed/deleted files?</li>
</ul></li>
<li><em>Git folks:</em> Commit.</li>
</ul>
<p>See the sample project at this point in <a href="https://github.com/STAT545-UBC/make-activity/tree/4f392d0e20bb7e4bfcdc00a812190e40e27ae3d4">this commit</a>.</p>
</div>
<div id="plot-a-histogram-of-word-lengths-update-all-and-clean" class="section level2">
<h2><span class="header-section-number">36.9</span> Plot a histogram of word lengths, update all and clean</h2>
<p>This rule will read the table of word lengths and plot a histogram using <code>ggplot2::qplot()</code>. The R snippet is three lines long, but we’ll still include the script in the <code>Makefile</code> directly, and use semicolons <code>;</code> to separate the R commands. The variable <code>$@</code> refers to the output file, <code>histogram.png</code>.</p>
<div class="sourceCode" id="cb361"><pre class="sourceCode makefile"><code class="sourceCode makefile"><span id="cb361-1"><a href="#cb361-1"></a><span class="dv">histogram.png:</span><span class="dt"> histogram.tsv</span></span>
<span id="cb361-2"><a href="#cb361-2"></a>    Rscript -e <span class="st">&#39;library(ggplot2); qplot(Length, Freq, data=read.delim(&quot;</span><span class="ch">$&lt;</span><span class="st">&quot;)); ggsave(&quot;</span><span class="ch">$@</span><span class="st">&quot;)&#39;</span></span></code></pre></div>
<p><strong>Suggested workflow:</strong></p>
<ul>
<li>Test the histogram-drawing code in the R Console to make sure it works.</li>
<li>Inspect the resulting PNG to make sure it’s good.</li>
<li>Clean up after yourself.</li>
<li>Add the above rule to your <code>Makefile</code>.</li>
<li>Test that new rule works.</li>
<li>If you get an unexpected empty plot <code>Rplots.pdf</code>, don’t worry about it yet.</li>
<li>Update the <code>all</code> and <code>clean</code> targets in light of this addition to the pipeline.</li>
<li>Test the new definitions of <code>all</code> and <code>clean</code>.</li>
<li><em>Git folks:</em> commit.</li>
</ul>
<p><em>NOTE: Why are we writing this PNG to file when, by the end of the activity, we are writing an R Markdown report? We could include this figure-making code in an R chunk there. We’re doing it this way to demonstrate more about R and <code>make</code> workflows. Plus sometimes we do work this way in real life, if a figure has a life outside one specific R Markdown report.</em></p>
<p>See the sample project at this point in <a href="https://github.com/STAT545-UBC/make-activity/tree/221c2d66fe9fd7a359835492db6557e258178780">this commit</a>.</p>
</div>
<div id="use-make-to-deal-with-an-annoyance" class="section level2">
<h2><span class="header-section-number">36.10</span> Use <code>make</code> to deal with an annoyance</h2>
<p>The code used above to create <code>histogram.png</code> usually leaves an empty <code>Rplots.pdf</code> file behind. You can read <a href="http://stackoverflow.com/questions/17348359/how-to-stop-r-from-creating-empty-rplots-pdf-file-when-using-ggsave-and-rscript">this thread on stackoverflow</a> if you’d like to know more.</p>
<p>We’ll just use this as a teachable moment to demonstrate how handy an automated pipeline is for dealing with such annoyances and to show a multi-line <code>make</code> rule.</p>
<p>Update the <code>histogram.png</code> rule like so:</p>
<div class="sourceCode" id="cb362"><pre class="sourceCode makefile"><code class="sourceCode makefile"><span id="cb362-1"><a href="#cb362-1"></a><span class="dv">histogram.png:</span><span class="dt"> histogram.tsv</span></span>
<span id="cb362-2"><a href="#cb362-2"></a>    Rscript -e <span class="st">&#39;library(ggplot2); qplot(Length, Freq, data=read.delim(&quot;</span><span class="ch">$&lt;</span><span class="st">&quot;)); ggsave(&quot;</span><span class="ch">$@</span><span class="st">&quot;)&#39;</span></span>
<span id="cb362-3"><a href="#cb362-3"></a>    rm Rplots.pdf</span></code></pre></div>
<p><strong>Suggested workflow:</strong></p>
<ul>
<li>Remove <code>Rplots.pdf</code> manually</li>
<li>Add the <code>rm Rplots.pdf</code> command to the <code>histogram.png</code> rule.</li>
<li>Test that new rule works.</li>
<li>Test that behavior of <code>all</code> and <code>clean</code> still good.</li>
<li><em>Git folks:</em> commit.</li>
</ul>
<p>See the sample project at this point in <a href="https://github.com/STAT545-UBC/make-activity/tree/3b75dac0d0cd8dd7e7cd3c2e66799a65d90b9fff">this commit</a>.</p>
</div>
<div id="render-an-html-report" class="section level2">
<h2><span class="header-section-number">36.11</span> Render an HTML report</h2>
<p>Finally, we’ll use <code>rmarkdown::render()</code> to generate an HTML report. If we think narrowly, we might say that the HTML report depends only on its Markdown predecessor, which would lead to a rule like this:</p>
<div class="sourceCode" id="cb363"><pre class="sourceCode makefile"><code class="sourceCode makefile"><span id="cb363-1"><a href="#cb363-1"></a><span class="dv">report.html:</span><span class="dt"> report.md</span></span>
<span id="cb363-2"><a href="#cb363-2"></a>    Rscript -e <span class="st">&#39;rmarkdown::render(&quot;</span><span class="ch">$&lt;</span><span class="st">&quot;)&#39;</span></span></code></pre></div>
<p>But we really shouldn’t hard-wire statements about word length in Markdown; we should use inline R code to compute that from the word length table. Similarly, if the plotted histogram were to change, we’d need to remake the HTML report. Here is a better rule that captures all of these dependencies:</p>
<div class="sourceCode" id="cb364"><pre class="sourceCode makefile"><code class="sourceCode makefile"><span id="cb364-1"><a href="#cb364-1"></a><span class="dv">report.html:</span><span class="dt"> report.rmd histogram.tsv histogram.png</span></span>
<span id="cb364-2"><a href="#cb364-2"></a>    Rscript -e <span class="st">&#39;rmarkdown::render(&quot;</span><span class="ch">$&lt;</span><span class="st">&quot;)&#39;</span></span></code></pre></div>
<p>Create the R Markdown file <code>report.rmd</code> that reads the table of word lengths <code>histogram.tsv</code>, reports the most common word length, and displays the pre-made histogram <code>histogram.png</code>. Here’s <a href="https://raw.githubusercontent.com/STAT545-UBC/STAT545-UBC.github.io/master/automation10_holding-area/activity/report.rmd">one solution</a>, but try not to peek until you’ve attempted this task yourself.</p>
<p><strong>Suggested workflow:</strong></p>
<ul>
<li>Develop <code>report.rmd</code>, running the R chunks often, from a clean workspace and fresh R session. Debugging only gets harder once you’re rendering entire reports at arm’s length via <code>make</code>!</li>
<li>Render the report using <code>rmarkdown::render()</code> in the Console or RStudio’s Preview HTML button.</li>
<li>Clean up after yourself.</li>
<li>Add the above rule for <code>report.html</code> to your <code>Makefile</code>.</li>
<li>Test that new rule works.</li>
<li>Update the <code>all</code> and <code>clean</code> targets in light of this addition to the pipeline.</li>
<li>Test the new definitions of <code>all</code> and <code>clean</code>.</li>
<li><em>Git folks:</em> commit.</li>
</ul>
<p>See the sample project at this point in <a href="https://github.com/STAT545-UBC/make-activity/tree/91ebcfc7d25743ebd8d6c9684ed7923ad4758585">this commit</a>.</p>
<!-- TO DO: this PDF bit awaiting attention from Shaun -->
<!--

Render a PDF report
================================================================================

Can you modify the `rmarkdown::render` command to generate a PDF report instead of an HTML report? Hint: look at the optional second argument of `rmarkdown::render`. Alternatively, click the *Knit* dropdown box and select *Knit PDF*, and look at how RStudio modifies the header of your R Markdown script.

-->
</div>
<div id="the-final-makefile" class="section level2">
<h2><span class="header-section-number">36.12</span> The final <code>Makefile</code></h2>
<p>At this point, your <code>Makefile</code> should look something like this:</p>
<div class="sourceCode" id="cb365"><pre class="sourceCode makefile"><code class="sourceCode makefile"><span id="cb365-1"><a href="#cb365-1"></a><span class="dv">all:</span><span class="dt"> report.html</span></span>
<span id="cb365-2"><a href="#cb365-2"></a></span>
<span id="cb365-3"><a href="#cb365-3"></a><span class="dv">clean:</span></span>
<span id="cb365-4"><a href="#cb365-4"></a>    rm -f words.txt histogram.tsv histogram.png report.md report.html</span>
<span id="cb365-5"><a href="#cb365-5"></a></span>
<span id="cb365-6"><a href="#cb365-6"></a><span class="dv">words.txt:</span><span class="dt"> /usr/share/dict/words</span></span>
<span id="cb365-7"><a href="#cb365-7"></a>    cp /usr/share/dict/words words.txt</span>
<span id="cb365-8"><a href="#cb365-8"></a></span>
<span id="cb365-9"><a href="#cb365-9"></a><span class="dv">histogram.tsv:</span><span class="dt"> histogram.r words.txt</span></span>
<span id="cb365-10"><a href="#cb365-10"></a>    Rscript <span class="ch">$&lt;</span></span>
<span id="cb365-11"><a href="#cb365-11"></a></span>
<span id="cb365-12"><a href="#cb365-12"></a><span class="dv">histogram.png:</span><span class="dt"> histogram.tsv</span></span>
<span id="cb365-13"><a href="#cb365-13"></a>    Rscript -e <span class="st">&#39;library(ggplot2); qplot(Length, Freq, data=read.delim(&quot;</span><span class="ch">$&lt;</span><span class="st">&quot;)); ggsave(&quot;</span><span class="ch">$@</span><span class="st">&quot;)&#39;</span></span>
<span id="cb365-14"><a href="#cb365-14"></a>    rm Rplots.pdf</span>
<span id="cb365-15"><a href="#cb365-15"></a></span>
<span id="cb365-16"><a href="#cb365-16"></a><span class="dv">report.html:</span><span class="dt"> report.rmd histogram.tsv histogram.png</span></span>
<span id="cb365-17"><a href="#cb365-17"></a>    Rscript -e <span class="st">&#39;rmarkdown::render(&quot;</span><span class="ch">$&lt;</span><span class="st">&quot;)&#39;</span></span></code></pre></div>
<p>Remember, you can review the entire activity via the commit history of the sample project: <a href="https://github.com/STAT545-UBC/make-activity" class="uri">https://github.com/STAT545-UBC/make-activity</a>.</p>
<p>And that’s how a data analytical pipeline gets built using <code>make</code>, the shell, R, RStudio, and optionally Git.</p>
</div>
<div id="extending-the-makefile" class="section level2">
<h2><span class="header-section-number">36.13</span> Extending the <code>Makefile</code></h2>
<p>Here are <a href="https://www.gnu.org/software/make/manual/html_node/Special-Targets.html">some additions</a> you might like to include in your <code>Makefile</code>:</p>
<div class="sourceCode" id="cb366"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb366-1"><a href="#cb366-1"></a><span class="ex">.PHONY</span>: all clean</span>
<span id="cb366-2"><a href="#cb366-2"></a><span class="ex">.DELETE_ON_ERROR</span>:</span>
<span id="cb366-3"><a href="#cb366-3"></a><span class="ex">.SECONDARY</span>:</span></code></pre></div>
<p>The <code>.PHONY</code> line is where you declare which targets are <em>phony</em>, i.e. are not actual files to be made in the literal sense. It’s a good idea to explicitly tell <code>make</code> which targets are phony, instead of letting it try to deduce this. <code>make</code> can get confused if you create a file that has the same name as a phony target. If for example you create a directory named <code>clean</code> to hold your clean data and run <code>make clean</code>, then <code>make</code> will report <code>'clean' is up to date</code>, because a directory with that name already exists.</p>
<p><code>.DELETE_ON_ERROR</code> causes <code>make</code> to “delete the target of a rule if it has changed and its recipe exits with a nonzero exit status”. In English, this means that – if a rule starts to run but then exits due to error – any outputs written in the course of that fiasco will be deleted. This can protect you from having half-baked, erroneous files lying around that will just confuse you later.</p>
<p><code>.SECONDARY</code> tells <code>make</code> not to delete intermediate files of a chain of pattern rules. Consider creating a <code>Makefile</code> with two pattern rules, <code>%.md: %.rmd</code> and <code>%.html: %.md</code>, and then running <code>make report.html</code>. After <code>make</code> has created <code>report.md</code> and <code>report.html</code>, it will delete the intermediate file <code>report.md</code>. Adding <code>.SECONDARY</code> to your <code>Makefile</code> prevents the intermediate file from being deleted.</p>
</div>
</div>
<div id="example-pipelines" class="section level1">
<h1><span class="header-section-number">37</span> More example pipelines</h1>
<p>There are three more toy pipelines, using the Lord of the Rings data, that reinforce:</p>
<ul>
<li><a href="https://github.com/STAT545-UBC/STAT545-UBC.github.io/tree/master/automation10_holding-area/01_automation-example_just-r"><code>01_automation-example_just-r</code></a> - use of an R script as a pseudo-<code>Makefile</code>.</li>
<li><a href="https://github.com/STAT545-UBC/STAT545-UBC.github.io/tree/master/automation10_holding-area/02_automation-example_r-and-make"><code>02_automation-example_r-and-make</code></a> - use of a simple <code>Makefile</code>.</li>
<li><a href="https://github.com/STAT545-UBC/STAT545-UBC.github.io/tree/master/automation10_holding-area/03_automation-example_render-without-rstudio"><code>03_automation-example_render-without-rstudio</code></a> - use of <code>rmarkdown::render()</code> from a <code>Makefile</code>, as the default way of running an R script or an R Markdown document, leading to pretty HTML reports without any mouse clicks.</li>
</ul>
<!--RStudio Links-->
<!--HappyGitWithR Links-->
<!--Package Links-->
<!--Shiny links-->
<!--Publications-->
<!--R Documentation-->
<!--Wikipedia Links-->
<!--Misc. Links-->
<!--chapter:end:034_workflows.Rmd-->
</div>
<div id="part-get-data-from-the-web" class="section level1 unnumbered">
<h1>(PART) Get data from the web</h1>
</div>
<div id="web-data-slides" class="section level1">
<h1><span class="header-section-number">38</span> Slides</h1>
<!--Original content: https://stat545.com/webdata01_slides.html-->
<p>See <a href="supporting-docs/webdata01_slides.html">“Getting data from the web - R packages” slides</a> by Andrew MacDonald.</p>
<!--chapter:end:035_get-data-from-web.Rmd-->
</div>
<div id="api-wrappers" class="section level1">
<h1><span class="header-section-number">39</span> Use API-wrapping packages</h1>
<!--Original content: https://stat545.com/webdata02_activity.html-->
<!--Original author: Andrew MacDonald-->
<div id="introduction" class="section level2">
<h2><span class="header-section-number">39.1</span> Introduction</h2>
<p><strong>All this and more is described at the <a href="https://github.com/ropensci/webservices">rOpenSci repository of R tools for interacting with the internet</a>.</strong></p>
<p>There are many ways to obtain data from the internet; let’s consider four categories:</p>
<ul>
<li><em>Click-and-download</em> - on the internet as a “flat” file, such as CSV, XLS.</li>
<li><em>Install-and-play</em> - an API for which someone has written a handy R package.</li>
<li><em>API-query</em> - published with an unwrapped API.</li>
<li><em>Scraping</em> - implicit in an HTML website.</li>
</ul>
</div>
<div id="click-and-download" class="section level2">
<h2><span class="header-section-number">39.2</span> Click-and-Download</h2>
<p>In the simplest case, the data you need is already on the internet in a tabular format. There are a couple of strategies here:</p>
<ul>
<li>Use <code>read.csv</code> or <code>readr::read_csv</code> to read the data straight into R.</li>
<li>Use the command line program <code>curl</code> to do that work, and place it in a <code>Makefile</code> or shell script (see the <a href="#automation-overview">section on <code>make</code></a> for more on this).</li>
</ul>
<p>The second case is most useful when the data you want has been provided in a format that needs cleanup. For example, the World Value Survey makes several datasets available as Excel sheets. The safest option here is to download the <code>.xls</code> file, then read it into R with <code>readxl::read_excel()</code> or something similar. An exception to this is data provided as Google Spreadsheets, which can be read straight into R using the <a href="https://github.com/jennybc/googlesheets"><code>googlesheets</code></a> package.</p>
<div id="from-ropensci-web-services-page" class="section level3">
<h3><span class="header-section-number">39.2.1</span> From rOpenSci web services page:</h3>
<p>From rOpenSci’s <a href="https://github.com/ropensci/webservices">CRAN Task View: Web Technologies and Services</a>:</p>
<ul>
<li><code>downloader::download()</code> for SSL.</li>
<li><code>curl::curl()</code> for SSL.</li>
<li><code>httr::GET</code> data read this way needs to be parsed later with <code>read.table()</code>.</li>
<li><code>rio::import()</code> can “read a number of common data formats directly from an <code>https://</code> URL”. Isn’t that very similar to the previous?</li>
</ul>
<p>What about packages that install data?</p>
</div>
</div>
<div id="data-supplied-on-the-web" class="section level2">
<h2><span class="header-section-number">39.3</span> Data supplied on the web</h2>
<p>Many times, the data that you want is not already organized into one or a few tables that you can read directly into R. More frequently, you find this data is given in the form of an API. <strong>A</strong>pplication <strong>P</strong>rogramming <strong>I</strong>nterfaces (APIs) are descriptions of the kind of requests that can be made of a certain piece of software, and descriptions of the kind of answers that are returned.</p>
<p>Many sources of data – databases, websites, services – have made all (or part) of their data available via APIs over the internet. Computer programs (“clients”) can make requests of the server, and the server will respond by sending data (or an error message). This client can be many kinds of other programs or websites, including R running from your laptop.</p>
</div>
<div id="install-and-play" class="section level2">
<h2><span class="header-section-number">39.4</span> Install-and-play</h2>
<p>Many common web services and APIs have been “wrapped”, i.e. R functions have been written around them which send your query to the server and format the response.</p>
<p>Why would we want this?</p>
<ul>
<li>Provenance</li>
<li>Reproducible</li>
<li>Updating</li>
<li>Ease</li>
<li>Scaling</li>
</ul>
<div id="load-the-tidyverse-1" class="section level3">
<h3><span class="header-section-number">39.4.1</span> Load the tidyverse</h3>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb367-1"><a href="#cb367-1"></a><span class="kw">library</span>(tidyverse)</span></code></pre></div>
</div>
<div id="sightings-of-birds-rebird" class="section level3">
<h3><span class="header-section-number">39.4.2</span> Sightings of birds: rebird</h3>
<p><a href="https://github.com/ropensci/rebird">rebird</a> is an R interface for the <a href="http://ebird.org/content/ebird/">eBird</a> database. eBird lets birders upload sightings of birds, and allows everyone access to those data. rebird is on CRAN.</p>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb368-1"><a href="#cb368-1"></a><span class="co"># install.packages(&quot;rebird&quot;)</span></span>
<span id="cb368-2"><a href="#cb368-2"></a><span class="kw">library</span>(rebird)</span></code></pre></div>
<div id="search-birds-by-geography" class="section level4">
<h4><span class="header-section-number">39.4.2.1</span> Search birds by geography</h4>
<p>The eBird website categorizes some popular locations as “Hotspots”. These are areas where there are both lots of birds and lots of birders. One such location is at Iona Island, near Vancouver. You can see data for this Hotspot at <a href="http://ebird.org/ebird/hotspot/L261851">http://ebird.org/ebird/hotspot/L261851</a>.</p>
<p>At that link, you will see a page like this:</p>
<div class="figure">
<img src="img/Iona_island.png" alt="Iona Island" width="80%" />
<p class="caption">
(#fig:ebird-iona-island)Iona Island
</p>
</div>
<p>The data already looks to be organized in a data frame! rebird allows us to read these data directly into R (the ID code for Iona Island is <strong>“L261851”</strong>).</p>
<!--TODO: The following chunks are broken; ebird now requires an API key.-->
<div class="sourceCode" id="cb369"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb369-1"><a href="#cb369-1"></a><span class="kw">ebirdhotspot</span>(<span class="dt">locID =</span> <span class="st">&quot;L261851&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb369-2"><a href="#cb369-2"></a><span class="st">  </span><span class="kw">head</span>() <span class="op">%&gt;%</span></span>
<span id="cb369-3"><a href="#cb369-3"></a><span class="st">  </span><span class="kw">kable</span>()</span></code></pre></div>
<p>We can use the function <code>ebirdgeo()</code> to get a list for an area (note that South and West are negative):</p>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb370-1"><a href="#cb370-1"></a>vanbirds &lt;-<span class="st"> </span><span class="kw">ebirdgeo</span>(<span class="dt">lat =</span> <span class="fl">49.2500</span>, <span class="dt">lng =</span> <span class="fl">-123.1000</span>)</span>
<span id="cb370-2"><a href="#cb370-2"></a>vanbirds <span class="op">%&gt;%</span></span>
<span id="cb370-3"><a href="#cb370-3"></a><span class="st">  </span><span class="kw">head</span>() <span class="op">%&gt;%</span></span>
<span id="cb370-4"><a href="#cb370-4"></a><span class="st">  </span><span class="kw">kable</span>()</span></code></pre></div>
<p><strong>Note</strong>: Check the defaults on this function (e.g. radius of circle, time of year).</p>
<p>We can also search by “region”, which refers to short codes which serve as common shorthands for different political units. For example, France is represented by the letters <strong>FR</strong>.</p>
<div class="sourceCode" id="cb371"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb371-1"><a href="#cb371-1"></a>frenchbirds &lt;-<span class="st"> </span><span class="kw">ebirdregion</span>(<span class="st">&quot;FR&quot;</span>)</span>
<span id="cb371-2"><a href="#cb371-2"></a>frenchbirds <span class="op">%&gt;%</span></span>
<span id="cb371-3"><a href="#cb371-3"></a><span class="st">  </span><span class="kw">head</span>() <span class="op">%&gt;%</span></span>
<span id="cb371-4"><a href="#cb371-4"></a><span class="st">  </span><span class="kw">kable</span>()</span></code></pre></div>
<p>Find out <em>when</em> a bird has been seen in a certain place! Choosing a name from <code>vanbirds</code> above (the Bald Eagle):</p>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb372-1"><a href="#cb372-1"></a>eagle &lt;-<span class="st"> </span><span class="kw">ebirdgeo</span>(<span class="dt">species =</span> <span class="st">&#39;Haliaeetus leucocephalus&#39;</span>, <span class="dt">lat =</span> <span class="dv">42</span>, <span class="dt">lng =</span> <span class="dv">-76</span>)</span>
<span id="cb372-2"><a href="#cb372-2"></a>eagle <span class="op">%&gt;%</span></span>
<span id="cb372-3"><a href="#cb372-3"></a><span class="st">  </span><span class="kw">head</span>() <span class="op">%&gt;%</span></span>
<span id="cb372-4"><a href="#cb372-4"></a><span class="st">  </span><span class="kw">kable</span>()</span></code></pre></div>
<p>rebird <strong>knows where you are</strong>:</p>
<div class="sourceCode" id="cb373"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb373-1"><a href="#cb373-1"></a><span class="kw">ebirdgeo</span>(<span class="dt">species =</span> <span class="st">&#39;Buteo lagopus&#39;</span>)</span></code></pre></div>
</div>
</div>
<div id="geonames" class="section level3">
<h3><span class="header-section-number">39.4.3</span> Searching geographic info: geonames</h3>
<p><a href="https://ropensci.org">rOpenSci</a> has a package called <a href="https://docs.ropensci.org/geonames/">geonames</a> for accessing the <a href="https://www.geonames.org">GeoNames API</a>. First, install the geonames package from CRAN and load it.</p>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb374-1"><a href="#cb374-1"></a><span class="co"># install.packages(&quot;geonames&quot;)</span></span>
<span id="cb374-2"><a href="#cb374-2"></a><span class="kw">library</span>(geonames)</span></code></pre></div>
<p>The <a href="https://docs.ropensci.org/geonames/">geonames package website</a> tells us that there are a few things we need to do before we can use geonames to access the GeoNames API:</p>
<ol style="list-style-type: decimal">
<li>Go to <a href="https://www.geonames.org/login">the GeoNames site</a> and create a new user account.</li>
<li>Check your email and follow the instructions to activate your account.</li>
<li>Click [here] to enable the free web services for your account (Note! You must be logged into your GeoNames account already for the link to work).</li>
<li>Tell R your GeoNames username.</li>
</ol>
<p>To do the last step, we could run this line in R…</p>
<div class="sourceCode" id="cb375"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb375-1"><a href="#cb375-1"></a><span class="kw">options</span>(<span class="dt">geonamesUsername=</span><span class="st">&quot;my_user_name&quot;</span>)</span></code></pre></div>
<p>…but this is insecure. We don’t want to risk committing this line and pushing it to our public GitHub page!</p>
<p>Instead, we can add this line to our <code>.Rprofile</code> so it will be hidden. One way to edit your <code>.Rprofile</code> is with the helper function <code>edit_r_profile()</code> from the <a href="https://usethis.r-lib.org">usethis</a> package. Install/load the usethis package and run <code>edit_r_profile()</code> in the R Console:</p>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb376-1"><a href="#cb376-1"></a><span class="co"># install.packages(&quot;usethis&quot;)</span></span>
<span id="cb376-2"><a href="#cb376-2"></a><span class="kw">library</span>(usethis)</span>
<span id="cb376-3"><a href="#cb376-3"></a><span class="kw">edit_r_profile</span>()</span></code></pre></div>
<p>This will open up your <code>.Rprofile</code> file. Add <code>options(geonamesUsername="my_user_name")</code> on a new line (replace “my_user_name” with your GeoNames username).</p>
<p><strong>Important</strong>: Make sure your <code>.Rprofile</code> ends with a blank line!</p>
<p>Save the file, close it, and restart R. Now we’re ready to start using geonames to search the GeoNames API.</p>
<p>(Also see the <a href="https://happygitwithr.com/credential-caching.html">Cache credentials for HTTPS</a> chapter of <a href="https://happygitwithr.com">Happy Git and GitHub for the useR</a>.)</p>
<div id="using-geonames" class="section level4">
<h4><span class="header-section-number">39.4.3.1</span> Using GeoNames</h4>
<p>What can we do? We can get access to lots of geographical information via the various <a href="http://www.geonames.org/export/ws-overview.html">GeoNames WebServices</a>.</p>
<div class="sourceCode" id="cb377"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb377-1"><a href="#cb377-1"></a>countryInfo &lt;-<span class="st"> </span><span class="kw">GNcountryInfo</span>()</span></code></pre></div>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb378-1"><a href="#cb378-1"></a><span class="kw">glimpse</span>(countryInfo)</span></code></pre></div>
<p>This <code>countryInfo</code> dataset is very helpful for accessing the rest of the data because it gives us the standardized codes for country and language.</p>
</div>
<div id="remixing-geonames-and-rebird" class="section level4">
<h4><span class="header-section-number">39.4.3.2</span> Remixing geonames and rebird:</h4>
<p>What are the cities of France?</p>
<div class="sourceCode" id="cb379"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb379-1"><a href="#cb379-1"></a>francedata &lt;-<span class="st"> </span>countryInfo <span class="op">%&gt;%</span></span>
<span id="cb379-2"><a href="#cb379-2"></a><span class="st">  </span><span class="kw">filter</span>(countryName <span class="op">==</span><span class="st"> &quot;France&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb380"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb380-1"><a href="#cb380-1"></a>frenchcities &lt;-<span class="st"> </span><span class="kw">with</span>(francedata, <span class="kw">GNcities</span>(<span class="dt">north =</span> north, <span class="dt">east =</span> east, </span>
<span id="cb380-2"><a href="#cb380-2"></a>                                          <span class="dt">south =</span> south, <span class="dt">west =</span> west, </span>
<span id="cb380-3"><a href="#cb380-3"></a>                                          <span class="dt">maxRows =</span> <span class="dv">500</span>))</span></code></pre></div>
<div class="sourceCode" id="cb381"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb381-1"><a href="#cb381-1"></a><span class="kw">glimpse</span>(frenchcities)</span></code></pre></div>
</div>
</div>
<div id="wikipedia-searching" class="section level3">
<h3><span class="header-section-number">39.4.4</span> Wikipedia searching</h3>
<p>We can use geonames to search for georeferenced Wikipedia articles. Here are those within 20 km of Rio de Janerio, comparing results for English-language Wikipedia (<code>lang = "en"</code>) and Portuguese-language Wikipedia (<code>lang = "pt"</code>):</p>
<div class="sourceCode" id="cb382"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb382-1"><a href="#cb382-1"></a>rio_english &lt;-<span class="st"> </span><span class="kw">GNfindNearbyWikipedia</span>(<span class="dt">lat =</span> <span class="fl">-22.9083</span>, <span class="dt">lng =</span> <span class="fl">-43.1964</span>,</span>
<span id="cb382-2"><a href="#cb382-2"></a>                                     <span class="dt">radius =</span> <span class="dv">20</span>, <span class="dt">lang =</span> <span class="st">&quot;en&quot;</span>, <span class="dt">maxRows =</span> <span class="dv">500</span>)</span>
<span id="cb382-3"><a href="#cb382-3"></a>rio_portuguese &lt;-<span class="st"> </span><span class="kw">GNfindNearbyWikipedia</span>(<span class="dt">lat =</span> <span class="fl">-22.9083</span>, <span class="dt">lng =</span> <span class="fl">-43.1964</span>,</span>
<span id="cb382-4"><a href="#cb382-4"></a>                                        <span class="dt">radius =</span> <span class="dv">20</span>, <span class="dt">lang =</span> <span class="st">&quot;pt&quot;</span>, <span class="dt">maxRows =</span> <span class="dv">500</span>)</span></code></pre></div>
<div class="sourceCode" id="cb383"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb383-1"><a href="#cb383-1"></a><span class="kw">nrow</span>(rio_english)</span>
<span id="cb383-2"><a href="#cb383-2"></a><span class="kw">nrow</span>(rio_portuguese)</span></code></pre></div>
</div>
<div id="plos-one" class="section level3">
<h3><span class="header-section-number">39.4.5</span> Searching the Public Library of Science: rplos</h3>
<p><a href="https://journals.plos.org/plosone/">PLOS ONE</a> is an open-access journal. They allow access to an impressive range of search tools, and allow you to obtain the full text of their articles. rOpenSci has a package called rplos that we can use to interact with the <a href="http://api.plos.org">PLOS API</a>. They have a nice tutorial on the rOpenSci website that you can see <a href="https://ropensci.org/tutorials/rplos_tutorial.html">here</a>. First, install/load the rplos package from CRAN.</p>
<div class="sourceCode" id="cb384"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb384-1"><a href="#cb384-1"></a><span class="co"># install.packages(&quot;rplos&quot;)</span></span>
<span id="cb384-2"><a href="#cb384-2"></a><span class="kw">library</span>(rplos)</span></code></pre></div>
<div id="searching-plos-one" class="section level4">
<h4><span class="header-section-number">39.4.5.1</span> Searching PLOS ONE</h4>
<p>Let’s follow along with the <a href="https://ropensci.org/tutorials/rplos_tutorial.html"><code>rOpenSci</code> tutorial</a> and do some searches:</p>
<div class="sourceCode" id="cb385"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb385-1"><a href="#cb385-1"></a><span class="kw">searchplos</span>(<span class="dt">q=</span> <span class="st">&quot;Helianthus&quot;</span>, <span class="dt">fl=</span> <span class="st">&quot;id&quot;</span>, <span class="dt">limit =</span> <span class="dv">5</span>)</span>
<span id="cb385-2"><a href="#cb385-2"></a><span class="co">#&gt; $meta</span></span>
<span id="cb385-3"><a href="#cb385-3"></a><span class="co">#&gt; # A tibble: 1 x 2</span></span>
<span id="cb385-4"><a href="#cb385-4"></a><span class="co">#&gt;   numFound start</span></span>
<span id="cb385-5"><a href="#cb385-5"></a><span class="co">#&gt;      &lt;int&gt; &lt;int&gt;</span></span>
<span id="cb385-6"><a href="#cb385-6"></a><span class="co">#&gt; 1      642     0</span></span>
<span id="cb385-7"><a href="#cb385-7"></a><span class="co">#&gt; </span></span>
<span id="cb385-8"><a href="#cb385-8"></a><span class="co">#&gt; $data</span></span>
<span id="cb385-9"><a href="#cb385-9"></a><span class="co">#&gt; # A tibble: 5 x 1</span></span>
<span id="cb385-10"><a href="#cb385-10"></a><span class="co">#&gt;   id                          </span></span>
<span id="cb385-11"><a href="#cb385-11"></a><span class="co">#&gt;   &lt;chr&gt;                       </span></span>
<span id="cb385-12"><a href="#cb385-12"></a><span class="co">#&gt; 1 10.1371/journal.pone.0198869</span></span>
<span id="cb385-13"><a href="#cb385-13"></a><span class="co">#&gt; 2 10.1371/journal.pone.0213065</span></span>
<span id="cb385-14"><a href="#cb385-14"></a><span class="co">#&gt; 3 10.1371/journal.pone.0148280</span></span>
<span id="cb385-15"><a href="#cb385-15"></a><span class="co">#&gt; 4 10.1371/journal.pone.0111982</span></span>
<span id="cb385-16"><a href="#cb385-16"></a><span class="co">#&gt; 5 10.1371/journal.pone.0212371</span></span></code></pre></div>
<div class="sourceCode" id="cb386"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb386-1"><a href="#cb386-1"></a><span class="kw">searchplos</span>(<span class="st">&quot;materials_and_methods:France&quot;</span>, <span class="dt">fl =</span> <span class="st">&quot;title, materials_and_methods&quot;</span>)</span>
<span id="cb386-2"><a href="#cb386-2"></a><span class="co">#&gt; $meta</span></span>
<span id="cb386-3"><a href="#cb386-3"></a><span class="co">#&gt; # A tibble: 1 x 2</span></span>
<span id="cb386-4"><a href="#cb386-4"></a><span class="co">#&gt;   numFound start</span></span>
<span id="cb386-5"><a href="#cb386-5"></a><span class="co">#&gt;      &lt;int&gt; &lt;int&gt;</span></span>
<span id="cb386-6"><a href="#cb386-6"></a><span class="co">#&gt; 1    16091     0</span></span>
<span id="cb386-7"><a href="#cb386-7"></a><span class="co">#&gt; </span></span>
<span id="cb386-8"><a href="#cb386-8"></a><span class="co">#&gt; $data</span></span>
<span id="cb386-9"><a href="#cb386-9"></a><span class="co">#&gt; # A tibble: 10 x 2</span></span>
<span id="cb386-10"><a href="#cb386-10"></a><span class="co">#&gt;    title                               materials_and_methods                    </span></span>
<span id="cb386-11"><a href="#cb386-11"></a><span class="co">#&gt;    &lt;chr&gt;                               &lt;chr&gt;                                    </span></span>
<span id="cb386-12"><a href="#cb386-12"></a><span class="co">#&gt;  1 Borna Disease Virus Phosphoprotein~ &quot;\nEthics statement\nHuman fetuses were ~</span></span>
<span id="cb386-13"><a href="#cb386-13"></a><span class="co">#&gt;  2 Population Structure in Naegleria ~ &quot;\nSampling\nThe 47 N. fowleri strains a~</span></span>
<span id="cb386-14"><a href="#cb386-14"></a><span class="co">#&gt;  3 Prevalent hepatitis B surface anti~ &quot;\nStudy site\nThe study was carried out~</span></span>
<span id="cb386-15"><a href="#cb386-15"></a><span class="co">#&gt;  4 The Plasminogen Activation System ~ &quot;\n        Differentiation of ESCs\n    ~</span></span>
<span id="cb386-16"><a href="#cb386-16"></a><span class="co">#&gt;  5 Human Neural Cells Transiently Exp~ &quot;\nBiological samples\nTwelve human embr~</span></span>
<span id="cb386-17"><a href="#cb386-17"></a><span class="co">#&gt;  6 Immunity Traits in Pigs: Substanti~ &quot;\n        Ethics Statement\n        Our~</span></span>
<span id="cb386-18"><a href="#cb386-18"></a><span class="co">#&gt;  7 Different Oxidative Stress Respons~ &quot;\n         Ethics Statement\n         N~</span></span>
<span id="cb386-19"><a href="#cb386-19"></a><span class="co">#&gt;  8 Immunomodulation Stimulates the In~ &quot;\nAnimals and tissues\nAll procedures w~</span></span>
<span id="cb386-20"><a href="#cb386-20"></a><span class="co">#&gt;  9 Neonatal Hyperglycemia Inhibits An~ &quot;\nEthics\nAll experimental protocols an~</span></span>
<span id="cb386-21"><a href="#cb386-21"></a><span class="co">#&gt; 10 Identification of pOENI-1 and Rela~ &quot;\n        Bacteria strains and culture ~</span></span></code></pre></div>
<div class="sourceCode" id="cb387"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb387-1"><a href="#cb387-1"></a><span class="kw">searchplos</span>(<span class="st">&quot;materials_and_methods:study site&quot;</span>, <span class="dt">fl =</span> <span class="st">&quot;title, materials_and_methods&quot;</span>)</span>
<span id="cb387-2"><a href="#cb387-2"></a><span class="co">#&gt; $meta</span></span>
<span id="cb387-3"><a href="#cb387-3"></a><span class="co">#&gt; # A tibble: 1 x 2</span></span>
<span id="cb387-4"><a href="#cb387-4"></a><span class="co">#&gt;   numFound start</span></span>
<span id="cb387-5"><a href="#cb387-5"></a><span class="co">#&gt;      &lt;int&gt; &lt;int&gt;</span></span>
<span id="cb387-6"><a href="#cb387-6"></a><span class="co">#&gt; 1   112212     0</span></span>
<span id="cb387-7"><a href="#cb387-7"></a><span class="co">#&gt; </span></span>
<span id="cb387-8"><a href="#cb387-8"></a><span class="co">#&gt; $data</span></span>
<span id="cb387-9"><a href="#cb387-9"></a><span class="co">#&gt; # A tibble: 10 x 2</span></span>
<span id="cb387-10"><a href="#cb387-10"></a><span class="co">#&gt;    title                               materials_and_methods                    </span></span>
<span id="cb387-11"><a href="#cb387-11"></a><span class="co">#&gt;    &lt;chr&gt;                               &lt;chr&gt;                                    </span></span>
<span id="cb387-12"><a href="#cb387-12"></a><span class="co">#&gt;  1 Whi5 Regulation by Site Specific C~ &quot;\nYeast Culture and Strains\nCells were~</span></span>
<span id="cb387-13"><a href="#cb387-13"></a><span class="co">#&gt;  2 Remote Source Document Verificatio~ &quot;Two NIH-sponsored clinical trial networ~</span></span>
<span id="cb387-14"><a href="#cb387-14"></a><span class="co">#&gt;  3 Variance Component Analysis of a M~ &quot;\n1) The study\nAddona et al. [6] condu~</span></span>
<span id="cb387-15"><a href="#cb387-15"></a><span class="co">#&gt;  4 Obtaining Valid Laboratory Data in~ &quot;The study was a randomised, double-blin~</span></span>
<span id="cb387-16"><a href="#cb387-16"></a><span class="co">#&gt;  5 Transposable Prophage Mu Is Organi~ &quot;\nStrain construction\nAll strains used~</span></span>
<span id="cb387-17"><a href="#cb387-17"></a><span class="co">#&gt;  6 Effects of land-use change and rel~ &quot;\nBiodiversity data and species status\~</span></span>
<span id="cb387-18"><a href="#cb387-18"></a><span class="co">#&gt;  7 Structural and functional dissecti~ &quot;\nBacterial strains and culture conditi~</span></span>
<span id="cb387-19"><a href="#cb387-19"></a><span class="co">#&gt;  8 Retention in Care and Outpatient C~ &quot;\nEthics Statement\nThe Boston Universi~</span></span>
<span id="cb387-20"><a href="#cb387-20"></a><span class="co">#&gt;  9 Global migration of clinical resea~ &quot;\nPrimary data source\nOur primary data~</span></span>
<span id="cb387-21"><a href="#cb387-21"></a><span class="co">#&gt; 10 Risk of Injection-Site Abscess amo~ &quot;\nStudy Sites\nThe VAEIK study is a Pha~</span></span></code></pre></div>
<div class="sourceCode" id="cb388"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb388-1"><a href="#cb388-1"></a><span class="kw">searchplos</span>(<span class="st">&quot;*:*&quot;</span>, <span class="dt">fl =</span> <span class="st">&quot;id&quot;</span>)</span>
<span id="cb388-2"><a href="#cb388-2"></a><span class="co">#&gt; $meta</span></span>
<span id="cb388-3"><a href="#cb388-3"></a><span class="co">#&gt; # A tibble: 1 x 2</span></span>
<span id="cb388-4"><a href="#cb388-4"></a><span class="co">#&gt;   numFound start</span></span>
<span id="cb388-5"><a href="#cb388-5"></a><span class="co">#&gt;      &lt;int&gt; &lt;int&gt;</span></span>
<span id="cb388-6"><a href="#cb388-6"></a><span class="co">#&gt; 1  2469527     0</span></span>
<span id="cb388-7"><a href="#cb388-7"></a><span class="co">#&gt; </span></span>
<span id="cb388-8"><a href="#cb388-8"></a><span class="co">#&gt; $data</span></span>
<span id="cb388-9"><a href="#cb388-9"></a><span class="co">#&gt; # A tibble: 10 x 1</span></span>
<span id="cb388-10"><a href="#cb388-10"></a><span class="co">#&gt;    id                                                 </span></span>
<span id="cb388-11"><a href="#cb388-11"></a><span class="co">#&gt;    &lt;chr&gt;                                              </span></span>
<span id="cb388-12"><a href="#cb388-12"></a><span class="co">#&gt;  1 10.1371/journal.pbio.1000146/title                 </span></span>
<span id="cb388-13"><a href="#cb388-13"></a><span class="co">#&gt;  2 10.1371/journal.pbio.1000146/abstract              </span></span>
<span id="cb388-14"><a href="#cb388-14"></a><span class="co">#&gt;  3 10.1371/journal.pbio.1000146/references            </span></span>
<span id="cb388-15"><a href="#cb388-15"></a><span class="co">#&gt;  4 10.1371/journal.pbio.1000146/body                  </span></span>
<span id="cb388-16"><a href="#cb388-16"></a><span class="co">#&gt;  5 10.1371/journal.pbio.1000146/supporting_information</span></span>
<span id="cb388-17"><a href="#cb388-17"></a><span class="co">#&gt;  6 10.1371/journal.pbio.1000146/conclusions           </span></span>
<span id="cb388-18"><a href="#cb388-18"></a><span class="co">#&gt;  7 10.1371/journal.pbio.1000147/title                 </span></span>
<span id="cb388-19"><a href="#cb388-19"></a><span class="co">#&gt;  8 10.1371/journal.pbio.1000147/abstract              </span></span>
<span id="cb388-20"><a href="#cb388-20"></a><span class="co">#&gt;  9 10.1371/journal.pbio.1000147/references            </span></span>
<span id="cb388-21"><a href="#cb388-21"></a><span class="co">#&gt; 10 10.1371/journal.pbio.1000147/body</span></span></code></pre></div>
<p>Here is a list of <a href="http://api.plos.org/solr/search-fields/">options for the search</a> or you can run <code>data(plosfields)</code> followed by <code>plosfields</code> in the R Console.</p>
</div>
<div id="take-a-highbrow-look" class="section level4">
<h4><span class="header-section-number">39.4.5.2</span> Take a highbrow look!</h4>
<p>The <code>highplos()</code> function does “highlighted searches on PLOS Journals full-text content”.</p>
<div class="sourceCode" id="cb389"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb389-1"><a href="#cb389-1"></a>highlighted &lt;-<span class="st"> </span><span class="kw">highplos</span>(<span class="dt">q=</span><span class="st">&#39;alcohol&#39;</span>, <span class="dt">hl.fl =</span> <span class="st">&#39;abstract&#39;</span>, <span class="dt">rows=</span><span class="dv">10</span>)</span></code></pre></div>
<p>We can then pass this output to <code>highbrow()</code>, which will open up our default browser where we can browse the highlighted fragments. When we run <code>highbrow(highlighted)</code> in our R Console this is what we see in our browser:</p>
<div class="figure">
<img src="img/rplos-highbrow.png" alt="Example rplos highlights" width="100%" />
<p class="caption">
(#fig:unnamed-chunk-24)Example rplos highlights
</p>
</div>
</div>
<div id="plots-over-time" class="section level4">
<h4><span class="header-section-number">39.4.5.3</span> Plots over time</h4>
<p>We can use the <code>plot_throughtime()</code> function to visualize the results of a search over time.</p>
<div class="sourceCode" id="cb390"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb390-1"><a href="#cb390-1"></a><span class="kw">plot_throughtime</span>(<span class="dt">terms =</span> <span class="st">&quot;phylogeny&quot;</span>, <span class="dt">limit =</span> <span class="dv">200</span>)</span></code></pre></div>
<p><img src="036_api-wrappers_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
</div>
</div>
<div id="is-it-a-boy-or-a-girl-gender-associated-names-throughout-us-history" class="section level3">
<h3><span class="header-section-number">39.4.6</span> Is it a boy or a girl? gender-associated names throughout US history</h3>
<p>The gender package allows you access to data on the gender of names in the US. Because names change gender over the years, the probability of a name belonging to a man or a woman also depends on the <em>year</em>.</p>
<p>First, install/load the gender package from CRAN. You may be prompted to also install the companion package, genderdata. Go ahead and say yes. If you don’t see this message no need to worry, it is a one-time install.</p>
<div class="sourceCode" id="cb391"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb391-1"><a href="#cb391-1"></a><span class="co"># install.packages(&quot;gender&quot;)</span></span>
<span id="cb391-2"><a href="#cb391-2"></a><span class="kw">library</span>(gender)</span>
<span id="cb391-3"><a href="#cb391-3"></a><span class="co">#&gt; PLEASE </span><span class="al">NOTE</span><span class="co">: The method provided by this package must be used cautiously</span></span>
<span id="cb391-4"><a href="#cb391-4"></a><span class="co">#&gt; and responsibly. Please be sure to see the guidelines and warnings about</span></span>
<span id="cb391-5"><a href="#cb391-5"></a><span class="co">#&gt; usage in the README or the package documentation.</span></span></code></pre></div>
<p>Let’s do some searches for the name Kelsey.</p>
<div class="sourceCode" id="cb392"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb392-1"><a href="#cb392-1"></a><span class="kw">gender</span>(<span class="st">&quot;Kelsey&quot;</span>)</span>
<span id="cb392-2"><a href="#cb392-2"></a><span class="co">#&gt; # A tibble: 1 x 6</span></span>
<span id="cb392-3"><a href="#cb392-3"></a><span class="co">#&gt;   name   proportion_male proportion_female gender year_min year_max</span></span>
<span id="cb392-4"><a href="#cb392-4"></a><span class="co">#&gt;   &lt;chr&gt;            &lt;dbl&gt;             &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span id="cb392-5"><a href="#cb392-5"></a><span class="co">#&gt; 1 Kelsey          0.0314             0.969 female     1932     2012</span></span>
<span id="cb392-6"><a href="#cb392-6"></a><span class="kw">gender</span>(<span class="st">&quot;Kelsey&quot;</span>, <span class="dt">years =</span> <span class="dv">1940</span>)</span>
<span id="cb392-7"><a href="#cb392-7"></a><span class="co">#&gt; # A tibble: 1 x 6</span></span>
<span id="cb392-8"><a href="#cb392-8"></a><span class="co">#&gt;   name   proportion_male proportion_female gender year_min year_max</span></span>
<span id="cb392-9"><a href="#cb392-9"></a><span class="co">#&gt;   &lt;chr&gt;            &lt;dbl&gt;             &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span id="cb392-10"><a href="#cb392-10"></a><span class="co">#&gt; 1 Kelsey               1                 0 male       1940     1940</span></span></code></pre></div>
<!--RStudio Links-->
<!--HappyGitWithR Links-->
<!--Package Links-->
<!--Shiny links-->
<!--Publications-->
<!--R Documentation-->
<!--Wikipedia Links-->
<!--Misc. Links-->
<!--chapter:end:036_api-wrappers.Rmd-->
</div>
</div>
</div>
<div id="diy-web-data" class="section level1">
<h1><span class="header-section-number">40</span> DIY web data</h1>
<pre><code>No OMDb key available. Code chunks will not be evaluated.</code></pre>
<!--Original content: https://stat545.com/webdata03_activity.html-->
<!--Original author: Andrew MacDonald-->
<div id="interacting-with-an-api" class="section level2">
<h2><span class="header-section-number">40.1</span> Interacting with an API</h2>
<p>In Chapter @ref(api-wrappers) we experimented with several packages that “wrapped” APIs. That is, they handled the creation of the request and the formatting of the output. In this chapter we’re going to look at (part of) what these functions were doing.</p>
<div id="load-the-tidyverse-2" class="section level3">
<h3><span class="header-section-number">40.1.1</span> Load the tidyverse</h3>
<p>We will be using the functions from the <a href="https://www.tidyverse.org">tidyverse</a> throughout this chapter, so go ahead and load tidyverse package now.</p>
<div class="sourceCode" id="cb394"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb394-1"><a href="#cb394-1"></a><span class="kw">library</span>(tidyverse)</span></code></pre></div>
</div>
<div id="examine-the-structure-of-api-requests-using-the-open-movie-database" class="section level3">
<h3><span class="header-section-number">40.1.2</span> Examine the structure of API requests using the Open Movie Database</h3>
<p>First we’re going to examine the structure of API requests via the <a href="http://www.omdbapi.com/">Open Movie Database</a> (OMDb). OMDb is very similar to IMDb, except it has a nice, simple API. We can go to the website, input some search parameters, and obtain both the XML query and the response from it.</p>
<!--TODO: Will frequently get an "Error: Daily request limit reached" message when using the demo. Seems to be an issue on their end: https://github.com/omdbapi/OMDb-API/issues/124 Maybe remove this exercise from the chapter to avoid problems?-->
<p><strong>Exercise:</strong> determine the shape of an API request. Scroll down to the <a href="http://www.omdbapi.com/#examples">“Examples” section</a> on the OMDb site and play around with the parameters. Take a look at the resulting API call and the query you get back.</p>
<p>If we enter the following parameters:</p>
<ul>
<li><code>title = Interstellar</code>,</li>
<li><code>year = 2014</code>,</li>
<li><code>plot = full</code>,</li>
<li><code>response = JSON</code></li>
</ul>
<p>Here is what we see:</p>
<p>The request URL is:</p>
<pre class="http"><code>http://www.omdbapi.com/?t=Interstellar&amp;y=2014&amp;plot=full</code></pre>
<p>Notice the pattern in the request. Let’s try changing the response field from JSON to XML.</p>
<p>Now the request URL is:</p>
<pre class="http"><code>http://www.omdbapi.com/?t=Interstellar&amp;y=2014&amp;plot=full&amp;r=xml</code></pre>
<p>Try pasting these URLs into your browser. You should see this if you tried the first URL:</p>
<div class="sourceCode" id="cb397"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb397-1"><a href="#cb397-1"></a><span class="fu">{</span><span class="dt">&quot;Response&quot;</span><span class="fu">:</span><span class="st">&quot;False&quot;</span><span class="fu">,</span><span class="dt">&quot;Error&quot;</span><span class="fu">:</span><span class="st">&quot;No API key provided.&quot;</span><span class="fu">}</span></span></code></pre></div>
<p>…and this if you tried the second URL (where <code>r=xml</code>):</p>
<div class="sourceCode" id="cb398"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb398-1"><a href="#cb398-1"></a><span class="kw">&lt;root</span><span class="ot"> response=</span><span class="st">&quot;False&quot;</span><span class="kw">&gt;</span></span>
<span id="cb398-2"><a href="#cb398-2"></a>  <span class="kw">&lt;error&gt;</span>No API key provided.<span class="kw">&lt;/error&gt;</span></span>
<span id="cb398-3"><a href="#cb398-3"></a><span class="kw">&lt;/root&gt;</span></span></code></pre></div>
</div>
<div id="create-an-omdb-api-key" class="section level3">
<h3><span class="header-section-number">40.1.3</span> Create an OMDb API Key</h3>
<p>This tells us that we need an API key to access the OMDb API. We will store our key for the OMDb API in our <code>.Renviron</code> file using the helper function <code>edit_r_environ()</code> from the <a href="https://usethis.r-lib.org">usethis</a> package. Follow these steps:</p>
<ol style="list-style-type: decimal">
<li><p>Visit this URL and request your free API key: <a href="https://www.omdbapi.com/apikey.aspx" class="uri">https://www.omdbapi.com/apikey.aspx</a></p></li>
<li><p>Check your email and follow the instructions to activate your key.</p></li>
<li><p>Install/load the usethis package and run <code>edit_r_environ()</code> in the R Console:</p>
<div class="sourceCode" id="cb399"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb399-1"><a href="#cb399-1"></a><span class="co"># install.packages(&quot;usethis&quot;)</span></span>
<span id="cb399-2"><a href="#cb399-2"></a><span class="kw">library</span>(usethis)</span>
<span id="cb399-3"><a href="#cb399-3"></a><span class="kw">edit_r_environ</span>()</span></code></pre></div></li>
<li><p>Add <code>OMDB_API_KEY=&lt;your-secret-key&gt;</code> on a new line, press enter to add a blank line at the end (important!), save the file, and close it.</p>
<ul>
<li>Note that we use <code>&lt;your-secret-key&gt;</code> as a placeholder here and throughout these instructions. Your actual API key will look something like: <code>p319s0aa</code> (no quotes or other characters like <code>&lt;</code> or <code>&gt;</code> should go on the right of the <code>=</code> sign).</li>
</ul></li>
<li><p>Restart R.</p></li>
<li><p>You can now access your OMDb API key from the R console and save it as an object:</p>
<div class="sourceCode" id="cb400"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb400-1"><a href="#cb400-1"></a><span class="kw">Sys.getenv</span>(<span class="st">&quot;OMDB_API_KEY&quot;</span>)</span></code></pre></div></li>
<li><p>We can use this to easily add our API key to the request URL. Let’s make this API key an object we can refer to as <code>movie_key</code>:</p>
<div class="sourceCode" id="cb401"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb401-1"><a href="#cb401-1"></a><span class="co"># save it as an object</span></span>
<span id="cb401-2"><a href="#cb401-2"></a>movie_key &lt;-<span class="st"> </span><span class="kw">Sys.getenv</span>(<span class="st">&quot;OMDB_API_KEY&quot;</span>)</span></code></pre></div></li>
</ol>
<div id="alternative-strategy-for-keeping-keys-.rprofile" class="section level4">
<h4><span class="header-section-number">40.1.3.1</span> Alternative strategy for keeping keys: <code>.Rprofile</code></h4>
<p><strong>Remember to protect your key! It is important for your privacy. You know, like a key.</strong></p>
<p>Now we follow the rOpenSci <a href="https://github.com/ropensci/rOpenSci/wiki/Installation-and-use-of-API-keys">tutorial on API keys</a>:</p>
<ul>
<li><strong><em>Add <code>.Rprofile</code> to your <code>.gitignore</code> !!</em></strong></li>
<li>Make a <code>.Rprofile</code> file (<a href="http://cran.r-project.org/bin/windows/rw-FAQ.html#What-are-HOME-and-working-directories_003f">windows tips</a>; <a href="http://cran.r-project.org/bin/macosx/RMacOSX-FAQ.html#The-R-Console">mac tips</a>).</li>
<li>Write the following in it:</li>
</ul>
<div class="sourceCode" id="cb402"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb402-1"><a href="#cb402-1"></a><span class="kw">options</span>(<span class="dt">OMBD_API_KEY =</span> <span class="st">&quot;YOUR_KEY&quot;</span>)</span></code></pre></div>
<ul>
<li>Restart R (i.e. reopen your RStudio project).</li>
</ul>
<p>This code adds another element to the list of options, which you can see by calling <code>options()</code>. Part of the work done by <code>rplos::searchplos()</code> and friends is to go and obtain the value of this option with the function <code>getOption("OMBD_API_KEY")</code>. This indicates two things:</p>
<ol style="list-style-type: decimal">
<li>Spelling is important when you set the option in your <code>.Rprofile</code></li>
<li>You can do a similar process for an arbitrary package or key. For example:</li>
</ol>
<div class="sourceCode" id="cb403"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb403-1"><a href="#cb403-1"></a><span class="co">## in .Rprofile</span></span>
<span id="cb403-2"><a href="#cb403-2"></a><span class="kw">options</span>(<span class="st">&quot;this_is_my_key&quot;</span> =<span class="st"> </span>XXXX)</span>
<span id="cb403-3"><a href="#cb403-3"></a><span class="co">## later, in the R script:</span></span>
<span id="cb403-4"><a href="#cb403-4"></a>key &lt;-<span class="st"> </span><span class="kw">getOption</span>(<span class="st">&quot;this_is_my_key&quot;</span>)</span></code></pre></div>
<p>This is a simple means to keep your keys private, especially if you are sharing the same authentication across several projects.</p>
</div>
<div id="a-few-timely-reminders-about-your-.rprofile" class="section level4">
<h4><span class="header-section-number">40.1.3.2</span> A few timely reminders about your <code>.Rprofile</code></h4>
<div class="sourceCode" id="cb404"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb404-1"><a href="#cb404-1"></a><span class="kw">print</span>(<span class="st">&quot;This is Andrew&#39;s Rprofile and you can&#39;t have it!&quot;</span>)</span>
<span id="cb404-2"><a href="#cb404-2"></a><span class="kw">options</span>(<span class="dt">OMBD_API_KEY =</span> <span class="st">&quot;XXXXXXXXX&quot;</span>)</span></code></pre></div>
<ul>
<li>It must end with a blank line!</li>
<li>It lives in the project’s working directory, i.e. the location of your <code>.Rproj</code>.</li>
<li>It must be gitignored.</li>
</ul>
<p>Remember that using <code>.Rprofile</code> makes your code un-reproducible. In this case, that is exactly what we want!</p>
</div>
</div>
<div id="recreate-the-request-url-in-r" class="section level3">
<h3><span class="header-section-number">40.1.4</span> Recreate the request URL in R</h3>
<p>How can we recreate the same request URLs in R? We could use the <a href="https://glue.tidyverse.org/"><code>glue</code> package</a> to paste together the base URL, parameter labels, and parameter values:</p>
<div class="sourceCode" id="cb405"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb405-1"><a href="#cb405-1"></a>request &lt;-<span class="st"> </span>glue<span class="op">::</span><span class="kw">glue</span>(<span class="st">&quot;http://www.omdbapi.com/?t=Interstellar&amp;y=2014&amp;plot=short&amp;r=xml&amp;apikey={movie_key}&quot;</span>)</span>
<span id="cb405-2"><a href="#cb405-2"></a>request</span></code></pre></div>
<p>This works, but it only works for movie titled <code>Interstellar</code> from 2014 where we want the short plot and the XML format. Let’s try to pull out more variables and paste them in with <code>glue</code>:</p>
<div class="sourceCode" id="cb406"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb406-1"><a href="#cb406-1"></a>glue<span class="op">::</span><span class="kw">glue</span>(<span class="st">&quot;http://www.omdbapi.com/?t={title}&amp;y={year}&amp;plot={plot}&amp;r={format}&amp;apikey={api_key}&quot;</span>,</span>
<span id="cb406-2"><a href="#cb406-2"></a>           <span class="dt">title =</span> <span class="st">&quot;Interstellar&quot;</span>,</span>
<span id="cb406-3"><a href="#cb406-3"></a>           <span class="dt">year =</span> <span class="st">&quot;2014&quot;</span>,</span>
<span id="cb406-4"><a href="#cb406-4"></a>           <span class="dt">plot =</span> <span class="st">&quot;short&quot;</span>,</span>
<span id="cb406-5"><a href="#cb406-5"></a>           <span class="dt">format =</span> <span class="st">&quot;xml&quot;</span>,</span>
<span id="cb406-6"><a href="#cb406-6"></a>           <span class="dt">api_key =</span> movie_key)</span></code></pre></div>
<p>We could go even further and make this into a function called <code>omdb()</code> that we can reuse more easily.</p>
<div class="sourceCode" id="cb407"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb407-1"><a href="#cb407-1"></a>omdb &lt;-<span class="st"> </span><span class="cf">function</span>(title, year, plot, format, api_key) {</span>
<span id="cb407-2"><a href="#cb407-2"></a>  glue<span class="op">::</span><span class="kw">glue</span>(<span class="st">&quot;http://www.omdbapi.com/?t={title}&amp;y={year}&amp;plot={plot}&amp;r={format}&amp;apikey={api_key}&quot;</span>)</span>
<span id="cb407-3"><a href="#cb407-3"></a>}</span></code></pre></div>
</div>
<div id="get-data-using-the-curl-package" class="section level3">
<h3><span class="header-section-number">40.1.5</span> Get data using the curl package</h3>
<p>Now we have a handy function that returns the API query. We can paste in the link, but we can also obtain data from within R using the <a href="https://CRAN.R-project.org/package=curl">curl</a> package. Install/load the curl package first.</p>
<div class="sourceCode" id="cb408"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb408-1"><a href="#cb408-1"></a><span class="co"># install.packages(&quot;curl&quot;)</span></span>
<span id="cb408-2"><a href="#cb408-2"></a><span class="kw">library</span>(curl)</span></code></pre></div>
<p>Using curl to get the data in XML format:</p>
<div class="sourceCode" id="cb409"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb409-1"><a href="#cb409-1"></a>request_xml &lt;-<span class="st"> </span><span class="kw">omdb</span>(<span class="dt">title =</span> <span class="st">&quot;Interstellar&quot;</span>, <span class="dt">year =</span> <span class="st">&quot;2014&quot;</span>, <span class="dt">plot =</span> <span class="st">&quot;short&quot;</span>, </span>
<span id="cb409-2"><a href="#cb409-2"></a>                    <span class="dt">format =</span> <span class="st">&quot;xml&quot;</span>, <span class="dt">api_key =</span> movie_key)</span>
<span id="cb409-3"><a href="#cb409-3"></a></span>
<span id="cb409-4"><a href="#cb409-4"></a>con &lt;-<span class="st">  </span><span class="kw">curl</span>(request_xml)</span>
<span id="cb409-5"><a href="#cb409-5"></a>answer_xml &lt;-<span class="st"> </span><span class="kw">readLines</span>(con, <span class="dt">warn =</span> <span class="ot">FALSE</span>)</span>
<span id="cb409-6"><a href="#cb409-6"></a><span class="kw">close</span>(con)</span>
<span id="cb409-7"><a href="#cb409-7"></a>answer_xml</span></code></pre></div>
<p>Using curl to get the data in JSON format:</p>
<div class="sourceCode" id="cb410"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb410-1"><a href="#cb410-1"></a>request_json &lt;-<span class="st"> </span><span class="kw">omdb</span>(<span class="dt">title =</span> <span class="st">&quot;Interstellar&quot;</span>, <span class="dt">year =</span> <span class="st">&quot;2014&quot;</span>, <span class="dt">plot =</span> <span class="st">&quot;short&quot;</span>, </span>
<span id="cb410-2"><a href="#cb410-2"></a>                     <span class="dt">format =</span> <span class="st">&quot;json&quot;</span>, <span class="dt">api_key =</span> movie_key)</span>
<span id="cb410-3"><a href="#cb410-3"></a></span>
<span id="cb410-4"><a href="#cb410-4"></a>con &lt;-<span class="st"> </span><span class="kw">curl</span>(request_json)</span>
<span id="cb410-5"><a href="#cb410-5"></a>answer_json &lt;-<span class="st"> </span><span class="kw">readLines</span>(con, <span class="dt">warn =</span> <span class="ot">FALSE</span>)</span>
<span id="cb410-6"><a href="#cb410-6"></a><span class="kw">close</span>(con)</span>
<span id="cb410-7"><a href="#cb410-7"></a>answer_json  </span></code></pre></div>
<p>We have two forms of data that are obviously structured. What are they?</p>
</div>
</div>
<div id="intro-to-json-and-xml" class="section level2">
<h2><span class="header-section-number">40.2</span> Intro to JSON and XML</h2>
<!--TODO: Add more to this section?-->
<p>There are two common languages of web services:</p>
<ol style="list-style-type: decimal">
<li><strong>J</strong>ava<strong>S</strong>cript <strong>O</strong>bject <strong>N</strong>otation (JSON)</li>
<li>e<strong>X</strong>tensible <strong>M</strong>arkup <strong>L</strong>anguage (XML)</li>
</ol>
<p>Here’s an example of JSON (from <a href="https://zapier.com/learn/apis/chapter-3-data-formats/">this wonderful site</a>):</p>
<div class="sourceCode" id="cb411"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb411-1"><a href="#cb411-1"></a><span class="op">{</span></span>
<span id="cb411-2"><a href="#cb411-2"></a>  <span class="st">&quot;crust&quot;</span><span class="op">:</span> <span class="st">&quot;original&quot;</span><span class="op">,</span></span>
<span id="cb411-3"><a href="#cb411-3"></a>  <span class="st">&quot;toppings&quot;</span><span class="op">:</span> [<span class="st">&quot;cheese&quot;</span><span class="op">,</span> <span class="st">&quot;pepperoni&quot;</span><span class="op">,</span> <span class="st">&quot;garlic&quot;</span>]<span class="op">,</span></span>
<span id="cb411-4"><a href="#cb411-4"></a>  <span class="st">&quot;status&quot;</span><span class="op">:</span> <span class="st">&quot;cooking&quot;</span><span class="op">,</span></span>
<span id="cb411-5"><a href="#cb411-5"></a>  <span class="st">&quot;customer&quot;</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb411-6"><a href="#cb411-6"></a>    <span class="st">&quot;name&quot;</span><span class="op">:</span> <span class="st">&quot;Brian&quot;</span><span class="op">,</span></span>
<span id="cb411-7"><a href="#cb411-7"></a>    <span class="st">&quot;phone&quot;</span><span class="op">:</span> <span class="st">&quot;573-111-1111&quot;</span></span>
<span id="cb411-8"><a href="#cb411-8"></a>  <span class="op">}</span></span>
<span id="cb411-9"><a href="#cb411-9"></a><span class="op">}</span></span></code></pre></div>
<p>And here is XML (also from <a href="https://zapier.com/learn/apis/chapter-3-data-formats/">this site</a>):</p>
<div class="sourceCode" id="cb412"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb412-1"><a href="#cb412-1"></a><span class="kw">&lt;order&gt;</span></span>
<span id="cb412-2"><a href="#cb412-2"></a>    <span class="kw">&lt;crust&gt;</span>original<span class="kw">&lt;/crust&gt;</span></span>
<span id="cb412-3"><a href="#cb412-3"></a>    <span class="kw">&lt;toppings&gt;</span></span>
<span id="cb412-4"><a href="#cb412-4"></a>        <span class="kw">&lt;topping&gt;</span>cheese<span class="kw">&lt;/topping&gt;</span></span>
<span id="cb412-5"><a href="#cb412-5"></a>        <span class="kw">&lt;topping&gt;</span>pepperoni<span class="kw">&lt;/topping&gt;</span></span>
<span id="cb412-6"><a href="#cb412-6"></a>        <span class="kw">&lt;topping&gt;</span>garlic<span class="kw">&lt;/topping&gt;</span></span>
<span id="cb412-7"><a href="#cb412-7"></a>    <span class="kw">&lt;/toppings&gt;</span></span>
<span id="cb412-8"><a href="#cb412-8"></a>    <span class="kw">&lt;status&gt;</span>cooking<span class="kw">&lt;/status&gt;</span></span>
<span id="cb412-9"><a href="#cb412-9"></a><span class="kw">&lt;/order&gt;</span></span></code></pre></div>
<p>You can see that both of these data structures are quite easy to read. They are “self-describing”. In other words, they tell you how they are meant to be read. There are easy means of taking these data types and creating R objects.</p>
<div id="parsing-the-json-response-with-jsonlite" class="section level3">
<h3><span class="header-section-number">40.2.1</span> Parsing the JSON response with jsonlite</h3>
<p>Our JSON response above can be parsed using <code>jsonlite::fromJSON()</code>. First install/load the jsonlite package.</p>
<div class="sourceCode" id="cb413"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb413-1"><a href="#cb413-1"></a><span class="co"># install.packages(&quot;jsonlite&quot;)</span></span>
<span id="cb413-2"><a href="#cb413-2"></a><span class="kw">library</span>(jsonlite)</span></code></pre></div>
<p>Parsing our JSON response with <code>fromJSON()</code>:</p>
<div class="sourceCode" id="cb414"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb414-1"><a href="#cb414-1"></a>answer_json <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb414-2"><a href="#cb414-2"></a><span class="st">  </span><span class="kw">fromJSON</span>()</span></code></pre></div>
<p>The output is a named list. A familiar and friendly R structure. Because data frames are lists and because this list has no nested lists-within-lists, we can coerce it very simply:</p>
<div class="sourceCode" id="cb415"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb415-1"><a href="#cb415-1"></a>answer_json <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb415-2"><a href="#cb415-2"></a><span class="st">  </span><span class="kw">fromJSON</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb415-3"><a href="#cb415-3"></a><span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb415-4"><a href="#cb415-4"></a><span class="st">  </span><span class="kw">glimpse</span>()</span></code></pre></div>
</div>
<div id="parsing-the-xml-response-using-xml2" class="section level3">
<h3><span class="header-section-number">40.2.2</span> Parsing the XML response using xml2</h3>
<p>We can use the <a href="https://xml2.r-lib.org">xml2</a> package to wrangle our XML response.</p>
<div class="sourceCode" id="cb416"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb416-1"><a href="#cb416-1"></a><span class="co"># install.packages(&quot;xml2&quot;)</span></span>
<span id="cb416-2"><a href="#cb416-2"></a><span class="kw">library</span>(xml2)</span></code></pre></div>
<p>Parsing our XML response with <code>read_xml()</code>:</p>
<div class="sourceCode" id="cb417"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb417-1"><a href="#cb417-1"></a>(xml_parsed &lt;-<span class="st"> </span><span class="kw">read_xml</span>(answer_xml))</span></code></pre></div>
<p>Not exactly the result we were hoping for! However, this does tell us about the XML document’s structure:</p>
<ul>
<li>It has a <code>&lt;root&gt;</code> node, which has a single child node, <code>&lt;movie&gt;</code>.</li>
<li>The information we want is all stored as attributes (e.g. title, year, etc.).</li>
</ul>
<p>The xml2 package has various functions to assist in navigating through XML. We can use the <code>xml_children()</code> function to extract all of the children nodes (i.e. the single child, <code>&lt;movie&gt;</code>):</p>
<div class="sourceCode" id="cb418"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb418-1"><a href="#cb418-1"></a>(contents &lt;-<span class="st"> </span><span class="kw">xml_contents</span>(xml_parsed))</span></code></pre></div>
<p>The <code>xml_attrs()</code> function “retrieves all attribute values as a named character vector”. Let’s use this to extract the information that we want from the <code>&lt;movie&gt;</code> node:</p>
<div class="sourceCode" id="cb419"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb419-1"><a href="#cb419-1"></a>(attrs &lt;-<span class="st"> </span><span class="kw">xml_attrs</span>(contents)[[<span class="dv">1</span>]])</span></code></pre></div>
<p>We can transform this named character vector into a data frame with the help of <code>dplyr::bind_rows()</code>:</p>
<div class="sourceCode" id="cb420"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb420-1"><a href="#cb420-1"></a>attrs <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb420-2"><a href="#cb420-2"></a><span class="st">  </span><span class="kw">bind_rows</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb420-3"><a href="#cb420-3"></a><span class="st">  </span><span class="kw">glimpse</span>()</span></code></pre></div>
</div>
</div>
<div id="introducing-the-easy-way-httr" class="section level2">
<h2><span class="header-section-number">40.3</span> Introducing the easy way: httr</h2>
<p><a href="https://httr.r-lib.org">httr</a> is yet another star in the <a href="https://www.tidyverse.org">tidyverse</a>. It is a package designed to facilitate all things HTTP from within R. This includes the major HTTP verbs, which are:</p>
<!--TODO: Find source for these definitions-->
<ul>
<li><strong><code>GET()</code></strong> - Fetch an existing resource. The URL contains all the necessary information the server needs to locate and return the resource.</li>
<li><strong><code>POST()</code></strong> - Create a new resource. POST requests usually carry a payload that specifies the data for the new resource.</li>
<li><strong><code>PUT()</code></strong> - Update an existing resource. The payload may contain the updated data for the resource.</li>
<li><strong><code>DELETE()</code></strong> - Delete an existing resource.</li>
</ul>
<!--TODO: It's not clear in the original stat545 lesson what this is referring to. I checked the paragraphs above and below and wasn't able to find them at this site. Keeping the link here to revisit later.

(from [HTTP made really easy](http://www.jmarshall.com/easy/http/))
-->
<p>HTTP is the foundation for APIs; understanding how it works is the key to interacting with all the diverse APIs out there. An excellent beginning resource for APIs (including HTTP basics) is <a href="https://zapier.com/learn/apis/">An Introduction to APIs</a> by Brian Cooksey.</p>
<p>httr also facilitates a variety of <strong><em>authentication</em></strong> protocols.</p>
<p>httr contains one function for every HTTP verb. The functions have the same names as the verbs (e.g. <code>GET()</code>, <code>POST()</code>). They have more informative outputs than simply using curl and come with nice convenience functions for working with the output:</p>
<div class="sourceCode" id="cb421"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb421-1"><a href="#cb421-1"></a><span class="co"># install.packages(&quot;httr&quot;)</span></span>
<span id="cb421-2"><a href="#cb421-2"></a><span class="kw">library</span>(httr)</span></code></pre></div>
<p>Using httr to get the data in JSON format:</p>
<div class="sourceCode" id="cb422"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb422-1"><a href="#cb422-1"></a>request_json &lt;-<span class="st"> </span><span class="kw">omdb</span>(<span class="dt">title =</span> <span class="st">&quot;Interstellar&quot;</span>, <span class="dt">year =</span> <span class="st">&quot;2014&quot;</span>, <span class="dt">plot =</span> <span class="st">&quot;short&quot;</span>, </span>
<span id="cb422-2"><a href="#cb422-2"></a>                     <span class="dt">format =</span> <span class="st">&quot;json&quot;</span>, <span class="dt">api_key =</span> movie_key)</span>
<span id="cb422-3"><a href="#cb422-3"></a>response_json &lt;-<span class="st"> </span><span class="kw">GET</span>(request_json)</span>
<span id="cb422-4"><a href="#cb422-4"></a><span class="kw">content</span>(response_json, <span class="dt">as =</span> <span class="st">&quot;parsed&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;application/json&quot;</span>)</span></code></pre></div>
<p>Using httr to get the data in XML format:</p>
<div class="sourceCode" id="cb423"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb423-1"><a href="#cb423-1"></a>request_xml &lt;-<span class="st"> </span><span class="kw">omdb</span>(<span class="dt">title =</span> <span class="st">&quot;Interstellar&quot;</span>, <span class="dt">year =</span> <span class="st">&quot;2014&quot;</span>, <span class="dt">plot =</span> <span class="st">&quot;short&quot;</span>, </span>
<span id="cb423-2"><a href="#cb423-2"></a>                    <span class="dt">format =</span> <span class="st">&quot;xml&quot;</span>, <span class="dt">api_key =</span> movie_key)</span>
<span id="cb423-3"><a href="#cb423-3"></a></span>
<span id="cb423-4"><a href="#cb423-4"></a>response_xml &lt;-<span class="st"> </span><span class="kw">GET</span>(request_xml)</span>
<span id="cb423-5"><a href="#cb423-5"></a><span class="kw">content</span>(response_xml, <span class="dt">as =</span> <span class="st">&quot;parsed&quot;</span>)</span></code></pre></div>
<p>httr also gives us access to lots of useful information about the quality of our response. For example, the header:</p>
<div class="sourceCode" id="cb424"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb424-1"><a href="#cb424-1"></a><span class="kw">headers</span>(response_xml)</span></code></pre></div>
<p>And also a handy means to extract specifically the HTTP status code:</p>
<div class="sourceCode" id="cb425"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb425-1"><a href="#cb425-1"></a><span class="kw">status_code</span>(response_xml)</span></code></pre></div>
<p>In fact, we didn’t need to create <code>omdb()</code> at all. httr provides a straightforward means of making an HTTP request with the <code>query</code> argument:</p>
<div class="sourceCode" id="cb426"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb426-1"><a href="#cb426-1"></a>the_martian &lt;-<span class="st"> </span><span class="kw">GET</span>(<span class="st">&quot;http://www.omdbapi.com/?&quot;</span>, </span>
<span id="cb426-2"><a href="#cb426-2"></a>                   <span class="dt">query =</span> <span class="kw">list</span>(<span class="dt">t =</span> <span class="st">&quot;The Martian&quot;</span>, <span class="dt">y =</span> <span class="dv">2015</span>, <span class="dt">plot =</span> <span class="st">&quot;short&quot;</span>, </span>
<span id="cb426-3"><a href="#cb426-3"></a>                                <span class="dt">r =</span> <span class="st">&quot;json&quot;</span>, <span class="dt">apikey =</span> movie_key))</span>
<span id="cb426-4"><a href="#cb426-4"></a><span class="kw">content</span>(the_martian)</span></code></pre></div>
<p>With httr, we are able to pass in the named arguments to the API call as a named list. We are also able to use spaces in movie names; httr encodes these in the URL before making the GET request.</p>
<p>It is very good to <a href="https://www.flickr.com/photos/girliemac/sets/72157628409467125">learn your HTTP status codes</a>.</p>
<p>The documentation for httr includes a vignette of <a href="https://httr.r-lib.org/articles/api-packages.html">“Best practices for writing an API package”</a>, which is useful for when you want to bring your favourite web resource into the world of R.</p>
</div>
<div id="scraping" class="section level2">
<h2><span class="header-section-number">40.4</span> Scraping</h2>
<p>What if data is present on a website, but isn’t provided in an API at all? It is possible to grab that information too. How easy that is to do depends a lot on the quality of the website that we are using.</p>
<p>HTML is a structured way of displaying information. It is very similar in structure to XML (in fact many modern html sites are actually XHTML5, <a href="http://www.w3.org/TR/html5/the-xhtml-syntax.html">which is also valid XML</a>).</p>
<p>Two pieces of equipment:</p>
<ol style="list-style-type: decimal">
<li>The <a href="https://rvest.tidyverse.org">rvest</a> package (<a href="https://CRAN.R-project.org/package=rvest">CRAN</a>; <a href="https://github.com/tidyverse/rvest">GitHub</a>). Install via <code>install.packages("rvest)"</code>.</li>
<li>SelectorGadget: point and click CSS selectors. <a href="http://selectorgadget.com/">Install in your browser</a>.</li>
</ol>
<p>Before we go any further, <a href="http://flukeout.github.io">let’s play a game together</a>!</p>
<div id="obtain-a-table" class="section level3">
<h3><span class="header-section-number">40.4.1</span> Obtain a table</h3>
<p>Let’s make a simple HTML table and then parse it.</p>
<ol style="list-style-type: decimal">
<li>Make a new, empty project</li>
<li>Make a totally empty <code>.Rmd</code> file and save it as <code>"GapminderHead.Rmd"</code></li>
<li>Copy this into the body:</li>
</ol>
<div class="sourceCode" id="cb427"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb427-1"><a href="#cb427-1"></a>---</span>
<span id="cb427-2"><a href="#cb427-2"></a>output: html_document</span>
<span id="cb427-3"><a href="#cb427-3"></a>---</span>
<span id="cb427-4"><a href="#cb427-4"></a></span>
<span id="cb427-5"><a href="#cb427-5"></a><span class="bn">```{r echo=FALSE, results=&#39;asis&#39;}</span></span>
<span id="cb427-6"><a href="#cb427-6"></a><span class="bn">library(gapminder)</span></span>
<span id="cb427-7"><a href="#cb427-7"></a><span class="bn">knitr::kable(head(gapminder))</span></span>
<span id="cb427-8"><a href="#cb427-8"></a><span class="bn">```</span></span></code></pre></div>
<p>Knit the document and click “View in Browser”. It should look like this:</p>
<p>We have created a simple HTML table with the head of <code>gapminder</code> in it! We can get our data back by parsing this table into a data frame again. Extracting data from HTML is called “scraping”, and we can do it in R with the rvest package:</p>
<div class="sourceCode" id="cb428"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb428-1"><a href="#cb428-1"></a><span class="co"># install.packages(&quot;rvest&quot;)</span></span>
<span id="cb428-2"><a href="#cb428-2"></a><span class="kw">library</span>(rvest)</span></code></pre></div>
<div class="sourceCode" id="cb429"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb429-1"><a href="#cb429-1"></a><span class="kw">read_html</span>(<span class="st">&quot;GapminderHead.html&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb429-2"><a href="#cb429-2"></a><span class="st">  </span><span class="kw">html_table</span>()</span></code></pre></div>
</div>
</div>
<div id="scraping-via-css-selectors" class="section level2">
<h2><span class="header-section-number">40.5</span> Scraping via CSS selectors</h2>
<p>Let’s practice scraping websites using our newfound abilities. Here is a table of research <a href="https://www.scimagojr.com/countryrank.php">publications by country</a>.</p>
<p>We can try to get this data directly into R using <code>read_html()</code> and <code>html_table()</code>:</p>
<div class="sourceCode" id="cb430"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb430-1"><a href="#cb430-1"></a>research &lt;-<span class="st"> </span><span class="kw">read_html</span>(<span class="st">&quot;https://www.scimagojr.com/countryrank.php&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb430-2"><a href="#cb430-2"></a><span class="st">  </span><span class="kw">html_table</span>(<span class="dt">fill =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p>If you look at the structure of <code>research</code> (i.e. via <code>str(research)</code>) you’ll see that we’ve obtained a list of data.frames. The top of the page contains another table element. This was also scraped!</p>
<p>Can we be more specific about what we obtain from this page? We can, by highlighting that table with CSS selectors:</p>
<div class="sourceCode" id="cb431"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb431-1"><a href="#cb431-1"></a>research &lt;-<span class="st"> </span><span class="kw">read_html</span>(<span class="st">&quot;http://www.scimagojr.com/countryrank.php&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb431-2"><a href="#cb431-2"></a><span class="st">  </span><span class="kw">html_node</span>(<span class="st">&quot;.tabla_datos&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb431-3"><a href="#cb431-3"></a><span class="st">    </span><span class="kw">html_table</span>()</span>
<span id="cb431-4"><a href="#cb431-4"></a><span class="kw">glimpse</span>(research)</span></code></pre></div>
</div>
<div id="random-observations-on-scraping" class="section level2">
<h2><span class="header-section-number">40.6</span> Random observations on scraping</h2>
<ul>
<li>Make sure you’ve obtained ONLY what you want! Scroll over the whole page to ensure that SelectorGadget hasn’t found too many things.</li>
<li>If you are having trouble parsing, try selecting a smaller subset of the thing you are seeking (e.g. being more precise).</li>
</ul>
<p><strong>MOST IMPORTANTLY</strong> confirm that there is NO <a href="https://ropensci.org/packages/">rOpenSci package</a> and NO API before you <a href="https://rpubs.com/aammd/kivascrape">spend hours scraping</a> (the <a href="http://build.kiva.org/">API was right here</a>).</p>
</div>
<div id="extras" class="section level2">
<h2><span class="header-section-number">40.7</span> Extras</h2>
<div id="airports" class="section level3">
<h3><span class="header-section-number">40.7.1</span> Airports</h3>
<p>First, go to this website about <a href="https://www.developer.aero/Airport-API">Airports</a>. Follow the link to get your API key (you will need to click a confirmation email).</p>
<p>List of all the airports on the planet:</p>
<pre class="url"><code>https://airport.api.aero/airport/?user_key={yourkey}</code></pre>
<p>List of all the airports matching Toronto:</p>
<pre><code>https://airport.api.aero/airport/match/toronto?user_key={yourkey}</code></pre>
<p>The distance between YVR and LAX:</p>
<pre><code>https://airport.api.aero/airport/distance/YVR/LAX?user_key={yourkey}</code></pre>
<p>Do you need just the US airports? <a href="https://github.com/Federal-Aviation-Administration/ASWS">This API does that</a> (also see <a href="https://www.fly.faa.gov/flyfaa/usmap.jsp">this</a>) and is free.</p>
<!--chapter:end:037_diy-web-data.Rmd-->
</div>
</div>
</div>
<div id="part-all-the-shiny-things" class="section level1 unnumbered">
<h1>(PART) All the Shiny things</h1>
</div>
<div id="shiny-overview" class="section level1 unnumbered">
<h1>Overview</h1>
<!--Original content: https://stat545.com/shiny00_index.html-->
<ul>
<li>Chapter @ref(shiny-slides) - Slides to accompany Chapter @ref(shiny-tutorial).</li>
<li>Chapter @ref(shiny-tutorial) - Shiny tutorial with hands-on activity to build <a href="https://daattali.com/shiny/bcl/">this app</a> using the BC Liquor Store dataset.</li>
</ul>
<div id="awesome-add-on-packages-to-shiny" class="section level2 unnumbered">
<h2>Awesome add-on packages to Shiny</h2>
<p>Many people have written packages that enhance Shiny in some way or add extra functionality. Here is a list of several popular packages that people often use together with Shiny:</p>
<ul>
<li><a href="https://rstudio.github.io/shinythemes/">shinythemes</a> - Easily alter the appearance of your app (<a href="https://CRAN.R-project.org/package=shinythemes">CRAN</a>).</li>
<li><a href="https://deanattali.com/shinyjs/">shinyjs</a> - Enhance user experience in Shiny apps using JavaScript functions without knowing JavaScript (<a href="https://CRAN.R-project.org/package=shinyjs">CRAN</a>; <a href="https://github.com/daattali/shinyjs">GitHub</a>).</li>
<li><a href="https://rstudio.github.io/leaflet/">leaflet</a> - Add interactive maps to your apps (<a href="https://CRAN.R-project.org/package=leaflet">CRAN</a>; <a href="https://github.com/rstudio/leaflet">GitHub</a>).</li>
<li><a href="https://ggvis.rstudio.com">ggvis</a> - Similar to ggplot2, but the plots are focused on being web-based and are more interactive (<a href="https://CRAN.R-project.org/package=ggvis">CRAN</a>).</li>
<li><a href="https://rstudio.github.io/shinydashboard/">shinydashboard</a> - Gives you tools to create visual “dashboards” (<a href="https://CRAN.R-project.org/package=shinydashboard">CRAN</a>; <a href="https://github.com/rstudio/shinydashboard">GitHub</a>).</li>
</ul>
</div>
<div id="resources-12" class="section level2 unnumbered">
<h2>Resources</h2>
<p>Shiny is a very popular package and has lots of resources on the web. Here’s a compiled list of a few resources I recommend, which are all fairly easy to read and understand.</p>
<ul>
<li><a href="https://shiny.rstudio.com">Shiny official website</a></li>
<li><a href="https://shiny.rstudio.com/tutorial/">Shiny official tutorial</a></li>
<li><a href="https://shiny.rstudio.com/images/shiny-cheatsheet.pdf">Shiny cheatsheet</a></li>
<li><a href="https://shiny.rstudio.com/articles/">Lots of short useful articles about different topics in Shiny - <strong>highly recommended</strong></a></li>
<li><a href="http://rmarkdown.rstudio.com/authoring_shiny.html">Shiny in R Markdown</a></li>
<li>Get help from the <a href="https://groups.google.com/forum/#!forum/shiny-discuss">Shiny Google group</a> or <a href="https://stackoverflow.com/questions/tagged/shiny">StackOverflow</a></li>
<li><a href="https://www.shinyapps.io">Publish your apps for free with shinyapps.io</a></li>
<li><a href="https://deanattali.com/2015/05/09/setup-rstudio-shiny-server-digital-ocean/">Host your app on your own Shiny server</a></li>
<li><a href="https://shiny.rstudio.com/articles/understanding-reactivity.html">Learn about how reactivity works</a></li>
<li><a href="https://shiny.rstudio.com/articles/debugging.html">Learn about useful debugging techniques</a></li>
</ul>
</div>
</div>
<div id="shiny-slides" class="section level1">
<h1><span class="header-section-number">41</span> Slides</h1>
<p>See <a href="https://docs.google.com/presentation/d/1dXhqqsD7dPOOdcC5Y7RW--dEU7UfU52qlb0YD3kKeLw/edit#slide=id.p">“Building Shiny Apps” slides</a> by Dean Attali.</p>
</div>
<div id="shiny-tutorial" class="section level1">
<h1><span class="header-section-number">42</span> Building Shiny apps</h1>
<!--Original content: https://stat545.com/shiny01_activity.html-->
<!--Original Author: Dean Attali-->
<p><a href="https://shiny.rstudio.com">Shiny</a> is a package from RStudio that can be used to build interactive web pages with R. While that may sound scary because of the words “web pages”, Shiny is geared to R users who have zero experience with web development, and you do not need to know any HTML/CSS/JavaScript.</p>
<p>You can do quite a lot with Shiny: think of it as an easy way to make an interactive web page, and that web page can seamlessly interact with R and display R objects (plots, tables, of anything else you do in R). To get a sense of the wide range of things you can do with Shiny, you can visit my Shiny server (<a href="https://daattali.com/shiny/" class="uri">https://daattali.com/shiny/</a>), which hosts some of my own Shiny apps.</p>
<p>This tutorial is a hands-on activity complement to a set of <a href="#shiny-slides">presentation slides</a> for learning how to build Shiny apps. In this activity, we’ll walk through all the steps of building a Shiny app using a dataset that lets you explore the products available at the BC Liquor Store. The final version of the app, including a few extra features that are left as exercises for the reader, can be seen here: <a href="https://daattali.com/shiny/bcl/" class="uri">https://daattali.com/shiny/bcl/</a>. Any activity deemed as an exercise throughout this tutorial is not mandatory for building our app, but they are good for getting more practice with Shiny.</p>
<p>This tutorial should take approximately an hour to complete. If you want even more practice, another great tutorial is the <a href="https://shiny.rstudio.com/tutorial/">official Shiny tutorial</a>. RStudio also provides a <a href="https://shiny.rstudio.com/images/shiny-cheatsheet.pdf">handy cheatsheet</a> to remember all the little details after you already learned the basics.</p>
<div id="shiny-tutorial-1" class="section level2">
<h2><span class="header-section-number">42.1</span> Before we begin</h2>
<p>You’ll need to have the shiny package, so install it.</p>
<div class="sourceCode" id="cb435"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb435-1"><a href="#cb435-1"></a><span class="kw">install.packages</span>(<span class="st">&quot;shiny&quot;</span>)</span></code></pre></div>
<p>To ensure you successfully installed Shiny, try running one of the demo apps.</p>
<div class="sourceCode" id="cb436"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb436-1"><a href="#cb436-1"></a><span class="kw">library</span>(shiny)</span>
<span id="cb436-2"><a href="#cb436-2"></a><span class="kw">runExample</span>(<span class="st">&quot;01_hello&quot;</span>)</span></code></pre></div>
<p>If the example app is running, press <em>Escape</em> to close the app, and you are ready to build your first Shiny app!</p>
<p><strong>Exercise:</strong> Visit <a href="https://www.showmeshiny.com/" class="uri">https://www.showmeshiny.com/</a>, which is a gallery of user-submitted Shiny apps, and click through some of the showcased apps. Get a feel for the wide range of things you can do with Shiny.</p>
</div>
<div id="shiny-tutorial-2" class="section level2">
<h2><span class="header-section-number">42.2</span> Shiny app basics</h2>
<p>Every Shiny app is composed of a two parts: a web page that shows the app to the user, and a computer that powers the app. The computer that runs the app can either be your own laptop (such as when you’re running an app from RStudio) or a server somewhere else. You, as the Shiny app developer, need to write these two parts (you’re not going to write a computer, but rather the code that powers the app). In Shiny terminology, they are called <em>UI</em> (user interface) and <em>server</em>.</p>
<p>UI is just a web document that the user gets to see, it’s HTML that you write using Shiny’s functions. The UI is responsible for creating the layout of the app and telling Shiny exactly where things go. The server is responsible for the logic of the app; it’s the set of instructions that tell the web page what to show when the user interacts with the page.</p>
<p>If you look at the app we will be building (<a href="http://daattali.com/shiny/bcl/" class="uri">http://daattali.com/shiny/bcl/</a>), the page that you see is built with the UI code. You’ll notice there are some controls that you, as the user, can manipulate. If you adjust the price or choose a country, you’ll notice that the plot and the table get updated. The UI is responsible for creating these controls and telling Shiny <em>where</em> to place the controls and where to place the plot and table, while the server is responsible for creating the actual plot or the data in the table.</p>
</div>
<div id="shiny-tutorial-3" class="section level2">
<h2><span class="header-section-number">42.3</span> Create an empty Shiny app</h2>
<p>All Shiny apps follow the same template:</p>
<div class="sourceCode" id="cb437"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb437-1"><a href="#cb437-1"></a><span class="kw">library</span>(shiny)</span>
<span id="cb437-2"><a href="#cb437-2"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>()</span>
<span id="cb437-3"><a href="#cb437-3"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output) {}</span>
<span id="cb437-4"><a href="#cb437-4"></a><span class="kw">shinyApp</span>(<span class="dt">ui =</span> ui, <span class="dt">server =</span> server)</span></code></pre></div>
<p>This template is by itself a working minimal Shiny app that doesn’t do much. It initializes an empty UI and an empty server, and runs an app using these empty parts. Copy this template into a new file named <code>app.R</code> in a new folder. It is <strong>very important</strong> that the name of the file is <code>app.R</code>, otherwise it would not be recognized as a Shiny app. It is also <strong>very important</strong> that you place this app in its own folder, and not in a folder that already has other R scripts or files, unless those other files are used by your app.</p>
<p>After saving the file, RStudio should recognize that this is a Shiny app, and you should see the usual <em>Run</em> button at the top change to <em>Run App</em>.</p>
<div class="figure">
<img src="img/shiny-runapp.png" alt="Shiny run app button" width="93%" />
<p class="caption">
(#fig:unnamed-chunk-2)Shiny run app button
</p>
</div>
<p>If you don’t see the <em>Run App</em> button, it means you either have a very old version of RStudio, don’t have Shiny installed, or didn’t follow the file naming conventions.</p>
<p>Click the <em>Run App</em> button, and now your app should run. You won’t see much because it’s an empty app, but you should see that the R Console has some text printed in the form of <code>Listening on http://127.0.0.1:5274</code> and that a little stop sign appeared at the top of the R Console You’ll also notice that you can’t run any commands in the R Console This is because R is busy - your R session is currently powering a Shiny app and listening for user interaction (which won’t happen because the app has nothing in it yet).</p>
<p>Click the stop button to stop the app, or press the <em>Escape</em> key.</p>
<div class="figure">
<img src="img/shiny-stopapp.png" alt="Shiny stop app button" width="93%" />
<p class="caption">
(#fig:unnamed-chunk-3)Shiny stop app button
</p>
</div>
<p>You may have noticed that when you click the <em>Run App</em> button, all it’s doing is just running the function <code>shiny::runApp()</code> in the R Console You can run that command instead of clicking the button if you prefer.</p>
<p><strong>Exercise:</strong> Try running the empty app using the <code>runApp()</code> function instead of using the <em>Run App</em> button.</p>
<div id="alternate-way-to-create-a-shiny-app-separate-ui-and-server-files" class="section level3">
<h3><span class="header-section-number">42.3.1</span> Alternate way to create a Shiny app: separate UI and server files</h3>
<p>Another way to define a Shiny app is by separating the UI and server code into two files: <code>ui.R</code> and <code>server.R</code>. This is the preferable way to write Shiny apps when the app is complex and involves more code, but in this tutorial we’ll stick to the simple single file. If you want to break up your app into these two files, you simply put all code that is assigned to the <code>ui</code> variable in <code>ui.R</code> and all the code assigned to the <code>server</code> function in <code>server.R</code>. When RStudio sees these two files in the same folder, it will know you’re writing a Shiny app.</p>
<p><strong>Exercise:</strong> Try making a new Shiny app by creating the two files <code>ui.R</code> and <code>server.R</code>. Remember that they have to be in the same folder. Also remember to put them in a <em>new, isolated</em> folder (not where your <code>app.R</code> already exists).</p>
</div>
<div id="let-rstudio-fill-out-a-shiny-app-template-for-you" class="section level3">
<h3><span class="header-section-number">42.3.2</span> Let RStudio fill out a Shiny app template for you</h3>
<p>You can also create a new Shiny app using RStudio’s menu by selecting <em>File &gt; New File &gt; Shiny Web App…</em>. If you do this, RStudio will let you choose if you want a single-file app (<code>app.R</code>) or a two-file app (<code>ui.R</code>+<code>server.R</code>). RStudio will initialize a simple functional Shiny app with some code in it. I personally don’t use this feature because I find it easier to simply type the few lines of a Shiny app and save the files.</p>
</div>
</div>
<div id="shiny-tutorial-4" class="section level2">
<h2><span class="header-section-number">42.4</span> Load the dataset</h2>
<!--TODO:
Link to the original dataset no longer works. The closest thing I could find is [this](https://catalogue.data.gov.bc.ca/dataset/bc-liquor-store-product-price-list-historical-prices) but it was just modified in 2019. The csv at deanattali.com is still live so will just refer to that for now. 
-->
<p>The dataset we’ll be using contains information about all the products sold by BC Liquor Store and is provided by <a href="https://www.opendatabc.ca/dataset/bc-liquor-store-product-price-list-current-prices">OpenDataBC</a>. They provide a direct link to download a CSV version of the data, and this data has the rare quality that it is immediately clean and useful. You can view the <a href="http://pub.data.gov.bc.ca/datasets/176284/BC_Liquor_Store_Product_Price_List.csv">raw data</a> they provide, but I have taken a few steps to simplify the dataset to make it more useful for our app. I removed some columns, renamed other columns, and dropped a few rare factor levels.</p>
<p>The processed dataset we’ll be using in this app is available <a href="https://deanattali.com/files/bcl-data.csv">here</a>. Download it now and place this file in the same folder as your Shiny app. Make sure the file is named <code>bcl-data.csv</code>.</p>
<p>Add a line in your app to load the data into a variable called <code>bcl</code>. It should look something like this</p>
<div class="sourceCode" id="cb438"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb438-1"><a href="#cb438-1"></a>bcl &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;bcl-data.csv&quot;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p>Place this line in your app as the second line, just after <code>library(shiny)</code>. Make sure the file path and file name are correct, otherwise your app won’t run. Try to run the app to make sure the file can be loaded without errors.</p>
<p>If you want to verify that the app can successfully read the data, you can add a <code>print()</code> statement after reading the data. This won’t make anything happen in your Shiny app, but you will see a summary of the dataset printed in the R Console, which should let you know that the dataset was indeed loaded correctly. You can place the following line after reading the data:</p>
<div class="sourceCode" id="cb439"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb439-1"><a href="#cb439-1"></a><span class="kw">print</span>(<span class="kw">str</span>(bcl))</span></code></pre></div>
<p>Once you get confirmation that the data is properly loaded, you can remove that line.</p>
<blockquote>
<p>In case you’re curious, the code I used to process the raw data into the data we’ll be using is available <a href="https://gist.github.com/daattali/56b9fa8f3e99174fba63">as a gist</a>.</p>
</blockquote>
<p><strong>Exercise:</strong> Load the data file into R and get a feel for what’s in it. How big is it, what variables are there, what are the normal price ranges, etc.</p>
</div>
<div id="shiny-tutorial-5" class="section level2">
<h2><span class="header-section-number">42.5</span> Build the basic UI</h2>
<p>Let’s start populating our app with some elements visually. This is usually the first thing you do when writing a Shiny app - add elements to the UI.</p>
<div id="add-plain-text-to-the-ui" class="section level3">
<h3><span class="header-section-number">42.5.1</span> Add plain text to the UI</h3>
<p>You can place R strings inside <code>fluidPage()</code> to render text.</p>
<div class="sourceCode" id="cb440"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb440-1"><a href="#cb440-1"></a><span class="kw">fluidPage</span>(<span class="st">&quot;BC Liquor Store&quot;</span>, <span class="st">&quot;prices&quot;</span>)</span></code></pre></div>
<p>Replace the line in your app that assigns an empty <code>fluidPage()</code> into <code>ui</code> with the one above, and run the app.</p>
<p>The entire UI will be built by passing comma-separated arguments into the <code>fluidPage()</code> function. By passing regular text, the web page will just render boring unformatted text.</p>
<p><strong>Exercise:</strong> Add several more strings to <code>fluidPage()</code> and run the app. Nothing too exciting is happening yet, but you should just see all the text appear in one contiguous block.</p>
</div>
<div id="add-formatted-text-and-other-html-elements" class="section level3">
<h3><span class="header-section-number">42.5.2</span> Add formatted text and other HTML elements</h3>
<p>If we want our text to be formatted nicer, Shiny has many functions that are wrappers around HTML tags that format text. We can use the…</p>
<ul>
<li><code>h1()</code> function for a top-level header (<code>&lt;h1&gt;</code> in HTML)</li>
<li><code>h2()</code> for a secondary header (<code>&lt;h2&gt;</code> in HTML)</li>
<li><code>strong()</code> to make text bold (<code>&lt;strong&gt;</code> in HTML)</li>
<li><code>em()</code> to make text italicized (<code>&lt;em&gt;</code> in HTML)</li>
<li>…and many more.</li>
</ul>
<p>There are also functions that are wrappers to other HTML tags, such as <code>br()</code> for a line break, <code>img()</code> for an image, <code>a()</code> for a hyperlink, and others.</p>
<p>All of these functions are actually just wrappers to HTML tags with the equivalent name. You can add any arbitrary HTML tag using the <code>tags</code> object, which you can learn more about by reading the help file via <code>?tags</code>.</p>
<p>Just as a demonstration, try replacing the <code>fluidPage()</code> function in your UI with the following:</p>
<div class="sourceCode" id="cb441"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb441-1"><a href="#cb441-1"></a><span class="kw">fluidPage</span>(</span>
<span id="cb441-2"><a href="#cb441-2"></a>  <span class="kw">h1</span>(<span class="st">&quot;My app&quot;</span>),</span>
<span id="cb441-3"><a href="#cb441-3"></a>  <span class="st">&quot;BC&quot;</span>,</span>
<span id="cb441-4"><a href="#cb441-4"></a>  <span class="st">&quot;Liquor&quot;</span>,</span>
<span id="cb441-5"><a href="#cb441-5"></a>  <span class="kw">br</span>(),</span>
<span id="cb441-6"><a href="#cb441-6"></a>  <span class="st">&quot;Store&quot;</span>,</span>
<span id="cb441-7"><a href="#cb441-7"></a>  <span class="kw">strong</span>(<span class="st">&quot;prices&quot;</span>)</span>
<span id="cb441-8"><a href="#cb441-8"></a>)</span></code></pre></div>
<p>Run the app with this code as the UI. Notice the formatting of the text and understand why it is rendered that way.</p>
<blockquote>
<p>For people who know basic HTML: any named argument you pass to an HTML function becomes an attribute of the HTML element, and any unnamed argument will be a child of the element. That means that you can, for example, create blue text with <code>div("this is blue", style = "color: blue;")</code>.</p>
</blockquote>
<p><strong>Exercise:</strong> Experiment with different HTML-wrapper functions inside <code>fluidPage()</code>. Run the <code>fluidPage(...)</code> function in the R Console and see the HTML that it creates.</p>
</div>
<div id="add-a-title" class="section level3">
<h3><span class="header-section-number">42.5.3</span> Add a title</h3>
<p>We could add a title to the app with <code>h1()</code>, but Shiny also has a special function <code>titlePanel()</code>. Using <code>titlePanel()</code> not only adds a visible big title-like text to the top of the page, but it also sets the “official” title of the web page. This means that when you look at the name of the tab in the browser, you’ll see this title.</p>
<p>Overwrite the <code>fluidPage()</code> that you experimented with so far, and replace it with the simple one below, that simply has a title and nothing else.</p>
<div class="sourceCode" id="cb442"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb442-1"><a href="#cb442-1"></a><span class="kw">fluidPage</span>(</span>
<span id="cb442-2"><a href="#cb442-2"></a>  <span class="kw">titlePanel</span>(<span class="st">&quot;BC Liquor Store prices&quot;</span>)</span>
<span id="cb442-3"><a href="#cb442-3"></a>)</span></code></pre></div>
<p><strong>Exercise:</strong> Look at the documentation for the <code>titlePanel()</code> function and notice it has another argument. Use that argument and see if you can see what it does.</p>
</div>
<div id="add-a-layout" class="section level3">
<h3><span class="header-section-number">42.5.4</span> Add a layout</h3>
<p>You may have noticed that so far, by just adding text and HTML tags, everything is unstructured and the elements simply stack up one below the other in one column. We’ll use <code>sidebarLayout()</code> to add a simple structure. It provides a simple two-column layout with a smaller sidebar and a larger main panel. We’ll build our app such that all the inputs that the user can manipulate will be in the sidebar, and the results will be shown in the main panel on the right.</p>
<p>Add the following code after the <code>titlePanel()</code></p>
<div class="sourceCode" id="cb443"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb443-1"><a href="#cb443-1"></a><span class="kw">sidebarLayout</span>(</span>
<span id="cb443-2"><a href="#cb443-2"></a>  <span class="kw">sidebarPanel</span>(<span class="st">&quot;our inputs will go here&quot;</span>),</span>
<span id="cb443-3"><a href="#cb443-3"></a>  <span class="kw">mainPanel</span>(<span class="st">&quot;the results will go here&quot;</span>)</span>
<span id="cb443-4"><a href="#cb443-4"></a>)</span></code></pre></div>
<p>Remember that all the arguments inside <code>fluidPage()</code> need to be separated by commas.</p>
<p>So far our complete app looks like this (hopefully this isn’t a surprise to you):</p>
<div class="sourceCode" id="cb444"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb444-1"><a href="#cb444-1"></a><span class="kw">library</span>(shiny)</span>
<span id="cb444-2"><a href="#cb444-2"></a>bcl &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;bcl-data.csv&quot;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</span>
<span id="cb444-3"><a href="#cb444-3"></a></span>
<span id="cb444-4"><a href="#cb444-4"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb444-5"><a href="#cb444-5"></a>  <span class="kw">titlePanel</span>(<span class="st">&quot;BC Liquor Store prices&quot;</span>),</span>
<span id="cb444-6"><a href="#cb444-6"></a>  <span class="kw">sidebarLayout</span>(</span>
<span id="cb444-7"><a href="#cb444-7"></a>    <span class="kw">sidebarPanel</span>(<span class="st">&quot;our inputs will go here&quot;</span>),</span>
<span id="cb444-8"><a href="#cb444-8"></a>    <span class="kw">mainPanel</span>(<span class="st">&quot;the results will go here&quot;</span>)</span>
<span id="cb444-9"><a href="#cb444-9"></a>  )</span>
<span id="cb444-10"><a href="#cb444-10"></a>)</span>
<span id="cb444-11"><a href="#cb444-11"></a></span>
<span id="cb444-12"><a href="#cb444-12"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output) {}</span>
<span id="cb444-13"><a href="#cb444-13"></a></span>
<span id="cb444-14"><a href="#cb444-14"></a><span class="kw">shinyApp</span>(<span class="dt">ui =</span> ui, <span class="dt">server =</span> server)</span></code></pre></div>
<div class="figure">
<img src="img/shiny-layout.png" alt="Our Shiny app so far" width="93%" />
<p class="caption">
(#fig:unnamed-chunk-4)Our Shiny app so far
</p>
</div>
<blockquote>
<p>If you want to be a lot more flexible with the design, you can have much more fine control over where things go by using a grid layout. We won’t cover that here, but if you’re interested, look at the documentation for <code>?column</code> and <code>?fluidRow</code>.</p>
</blockquote>
<p><strong>Exercise:</strong> Add some UI into each of the two panels (sidebar panel and main panel) and see how your app now has two columns.</p>
</div>
<div id="all-ui-functions-are-simply-html-wrappers" class="section level3">
<h3><span class="header-section-number">42.5.5</span> All UI functions are simply HTML wrappers</h3>
<p>This was already mentioned, but it’s important to remember: the entire UI is just HTML, and Shiny simply gives you easy tools to write it without having to know HTML. To convince yourself of this, look at the output when printing the contents of the <code>ui</code> variable.</p>
<div class="sourceCode" id="cb445"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb445-1"><a href="#cb445-1"></a><span class="kw">print</span>(ui)</span></code></pre></div>
<div class="sourceCode" id="cb446"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb446-1"><a href="#cb446-1"></a><span class="fu">## &lt;div class=&quot;container-fluid&quot;&gt;</span></span>
<span id="cb446-2"><a href="#cb446-2"></a><span class="fu">##   &lt;h2&gt;BC Liquor Store prices&lt;/h2&gt;</span></span>
<span id="cb446-3"><a href="#cb446-3"></a><span class="fu">##   &lt;div class=&quot;row&quot;&gt;</span></span>
<span id="cb446-4"><a href="#cb446-4"></a><span class="fu">##     &lt;div class=&quot;col-sm-4&quot;&gt;</span></span>
<span id="cb446-5"><a href="#cb446-5"></a><span class="fu">##       &lt;form class=&quot;well&quot;&gt;our inputs will go here&lt;/form&gt;</span></span>
<span id="cb446-6"><a href="#cb446-6"></a><span class="fu">##     &lt;/div&gt;</span></span>
<span id="cb446-7"><a href="#cb446-7"></a><span class="fu">##     &lt;div class=&quot;col-sm-8&quot;&gt;the results will go here&lt;/div&gt;</span></span>
<span id="cb446-8"><a href="#cb446-8"></a><span class="fu">##   &lt;/div&gt;</span></span>
<span id="cb446-9"><a href="#cb446-9"></a><span class="fu">## &lt;/div&gt;</span></span></code></pre></div>
<p>This should make you appreciate Shiny for not making you write horrendous HTML by hand.</p>
</div>
</div>
<div id="shiny-tutorial-6" class="section level2">
<h2><span class="header-section-number">42.6</span> Add inputs to the UI</h2>
<p>Inputs are what gives users a way to interact with a Shiny app. Shiny provides many input functions to support many kinds of interactions that the user could have with an app. For example, <code>textInput()</code> is used to let the user enter text, <code>numericInput()</code> lets the user select a number, <code>dateInput()</code> is for selecting a date, and <code>selectInput()</code> is for creating a select box (a.k.a. a dropdown menu).</p>
<div class="figure">
<img src="img/shiny-inputs.png" alt="Shiny inputs" width="93%" />
<p class="caption">
(#fig:unnamed-chunk-5)Shiny inputs
</p>
</div>
<p>All input functions have the same first two arguments: <code>inputId</code> and <code>label</code>. The <code>inputId</code> will be the name that Shiny will use to refer to this input when you want to retrieve its current value. It is important to note that every input must have a unique <code>inputId</code>. If you give more than one input the same <code>inputId</code>, Shiny will unfortunately not give you an explicit error, but your app won’t work correctly. The <code>label</code> argument specifies the text in the display label that goes along with the input widget. Every input can also have multiple other arguments specific to that input type. The only way to find out what arguments you can use with a specific input function is to look at its help file.</p>
<p><strong>Exercise:</strong> Read the documentation of <code>numericInput</code> (via <code>?numericInput</code>) and try adding a numeric input to the UI. Experiment with the different arguments. Run the app and see how you can interact with this input. Then try different inputs types.</p>
<div id="input-for-price" class="section level3">
<h3><span class="header-section-number">42.6.1</span> Input for price</h3>
<p>The first input we want to have is for specifying a price range (minimum and maximum price). The most sensible types of input for this are either <code>numericInput()</code> or <code>sliderInput()</code> since they are both used for selecting numbers. If we use <code>numericInput()</code>, we’d have to use two inputs, one for the minimum value and one for the maximum. Looking at the documentation for <code>sliderInput()</code>, you’ll see that by supplying a vector of length two as the <code>value</code> argument, it can be used to specify a range rather than a single number. This sounds like what we want in this case, so we’ll use <code>sliderInput()</code>.</p>
<p>To create a slider input, a maximum value needs to be provided. We could use the maximum price in the dataset, which is $30,250, but I doubt I’d ever buy something that expensive. I think $100 is a more reasonable max price for me, and about 85% of the products in this dataset are below $100, so let’s use that as our max.</p>
<p>By looking at the documentation for the slider input function, the following piece of code can be constructed.</p>
<div class="sourceCode" id="cb447"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb447-1"><a href="#cb447-1"></a><span class="kw">sliderInput</span>(<span class="st">&quot;priceInput&quot;</span>, <span class="st">&quot;Price&quot;</span>, <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="dv">100</span>,</span>
<span id="cb447-2"><a href="#cb447-2"></a>            <span class="dt">value =</span> <span class="kw">c</span>(<span class="dv">25</span>, <span class="dv">40</span>), <span class="dt">pre =</span> <span class="st">&quot;$&quot;</span>)</span></code></pre></div>
<p>Place the code for the slider input inside <code>sidebarPanel()</code> (replace the text we wrote earlier with this input).</p>
<p><strong>Exercise:</strong> Run the code of the <code>sliderInput()</code> in the R Console and see what it returns. Change some of the parameters of <code>sliderInput()</code>, and see how that changes the result. It’s important to truly understand that all these functions in the UI are simply a convenient way to write HTML, as is apparent whenever you run these functions on their own.</p>
</div>
<div id="input-for-product-type" class="section level3">
<h3><span class="header-section-number">42.6.2</span> Input for product type</h3>
<p>Usually when going to the liquor store you know whether you’re looking for beer or wine, and you don’t want to waste your time in the wrong section. The same is true in our app, we should be able to choose what type of product we want.</p>
<p>For this we want some kind of a text input. But allowing the user to enter text freely isn’t the right solution because we want to restrict the user to only a few choices. We could either use radio buttons or a select box for our purpose. Let’s use radio buttons for now since there are only a few options, so take a look at the documentation for <code>radioButtons()</code> and come up with a reasonable input function code. It should look like this:</p>
<div class="sourceCode" id="cb448"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb448-1"><a href="#cb448-1"></a><span class="kw">radioButtons</span>(<span class="st">&quot;typeInput&quot;</span>, <span class="st">&quot;Product type&quot;</span>,</span>
<span id="cb448-2"><a href="#cb448-2"></a>            <span class="dt">choices =</span> <span class="kw">c</span>(<span class="st">&quot;BEER&quot;</span>, <span class="st">&quot;REFRESHMENT&quot;</span>, <span class="st">&quot;SPIRITS&quot;</span>, <span class="st">&quot;WINE&quot;</span>),</span>
<span id="cb448-3"><a href="#cb448-3"></a>            <span class="dt">selected =</span> <span class="st">&quot;WINE&quot;</span>)</span></code></pre></div>
<p>Add this input code inside <code>sidebarPanel()</code>, after the previous input (separate them with a comma).</p>
<blockquote>
<p>If you look at that input function and think “what if there were 100 types, listing them by hand would not be fun, there’s got to be a better way!”, then you’re right. This is where <a href="#shiny-tutorial-11"><code>uiOutput()</code></a> comes in handy, but we’ll talk about that later.</p>
</blockquote>
</div>
<div id="input-for-country" class="section level3">
<h3><span class="header-section-number">42.6.3</span> Input for country</h3>
<p>Sometimes I like to feel fancy and only look for wines imported from France. We should add one last input, to select a <code>Country</code>. The most appropriate input type in this case is probably the select box. Look at the documentation for <code>selectInput()</code> and create an input function. For now let’s only have <code>"CANADA"</code>, <code>"FRANCE"</code>, <code>"ITALY"</code> as options, and later we’ll see how to include all countries.</p>
<div class="sourceCode" id="cb449"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb449-1"><a href="#cb449-1"></a><span class="kw">selectInput</span>(<span class="st">&quot;countryInput&quot;</span>, <span class="st">&quot;Country&quot;</span>,</span>
<span id="cb449-2"><a href="#cb449-2"></a>            <span class="dt">choices =</span> <span class="kw">c</span>(<span class="st">&quot;CANADA&quot;</span>, <span class="st">&quot;FRANCE&quot;</span>, <span class="st">&quot;ITALY&quot;</span>))</span></code></pre></div>
<p>Add this function as well to your app. If you followed along, your entire app should have this code:</p>
<div class="sourceCode" id="cb450"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb450-1"><a href="#cb450-1"></a><span class="kw">library</span>(shiny)</span>
<span id="cb450-2"><a href="#cb450-2"></a>bcl &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;bcl-data.csv&quot;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</span>
<span id="cb450-3"><a href="#cb450-3"></a></span>
<span id="cb450-4"><a href="#cb450-4"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb450-5"><a href="#cb450-5"></a>  <span class="kw">titlePanel</span>(<span class="st">&quot;BC Liquor Store prices&quot;</span>),</span>
<span id="cb450-6"><a href="#cb450-6"></a>  <span class="kw">sidebarLayout</span>(</span>
<span id="cb450-7"><a href="#cb450-7"></a>    <span class="kw">sidebarPanel</span>(</span>
<span id="cb450-8"><a href="#cb450-8"></a>      <span class="kw">sliderInput</span>(<span class="st">&quot;priceInput&quot;</span>, <span class="st">&quot;Price&quot;</span>, <span class="dv">0</span>, <span class="dv">100</span>, <span class="kw">c</span>(<span class="dv">25</span>, <span class="dv">40</span>), <span class="dt">pre =</span> <span class="st">&quot;$&quot;</span>),</span>
<span id="cb450-9"><a href="#cb450-9"></a>      <span class="kw">radioButtons</span>(<span class="st">&quot;typeInput&quot;</span>, <span class="st">&quot;Product type&quot;</span>,</span>
<span id="cb450-10"><a href="#cb450-10"></a>                  <span class="dt">choices =</span> <span class="kw">c</span>(<span class="st">&quot;BEER&quot;</span>, <span class="st">&quot;REFRESHMENT&quot;</span>, <span class="st">&quot;SPIRITS&quot;</span>, <span class="st">&quot;WINE&quot;</span>),</span>
<span id="cb450-11"><a href="#cb450-11"></a>                  <span class="dt">selected =</span> <span class="st">&quot;WINE&quot;</span>),</span>
<span id="cb450-12"><a href="#cb450-12"></a>      <span class="kw">selectInput</span>(<span class="st">&quot;countryInput&quot;</span>, <span class="st">&quot;Country&quot;</span>,</span>
<span id="cb450-13"><a href="#cb450-13"></a>                  <span class="dt">choices =</span> <span class="kw">c</span>(<span class="st">&quot;CANADA&quot;</span>, <span class="st">&quot;FRANCE&quot;</span>, <span class="st">&quot;ITALY&quot;</span>))</span>
<span id="cb450-14"><a href="#cb450-14"></a>    ),</span>
<span id="cb450-15"><a href="#cb450-15"></a>    <span class="kw">mainPanel</span>(<span class="st">&quot;the results will go here&quot;</span>)</span>
<span id="cb450-16"><a href="#cb450-16"></a>  )</span>
<span id="cb450-17"><a href="#cb450-17"></a>)</span>
<span id="cb450-18"><a href="#cb450-18"></a></span>
<span id="cb450-19"><a href="#cb450-19"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output) {}</span>
<span id="cb450-20"><a href="#cb450-20"></a></span>
<span id="cb450-21"><a href="#cb450-21"></a><span class="kw">shinyApp</span>(<span class="dt">ui =</span> ui, <span class="dt">server =</span> server)</span></code></pre></div>
<div class="figure">
<img src="img/shiny-addinputs.png" alt="Adding inputs to our Shiny app" width="93%" />
<p class="caption">
(#fig:unnamed-chunk-6)Adding inputs to our Shiny app
</p>
</div>
</div>
</div>
<div id="shiny-tutorial-7" class="section level2">
<h2><span class="header-section-number">42.7</span> Add placeholders for outputs</h2>
<p>After creating all the inputs, we should add elements to the UI to display the outputs. Outputs can be any object that R creates and that we want to display in our app - such as a plot, a table, or text. We’re still only building the UI, so at this point we can only add <em>placeholders</em> for the outputs that will determine where an output will be and what its ID is, but it won’t actually show anything. Each output needs to be constructed in the server code later.</p>
<p>Shiny provides several output functions, one for each type of output. Similarly to the input functions, all the output functions have a <code>outputId</code> argument that is used to identify each output, and this argument must be unique for each output.</p>
<div id="output-for-a-plot-of-the-results" class="section level3">
<h3><span class="header-section-number">42.7.1</span> Output for a plot of the results</h3>
<p>At the top of the main panel we’ll have a plot showing some visualization of the results. Since we want a plot, the function we use is <code>plotOutput()</code>.</p>
<p>Add the following code into the <code>mainPanel()</code> (replace the existing text):</p>
<div class="sourceCode" id="cb451"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb451-1"><a href="#cb451-1"></a><span class="kw">plotOutput</span>(<span class="st">&quot;coolplot&quot;</span>)</span></code></pre></div>
<p>This will add a placeholder in the UI for a plot named <em>coolplot</em>.</p>
<p><strong>Exercise:</strong> To remind yourself that we are still merely constructing HTML and not creating actual plots yet, run the above <code>plotOutput()</code> function in the R Console to see that all it does is create some HTML.</p>
</div>
<div id="output-for-a-table-summary-of-the-results" class="section level3">
<h3><span class="header-section-number">42.7.2</span> Output for a table summary of the results</h3>
<p>Below the plot, we will have a table that shows all the results. To get a table, we use the <code>tableOutput()</code> function.</p>
<p>Here is a simple way to create a UI element that will hold a table output:</p>
<div class="sourceCode" id="cb452"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb452-1"><a href="#cb452-1"></a><span class="kw">tableOutput</span>(<span class="st">&quot;results&quot;</span>)</span></code></pre></div>
<p>Add this output to the <code>mainPanel()</code> as well. Maybe add a couple <code>br()</code> in between the two outputs, just as a space buffer so that they aren’t too close to each other.</p>
</div>
</div>
<div id="shiny-tutorial-8" class="section level2">
<h2><span class="header-section-number">42.8</span> Checkpoint: what our app looks like after implementing the UI</h2>
<p>If you’ve followed along, your app should now have this code:</p>
<div class="sourceCode" id="cb453"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb453-1"><a href="#cb453-1"></a><span class="kw">library</span>(shiny)</span>
<span id="cb453-2"><a href="#cb453-2"></a>bcl &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;bcl-data.csv&quot;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</span>
<span id="cb453-3"><a href="#cb453-3"></a></span>
<span id="cb453-4"><a href="#cb453-4"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb453-5"><a href="#cb453-5"></a>  <span class="kw">titlePanel</span>(<span class="st">&quot;BC Liquor Store prices&quot;</span>),</span>
<span id="cb453-6"><a href="#cb453-6"></a>  <span class="kw">sidebarLayout</span>(</span>
<span id="cb453-7"><a href="#cb453-7"></a>    <span class="kw">sidebarPanel</span>(</span>
<span id="cb453-8"><a href="#cb453-8"></a>      <span class="kw">sliderInput</span>(<span class="st">&quot;priceInput&quot;</span>, <span class="st">&quot;Price&quot;</span>, <span class="dv">0</span>, <span class="dv">100</span>, <span class="kw">c</span>(<span class="dv">25</span>, <span class="dv">40</span>), <span class="dt">pre =</span> <span class="st">&quot;$&quot;</span>),</span>
<span id="cb453-9"><a href="#cb453-9"></a>      <span class="kw">radioButtons</span>(<span class="st">&quot;typeInput&quot;</span>, <span class="st">&quot;Product type&quot;</span>,</span>
<span id="cb453-10"><a href="#cb453-10"></a>                  <span class="dt">choices =</span> <span class="kw">c</span>(<span class="st">&quot;BEER&quot;</span>, <span class="st">&quot;REFRESHMENT&quot;</span>, <span class="st">&quot;SPIRITS&quot;</span>, <span class="st">&quot;WINE&quot;</span>),</span>
<span id="cb453-11"><a href="#cb453-11"></a>                  <span class="dt">selected =</span> <span class="st">&quot;WINE&quot;</span>),</span>
<span id="cb453-12"><a href="#cb453-12"></a>      <span class="kw">selectInput</span>(<span class="st">&quot;countryInput&quot;</span>, <span class="st">&quot;Country&quot;</span>,</span>
<span id="cb453-13"><a href="#cb453-13"></a>                  <span class="dt">choices =</span> <span class="kw">c</span>(<span class="st">&quot;CANADA&quot;</span>, <span class="st">&quot;FRANCE&quot;</span>, <span class="st">&quot;ITALY&quot;</span>))</span>
<span id="cb453-14"><a href="#cb453-14"></a>    ),</span>
<span id="cb453-15"><a href="#cb453-15"></a>    <span class="kw">mainPanel</span>(</span>
<span id="cb453-16"><a href="#cb453-16"></a>      <span class="kw">plotOutput</span>(<span class="st">&quot;coolplot&quot;</span>),</span>
<span id="cb453-17"><a href="#cb453-17"></a>      <span class="kw">br</span>(), <span class="kw">br</span>(),</span>
<span id="cb453-18"><a href="#cb453-18"></a>      <span class="kw">tableOutput</span>(<span class="st">&quot;results&quot;</span>)</span>
<span id="cb453-19"><a href="#cb453-19"></a>    )</span>
<span id="cb453-20"><a href="#cb453-20"></a>  )</span>
<span id="cb453-21"><a href="#cb453-21"></a>)</span>
<span id="cb453-22"><a href="#cb453-22"></a></span>
<span id="cb453-23"><a href="#cb453-23"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output) {}</span>
<span id="cb453-24"><a href="#cb453-24"></a></span>
<span id="cb453-25"><a href="#cb453-25"></a><span class="kw">shinyApp</span>(<span class="dt">ui =</span> ui, <span class="dt">server =</span> server)</span></code></pre></div>
</div>
<div id="shiny-tutorial-9" class="section level2">
<h2><span class="header-section-number">42.9</span> Implement server logic to create outputs</h2>
<p>So far we only wrote code inside that was assigned to the <code>ui</code> variable (or code that was written in <code>ui.R</code>). That’s usually the easier part of a Shiny app. Now we have to write the <code>server</code> function, which will be responsible for listening to changes to the inputs and creating outputs to show in the app.</p>
<p>If you look at the server function, you’ll notice that it is always defined with two arguments: <code>input</code> and <code>output</code>. You <em>must</em> define these two arguments! Both <code>input</code> and <code>output</code> are list-like objects. As the names suggest, <code>input</code> is a list you will read values <em>from</em> and <code>output</code> is a list you will write values <em>to</em>. <code>input</code> will contain the values of all the different inputs at any given time, and <code>output</code> is where you will save output objects (such as tables and plots) to display in your app.</p>
<div id="building-an-output" class="section level3">
<h3><span class="header-section-number">42.9.1</span> Building an output</h3>
<p>Recall that we created two output placeholders: <em>coolplot</em> (a plot) and <em>results</em> (a table). We need to write code in R that will tell Shiny what kind of plot or table to display. There are three rules to build an output in Shiny:</p>
<ol style="list-style-type: decimal">
<li>Save the output object into the <code>output</code> list (remember the app template - every server function has an <code>output</code> argument).</li>
<li>Build the object with a <code>render*</code> function, where <code>*</code> is the type of output.</li>
<li>Access input values using the <code>input</code> list (every server function has an <code>input</code> argument).</li>
</ol>
<p>The third rule is only required if you want your output to depend on some input, so let’s first see how to build a very basic output using only the first two rules. We’ll create a plot and send it to the <em>coolplot</em> output.</p>
<div class="sourceCode" id="cb454"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb454-1"><a href="#cb454-1"></a>output<span class="op">$</span>coolplot &lt;-<span class="st"> </span><span class="kw">renderPlot</span>({</span>
<span id="cb454-2"><a href="#cb454-2"></a>  <span class="kw">plot</span>(<span class="kw">rnorm</span>(<span class="dv">100</span>))</span>
<span id="cb454-3"><a href="#cb454-3"></a>})</span></code></pre></div>
<p>This simple code shows the first two rules: we’re creating a plot inside the <code>renderPlot()</code> function, and assigning it to <em>coolplot</em> in the <code>output</code> list. Remember that every output created in the UI must have a unique ID, now we see why. In order to attach an R object to an output with ID <em>x</em>, we assign the R object to <code>output$x</code>.</p>
<p>Since <em>coolplot</em> was defined as a <code>plotOutput</code>, we must use the <code>renderPlot</code> function, and we must create a plot inside the <code>renderPlot</code> function.</p>
<p>If you add the code above inside the server function, you should see a plot with 100 random points in the app.</p>
<p><strong>Exercise:</strong> The code inside <code>renderPlot()</code> doesn’t have to be only one line, it can be as long as you’d like as long as it returns a plot. Try making a more complex plot using ggplot2. The plot doesn’t have to use our dataset, it could be anything, just to make sure you can use <code>renderPlot()</code>.</p>
</div>
<div id="making-an-output-react-to-an-input" class="section level3">
<h3><span class="header-section-number">42.9.2</span> Making an output react to an input</h3>
<p>Now we’ll take the plot one step further. Instead of always plotting the same plot (100 random numbers), let’s use the minimum price selected as the number of points to show. It doesn’t make too much sense, but it’s just to learn how to make an output depend on an input.</p>
<p>Replace the previous code in your server function with the code below, and run the app.</p>
<div class="sourceCode" id="cb455"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb455-1"><a href="#cb455-1"></a>output<span class="op">$</span>coolplot &lt;-<span class="st"> </span><span class="kw">renderPlot</span>({</span>
<span id="cb455-2"><a href="#cb455-2"></a>  <span class="kw">plot</span>(<span class="kw">rnorm</span>(input<span class="op">$</span>priceInput[<span class="dv">1</span>]))</span>
<span id="cb455-3"><a href="#cb455-3"></a>})</span></code></pre></div>
<p>Whenever you choose a new minimum price range, the plot will update with a new number of points. Notice that the only thing different in the code is that instead of using the number <code>100</code> we are using <code>input$priceInput[1]</code>.</p>
<p>What does this mean? Just like the variable <code>output</code> contains a list of all the outputs (and we need to assign code into them), the variable <code>input</code> contains a list of all the inputs that are defined in the UI. <code>input$priceInput</code> return a vector of length two containing the minimum and maximum price. Whenever the user manipulates the slider in the app, these values are updated, and whatever code relies on it gets re-evaluated. This is a concept known as <strong>reactivity</strong>, which we will get to <a href="#reactivity-101">soon</a>.</p>
<p>Notice that these short three lines of code are using all the three rules for building outputs:</p>
<ul>
<li>We are saving to the <code>output</code> list (<code>output$coolplot &lt;-</code>).</li>
<li>We are using a <code>render*</code> function to build the output (<code>renderPlot({})</code>).</li>
<li>We are accessing an input value (<code>input$priceInput[1]</code>).</li>
</ul>
</div>
<div id="building-the-plot-output" class="section level3">
<h3><span class="header-section-number">42.9.3</span> Building the plot output</h3>
<p>Now we have all the knowledge required to build a plot visualizing some aspect of the data. We’ll create a simple histogram of the alcohol content of the products by using the same three rules to create a plot output.</p>
<p>First we need to make sure ggplot2 is attached, so add a <code>library(ggplot2)</code> at the top.</p>
<p>Next we’ll return a histogram of alcohol content from <code>renderPlot()</code>. Let’s start with just a histogram of the whole data, unfiltered.</p>
<div class="sourceCode" id="cb456"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb456-1"><a href="#cb456-1"></a>output<span class="op">$</span>coolplot &lt;-<span class="st"> </span><span class="kw">renderPlot</span>({</span>
<span id="cb456-2"><a href="#cb456-2"></a>  <span class="kw">ggplot</span>(bcl, <span class="kw">aes</span>(Alcohol_Content)) <span class="op">+</span></span>
<span id="cb456-3"><a href="#cb456-3"></a><span class="st">    </span><span class="kw">geom_histogram</span>()</span>
<span id="cb456-4"><a href="#cb456-4"></a>})</span></code></pre></div>
<p>If you run the app with this code inside your server, you should see a histogram in the app. But if you change the input values, nothing happens yet, so the next step is to actually filter the dataset based on the inputs.</p>
<p>Recall that we have 3 inputs: <code>priceInput</code>, <code>typeInput</code>, and <code>countryInput</code>. We can filter the data based on the values of these three inputs. We’ll use dplyr functions to filter the data, so be sure to include dplyr at the top. Then we’ll plot the filtered data instead of the original data.</p>
<p>Place this code in your server function and run the app:</p>
<div class="sourceCode" id="cb457"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb457-1"><a href="#cb457-1"></a>output<span class="op">$</span>coolplot &lt;-<span class="st"> </span><span class="kw">renderPlot</span>({</span>
<span id="cb457-2"><a href="#cb457-2"></a>  filtered &lt;-</span>
<span id="cb457-3"><a href="#cb457-3"></a><span class="st">    </span>bcl <span class="op">%&gt;%</span></span>
<span id="cb457-4"><a href="#cb457-4"></a><span class="st">    </span><span class="kw">filter</span>(Price <span class="op">&gt;=</span><span class="st"> </span>input<span class="op">$</span>priceInput[<span class="dv">1</span>],</span>
<span id="cb457-5"><a href="#cb457-5"></a>           Price <span class="op">&lt;=</span><span class="st"> </span>input<span class="op">$</span>priceInput[<span class="dv">2</span>],</span>
<span id="cb457-6"><a href="#cb457-6"></a>           Type <span class="op">==</span><span class="st"> </span>input<span class="op">$</span>typeInput,</span>
<span id="cb457-7"><a href="#cb457-7"></a>           Country <span class="op">==</span><span class="st"> </span>input<span class="op">$</span>countryInput</span>
<span id="cb457-8"><a href="#cb457-8"></a>    )</span>
<span id="cb457-9"><a href="#cb457-9"></a>  <span class="kw">ggplot</span>(filtered, <span class="kw">aes</span>(Alcohol_Content)) <span class="op">+</span></span>
<span id="cb457-10"><a href="#cb457-10"></a><span class="st">    </span><span class="kw">geom_histogram</span>()</span>
<span id="cb457-11"><a href="#cb457-11"></a>})</span></code></pre></div>
<p>If you change any input, you should see the histogram update. The way I know the histogram is correct is by noticing that the alcohol content is about 5% when I select beer, 40% for spirits, and 13% for wine. That sounds right.</p>
<p>Read this code and understand it. You’ve successfully created an interactive app - the plot is changing according to the user’s selection.</p>
<p>To make sure we’re on the same page, here is what your code should look like at this point:</p>
<div class="sourceCode" id="cb458"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb458-1"><a href="#cb458-1"></a><span class="kw">library</span>(shiny)</span>
<span id="cb458-2"><a href="#cb458-2"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb458-3"><a href="#cb458-3"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb458-4"><a href="#cb458-4"></a></span>
<span id="cb458-5"><a href="#cb458-5"></a>bcl &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;bcl-data.csv&quot;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</span>
<span id="cb458-6"><a href="#cb458-6"></a></span>
<span id="cb458-7"><a href="#cb458-7"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb458-8"><a href="#cb458-8"></a>  <span class="kw">titlePanel</span>(<span class="st">&quot;BC Liquor Store prices&quot;</span>),</span>
<span id="cb458-9"><a href="#cb458-9"></a>  <span class="kw">sidebarLayout</span>(</span>
<span id="cb458-10"><a href="#cb458-10"></a>    <span class="kw">sidebarPanel</span>(</span>
<span id="cb458-11"><a href="#cb458-11"></a>      <span class="kw">sliderInput</span>(<span class="st">&quot;priceInput&quot;</span>, <span class="st">&quot;Price&quot;</span>, <span class="dv">0</span>, <span class="dv">100</span>, <span class="kw">c</span>(<span class="dv">25</span>, <span class="dv">40</span>), <span class="dt">pre =</span> <span class="st">&quot;$&quot;</span>),</span>
<span id="cb458-12"><a href="#cb458-12"></a>      <span class="kw">radioButtons</span>(<span class="st">&quot;typeInput&quot;</span>, <span class="st">&quot;Product type&quot;</span>,</span>
<span id="cb458-13"><a href="#cb458-13"></a>                  <span class="dt">choices =</span> <span class="kw">c</span>(<span class="st">&quot;BEER&quot;</span>, <span class="st">&quot;REFRESHMENT&quot;</span>, <span class="st">&quot;SPIRITS&quot;</span>, <span class="st">&quot;WINE&quot;</span>),</span>
<span id="cb458-14"><a href="#cb458-14"></a>                  <span class="dt">selected =</span> <span class="st">&quot;WINE&quot;</span>),</span>
<span id="cb458-15"><a href="#cb458-15"></a>      <span class="kw">selectInput</span>(<span class="st">&quot;countryInput&quot;</span>, <span class="st">&quot;Country&quot;</span>,</span>
<span id="cb458-16"><a href="#cb458-16"></a>                  <span class="dt">choices =</span> <span class="kw">c</span>(<span class="st">&quot;CANADA&quot;</span>, <span class="st">&quot;FRANCE&quot;</span>, <span class="st">&quot;ITALY&quot;</span>))</span>
<span id="cb458-17"><a href="#cb458-17"></a>    ),</span>
<span id="cb458-18"><a href="#cb458-18"></a>    <span class="kw">mainPanel</span>(</span>
<span id="cb458-19"><a href="#cb458-19"></a>      <span class="kw">plotOutput</span>(<span class="st">&quot;coolplot&quot;</span>),</span>
<span id="cb458-20"><a href="#cb458-20"></a>      <span class="kw">br</span>(), <span class="kw">br</span>(),</span>
<span id="cb458-21"><a href="#cb458-21"></a>      <span class="kw">tableOutput</span>(<span class="st">&quot;results&quot;</span>)</span>
<span id="cb458-22"><a href="#cb458-22"></a>    )</span>
<span id="cb458-23"><a href="#cb458-23"></a>  )</span>
<span id="cb458-24"><a href="#cb458-24"></a>)</span>
<span id="cb458-25"><a href="#cb458-25"></a></span>
<span id="cb458-26"><a href="#cb458-26"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output) {</span>
<span id="cb458-27"><a href="#cb458-27"></a>  output<span class="op">$</span>coolplot &lt;-<span class="st"> </span><span class="kw">renderPlot</span>({</span>
<span id="cb458-28"><a href="#cb458-28"></a>    filtered &lt;-</span>
<span id="cb458-29"><a href="#cb458-29"></a><span class="st">      </span>bcl <span class="op">%&gt;%</span></span>
<span id="cb458-30"><a href="#cb458-30"></a><span class="st">      </span><span class="kw">filter</span>(Price <span class="op">&gt;=</span><span class="st"> </span>input<span class="op">$</span>priceInput[<span class="dv">1</span>],</span>
<span id="cb458-31"><a href="#cb458-31"></a>             Price <span class="op">&lt;=</span><span class="st"> </span>input<span class="op">$</span>priceInput[<span class="dv">2</span>],</span>
<span id="cb458-32"><a href="#cb458-32"></a>             Type <span class="op">==</span><span class="st"> </span>input<span class="op">$</span>typeInput,</span>
<span id="cb458-33"><a href="#cb458-33"></a>             Country <span class="op">==</span><span class="st"> </span>input<span class="op">$</span>countryInput</span>
<span id="cb458-34"><a href="#cb458-34"></a>      )</span>
<span id="cb458-35"><a href="#cb458-35"></a>    <span class="kw">ggplot</span>(filtered, <span class="kw">aes</span>(Alcohol_Content)) <span class="op">+</span></span>
<span id="cb458-36"><a href="#cb458-36"></a><span class="st">      </span><span class="kw">geom_histogram</span>()</span>
<span id="cb458-37"><a href="#cb458-37"></a>  })</span>
<span id="cb458-38"><a href="#cb458-38"></a>}</span>
<span id="cb458-39"><a href="#cb458-39"></a></span>
<span id="cb458-40"><a href="#cb458-40"></a><span class="kw">shinyApp</span>(<span class="dt">ui =</span> ui, <span class="dt">server =</span> server)</span></code></pre></div>
<div class="figure">
<img src="img/shiny-addplot.png" alt="Adding a plot to our Shiny app" width="93%" />
<p class="caption">
(#fig:unnamed-chunk-7)Adding a plot to our Shiny app
</p>
</div>
<p><strong>Exercise:</strong> The current plot doesn’t look very nice, you could enhance the plot and make it much more pleasant to look at.</p>
</div>
<div id="building-the-table-output" class="section level3">
<h3><span class="header-section-number">42.9.4</span> Building the table output</h3>
<p>Building the next output should be much easier now that we’ve done it once. The other output we have was called <code>results</code> (as defined in the UI) and should be a table of all the products that match the filters. Since it’s a table output, we should use the <code>renderTable()</code> function. We’ll do the exact same filtering on the data, and then simply return the data as a data.frame. Shiny will know that it needs to display it as a table because it’s defined as a <code>tableOutput</code>.</p>
<p>The code for creating the table output should make sense to you without too much explanation:</p>
<div class="sourceCode" id="cb459"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb459-1"><a href="#cb459-1"></a>output<span class="op">$</span>results &lt;-<span class="st"> </span><span class="kw">renderTable</span>({</span>
<span id="cb459-2"><a href="#cb459-2"></a>  filtered &lt;-</span>
<span id="cb459-3"><a href="#cb459-3"></a><span class="st">    </span>bcl <span class="op">%&gt;%</span></span>
<span id="cb459-4"><a href="#cb459-4"></a><span class="st">    </span><span class="kw">filter</span>(Price <span class="op">&gt;=</span><span class="st"> </span>input<span class="op">$</span>priceInput[<span class="dv">1</span>],</span>
<span id="cb459-5"><a href="#cb459-5"></a>           Price <span class="op">&lt;=</span><span class="st"> </span>input<span class="op">$</span>priceInput[<span class="dv">2</span>],</span>
<span id="cb459-6"><a href="#cb459-6"></a>           Type <span class="op">==</span><span class="st"> </span>input<span class="op">$</span>typeInput,</span>
<span id="cb459-7"><a href="#cb459-7"></a>           Country <span class="op">==</span><span class="st"> </span>input<span class="op">$</span>countryInput</span>
<span id="cb459-8"><a href="#cb459-8"></a>    )</span>
<span id="cb459-9"><a href="#cb459-9"></a>  filtered</span>
<span id="cb459-10"><a href="#cb459-10"></a>})</span></code></pre></div>
<p>Add this code to your server. Don’t overwrite the previous definition of <code>output$coolplot</code>, just add this code before or after that, but inside the server function. Run your app, and be amazed! You can now see a table showing all the products at the BC Liquor Store that match your criteria.</p>
<p><strong>Exercise:</strong> Add a new output. Either a new plot, a new table, or some piece of text that changes based on the inputs. For example, you could add a text output (<code>textOutput()</code> in the UI, <code>renderText()</code> in the server) that says how many results were found. If you choose to do this, I recommend first adding the output to the UI, then building the output in the server with static text to make sure you have the syntax correct. Only once you can see the text output in your app you should make it reflect the inputs. Pro-tip: since <code>textOutput()</code> is written in the UI, you can wrap it in other UI functions. For example, <code>h2(textOutput(...))</code> will result in larger text.</p>
</div>
</div>
<div id="shiny-tutorial-10" class="section level2">
<h2><span class="header-section-number">42.10</span> Reactivity 101</h2>
<p>Shiny uses a concept called <strong>reactive</strong> programming. This is what enables your outputs to <em>react</em> to changes in inputs. Reactivity in Shiny is complex, but as an extreme oversimplification, it means that when the value of a variable <code>x</code> changes, then anything that relies on <code>x</code> gets re-evaluated. Notice how this is very different from what you are used to in R. Consider the following code:</p>
<div class="sourceCode" id="cb460"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb460-1"><a href="#cb460-1"></a>x &lt;-<span class="st"> </span><span class="dv">5</span></span>
<span id="cb460-2"><a href="#cb460-2"></a>y &lt;-<span class="st"> </span>x <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb460-3"><a href="#cb460-3"></a>x &lt;-<span class="st"> </span><span class="dv">10</span></span></code></pre></div>
<p>What is the value of <code>y</code>? It’s 6. But in reactive programming, if <code>x</code> and <code>y</code> are reactive variables, then the value of <code>y</code> would be 11 because it would be updated whenever <code>x</code> is changed. This is a very powerful technique that is very useful for creating the responsiveness of Shiny apps, but it might be a bit weird at first because it’s a very different concept from what you’re used to.</p>
<p>Only <em>reactive</em> variables behave this way, and in Shiny all inputs are automatically reactive. That’s why you can always use <code>input$x</code> in render functions, and you can be sure that whatever output depends on <code>x</code> will use the updated value of <code>x</code> whenever <code>x</code> changes.</p>
<p>You might be wondering what it means to “depend” on a variable. This is not the official terminology, but it simply means that the variable is referenced in the code. So by merely accessing the value of a reactive variable, it causes the current code block to “depend” on that variable. Consider the following sample code to create a plot with a specific number of points in a specific colour:</p>
<div class="sourceCode" id="cb461"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb461-1"><a href="#cb461-1"></a>output<span class="op">$</span>someoutput &lt;-<span class="st"> </span><span class="kw">renderPlot</span>({</span>
<span id="cb461-2"><a href="#cb461-2"></a>  col &lt;-<span class="st"> </span>input<span class="op">$</span>mycolour</span>
<span id="cb461-3"><a href="#cb461-3"></a>  num &lt;-<span class="st"> </span>input<span class="op">$</span>mynumber</span>
<span id="cb461-4"><a href="#cb461-4"></a>  <span class="kw">plot</span>(<span class="kw">rnorm</span>(num), <span class="dt">col =</span> col)</span>
<span id="cb461-5"><a href="#cb461-5"></a>})</span></code></pre></div>
<p>The above render function accesses two different inputs: <code>input$mycolour</code> and <code>input$mynumber</code>. This means that this code block depends on <em>both</em> of these variables, so whenever either one of the two inputs is updated, the code gets re-executed with the new input values and <code>output$someoutput</code> is updated.</p>
<div id="creating-and-accessing-reactive-variables" class="section level3">
<h3><span class="header-section-number">42.10.1</span> Creating and accessing reactive variables</h3>
<p>One very important thing to remember about reactive variables (such as the <code>input</code> list) is that <strong>they can only be used inside reactive contexts</strong>. Any <code>render*</code> function is a reactive context, so you can always use <code>input$x</code> or any other reactive variable inside render functions. There are two other common reactive contexts that we’ll get to in a minute: <code>reactive({})</code> and <code>observe({})</code>. To show you what this means, let’s try accessing the price input value in the server function, without explicitly being inside a reactive context. Simply add <code>print(input$priceInput)</code> inside the <code>server</code> function, and you will get an error when running the app:</p>
<pre><code>Operation not allowed without an active reactive context. (You tried to do something that can only be done from inside a reactive expression or observer.)</code></pre>
<p>Shiny is very clear about what the error is: we are trying to access a reactive variable outside of a reactive context. To fix this, we can use the <code>observe({})</code> function to access the <code>input</code> variable. Inside the server, replace <code>print(input$priceInput)</code> with <code>observe({ print(input$priceInput) })</code>, and now the app should run fine. Note that this <code>observe({})</code> statement <em>depends</em> on <code>input$priceInput</code>, so whenever you change the value of the price, the code inside this <code>observe({})</code> will run again, and the new value will be printed. This is actually a very simple yet useful debugging technique in Shiny: often you want to know what value a reactive variable holds, so you need to remember to wrap the <code>cat(input$x)</code> or <code>print(input$x)</code> by an <code>observe({})</code>.</p>
<p>So far we only saw one reactive variable: the <code>input</code> list. You can also create your own reactive variables using the <code>reactive({})</code> function. The <code>reactive({})</code> function is similar to <code>observe({})</code> in that it is also a reactive context, which means that it will get re-run whenever any of the reactive variables in it get updated. The difference between them is that <code>reactive({})</code> returns a value. To see it in action, let’s create a variable called <code>priceDiff</code> that will be the difference between the maximum and minimum price selected. If you try to naively define <code>priceDiff &lt;- diff(input$priceInput)</code>, you’ll see the same error as before about doing something outside a reactive context. This is because <code>input$priceInput</code> is a reactive variable, and we can’t use a reactive variable outside a reactive context. Since we want to assign a value, we use the <code>reactive({})</code> function. Try adding the following line to your server:</p>
<div class="sourceCode" id="cb463"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb463-1"><a href="#cb463-1"></a>priceDiff &lt;-<span class="st"> </span><span class="kw">reactive</span>({</span>
<span id="cb463-2"><a href="#cb463-2"></a>  <span class="kw">diff</span>(input<span class="op">$</span>priceInput)</span>
<span id="cb463-3"><a href="#cb463-3"></a>})</span></code></pre></div>
<p>Now your app will run. If you want to access a reactive variable defined with <code>reactive({})</code>, <strong>you must add parentheses after the variable name, as if it’s a function</strong>. To demonstrate this, add <code>observe({ print(priceDiff()) })</code> to your server function. Notice that we use <code>priceDiff()</code> rather than <code>priceDiff</code>. It’s very important to remember this, because you can get confusing unclear errors if you simply try to access a custom reactive variable without the parentheses.</p>
<p>You can think of reactivity as causing a chain reaction: when one reactive value changes, anything that depends on it will get updated. If any of the updated values are themselves reactive variables, then any reactive contexts that depend on those variables will also get updated in turn. As a concrete example, let’s think about what happens when you change the value of the <code>priceInput</code> on the page. Since <code>input$priceInput</code> is a reactive variable, any expression that uses it will get updated. This means the two render functions from earlier will execute because they both depend on <code>input$priceInput</code>, as well as the <code>priceDiff</code> variable because it also depends on it. But since <code>priceDiff</code> is itself a reactive variable, Shiny will check if there is anything that depends on <code>priceDiff</code>, and indeed there is - the <code>observe({})</code> function that prints the value of <code>priceDiff</code>. So once <code>priceDiff</code> gets updated, the <code>observe({})</code> function will run, and the value will get printed.</p>
<p>Reactivity is usually the hardest part about Shiny to understand, so if you don’t quite get it, don’t feel bad. Try reading this section again, and I promise that with time and experience you will get more comfortable with reactivity. Once you do feel more confident with reactivity, it may be a good idea to read more advanced documentation describing reactivity, since this section greatly simplifies ideas to make them more understandable. A great resource is RStudio’s <a href="https://shiny.rstudio.com/articles/understanding-reactivity.html">tutorial on reactivity</a>.</p>
<p>Before continuing to the next section, you can remove all the <code>observe({})</code> and <code>reactive({})</code> functions we wrote in this section since they were all just for learning purposes.</p>
<p><strong>Exercise:</strong> Read this section again and really understand what a reactive variable means, what the three main reactive contexts are, how you can define reactive variables, and how a reactivity chain of events works.</p>
</div>
<div id="using-reactive-variables-to-reduce-code-duplication" class="section level3">
<h3><span class="header-section-number">42.10.2</span> Using reactive variables to reduce code duplication</h3>
<p>You may have noticed that we have the exact same code filtering the dataset in two places, once in each render function. We can solve that problem by defining a reactive variable that will hold the filtered dataset, and use that variable in the render functions.</p>
<p>The first step would be to create the reactive variable. The following code should be added to the server function.</p>
<div class="sourceCode" id="cb464"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb464-1"><a href="#cb464-1"></a>filtered &lt;-<span class="st"> </span><span class="kw">reactive</span>({</span>
<span id="cb464-2"><a href="#cb464-2"></a>  bcl <span class="op">%&gt;%</span></span>
<span id="cb464-3"><a href="#cb464-3"></a><span class="st">    </span><span class="kw">filter</span>(Price <span class="op">&gt;=</span><span class="st"> </span>input<span class="op">$</span>priceInput[<span class="dv">1</span>],</span>
<span id="cb464-4"><a href="#cb464-4"></a>           Price <span class="op">&lt;=</span><span class="st"> </span>input<span class="op">$</span>priceInput[<span class="dv">2</span>],</span>
<span id="cb464-5"><a href="#cb464-5"></a>           Type <span class="op">==</span><span class="st"> </span>input<span class="op">$</span>typeInput,</span>
<span id="cb464-6"><a href="#cb464-6"></a>           Country <span class="op">==</span><span class="st"> </span>input<span class="op">$</span>countryInput</span>
<span id="cb464-7"><a href="#cb464-7"></a>    )</span>
<span id="cb464-8"><a href="#cb464-8"></a>})</span></code></pre></div>
<p>The variable <code>filtered</code> is being defined exactly like before, except the body is wrapped by a <code>reactive({})</code>, and it’s defined in the server function instead of inside the individual render functions. Now that we have our reactive variable, we can use it in the output render functions. Try it yourself, and when you think you’re done, check the code below. Don’t forget that in order to access the value of a reactive expression, you must follow the name of the variable with parentheses! This is how your server function should look now:</p>
<div class="sourceCode" id="cb465"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb465-1"><a href="#cb465-1"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output) {</span>
<span id="cb465-2"><a href="#cb465-2"></a>  filtered &lt;-<span class="st"> </span><span class="kw">reactive</span>({</span>
<span id="cb465-3"><a href="#cb465-3"></a>    bcl <span class="op">%&gt;%</span></span>
<span id="cb465-4"><a href="#cb465-4"></a><span class="st">      </span><span class="kw">filter</span>(Price <span class="op">&gt;=</span><span class="st"> </span>input<span class="op">$</span>priceInput[<span class="dv">1</span>],</span>
<span id="cb465-5"><a href="#cb465-5"></a>             Price <span class="op">&lt;=</span><span class="st"> </span>input<span class="op">$</span>priceInput[<span class="dv">2</span>],</span>
<span id="cb465-6"><a href="#cb465-6"></a>             Type <span class="op">==</span><span class="st"> </span>input<span class="op">$</span>typeInput,</span>
<span id="cb465-7"><a href="#cb465-7"></a>             Country <span class="op">==</span><span class="st"> </span>input<span class="op">$</span>countryInput</span>
<span id="cb465-8"><a href="#cb465-8"></a>      )</span>
<span id="cb465-9"><a href="#cb465-9"></a>  })</span>
<span id="cb465-10"><a href="#cb465-10"></a>  </span>
<span id="cb465-11"><a href="#cb465-11"></a>  output<span class="op">$</span>coolplot &lt;-<span class="st"> </span><span class="kw">renderPlot</span>({</span>
<span id="cb465-12"><a href="#cb465-12"></a>    <span class="kw">ggplot</span>(<span class="kw">filtered</span>(), <span class="kw">aes</span>(Alcohol_Content)) <span class="op">+</span></span>
<span id="cb465-13"><a href="#cb465-13"></a><span class="st">      </span><span class="kw">geom_histogram</span>()</span>
<span id="cb465-14"><a href="#cb465-14"></a>  })</span>
<span id="cb465-15"><a href="#cb465-15"></a></span>
<span id="cb465-16"><a href="#cb465-16"></a>  output<span class="op">$</span>results &lt;-<span class="st"> </span><span class="kw">renderTable</span>({</span>
<span id="cb465-17"><a href="#cb465-17"></a>    <span class="kw">filtered</span>()</span>
<span id="cb465-18"><a href="#cb465-18"></a>  })</span>
<span id="cb465-19"><a href="#cb465-19"></a>}</span></code></pre></div>
<p>As a reminder, Shiny creates a dependency tree with all the reactive expressions to know what value depends on what other value. For example, when the price input changes, Shiny looks at what values depend on price, and sees that <code>filtered</code> is a reactive expression that depends on the price input, so it re-evaluates <code>filtered</code>. Then, because <code>filtered</code> is changed, Shiny now looks to see what expressions depend on <code>filtered</code>, and it finds that the two render functions use <code>filtered</code>. So Shiny re-executes the two render functions as well.</p>
</div>
</div>
<div id="shiny-tutorial-11" class="section level2">
<h2><span class="header-section-number">42.11</span> Using <code>uiOutput()</code> to create UI elements dynamically</h2>
<p>One of the output functions you can add in the UI is <code>uiOutput()</code>. According to the naming convention (e.g. <code>plotOutput()</code> is an output to render a plot), this is an output used to render more UI. This may sound a bit confusing, but it’s actually very useful. It’s usually used to create inputs (or any other UI) from the server, or in other words - you can create inputs dynamically.</p>
<p>Any input that you normally create in the UI is created when the app starts, and it cannot be changed. But what if one of your inputs depends on another input? In that case, you want to be able to create an input dynamically, in the server, and you would use <code>uiOutput()</code>. <code>uiOutput()</code> can be used to create <em>any</em> UI element, but it’s most often used to create input UI elements. The same rules regarding building outputs apply, which means the output (which is a UI element in this case) is created with the function <code>renderUI()</code>.</p>
<div id="basic-example-of-uioutput" class="section level3">
<h3><span class="header-section-number">42.11.1</span> Basic example of <code>uiOutput()</code></h3>
<p>As a very basic example, consider this app:</p>
<div class="sourceCode" id="cb466"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb466-1"><a href="#cb466-1"></a><span class="kw">library</span>(shiny)</span>
<span id="cb466-2"><a href="#cb466-2"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb466-3"><a href="#cb466-3"></a>  <span class="kw">numericInput</span>(<span class="st">&quot;num&quot;</span>, <span class="st">&quot;Maximum slider value&quot;</span>, <span class="dv">5</span>),</span>
<span id="cb466-4"><a href="#cb466-4"></a>  <span class="kw">uiOutput</span>(<span class="st">&quot;slider&quot;</span>)</span>
<span id="cb466-5"><a href="#cb466-5"></a>)</span>
<span id="cb466-6"><a href="#cb466-6"></a></span>
<span id="cb466-7"><a href="#cb466-7"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output) {</span>
<span id="cb466-8"><a href="#cb466-8"></a>  output<span class="op">$</span>slider &lt;-<span class="st"> </span><span class="kw">renderUI</span>({</span>
<span id="cb466-9"><a href="#cb466-9"></a>    <span class="kw">sliderInput</span>(<span class="st">&quot;slider&quot;</span>, <span class="st">&quot;Slider&quot;</span>, <span class="dt">min =</span> <span class="dv">0</span>,</span>
<span id="cb466-10"><a href="#cb466-10"></a>                <span class="dt">max =</span> input<span class="op">$</span>num, <span class="dt">value =</span> <span class="dv">0</span>)</span>
<span id="cb466-11"><a href="#cb466-11"></a>  })</span>
<span id="cb466-12"><a href="#cb466-12"></a>}</span>
<span id="cb466-13"><a href="#cb466-13"></a></span>
<span id="cb466-14"><a href="#cb466-14"></a><span class="kw">shinyApp</span>(<span class="dt">ui =</span> ui, <span class="dt">server =</span> server)</span></code></pre></div>
<p>If you run that tiny app, you will see that whenever you change the value of the numeric input, the slider input is re-generated. This behavior can come in handy often.</p>
</div>
<div id="use-uioutput-in-our-app-to-populate-the-countries" class="section level3">
<h3><span class="header-section-number">42.11.2</span> Use <code>uiOutput()</code> in our app to populate the countries</h3>
<p>We can use this concept in our app to populate the choices for the country selector. The country selector currently only holds 3 values that we manually entered, but instead we could render the country selector in the server and use the data to determine what countries it can have.</p>
<p>First we need to replace the <code>selectInput("countryInput", ...)</code> in the UI with:</p>
<div class="sourceCode" id="cb467"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb467-1"><a href="#cb467-1"></a><span class="kw">uiOutput</span>(<span class="st">&quot;countryOutput&quot;</span>)</span></code></pre></div>
<p>Then we need to create the output (which will create a UI element - yeah, it can be a bit confusing at first), so add the following code to the server function:</p>
<div class="sourceCode" id="cb468"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb468-1"><a href="#cb468-1"></a>output<span class="op">$</span>countryOutput &lt;-<span class="st"> </span><span class="kw">renderUI</span>({</span>
<span id="cb468-2"><a href="#cb468-2"></a>  <span class="kw">selectInput</span>(<span class="st">&quot;countryInput&quot;</span>, <span class="st">&quot;Country&quot;</span>,</span>
<span id="cb468-3"><a href="#cb468-3"></a>              <span class="kw">sort</span>(<span class="kw">unique</span>(bcl<span class="op">$</span>Country)),</span>
<span id="cb468-4"><a href="#cb468-4"></a>              <span class="dt">selected =</span> <span class="st">&quot;CANADA&quot;</span>)</span>
<span id="cb468-5"><a href="#cb468-5"></a>})</span></code></pre></div>
<p>Now if you run the app, you should be able to see all the countries that BC Liquor stores import from.</p>
</div>
<div id="errors-showing-up-and-quickly-disappearing" class="section level3">
<h3><span class="header-section-number">42.11.3</span> Errors showing up and quickly disappearing</h3>
<p>You might notice that when you first run the app, each of the two outputs are throwing an error message, but the error message goes away after a second. The problem is that when the app initializes, <code>filtered</code> is trying to access the country input, but the country input hasn’t been created yet. After Shiny finishes loading fully and the country input is generated, <code>filtered</code> tries accessing it again, this time it’s successful, and the error goes away.</p>
<p>Once we understand why the error is happening, fixing it is simple. Inside the <code>filtered</code> reactive function, we should check if the country input exists, and if not then just return <code>NULL</code>.</p>
<div class="sourceCode" id="cb469"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb469-1"><a href="#cb469-1"></a>filtered &lt;-<span class="st"> </span><span class="kw">reactive</span>({</span>
<span id="cb469-2"><a href="#cb469-2"></a>  <span class="cf">if</span> (<span class="kw">is.null</span>(input<span class="op">$</span>countryInput)) {</span>
<span id="cb469-3"><a href="#cb469-3"></a>    <span class="kw">return</span>(<span class="ot">NULL</span>)</span>
<span id="cb469-4"><a href="#cb469-4"></a>  }    </span>
<span id="cb469-5"><a href="#cb469-5"></a>  </span>
<span id="cb469-6"><a href="#cb469-6"></a>  bcl <span class="op">%&gt;%</span></span>
<span id="cb469-7"><a href="#cb469-7"></a><span class="st">    </span><span class="kw">filter</span>(Price <span class="op">&gt;=</span><span class="st"> </span>input<span class="op">$</span>priceInput[<span class="dv">1</span>],</span>
<span id="cb469-8"><a href="#cb469-8"></a>           Price <span class="op">&lt;=</span><span class="st"> </span>input<span class="op">$</span>priceInput[<span class="dv">2</span>],</span>
<span id="cb469-9"><a href="#cb469-9"></a>           Type <span class="op">==</span><span class="st"> </span>input<span class="op">$</span>typeInput,</span>
<span id="cb469-10"><a href="#cb469-10"></a>           Country <span class="op">==</span><span class="st"> </span>input<span class="op">$</span>countryInput</span>
<span id="cb469-11"><a href="#cb469-11"></a>    )</span>
<span id="cb469-12"><a href="#cb469-12"></a>})</span></code></pre></div>
<p>Now when the render function tries to access the data, it will get a <code>NULL</code> value before the app is fully loaded. You will still get an error, because the <code>ggplot()</code> function will not work with a <code>NULL</code> dataset, so we also need to make a similar check in the <code>renderPlot()</code> function. Only once the data is loaded, we can try to plot.</p>
<div class="sourceCode" id="cb470"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb470-1"><a href="#cb470-1"></a>output<span class="op">$</span>coolplot &lt;-<span class="st"> </span><span class="kw">renderPlot</span>({</span>
<span id="cb470-2"><a href="#cb470-2"></a>  <span class="cf">if</span> (<span class="kw">is.null</span>(<span class="kw">filtered</span>())) {</span>
<span id="cb470-3"><a href="#cb470-3"></a>    <span class="kw">return</span>()</span>
<span id="cb470-4"><a href="#cb470-4"></a>  }</span>
<span id="cb470-5"><a href="#cb470-5"></a>  <span class="kw">ggplot</span>(<span class="kw">filtered</span>(), <span class="kw">aes</span>(Alcohol_Content)) <span class="op">+</span></span>
<span id="cb470-6"><a href="#cb470-6"></a><span class="st">    </span><span class="kw">geom_histogram</span>()</span>
<span id="cb470-7"><a href="#cb470-7"></a>})</span></code></pre></div>
<p>The <code>renderTable()</code> function doesn’t need this fix applied because Shiny doesn’t have a problem rendering a <code>NULL</code> table.</p>
<p><strong>Exercise:</strong> Change the product type radio buttons to get generated in the server with the values from the dataset, instead of being created in the UI with the values entered manually. If you’re feeling confident, try adding an input for “subtype” that will get re-generated every time a new type is chosen, and will be populated with all the subtype options available for the currently selected type (for example, if <code>"WINE"</code> is selected, then the subtypes are white wine, red wine, etc.).</p>
</div>
</div>
<div id="shiny-tutorial-12" class="section level2">
<h2><span class="header-section-number">42.12</span> Final Shiny app code</h2>
<p>In case you got lost somewhere, here is the final code. The app is now functional, but there are plenty of features you can add to make it better.</p>
<div class="sourceCode" id="cb471"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb471-1"><a href="#cb471-1"></a><span class="kw">library</span>(shiny)</span>
<span id="cb471-2"><a href="#cb471-2"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb471-3"><a href="#cb471-3"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb471-4"><a href="#cb471-4"></a></span>
<span id="cb471-5"><a href="#cb471-5"></a>bcl &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;bcl-data.csv&quot;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</span>
<span id="cb471-6"><a href="#cb471-6"></a></span>
<span id="cb471-7"><a href="#cb471-7"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb471-8"><a href="#cb471-8"></a>  <span class="kw">titlePanel</span>(<span class="st">&quot;BC Liquor Store prices&quot;</span>),</span>
<span id="cb471-9"><a href="#cb471-9"></a>  <span class="kw">sidebarLayout</span>(</span>
<span id="cb471-10"><a href="#cb471-10"></a>    <span class="kw">sidebarPanel</span>(</span>
<span id="cb471-11"><a href="#cb471-11"></a>      <span class="kw">sliderInput</span>(<span class="st">&quot;priceInput&quot;</span>, <span class="st">&quot;Price&quot;</span>, <span class="dv">0</span>, <span class="dv">100</span>, <span class="kw">c</span>(<span class="dv">25</span>, <span class="dv">40</span>), <span class="dt">pre =</span> <span class="st">&quot;$&quot;</span>),</span>
<span id="cb471-12"><a href="#cb471-12"></a>      <span class="kw">radioButtons</span>(<span class="st">&quot;typeInput&quot;</span>, <span class="st">&quot;Product type&quot;</span>,</span>
<span id="cb471-13"><a href="#cb471-13"></a>                  <span class="dt">choices =</span> <span class="kw">c</span>(<span class="st">&quot;BEER&quot;</span>, <span class="st">&quot;REFRESHMENT&quot;</span>, <span class="st">&quot;SPIRITS&quot;</span>, <span class="st">&quot;WINE&quot;</span>),</span>
<span id="cb471-14"><a href="#cb471-14"></a>                  <span class="dt">selected =</span> <span class="st">&quot;WINE&quot;</span>),</span>
<span id="cb471-15"><a href="#cb471-15"></a>      <span class="kw">uiOutput</span>(<span class="st">&quot;countryOutput&quot;</span>)</span>
<span id="cb471-16"><a href="#cb471-16"></a>    ),</span>
<span id="cb471-17"><a href="#cb471-17"></a>    <span class="kw">mainPanel</span>(</span>
<span id="cb471-18"><a href="#cb471-18"></a>      <span class="kw">plotOutput</span>(<span class="st">&quot;coolplot&quot;</span>),</span>
<span id="cb471-19"><a href="#cb471-19"></a>      <span class="kw">br</span>(), <span class="kw">br</span>(),</span>
<span id="cb471-20"><a href="#cb471-20"></a>      <span class="kw">tableOutput</span>(<span class="st">&quot;results&quot;</span>)</span>
<span id="cb471-21"><a href="#cb471-21"></a>    )</span>
<span id="cb471-22"><a href="#cb471-22"></a>  )</span>
<span id="cb471-23"><a href="#cb471-23"></a>)</span>
<span id="cb471-24"><a href="#cb471-24"></a></span>
<span id="cb471-25"><a href="#cb471-25"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output) {</span>
<span id="cb471-26"><a href="#cb471-26"></a>  output<span class="op">$</span>countryOutput &lt;-<span class="st"> </span><span class="kw">renderUI</span>({</span>
<span id="cb471-27"><a href="#cb471-27"></a>    <span class="kw">selectInput</span>(<span class="st">&quot;countryInput&quot;</span>, <span class="st">&quot;Country&quot;</span>,</span>
<span id="cb471-28"><a href="#cb471-28"></a>                <span class="kw">sort</span>(<span class="kw">unique</span>(bcl<span class="op">$</span>Country)),</span>
<span id="cb471-29"><a href="#cb471-29"></a>                <span class="dt">selected =</span> <span class="st">&quot;CANADA&quot;</span>)</span>
<span id="cb471-30"><a href="#cb471-30"></a>  })  </span>
<span id="cb471-31"><a href="#cb471-31"></a>  </span>
<span id="cb471-32"><a href="#cb471-32"></a>  filtered &lt;-<span class="st"> </span><span class="kw">reactive</span>({</span>
<span id="cb471-33"><a href="#cb471-33"></a>    <span class="cf">if</span> (<span class="kw">is.null</span>(input<span class="op">$</span>countryInput)) {</span>
<span id="cb471-34"><a href="#cb471-34"></a>      <span class="kw">return</span>(<span class="ot">NULL</span>)</span>
<span id="cb471-35"><a href="#cb471-35"></a>    }    </span>
<span id="cb471-36"><a href="#cb471-36"></a>    </span>
<span id="cb471-37"><a href="#cb471-37"></a>    bcl <span class="op">%&gt;%</span></span>
<span id="cb471-38"><a href="#cb471-38"></a><span class="st">      </span><span class="kw">filter</span>(Price <span class="op">&gt;=</span><span class="st"> </span>input<span class="op">$</span>priceInput[<span class="dv">1</span>],</span>
<span id="cb471-39"><a href="#cb471-39"></a>             Price <span class="op">&lt;=</span><span class="st"> </span>input<span class="op">$</span>priceInput[<span class="dv">2</span>],</span>
<span id="cb471-40"><a href="#cb471-40"></a>             Type <span class="op">==</span><span class="st"> </span>input<span class="op">$</span>typeInput,</span>
<span id="cb471-41"><a href="#cb471-41"></a>             Country <span class="op">==</span><span class="st"> </span>input<span class="op">$</span>countryInput</span>
<span id="cb471-42"><a href="#cb471-42"></a>      )</span>
<span id="cb471-43"><a href="#cb471-43"></a>  })</span>
<span id="cb471-44"><a href="#cb471-44"></a>  </span>
<span id="cb471-45"><a href="#cb471-45"></a>  output<span class="op">$</span>coolplot &lt;-<span class="st"> </span><span class="kw">renderPlot</span>({</span>
<span id="cb471-46"><a href="#cb471-46"></a>    <span class="cf">if</span> (<span class="kw">is.null</span>(<span class="kw">filtered</span>())) {</span>
<span id="cb471-47"><a href="#cb471-47"></a>      <span class="kw">return</span>()</span>
<span id="cb471-48"><a href="#cb471-48"></a>    }</span>
<span id="cb471-49"><a href="#cb471-49"></a>    <span class="kw">ggplot</span>(<span class="kw">filtered</span>(), <span class="kw">aes</span>(Alcohol_Content)) <span class="op">+</span></span>
<span id="cb471-50"><a href="#cb471-50"></a><span class="st">      </span><span class="kw">geom_histogram</span>()</span>
<span id="cb471-51"><a href="#cb471-51"></a>  })</span>
<span id="cb471-52"><a href="#cb471-52"></a></span>
<span id="cb471-53"><a href="#cb471-53"></a>  output<span class="op">$</span>results &lt;-<span class="st"> </span><span class="kw">renderTable</span>({</span>
<span id="cb471-54"><a href="#cb471-54"></a>    <span class="kw">filtered</span>()</span>
<span id="cb471-55"><a href="#cb471-55"></a>  })</span>
<span id="cb471-56"><a href="#cb471-56"></a>}</span>
<span id="cb471-57"><a href="#cb471-57"></a></span>
<span id="cb471-58"><a href="#cb471-58"></a><span class="kw">shinyApp</span>(<span class="dt">ui =</span> ui, <span class="dt">server =</span> server)</span></code></pre></div>
</div>
<div id="shiny-tutorial-13" class="section level2">
<h2><span class="header-section-number">42.13</span> Share your app with the world</h2>
<p>Remember how every single app is a web page powered by an R session on a computer? So far, you’ve been running Shiny locally, which means your computer was used to power the app. It also means that the app was not accessible to anyone on the internet. If you want to share your app with the world, you need to host it somewhere.</p>
<div id="host-on-shinyapps.io" class="section level3">
<h3><span class="header-section-number">42.13.1</span> Host on shinyapps.io</h3>
<p>RStudio provides a service called <a href="https://www.shinyapps.io">shinyapps.io</a> which lets you host your apps for free. It is integrated seamlessly into RStudio so that you can publish your apps with the click of a button, and it has a free version. The free version allows a certain number of apps per user and a certain number of activity on each app, but it should be good enough for most of you. It also lets you see some basic stats about usage of your app.</p>
<p>Hosting your app on shinyapps.io is the easy and recommended way of getting your app online. Go to <a href="https://www.shinyapps.io">www.shinyapps.io</a> and sign up for an account. When you’re ready to publish your app, click on the “Publish Application” button in RStudio and follow the instructions. You might be asked to install a couple packages if it’s your first time.</p>
<div class="figure">
<img src="img/shiny-publish.png" alt="Shiny publish application button" width="93%" />
<p class="caption">
(#fig:unnamed-chunk-8)Shiny publish application button
</p>
</div>
<p>After a successful deployment to shinyapps.io, you will be redirected to your app in the browser. You can use that URL to show off to your family what a cool app you wrote.</p>
</div>
<div id="host-on-a-shiny-server" class="section level3">
<h3><span class="header-section-number">42.13.2</span> Host on a Shiny Server</h3>
<p>The other option for hosting your app is on your own private <a href="https://www.rstudio.com/products/shiny/shiny-server/">Shiny Server</a>. Shiny Server is also a product by RStudio that lets you host apps on your own server. This means that instead of RStudio hosting the app for you, you have it on your own private server. This means you have a lot more freedom and flexibility, but it also means you need to have a server and be comfortable administering a server. I currently host all my apps on <a href="https://daattali.com/shiny/">my own Shiny Server</a> just because I like having the extra control, but when I first learned about Shiny I used shinyapps.io for several months.</p>
<p>If you’re feeling adventurous and want to host your own server, you can follow <a href="https://deanattali.com/2015/05/09/setup-rstudio-shiny-server-digital-ocean/">my tutorial for hosting a Shiny Server</a>.</p>
</div>
</div>
<div id="shiny-tutorial-14" class="section level2">
<h2><span class="header-section-number">42.14</span> More Shiny features to check out</h2>
<p>Shiny is extremely powerful and has lots of features that we haven’t covered. Here’s a sneak peek of just a few other common Shiny features that are not too advanced.</p>
<div id="shiny-in-r-markdown" class="section level3">
<h3><span class="header-section-number">42.14.1</span> Shiny in R Markdown</h3>
<p>You can include Shiny inputs and outputs in an R Markdown document! This means that your R Markdown document can be interactive. Learn more <a href="https://bookdown.org/yihui/rmarkdown/shiny-documents.html">here</a>. Here’s a simple example of how to include interactive Shiny elements in an R Markdown:</p>
<div class="sourceCode" id="cb472"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb472-1"><a href="#cb472-1"></a>---</span>
<span id="cb472-2"><a href="#cb472-2"></a>output: html_document</span>
<span id="cb472-3"><a href="#cb472-3"></a>runtime: shiny</span>
<span id="cb472-4"><a href="#cb472-4"></a>---</span>
<span id="cb472-5"><a href="#cb472-5"></a></span>
<span id="cb472-6"><a href="#cb472-6"></a><span class="bn">```{r echo=FALSE}</span></span>
<span id="cb472-7"><a href="#cb472-7"></a><span class="bn">sliderInput(&quot;num&quot;, &quot;Choose a number&quot;,</span></span>
<span id="cb472-8"><a href="#cb472-8"></a><span class="bn">            0, 100, 20)</span></span>
<span id="cb472-9"><a href="#cb472-9"></a></span>
<span id="cb472-10"><a href="#cb472-10"></a><span class="bn">renderPlot({</span></span>
<span id="cb472-11"><a href="#cb472-11"></a><span class="bn">    plot(seq(input$num))</span></span>
<span id="cb472-12"><a href="#cb472-12"></a><span class="bn">})</span></span>
<span id="cb472-13"><a href="#cb472-13"></a><span class="bn">```</span></span></code></pre></div>
</div>
<div id="use-conditionalpanel-to-conditionally-show-ui-elements" class="section level3">
<h3><span class="header-section-number">42.14.2</span> Use <code>conditionalPanel()</code> to conditionally show UI elements</h3>
<p>You can use <code>conditionalPanel()</code> to either show or hide a UI element based on a simple condition, such as the value of another input. Learn more via <code>?conditionalPanel</code>.</p>
<div class="sourceCode" id="cb473"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb473-1"><a href="#cb473-1"></a><span class="kw">library</span>(shiny)</span>
<span id="cb473-2"><a href="#cb473-2"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb473-3"><a href="#cb473-3"></a>  <span class="kw">numericInput</span>(<span class="st">&quot;num&quot;</span>, <span class="st">&quot;Number&quot;</span>, <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">10</span>),</span>
<span id="cb473-4"><a href="#cb473-4"></a>  <span class="kw">conditionalPanel</span>(</span>
<span id="cb473-5"><a href="#cb473-5"></a>    <span class="st">&quot;input.num &gt;=5&quot;</span>,</span>
<span id="cb473-6"><a href="#cb473-6"></a>    <span class="st">&quot;Hello!&quot;</span></span>
<span id="cb473-7"><a href="#cb473-7"></a>  )</span>
<span id="cb473-8"><a href="#cb473-8"></a>)</span>
<span id="cb473-9"><a href="#cb473-9"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output) {}</span>
<span id="cb473-10"><a href="#cb473-10"></a><span class="kw">shinyApp</span>(<span class="dt">ui =</span> ui, <span class="dt">server =</span> server)</span></code></pre></div>
</div>
<div id="use-navbarpage-or-tabsetpanel-to-have-multiple-tabs-in-the-ui" class="section level3">
<h3><span class="header-section-number">42.14.3</span> Use <code>navbarPage()</code> or <code>tabsetPanel()</code> to have multiple tabs in the UI</h3>
<p>If your apps requires more than a single “view”, you can have separate tabs. Learn more via <code>?navbarPage</code> or <code>?tabsetPanel</code>.</p>
<div class="sourceCode" id="cb474"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb474-1"><a href="#cb474-1"></a><span class="kw">library</span>(shiny)</span>
<span id="cb474-2"><a href="#cb474-2"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb474-3"><a href="#cb474-3"></a>  <span class="kw">tabsetPanel</span>(</span>
<span id="cb474-4"><a href="#cb474-4"></a>    <span class="kw">tabPanel</span>(<span class="st">&quot;Tab 1&quot;</span>, <span class="st">&quot;Hello&quot;</span>),</span>
<span id="cb474-5"><a href="#cb474-5"></a>    <span class="kw">tabPanel</span>(<span class="st">&quot;Tab 2&quot;</span>, <span class="st">&quot;there!&quot;</span>)</span>
<span id="cb474-6"><a href="#cb474-6"></a>  )</span>
<span id="cb474-7"><a href="#cb474-7"></a>)</span>
<span id="cb474-8"><a href="#cb474-8"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output) {}</span>
<span id="cb474-9"><a href="#cb474-9"></a><span class="kw">shinyApp</span>(<span class="dt">ui =</span> ui, <span class="dt">server =</span> server)</span></code></pre></div>
</div>
<div id="use-dt-for-beautiful-interactive-tables" class="section level3">
<h3><span class="header-section-number">42.14.4</span> Use DT for beautiful, interactive tables</h3>
<p>Whenever you use <code>tableOutput()</code> + <code>renderTable()</code>, the table that Shiny creates is a static and boring-looking table. If you download the DT package, you can replace the default table with a much sleeker table by just using <code>DT::dataTableOutput()</code> + <code>DT::renderDataTable()</code>. It’s worth trying. Learn more on <a href="https://rstudio.github.io/DT/">DT’s website</a>.</p>
</div>
<div id="use-isolate-function-to-remove-a-dependency-on-a-reactive-variable" class="section level3">
<h3><span class="header-section-number">42.14.5</span> Use <code>isolate()</code> function to remove a dependency on a reactive variable</h3>
<p>When you have multiple reactive variables inside a reactive context, the whole code block will get re-executed whenever <em>any</em> of the reactive variables change because all the variables become dependencies of the code. If you want to suppress this behavior and cause a reactive variable to not be a dependency, you can wrap the code that uses that variable inside the <code>isolate()</code> function. Any reactive variables that are inside <code>isolate()</code> will not result in the code re-executing when their value is changed. Read more about this behavior via <code>?isolate</code>.</p>
</div>
<div id="use-updateinput-functions-to-update-input-values-programmatically" class="section level3">
<h3><span class="header-section-number">42.14.6</span> Use <code>update*Input()</code> functions to update input values programmatically</h3>
<p>Any input function has an equivalent <code>update*Input</code> function that can be used to update any of its parameters.</p>
<div class="sourceCode" id="cb475"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb475-1"><a href="#cb475-1"></a><span class="kw">library</span>(shiny)</span>
<span id="cb475-2"><a href="#cb475-2"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb475-3"><a href="#cb475-3"></a>  <span class="kw">sliderInput</span>(<span class="st">&quot;slider&quot;</span>, <span class="st">&quot;Move me&quot;</span>, <span class="dt">value =</span> <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">10</span>),</span>
<span id="cb475-4"><a href="#cb475-4"></a>  <span class="kw">numericInput</span>(<span class="st">&quot;num&quot;</span>, <span class="st">&quot;Number&quot;</span>, <span class="dt">value =</span> <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">10</span>)</span>
<span id="cb475-5"><a href="#cb475-5"></a>)</span>
<span id="cb475-6"><a href="#cb475-6"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session) {</span>
<span id="cb475-7"><a href="#cb475-7"></a>  <span class="kw">observe</span>({</span>
<span id="cb475-8"><a href="#cb475-8"></a>    <span class="kw">updateNumericInput</span>(session, <span class="st">&quot;num&quot;</span>, <span class="dt">value =</span> input<span class="op">$</span>slider)</span>
<span id="cb475-9"><a href="#cb475-9"></a>  })</span>
<span id="cb475-10"><a href="#cb475-10"></a>}</span>
<span id="cb475-11"><a href="#cb475-11"></a><span class="kw">shinyApp</span>(<span class="dt">ui =</span> ui, <span class="dt">server =</span> server)</span></code></pre></div>
<p>Note that we used an additional argument <code>session</code> when defining the <code>server</code> function. While the <code>input</code> and <code>output</code> arguments are mandatory, the <code>session</code> argument is optional. You need to define the <code>session</code> argument when you want to use functions that need to access the session. The <code>session</code> parameter actually has some useful information in it, you can learn more about this via <code>?shiny::session</code>.</p>
</div>
<div id="scoping-rules-in-shiny-apps" class="section level3">
<h3><span class="header-section-number">42.14.7</span> Scoping rules in Shiny apps</h3>
<p>Scoping is very important to understand in Shiny once you want to support more than one user at a time. Since your app can be hosted online, multiple users can use your app simultaneously. If there are any variables (such as datasets or global parameters) that should be shared by all users, then you can safely define them globally. But any variable that should be specific to each user’s session should be not be defined globally.</p>
<p>You can think of the <code>server</code> function as a sandbox for each user. Any code outside of the server function is run once and is shared by all the instances of your Shiny app. Any code inside the server is run once <em>for every user that visits your app</em>. This means that any user-specific variables should be defined inside server. If you look at the code in our BC Liquor Store app, you’ll see that we followed this rule: the raw dataset was loaded outside the server and is therefore available to all users, but the <code>filtered</code> object is constructed inside the server so that every user has their own version of it. If <code>filtered</code> was a global variable, then when one user changes the values in your app, all other users connected to your app would see the change happen.</p>
<p>You can learn more about the scoping rules in Shiny <a href="https://shiny.rstudio.com/articles/scoping.html">here</a>.</p>
</div>
<div id="use-global.r-to-define-objects-available-to-both-ui.r-and-server.r" class="section level3">
<h3><span class="header-section-number">42.14.8</span> Use <code>global.R</code> to define objects available to both <code>ui.R</code> and <code>server.R</code></h3>
<p>If there are objects that you want to have available to both <code>ui.R</code> and <code>server.R</code>, you can place them in <code>global.R</code>. You can learn more about <code>global.R</code> and other scoping rules <a href="https://shiny.rstudio.com/articles/scoping.html">here</a>.</p>
</div>
<div id="add-images" class="section level3">
<h3><span class="header-section-number">42.14.9</span> Add images</h3>
<p>You can add an image to your Shiny app by placing an image under the <code>www/</code> folder and using the UI function <code>img(src = "image.png")</code>. Shiny will know to automatically look in the <code>www/</code> folder for the image.</p>
</div>
<div id="add-javascriptcss" class="section level3">
<h3><span class="header-section-number">42.14.10</span> Add JavaScript/CSS</h3>
<p>If you know JavaScript or CSS you are more than welcome to use some in your app.</p>
<div class="sourceCode" id="cb476"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb476-1"><a href="#cb476-1"></a><span class="kw">library</span>(shiny)</span>
<span id="cb476-2"><a href="#cb476-2"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb476-3"><a href="#cb476-3"></a>  tags<span class="op">$</span><span class="kw">head</span>(tags<span class="op">$</span><span class="kw">script</span>(<span class="st">&quot;alert(&#39;Hello!&#39;);&quot;</span>)),</span>
<span id="cb476-4"><a href="#cb476-4"></a>  tags<span class="op">$</span><span class="kw">head</span>(tags<span class="op">$</span><span class="kw">style</span>(<span class="st">&quot;body{ color: blue; }&quot;</span>)),</span>
<span id="cb476-5"><a href="#cb476-5"></a>  <span class="st">&quot;Hello&quot;</span></span>
<span id="cb476-6"><a href="#cb476-6"></a>)</span>
<span id="cb476-7"><a href="#cb476-7"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output) {</span>
<span id="cb476-8"><a href="#cb476-8"></a>  </span>
<span id="cb476-9"><a href="#cb476-9"></a>}</span>
<span id="cb476-10"><a href="#cb476-10"></a><span class="kw">shinyApp</span>(<span class="dt">ui =</span> ui, <span class="dt">server =</span> server)</span></code></pre></div>
<p>If you do want to add some JavaScript or use common JavaScript functions in your apps, you might want to check out <a href="https://deanattali.com/shinyjs/"><code>shinyjs</code></a>.</p>
</div>
</div>
<div id="shiny-tutorial-15" class="section level2">
<h2><span class="header-section-number">42.15</span> Ideas to improve our app</h2>
<p>The app we developed is functional, but there are plenty of improvements that can be made. You can compare the app we developed to <a href="https://daattali.com/shiny/bcl/">my version of this app</a> to get an idea of what a (slightly) more functional app could include. Here are some suggestions of varying difficulties. Each idea also has a hint, I would recommend only reading the hint if you’re stuck for 10 minutes.</p>
<ol style="list-style-type: decimal">
<li>Split the app into two separate files: <code>ui.R</code> and <code>server.R</code>.
<ul>
<li><strong>Hint:</strong> All the code assigned into the <code>ui</code> variable goes into <code>ui.R</code> and all the code for the <code>server</code> function goes into <code>server.R</code>. You do not need to explicitly call the <code>shinyApp()</code> function.</li>
</ul></li>
<li>Add an option to sort the results table by price.
<ul>
<li><strong>Hint:</strong> Use <code>checkboxInput()</code> to get <code>TRUE</code>/<code>FALSE</code> values from the user.</li>
</ul></li>
<li>Add an image of the BC Liquor Store to the UI.
<ul>
<li><strong>Hint:</strong> Place the image in a folder named <code>www</code>, and use <code>img(src = "imagename.png")</code> to add the image.</li>
</ul></li>
<li>Share your app with everyone on the internet by deploying to shinyapps.io.
<ul>
<li><strong>Hint:</strong> Go to <a href="https://www.shinyapps.io">shinyapps.io</a>, register for an account, then click the “Publish App” button in RStudio.</li>
</ul></li>
<li>Use the DT package to turn the current results table into an interactive table.
<ul>
<li><strong>Hint:</strong> Install the DT package, replace <code>tableOutput()</code> with <code>DT::dataTableOutput()</code> and replace <code>renderTable()</code> with <code>DT::renderDataTable()</code>.</li>
</ul></li>
<li>Add parameters to the plot.
<ul>
<li><strong>Hint:</strong> You will need to add input functions that will be used as parameters for the plot. You could use <code>shinyjs::colourInput()</code> to let the user decide on the colours of the bars in the plot.</li>
</ul></li>
<li>The app currently behaves strangely when the user selects filters that return 0 results. For example, try searching for wines from Belgium. There will be an empty plot and empty table generated, and there will be a warning message in the R Console. Try to figure out why this warning message is appearing, and how to fix it.
<ul>
<li><strong>Hint:</strong> The problem happens because <code>renderPlot()</code> and <code>renderTable()</code> are trying to render an empty data frame. To fix this issue, the <code>filtered</code> reactive expression should check for the number of rows in the filtered data, and if that number is 0 then return <code>NULL</code> instead of a 0-row data frame.</li>
</ul></li>
<li>Place the plot and the table in separate tabs.
<ul>
<li><strong>Hint:</strong> Use <code>tabsetPanel()</code> to create an interface with multiple tabs.</li>
</ul></li>
<li>If you know CSS, add CSS to make your app look nicer.
<ul>
<li><strong>Hint:</strong> Add a CSS file under <code>www</code> and use the function <code>includeCSS()</code> to use it in your app.</li>
</ul></li>
<li>Experiment with packages that add extra features to Shiny, such as <code>shinyjs</code>, <code>leaflet</code>, <code>shinydashboard</code>, <code>shinythemes</code>, <code>ggvis</code>.
<ul>
<li><strong>Hint:</strong> Each package is unique and has a different purpose, so you need to read the documentation of each package in order to know what it provides and how to use it.</li>
</ul></li>
<li>Show the number of results found whenever the filters change. For example, when searching for Italian wines $20-$40, the app would show the text “We found 122 options for you”.
<ul>
<li><strong>Hint:</strong> Add a <code>textOutput()</code> to the UI, and in its corresponding <code>renderText()</code> use the number of rows in the <code>filtered()</code> object.</li>
</ul></li>
<li>Allow the user to download the results table as a <code>.csv</code> file.
<ul>
<li><strong>Hint:</strong> Look into the <code>downloadButton()</code> and <code>downloadHandler()</code> functions.</li>
</ul></li>
<li>When the user wants to see only wines, show a new input that allows the user to filter by sweetness level. Only show this input if wines are selected.
<ul>
<li><strong>Hint:</strong> Create a new input function for the sweetness level, and use it in the server code that filters the data. Use <code>conditionalPanel()</code> to conditionally show this new input. The <code>condition</code> argument of <code>conditionalPanel</code> should be something like <code>input.typeInput == "WINE"</code>.</li>
</ul></li>
<li>Allow the user to search for multiple alcohol types simultaneously, instead of being able to choose only wines/beers/etc.
<ul>
<li><strong>Hint:</strong> There are two approaches to do this. Either change the <code>typeInput</code> radio buttons into checkboxes (<code>checkboxGroupInput()</code>) since checkboxes support choosing multiple items, or change <code>typeInput</code> into a select box (<code>selectInput()</code>) with the argument <code>multiple = TRUE</code> to support choosing multiple options.</li>
</ul></li>
<li>If you look at the dataset, you’ll see that each product has a “type” (beer, wine, spirit, or refreshment) and also a “subtype” (red wine, rum, cider, etc.). Add an input for “subtype” that will let the user filter for only a specific subtype of products. Since each type has different subtype options, the choices for subtype should get re-generated every time a new type is chosen. For example, if “wine” is selected, then the subtypes available should be white wine, red wine, etc.
<ul>
<li><strong>Hint:</strong> Use <code>uiOutput()</code> to create this input in the server code.</li>
</ul></li>
<li>Provide a way for the user to show results from <em>all</em> countries (instead of forcing a filter by only one specific country).
<ul>
<li><strong>Hint:</strong> There are two ways to approach this. You can either add a value of “All” to the dropdown list of country options, you can include a checkbox for “Filter by country” and only show the dropdown.</li>
</ul></li>
</ol>
<!--RStudio Links-->
<!--HappyGitWithR Links-->
<!--Package Links-->
<!--Shiny links-->
<!--Publications-->
<!--R Documentation-->
<!--Wikipedia Links-->
<!--Misc. Links-->
<!--chapter:end:038_shiny.Rmd-->
</div>
</div>
<div id="appendix-appendix" class="section level1 unnumbered">
<h1>(APPENDIX) Appendix</h1>
</div>
<div id="oldies" class="section level1">
<h1><span class="header-section-number">43</span> Deprecated</h1>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#clcjhevlmn .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#clcjhevlmn .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#clcjhevlmn .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#clcjhevlmn .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#clcjhevlmn .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#clcjhevlmn .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#clcjhevlmn .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#clcjhevlmn .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#clcjhevlmn .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#clcjhevlmn .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#clcjhevlmn .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#clcjhevlmn .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#clcjhevlmn .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#clcjhevlmn .gt_from_md > :first-child {
  margin-top: 0;
}

#clcjhevlmn .gt_from_md > :last-child {
  margin-bottom: 0;
}

#clcjhevlmn .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#clcjhevlmn .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#clcjhevlmn .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#clcjhevlmn .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#clcjhevlmn .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#clcjhevlmn .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#clcjhevlmn .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#clcjhevlmn .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#clcjhevlmn .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#clcjhevlmn .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#clcjhevlmn .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#clcjhevlmn .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#clcjhevlmn .gt_left {
  text-align: left;
}

#clcjhevlmn .gt_center {
  text-align: center;
}

#clcjhevlmn .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#clcjhevlmn .gt_font_normal {
  font-weight: normal;
}

#clcjhevlmn .gt_font_bold {
  font-weight: bold;
}

#clcjhevlmn .gt_font_italic {
  font-style: italic;
}

#clcjhevlmn .gt_super {
  font-size: 65%;
}

#clcjhevlmn .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="clcjhevlmn" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  <thead class="gt_header">
    <tr>
      <th colspan="2" class="gt_heading gt_title gt_font_normal" style>Deprecated STAT 545 Content</th>
    </tr>
    <tr>
      <th colspan="2" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style></th>
    </tr>
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">Lesson</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">Last Updated</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_left"><div class='gt_from_md'><p><a href="https://STAT545-UBC.github.io/STAT545-UBC.github.io/block031_vector-tibble-relations.html">Vectors versus tibbles</a></p>
</div></td>
      <td class="gt_row gt_left"><div class='gt_from_md'><p>2016</p>
</div></td>
    </tr>
    <tr>
      <td class="gt_row gt_left"><div class='gt_from_md'><p><a href="https://STAT545-UBC.github.io/STAT545-UBC.github.io/block023_dplyr-do.html">Computing by groups within data.frames with dplyr and broom</a></p>
</div></td>
      <td class="gt_row gt_left"><div class='gt_from_md'><p>2016</p>
</div></td>
    </tr>
    <tr>
      <td class="gt_row gt_left"><div class='gt_from_md'><p><a href="https://STAT545-UBC.github.io/STAT545-UBC.github.io/block014_factors.html">Be the boss of your factors (2015)</a></p>
</div></td>
      <td class="gt_row gt_left"><div class='gt_from_md'><p>2016</p>
</div></td>
    </tr>
    <tr>
      <td class="gt_row gt_left"><div class='gt_from_md'><p><a href="https://STAT545-UBC.github.io/STAT545-UBC.github.io/block027_regular-expressions.html">Regular expressions and character data (2015)</a></p>
</div></td>
      <td class="gt_row gt_left"><div class='gt_from_md'><p>2015</p>
</div></td>
    </tr>
    <tr>
      <td class="gt_row gt_left"><div class='gt_from_md'><p><a href="https://STAT545-UBC.github.io/STAT545-UBC.github.io/packages02_activity.html">Write your own R package, part 1 (2014)</a></p>
</div></td>
      <td class="gt_row gt_left"><div class='gt_from_md'><p>2015</p>
</div></td>
    </tr>
    <tr>
      <td class="gt_row gt_left"><div class='gt_from_md'><p><a href="https://STAT545-UBC.github.io/STAT545-UBC.github.io/packages03_activity_part2.html">Write your own R package, part 2 (2014)</a></p>
</div></td>
      <td class="gt_row gt_left"><div class='gt_from_md'><p>2015</p>
</div></td>
    </tr>
    <tr>
      <td class="gt_row gt_left"><div class='gt_from_md'><p><a href="https://STAT545-UBC.github.io/STAT545-UBC.github.io/block013_plyr-ddply.html">Computing by groups within data.frames with plyr</a></p>
</div></td>
      <td class="gt_row gt_left"><div class='gt_from_md'><p>2015</p>
</div></td>
    </tr>
    <tr>
      <td class="gt_row gt_left"><div class='gt_from_md'><p><a href="https://STAT545-UBC.github.io/STAT545-UBC.github.io/block025_lm-poly.html">Wrapping lm</a></p>
</div></td>
      <td class="gt_row gt_left"><div class='gt_from_md'><p>2015</p>
</div></td>
    </tr>
    <tr>
      <td class="gt_row gt_left"><div class='gt_from_md'><p><a href="https://STAT545-UBC.github.io/STAT545-UBC.github.io/block022_regular-expression.html">Regular expressions in R (2014)</a></p>
</div></td>
      <td class="gt_row gt_left"><div class='gt_from_md'><p>2015</p>
</div></td>
    </tr>
  </tbody>
  
  
</table></div>
</div>
<div id="random" class="section level1">
<h1><span class="header-section-number">44</span> Short random things</h1>
<div id="draw-the-owl" class="section level2">
<h2><span class="header-section-number">44.1</span> Draw the rest of the owl, a pep talk for building off simple examples</h2>
<!--Original content: https://stat545.com/bit007_draw-the-rest-of-the-owl.html-->
<div class="figure">
<img src="img/how-to-draw-an-own-imgur.jpg" alt="&quot;How to draw an owl&quot; from [imgur](http://imgur.com/gallery/RadSf)&quot;" width="50%" />
<p class="caption">
(#fig:draw-an-owl)“How to draw an owl” from <a href="http://imgur.com/gallery/RadSf">imgur</a>"
</p>
</div>
<p>Figure @ref(fig:draw-an-owl) is an image that is often used to illustrate how hard it can be to go from simple examples to the real thing you actually want.</p>
<p>I recently needed to draw a f*cking owl in R, so I decided to record the process as an experiment.</p>
<p>When I teach <a href="https://stat545.com">STAT545</a> or <a href="https://software-carpentry.org">Software Carpentry</a>, I try to convey as much about <em>process</em> as anything else. You can always look up technical details, e.g., syntax, but you don’t usually get to see how other people work. This is also how I approach teaching about <a href="#functions-part1">writing R functions</a>. Newcomers often look at finished code and assume it flowed perfectly formed out of someone’s fingertips. It probably did not.</p>
<p>My <em>modus operandi</em>: start with something that works and add features in small increments, maniacally checking that everything still works. Other people undoubtedly move faster (and, therefore, travel faster but crash harder), but I’m OK with that.</p>
<div id="context-writing-a-function-factory" class="section level3">
<h3><span class="header-section-number">44.1.1</span> Context: writing a function factory</h3>
<p>I have an R package <a href="https://github.com/jennybc/googlesheets"><code>googlesheets</code></a> that gets Google Sheets in and out of R. Lately we’ve had a lot of trouble with <code>Internal Server Error (HTTP 500)</code>, which, as you might expect, is an error on the Google server side. All you can do as a user is try, try again. But this is a showstopper for unattended scripts or multi-step operations, like building and checking the package. A single error renders lots of other work moot, which is completely infuriating.</p>
<p>I want to catch these errors and automatically retry the request after an appropriate delay.</p>
<p>The brute force approach would be to literally drop little <code>for</code> or <code>while</code> loops all over the package, to inspect the response and retry if necessary. But I try to follow the <a href="https://en.wikipedia.org/wiki/Don%27t_repeat_yourself">DRY principle</a>, so would prefer to write a new “retry-capable” version of the function that makes these http requests.</p>
<p>It also turns out there’s more than one function for making these requests. I’m talking about the <a href="https://www.restapitutorial.com/lessons/httpmethods.html">HTTP verbs you use with REST APIs</a>: GET, POST, PATCH, etc. I potentially need to give them all the “retry” treatment. So what I really need is a <em>function factory</em>: an HTTP verb goes in and out comes a retry-capable version of the verb.</p>
<p>It turns out you can write R (or S) for ~20 years and not be very facile with this technique. I certainly am not! But I can read, which is how I got the two circles to start my owl.</p>
</div>
<div id="start-at-the-beginning" class="section level3">
<h3><span class="header-section-number">44.1.2</span> Start at the beginning</h3>
<p>My reference is the section of Wickham’s <a href="http://adv-r.had.co.nz">Advanced R</a> <span class="citation">(<a href="#ref-wickham2015a" role="doc-biblioref">2015</a>)</span> that is about <a href="http://adv-r.had.co.nz/Functional-programming.html#closures">closures</a>, “functions written by functions”. Here’s one of the two main examples: a function that creates an exponentiation function.</p>
<div class="sourceCode" id="cb477"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb477-1"><a href="#cb477-1"></a>power &lt;-<span class="st"> </span><span class="cf">function</span>(exponent) {</span>
<span id="cb477-2"><a href="#cb477-2"></a>  <span class="cf">function</span>(x) {</span>
<span id="cb477-3"><a href="#cb477-3"></a>    x <span class="op">^</span><span class="st"> </span>exponent</span>
<span id="cb477-4"><a href="#cb477-4"></a>  }</span>
<span id="cb477-5"><a href="#cb477-5"></a>}</span>
<span id="cb477-6"><a href="#cb477-6"></a>square &lt;-<span class="st"> </span><span class="kw">power</span>(<span class="dv">2</span>)</span>
<span id="cb477-7"><a href="#cb477-7"></a><span class="kw">square</span>(<span class="dv">2</span>)</span>
<span id="cb477-8"><a href="#cb477-8"></a><span class="co">#&gt; [1] 4</span></span>
<span id="cb477-9"><a href="#cb477-9"></a><span class="kw">square</span>(<span class="dv">4</span>)</span>
<span id="cb477-10"><a href="#cb477-10"></a><span class="co">#&gt; [1] 16</span></span>
<span id="cb477-11"><a href="#cb477-11"></a>cube &lt;-<span class="st"> </span><span class="kw">power</span>(<span class="dv">3</span>)</span>
<span id="cb477-12"><a href="#cb477-12"></a><span class="kw">cube</span>(<span class="dv">2</span>)</span>
<span id="cb477-13"><a href="#cb477-13"></a><span class="co">#&gt; [1] 8</span></span>
<span id="cb477-14"><a href="#cb477-14"></a><span class="kw">cube</span>(<span class="dv">4</span>)</span>
<span id="cb477-15"><a href="#cb477-15"></a><span class="co">#&gt; [1] 64</span></span></code></pre></div>
<p>I make myself type all this code in and run it. No shortcuts!</p>
<p>What have I learned? I can write a factory, <code>power()</code>, that takes some input, <code>exponent</code>, and gives me back a function, such as <code>square()</code> or <code>cube()</code>.</p>
<p>But let’s be honest, this is pretty far from what I need to do.</p>
</div>
<div id="can-the-input-be-a-function" class="section level3">
<h3><span class="header-section-number">44.1.3</span> Can the input be a function?</h3>
<p>My problem is different. My input is a <em>function</em>, not an exponent like 2 or 3. Can I even do that?</p>
<p>The simplest thing I could think of that sort of looks like my problem:</p>
<ul>
<li>The factory takes a function as input.</li>
<li>It returns a function that executes the input function twice, with whatever inputs that function had in the first place.</li>
</ul>
<div class="sourceCode" id="cb478"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb478-1"><a href="#cb478-1"></a>call_me_twice &lt;-<span class="st"> </span><span class="cf">function</span>(f) {</span>
<span id="cb478-2"><a href="#cb478-2"></a>  <span class="cf">function</span>(...) {</span>
<span id="cb478-3"><a href="#cb478-3"></a>    <span class="kw">f</span>(...)</span>
<span id="cb478-4"><a href="#cb478-4"></a>    <span class="kw">f</span>(...)</span>
<span id="cb478-5"><a href="#cb478-5"></a>  }</span>
<span id="cb478-6"><a href="#cb478-6"></a>}</span></code></pre></div>
<p>Now I need an input function to be the guinea pig. It needs to take input and be chatty, so I can tell if it’s getting executed. Make sure it works as expected!</p>
<div class="sourceCode" id="cb479"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb479-1"><a href="#cb479-1"></a>jfun &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">cat</span>(x, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb479-2"><a href="#cb479-2"></a><span class="kw">jfun</span>(<span class="st">&quot;a&quot;</span>)</span>
<span id="cb479-3"><a href="#cb479-3"></a><span class="co">#&gt; a</span></span>
<span id="cb479-4"><a href="#cb479-4"></a><span class="kw">jfun</span>(<span class="dv">1</span>)</span>
<span id="cb479-5"><a href="#cb479-5"></a><span class="co">#&gt; 1</span></span></code></pre></div>
<p>Put it all together.</p>
<div class="sourceCode" id="cb480"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb480-1"><a href="#cb480-1"></a>jfunner &lt;-<span class="st"> </span><span class="kw">call_me_twice</span>(jfun)</span>
<span id="cb480-2"><a href="#cb480-2"></a><span class="kw">jfunner</span>(<span class="st">&quot;a&quot;</span>)</span>
<span id="cb480-3"><a href="#cb480-3"></a><span class="co">#&gt; a </span></span>
<span id="cb480-4"><a href="#cb480-4"></a><span class="co">#&gt; a</span></span>
<span id="cb480-5"><a href="#cb480-5"></a><span class="kw">jfunner</span>(<span class="dv">1</span>)</span>
<span id="cb480-6"><a href="#cb480-6"></a><span class="co">#&gt; 1 </span></span>
<span id="cb480-7"><a href="#cb480-7"></a><span class="co">#&gt; 1</span></span></code></pre></div>
<p>I won’t lie, I’m pleasantly surprised this worked. Morale boost.</p>
</div>
<div id="faux-verb" class="section level3">
<h3><span class="header-section-number">44.1.4</span> Faux VERB</h3>
<p>I need a placeholder for the HTTP verbs with these qualities:</p>
<ul>
<li>Takes some input.</li>
<li>Generates a non-deterministic status.</li>
<li>Returns a list with the input, status, and some content.</li>
</ul>
<div class="sourceCode" id="cb481"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb481-1"><a href="#cb481-1"></a>VERB &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">url =</span> <span class="st">&quot;URL!&quot;</span>)</span>
<span id="cb481-2"><a href="#cb481-2"></a>  <span class="kw">list</span>(<span class="dt">url =</span> url,</span>
<span id="cb481-3"><a href="#cb481-3"></a>       <span class="dt">status =</span> <span class="kw">sample</span>(<span class="kw">c</span>(<span class="dv">200</span>, <span class="dv">500</span>), <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">prob =</span> <span class="kw">c</span>(<span class="fl">0.6</span>, <span class="fl">0.4</span>)),</span>
<span id="cb481-4"><a href="#cb481-4"></a>       <span class="dt">content =</span> <span class="kw">rnorm</span>(<span class="dv">5</span>))</span>
<span id="cb481-5"><a href="#cb481-5"></a><span class="kw">VERB</span>()</span>
<span id="cb481-6"><a href="#cb481-6"></a><span class="co">#&gt; $url</span></span>
<span id="cb481-7"><a href="#cb481-7"></a><span class="co">#&gt; [1] &quot;URL!&quot;</span></span>
<span id="cb481-8"><a href="#cb481-8"></a><span class="co">#&gt; </span></span>
<span id="cb481-9"><a href="#cb481-9"></a><span class="co">#&gt; $status</span></span>
<span id="cb481-10"><a href="#cb481-10"></a><span class="co">#&gt; [1] 500</span></span>
<span id="cb481-11"><a href="#cb481-11"></a><span class="co">#&gt; </span></span>
<span id="cb481-12"><a href="#cb481-12"></a><span class="co">#&gt; $content</span></span>
<span id="cb481-13"><a href="#cb481-13"></a><span class="co">#&gt; [1]  0.773  0.922  2.287  0.608 -0.256</span></span>
<span id="cb481-14"><a href="#cb481-14"></a><span class="kw">VERB</span>()</span>
<span id="cb481-15"><a href="#cb481-15"></a><span class="co">#&gt; $url</span></span>
<span id="cb481-16"><a href="#cb481-16"></a><span class="co">#&gt; [1] &quot;URL!&quot;</span></span>
<span id="cb481-17"><a href="#cb481-17"></a><span class="co">#&gt; </span></span>
<span id="cb481-18"><a href="#cb481-18"></a><span class="co">#&gt; $status</span></span>
<span id="cb481-19"><a href="#cb481-19"></a><span class="co">#&gt; [1] 200</span></span>
<span id="cb481-20"><a href="#cb481-20"></a><span class="co">#&gt; </span></span>
<span id="cb481-21"><a href="#cb481-21"></a><span class="co">#&gt; $content</span></span>
<span id="cb481-22"><a href="#cb481-22"></a><span class="co">#&gt; [1] -1.695  0.156  0.917  1.237  0.163</span></span></code></pre></div>
<p>Oh wait, we have functions in R to do something over and over again.</p>
<div class="sourceCode" id="cb482"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb482-1"><a href="#cb482-1"></a><span class="kw">replicate</span>(<span class="dv">5</span>, <span class="kw">VERB</span>())</span>
<span id="cb482-2"><a href="#cb482-2"></a><span class="co">#&gt;         [,1]      [,2]      [,3]      [,4]      [,5]     </span></span>
<span id="cb482-3"><a href="#cb482-3"></a><span class="co">#&gt; url     &quot;URL!&quot;    &quot;URL!&quot;    &quot;URL!&quot;    &quot;URL!&quot;    &quot;URL!&quot;   </span></span>
<span id="cb482-4"><a href="#cb482-4"></a><span class="co">#&gt; status  200       200       500       500       200      </span></span>
<span id="cb482-5"><a href="#cb482-5"></a><span class="co">#&gt; content Numeric,5 Numeric,5 Numeric,5 Numeric,5 Numeric,5</span></span></code></pre></div>
<p>Send <code>VERB()</code> off to the function factory.</p>
<div class="sourceCode" id="cb483"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb483-1"><a href="#cb483-1"></a>VERB_twice &lt;-<span class="st"> </span><span class="kw">call_me_twice</span>(VERB)</span>
<span id="cb483-2"><a href="#cb483-2"></a><span class="kw">replicate</span>(<span class="dv">5</span>, <span class="kw">VERB_twice</span>())</span>
<span id="cb483-3"><a href="#cb483-3"></a><span class="co">#&gt;         [,1]      [,2]      [,3]      [,4]      [,5]     </span></span>
<span id="cb483-4"><a href="#cb483-4"></a><span class="co">#&gt; url     &quot;URL!&quot;    &quot;URL!&quot;    &quot;URL!&quot;    &quot;URL!&quot;    &quot;URL!&quot;   </span></span>
<span id="cb483-5"><a href="#cb483-5"></a><span class="co">#&gt; status  500       200       200       200       200      </span></span>
<span id="cb483-6"><a href="#cb483-6"></a><span class="co">#&gt; content Numeric,5 Numeric,5 Numeric,5 Numeric,5 Numeric,5</span></span></code></pre></div>
<p>Hmmmm…I only see one output per call of <code>VERB_twice()</code>. But why? Is it because <code>VERB()</code> is only getting called once? That means I’ve screwed up. Or is <code>VERB()</code> getting called twice but I’m only seeing evidence of the second call?</p>
</div>
<div id="a-better-faux-verb" class="section level3">
<h3><span class="header-section-number">44.1.5</span> A better faux VERB</h3>
<div class="sourceCode" id="cb484"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb484-1"><a href="#cb484-1"></a>VERB &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">url =</span> <span class="st">&quot;URL!&quot;</span>) {</span>
<span id="cb484-2"><a href="#cb484-2"></a>  req &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">url =</span> url,</span>
<span id="cb484-3"><a href="#cb484-3"></a>              <span class="dt">status =</span> <span class="kw">sample</span>(<span class="kw">c</span>(<span class="dv">200</span>, <span class="dv">500</span>), <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">prob =</span> <span class="kw">c</span>(<span class="fl">0.6</span>, <span class="fl">0.4</span>)),</span>
<span id="cb484-4"><a href="#cb484-4"></a>              <span class="dt">content =</span> <span class="kw">rnorm</span>(<span class="dv">5</span>))</span>
<span id="cb484-5"><a href="#cb484-5"></a>  <span class="kw">message</span>(req<span class="op">$</span>status)</span>
<span id="cb484-6"><a href="#cb484-6"></a>  req</span>
<span id="cb484-7"><a href="#cb484-7"></a>}</span>
<span id="cb484-8"><a href="#cb484-8"></a><span class="kw">replicate</span>(<span class="dv">5</span>, <span class="kw">VERB</span>())</span>
<span id="cb484-9"><a href="#cb484-9"></a><span class="co">#&gt; 200</span></span>
<span id="cb484-10"><a href="#cb484-10"></a><span class="co">#&gt; 200</span></span>
<span id="cb484-11"><a href="#cb484-11"></a><span class="co">#&gt; 500</span></span>
<span id="cb484-12"><a href="#cb484-12"></a><span class="co">#&gt; 200</span></span>
<span id="cb484-13"><a href="#cb484-13"></a><span class="co">#&gt; 200</span></span>
<span id="cb484-14"><a href="#cb484-14"></a><span class="co">#&gt;         [,1]      [,2]      [,3]      [,4]      [,5]     </span></span>
<span id="cb484-15"><a href="#cb484-15"></a><span class="co">#&gt; url     &quot;URL!&quot;    &quot;URL!&quot;    &quot;URL!&quot;    &quot;URL!&quot;    &quot;URL!&quot;   </span></span>
<span id="cb484-16"><a href="#cb484-16"></a><span class="co">#&gt; status  200       200       500       200       200      </span></span>
<span id="cb484-17"><a href="#cb484-17"></a><span class="co">#&gt; content Numeric,5 Numeric,5 Numeric,5 Numeric,5 Numeric,5</span></span></code></pre></div>
<p>Why is this better? Each call of <code>VERB()</code> causes a message AND returns something.</p>
<p>Send new and improved <code>VERB()</code> off to the function factory.</p>
<div class="sourceCode" id="cb485"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb485-1"><a href="#cb485-1"></a>VERB_twice &lt;-<span class="st"> </span><span class="kw">call_me_twice</span>(VERB)</span>
<span id="cb485-2"><a href="#cb485-2"></a><span class="kw">replicate</span>(<span class="dv">5</span>, <span class="kw">VERB_twice</span>())</span>
<span id="cb485-3"><a href="#cb485-3"></a><span class="co">#&gt; 200</span></span>
<span id="cb485-4"><a href="#cb485-4"></a><span class="co">#&gt; 200</span></span>
<span id="cb485-5"><a href="#cb485-5"></a><span class="co">#&gt; 500</span></span>
<span id="cb485-6"><a href="#cb485-6"></a><span class="co">#&gt; 200</span></span>
<span id="cb485-7"><a href="#cb485-7"></a><span class="co">#&gt; 200</span></span>
<span id="cb485-8"><a href="#cb485-8"></a><span class="co">#&gt; 200</span></span>
<span id="cb485-9"><a href="#cb485-9"></a><span class="co">#&gt; 200</span></span>
<span id="cb485-10"><a href="#cb485-10"></a><span class="co">#&gt; 200</span></span>
<span id="cb485-11"><a href="#cb485-11"></a><span class="co">#&gt; 200</span></span>
<span id="cb485-12"><a href="#cb485-12"></a><span class="co">#&gt; 200</span></span>
<span id="cb485-13"><a href="#cb485-13"></a><span class="co">#&gt;         [,1]      [,2]      [,3]      [,4]      [,5]     </span></span>
<span id="cb485-14"><a href="#cb485-14"></a><span class="co">#&gt; url     &quot;URL!&quot;    &quot;URL!&quot;    &quot;URL!&quot;    &quot;URL!&quot;    &quot;URL!&quot;   </span></span>
<span id="cb485-15"><a href="#cb485-15"></a><span class="co">#&gt; status  200       200       200       200       200      </span></span>
<span id="cb485-16"><a href="#cb485-16"></a><span class="co">#&gt; content Numeric,5 Numeric,5 Numeric,5 Numeric,5 Numeric,5</span></span></code></pre></div>
<p>I like it! What do I like about it?</p>
<ul>
<li>5 calls produce 10 messages, which tells me <code>VERB()</code> is getting called twice.</li>
<li>5 calls produce 5 outputs, which is good for my eventual goal, where I will only want to return the value of the last call of the enclosed function.</li>
</ul>
</div>
<div id="retry-n-times-and-a-temporary-setback" class="section level3">
<h3><span class="header-section-number">44.1.6</span> Retry <code>n</code> times … and a temporary setback</h3>
<p>Instead of hard-wiring 2 calls of the enclosed function <code>f</code>, let’s call it <code>n</code> times via a <code>for</code> loop.</p>
<div class="sourceCode" id="cb486"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb486-1"><a href="#cb486-1"></a>call_me_n &lt;-<span class="st"> </span><span class="cf">function</span>(f, <span class="dt">n =</span> <span class="dv">3</span>) {</span>
<span id="cb486-2"><a href="#cb486-2"></a>  <span class="cf">function</span>(...) <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_len</span>(n)) <span class="kw">f</span>(...)</span>
<span id="cb486-3"><a href="#cb486-3"></a>}</span></code></pre></div>
<p>Let’s try my new function factory.</p>
<div class="sourceCode" id="cb487"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb487-1"><a href="#cb487-1"></a>VERB_<span class="dv">3</span> &lt;-<span class="st"> </span><span class="kw">call_me_n</span>(VERB)</span>
<span id="cb487-2"><a href="#cb487-2"></a><span class="kw">VERB_3</span>()</span>
<span id="cb487-3"><a href="#cb487-3"></a><span class="co">#&gt; 500</span></span>
<span id="cb487-4"><a href="#cb487-4"></a><span class="co">#&gt; 200</span></span>
<span id="cb487-5"><a href="#cb487-5"></a><span class="co">#&gt; 200</span></span></code></pre></div>
<p>That’s disappointing. I see the message, but get no actual output. Is there really no output coming back? Or is it just invisible?</p>
<div class="sourceCode" id="cb488"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb488-1"><a href="#cb488-1"></a>x &lt;-<span class="st"> </span><span class="kw">VERB_3</span>()</span>
<span id="cb488-2"><a href="#cb488-2"></a><span class="co">#&gt; 200</span></span>
<span id="cb488-3"><a href="#cb488-3"></a><span class="co">#&gt; 500</span></span>
<span id="cb488-4"><a href="#cb488-4"></a><span class="co">#&gt; 200</span></span>
<span id="cb488-5"><a href="#cb488-5"></a><span class="kw">str</span>(x)</span>
<span id="cb488-6"><a href="#cb488-6"></a><span class="co">#&gt;  NULL</span></span></code></pre></div>
<p>Nope, there really is no output. Fix that.</p>
<div class="sourceCode" id="cb489"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb489-1"><a href="#cb489-1"></a>call_me_n &lt;-<span class="st"> </span><span class="cf">function</span>(f, <span class="dt">n =</span> <span class="dv">3</span>) {</span>
<span id="cb489-2"><a href="#cb489-2"></a>  <span class="cf">function</span>(...) {</span>
<span id="cb489-3"><a href="#cb489-3"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_len</span>(n)) out &lt;-<span class="st"> </span><span class="kw">f</span>(...)</span>
<span id="cb489-4"><a href="#cb489-4"></a>    out</span>
<span id="cb489-5"><a href="#cb489-5"></a>  }</span>
<span id="cb489-6"><a href="#cb489-6"></a>}</span>
<span id="cb489-7"><a href="#cb489-7"></a>VERB_<span class="dv">3</span> &lt;-<span class="st"> </span><span class="kw">call_me_n</span>(VERB)</span>
<span id="cb489-8"><a href="#cb489-8"></a><span class="kw">VERB_3</span>()</span>
<span id="cb489-9"><a href="#cb489-9"></a><span class="co">#&gt; 200</span></span>
<span id="cb489-10"><a href="#cb489-10"></a><span class="co">#&gt; 500</span></span>
<span id="cb489-11"><a href="#cb489-11"></a><span class="co">#&gt; 200</span></span>
<span id="cb489-12"><a href="#cb489-12"></a><span class="co">#&gt; $url</span></span>
<span id="cb489-13"><a href="#cb489-13"></a><span class="co">#&gt; [1] &quot;URL!&quot;</span></span>
<span id="cb489-14"><a href="#cb489-14"></a><span class="co">#&gt; </span></span>
<span id="cb489-15"><a href="#cb489-15"></a><span class="co">#&gt; $status</span></span>
<span id="cb489-16"><a href="#cb489-16"></a><span class="co">#&gt; [1] 200</span></span>
<span id="cb489-17"><a href="#cb489-17"></a><span class="co">#&gt; </span></span>
<span id="cb489-18"><a href="#cb489-18"></a><span class="co">#&gt; $content</span></span>
<span id="cb489-19"><a href="#cb489-19"></a><span class="co">#&gt; [1] -1.3931 -1.1298 -2.6355  0.7029 -0.0562</span></span></code></pre></div>
<p>YAY! Before I move on, let’s make sure I can actually set the <code>n</code> argument to something other than 3.</p>
<div class="sourceCode" id="cb490"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb490-1"><a href="#cb490-1"></a>VERB_<span class="dv">4</span> &lt;-<span class="st"> </span><span class="kw">call_me_n</span>(VERB, <span class="dv">4</span>)</span>
<span id="cb490-2"><a href="#cb490-2"></a><span class="kw">VERB_4</span>()</span>
<span id="cb490-3"><a href="#cb490-3"></a><span class="co">#&gt; 200</span></span>
<span id="cb490-4"><a href="#cb490-4"></a><span class="co">#&gt; 200</span></span>
<span id="cb490-5"><a href="#cb490-5"></a><span class="co">#&gt; 200</span></span>
<span id="cb490-6"><a href="#cb490-6"></a><span class="co">#&gt; 200</span></span>
<span id="cb490-7"><a href="#cb490-7"></a><span class="co">#&gt; $url</span></span>
<span id="cb490-8"><a href="#cb490-8"></a><span class="co">#&gt; [1] &quot;URL!&quot;</span></span>
<span id="cb490-9"><a href="#cb490-9"></a><span class="co">#&gt; </span></span>
<span id="cb490-10"><a href="#cb490-10"></a><span class="co">#&gt; $status</span></span>
<span id="cb490-11"><a href="#cb490-11"></a><span class="co">#&gt; [1] 200</span></span>
<span id="cb490-12"><a href="#cb490-12"></a><span class="co">#&gt; </span></span>
<span id="cb490-13"><a href="#cb490-13"></a><span class="co">#&gt; $content</span></span>
<span id="cb490-14"><a href="#cb490-14"></a><span class="co">#&gt; [1]  1.480 -0.021  0.475  0.649 -1.092</span></span></code></pre></div>
</div>
<div id="conditional-retries" class="section level3">
<h3><span class="header-section-number">44.1.7</span> Conditional retries</h3>
<p>Almost done!</p>
<p>My real factory needs to use the output of the enclosed HTTP verb to decide whether a retry is sensible. The new name reflects HTTP verb specificity. I now add the actual logic and behavior I need in real life.</p>
<div class="sourceCode" id="cb491"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb491-1"><a href="#cb491-1"></a>VERB_n &lt;-<span class="st"> </span><span class="cf">function</span>(VERB, <span class="dt">n =</span> <span class="dv">3</span>) {</span>
<span id="cb491-2"><a href="#cb491-2"></a>  <span class="kw">force</span>(VERB)</span>
<span id="cb491-3"><a href="#cb491-3"></a>  <span class="kw">force</span>(n)</span>
<span id="cb491-4"><a href="#cb491-4"></a>  <span class="cf">function</span>(...) {</span>
<span id="cb491-5"><a href="#cb491-5"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_len</span>(n)) {</span>
<span id="cb491-6"><a href="#cb491-6"></a>      out &lt;-<span class="st"> </span><span class="kw">VERB</span>(...)</span>
<span id="cb491-7"><a href="#cb491-7"></a>      <span class="cf">if</span> (out<span class="op">$</span>status <span class="op">&lt;</span><span class="st"> </span><span class="dv">499</span> <span class="op">||</span><span class="st"> </span>i <span class="op">==</span><span class="st"> </span>n) <span class="cf">break</span></span>
<span id="cb491-8"><a href="#cb491-8"></a>      backoff &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dt">n =</span> <span class="dv">1</span>, <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="dv">2</span> <span class="op">^</span><span class="st"> </span>i <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb491-9"><a href="#cb491-9"></a>      <span class="kw">message</span>(<span class="st">&quot;HTTP error &quot;</span>, out<span class="op">$</span>status, <span class="st">&quot; on attempt &quot;</span>, i,</span>
<span id="cb491-10"><a href="#cb491-10"></a>              <span class="st">&quot; ... retrying after a back off of &quot;</span>, <span class="kw">round</span>(backoff, <span class="dv">2</span>),</span>
<span id="cb491-11"><a href="#cb491-11"></a>              <span class="st">&quot; seconds.&quot;</span>)</span>
<span id="cb491-12"><a href="#cb491-12"></a>      <span class="kw">Sys.sleep</span>(backoff)</span>
<span id="cb491-13"><a href="#cb491-13"></a>    }</span>
<span id="cb491-14"><a href="#cb491-14"></a>    out</span>
<span id="cb491-15"><a href="#cb491-15"></a>  }</span>
<span id="cb491-16"><a href="#cb491-16"></a>}</span></code></pre></div>
<p>I send my existing faux <code>VERB()</code> off to the new and improved factory. Start providing input again, just to make sure that all still works.</p>
<div class="sourceCode" id="cb492"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb492-1"><a href="#cb492-1"></a>VERB_<span class="dv">5</span> &lt;-<span class="st"> </span><span class="kw">VERB_n</span>(VERB, <span class="dt">n =</span> <span class="dv">5</span>)</span>
<span id="cb492-2"><a href="#cb492-2"></a><span class="kw">VERB_5</span>(<span class="st">&quot;Owls can rotate their necks 270 degrees.&quot;</span>)</span>
<span id="cb492-3"><a href="#cb492-3"></a><span class="co">#&gt; 200</span></span>
<span id="cb492-4"><a href="#cb492-4"></a><span class="co">#&gt; $url</span></span>
<span id="cb492-5"><a href="#cb492-5"></a><span class="co">#&gt; [1] &quot;Owls can rotate their necks 270 degrees.&quot;</span></span>
<span id="cb492-6"><a href="#cb492-6"></a><span class="co">#&gt; </span></span>
<span id="cb492-7"><a href="#cb492-7"></a><span class="co">#&gt; $status</span></span>
<span id="cb492-8"><a href="#cb492-8"></a><span class="co">#&gt; [1] 200</span></span>
<span id="cb492-9"><a href="#cb492-9"></a><span class="co">#&gt; </span></span>
<span id="cb492-10"><a href="#cb492-10"></a><span class="co">#&gt; $content</span></span>
<span id="cb492-11"><a href="#cb492-11"></a><span class="co">#&gt; [1]  1.381 -1.811 -0.326 -0.494 -1.732</span></span>
<span id="cb492-12"><a href="#cb492-12"></a><span class="kw">VERB_5</span>(<span class="st">&quot;Owls are cute.&quot;</span>)</span>
<span id="cb492-13"><a href="#cb492-13"></a><span class="co">#&gt; 200</span></span>
<span id="cb492-14"><a href="#cb492-14"></a><span class="co">#&gt; $url</span></span>
<span id="cb492-15"><a href="#cb492-15"></a><span class="co">#&gt; [1] &quot;Owls are cute.&quot;</span></span>
<span id="cb492-16"><a href="#cb492-16"></a><span class="co">#&gt; </span></span>
<span id="cb492-17"><a href="#cb492-17"></a><span class="co">#&gt; $status</span></span>
<span id="cb492-18"><a href="#cb492-18"></a><span class="co">#&gt; [1] 200</span></span>
<span id="cb492-19"><a href="#cb492-19"></a><span class="co">#&gt; </span></span>
<span id="cb492-20"><a href="#cb492-20"></a><span class="co">#&gt; $content</span></span>
<span id="cb492-21"><a href="#cb492-21"></a><span class="co">#&gt; [1]  0.365 -0.258  0.574 -0.681  0.347</span></span>
<span id="cb492-22"><a href="#cb492-22"></a><span class="kw">VERB_5</span>(<span class="st">&quot;A group of owls is called a Parliament.&quot;</span>)</span>
<span id="cb492-23"><a href="#cb492-23"></a><span class="co">#&gt; 500</span></span>
<span id="cb492-24"><a href="#cb492-24"></a><span class="co">#&gt; HTTP error 500 on attempt 1 ... retrying after a back off of 0.91 seconds.</span></span>
<span id="cb492-25"><a href="#cb492-25"></a><span class="co">#&gt; 500</span></span>
<span id="cb492-26"><a href="#cb492-26"></a><span class="co">#&gt; HTTP error 500 on attempt 2 ... retrying after a back off of 0.92 seconds.</span></span>
<span id="cb492-27"><a href="#cb492-27"></a><span class="co">#&gt; 500</span></span>
<span id="cb492-28"><a href="#cb492-28"></a><span class="co">#&gt; HTTP error 500 on attempt 3 ... retrying after a back off of 5.66 seconds.</span></span>
<span id="cb492-29"><a href="#cb492-29"></a><span class="co">#&gt; 200</span></span>
<span id="cb492-30"><a href="#cb492-30"></a><span class="co">#&gt; $url</span></span>
<span id="cb492-31"><a href="#cb492-31"></a><span class="co">#&gt; [1] &quot;A group of owls is called a Parliament.&quot;</span></span>
<span id="cb492-32"><a href="#cb492-32"></a><span class="co">#&gt; </span></span>
<span id="cb492-33"><a href="#cb492-33"></a><span class="co">#&gt; $status</span></span>
<span id="cb492-34"><a href="#cb492-34"></a><span class="co">#&gt; [1] 200</span></span>
<span id="cb492-35"><a href="#cb492-35"></a><span class="co">#&gt; </span></span>
<span id="cb492-36"><a href="#cb492-36"></a><span class="co">#&gt; $content</span></span>
<span id="cb492-37"><a href="#cb492-37"></a><span class="co">#&gt; [1] -1.1191 -2.3098  0.5061 -0.0282  0.3780</span></span></code></pre></div>
<p>And we have drawn some f*cking owls, with retries!</p>
<div class="figure">
<img src="https://img.buzzfeed.com/buzzfeed-static/static/2014-03/enhanced/webdr05/7/10/enhanced-22024-1394207918-30.jpg" alt="From [BuzzFeed](https://img.buzzfeed.com/buzzfeed-static/static/2014-03/enhanced/webdr05/7/10/enhanced-22024-1394207918-30.jpg)" width="50%" />
<p class="caption">
(#fig:unnamed-chunk-20)From <a href="https://img.buzzfeed.com/buzzfeed-static/static/2014-03/enhanced/webdr05/7/10/enhanced-22024-1394207918-30.jpg">BuzzFeed</a>
</p>
</div>
</div>
<div id="the-final-result-is-not-that-exciting" class="section level3">
<h3><span class="header-section-number">44.1.8</span> The final result is not that exciting</h3>
<p>Now in real life, I create retry-capable HTTP verbs like so: <code>rGET &lt;- VERB_n(httr::GET)</code>. Then just replace all instances of <code>httr::GET()</code> with <code>rGet()</code>. It’s terribly anticlimactic.</p>
<p>The final version of the function factory is about a dozen lines of fairly pedestrian code. I probably wrote and discarded at least 10x that. This is typical, so don’t be surprised if this is how it works for you too. Get a working example and take tiny steps to morph it into the thing you need.</p>
<p><em>The <strong>results</strong> of this effort are, however, pretty gratifying. I have had zero build/check failures locally and on Travis, since I implemented retries on <code>httr::GET()</code>. Or, to be honest, I’ve had failures, but for other reasons. So it was totally worth it! I also thank Konrad Rudolph and Kevin Ushey for <a href="https://gist.github.com/jennybc/65c577f98c2bad7e2b3d0ccb773dfaf8">straightening me out</a> on the need to use <code>force()</code> inside the function factory.</em></p>
</div>
</div>
<div id="gh-package" class="section level2">
<h2><span class="header-section-number">44.2</span> How to obtain a bunch of GitHub issues or pull requests with R</h2>
<p><a href="https://github.com/jennybc/analyze-github-stuff-with-r">Using dplyr + purrr + tidyr</a> to analyze data about GitHub repos via the <a href="https://github.com/r-lib/gh">gh package</a></p>
</div>
<div id="tame-google-sheets" class="section level2">
<h2><span class="header-section-number">44.3</span> How to tame XML with nested data frames and purrr</h2>
<p><a href="https://github.com/jennybc/manipulate-xml-with-purrr-dplyr-tidyr">Using dplyr + purrr + tidyr + xml2</a> to tame the annoying XML from Google Sheets</p>
</div>
<div id="github-browsability" class="section level2">
<h2><span class="header-section-number">44.4</span> Make browsing your GitHub repos more rewarding</h2>
<!--Original content: https://stat545.com/bit006_github-browsability-wins.html-->
<p><em>The unreasonable effectiveness of GitHub browsability</em></p>
<p>One of my favorite aspects of GitHub is the ability to inspect a repository’s files in a browser. Certain practices make browsing more rewarding and can postpone the day when you must create a proper website for a project. Perhaps indefinitely.</p>
<div id="be-savvy-about-your-files" class="section level3">
<h3><span class="header-section-number">44.4.1</span> Be savvy about your files</h3>
<p>Keep files in the plainest, web-friendliest form that is compatible with your main goals. Plain text is the very best. GitHub offers special handling for certain types of files:</p>
<ul>
<li>Markdown files, which may be destined for conversion into, e.g., HTML</li>
<li>Markdown files named <code>README.md</code></li>
<li>HTML files, often the result of compiling Markdown files</li>
<li>Source code, such as <code>.R</code> files</li>
<li>Delimited files, containing data one might bring into R via <code>read.table()</code></li>
<li>PNG files</li>
</ul>
</div>
<div id="get-over-your-hang-ups-re-committing-derived-products" class="section level3">
<h3><span class="header-section-number">44.4.2</span> Get over your hang ups re: committing derived products</h3>
<p>Let’s acknowledge the discomfort some people feel about putting derived products under version control. Specifically, if you’ve got an R Markdown document <code>foo.Rmd</code>, it can be <code>knit()</code> to produce the intermediate product <code>foo.md</code>, which can be converted to the ultimate output <code>foo.html</code>. Which of those files are you “allowed” to put under version control? Source-is-real hardliners will say only <code>foo.Rmd</code> but pragmatists know this can be a serious bummer in real life. Just because I <em>can</em> rebuild everything from scratch, it doesn’t mean I <em>want</em> to.</p>
<p>The taboo of keeping derived products under version control originates from compilation of binary executables from source. Software built on a Mac would not work on Windows and so it made sense to keep these binaries out of the holy source code repository. Also, you could assume the people with access to the repository have the full development stack and relish opportunities to use it. None of these arguments really apply to the <code>foo.Rmd --&gt; foo.md --&gt; foo.html</code> workflow. We don’t have to blindly follow traditions from the compilation domain!</p>
<p>In fact, looking at the diffs for <code>foo.md</code> or <code>foo-figure-01.png</code> can be extremely informative. This is also true in larger data analytic projects projects after a <code>make clean; make all</code> operation. By looking at the diffs in the downstream products, you often catch unexpected changes. This can tip you off to changes in the underlying data and/or the behavior of packages you depend on.</p>
<p>This is a note about cool things GitHub can do with various file types, if they happen to end up in your repo. I won’t ask you how they got there.</p>
</div>
<div id="markdown" class="section level3">
<h3><span class="header-section-number">44.4.3</span> Markdown</h3>
<p>You will quickly discover that GitHub renders Markdown files very nicely. By clicking on <code>foo.md</code>, you’ll get a decent preview of <code>foo.html</code>. Yay!</p>
<p>Aggressively exploit this handy feature. Make Markdown your default format for narrative text files and use them liberally to embed notes to yourself and others in a repository hosted on GitHub. It’s an easy way to get pseudo-webpages inside a project “for free”. You may never even compile these files to HTML explicitly; in many cases, the HTML preview offered by GitHub is all you ever need.</p>
<p>What does this mean for R Markdown files? <strong>Keep intermediate Markdown.</strong> Commit both <code>foo.Rmd</code> and <code>foo.md</code>, even if you choose to <code>.gitignore</code> the final <code>foo.html</code>. As of <a href="https://github.com/github/markup/pull/343">September 2014</a>, GitHub renders R Markdown files nicely, like Markdown, and with proper syntax highlighting, which is great. But, of course, the code blocks just sit there un-executed, so my advice about keeping intermediate Markdown still holds. You want YAML frontmatter that looks something like <a href="https://gist.github.com/jennybc/402761e30b9be8023af9#file-yaml_frontmatter_rmd_keep_md-yml">this</a> for <code>.Rmd</code>:</p>
<div class="sourceCode" id="cb493"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb493-1"><a href="#cb493-1"></a><span class="pp">---</span></span>
<span id="cb493-2"><a href="#cb493-2"></a><span class="fu">title</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;Something fascinating&quot;</span></span>
<span id="cb493-3"><a href="#cb493-3"></a><span class="fu">author</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;Jenny Bryan&quot;</span></span>
<span id="cb493-4"><a href="#cb493-4"></a><span class="fu">date</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;`r format(Sys.Date())`&quot;</span></span>
<span id="cb493-5"><a href="#cb493-5"></a><span class="fu">output</span><span class="kw">:</span></span>
<span id="cb493-6"><a href="#cb493-6"></a><span class="at">  </span><span class="fu">html_document</span><span class="kw">:</span></span>
<span id="cb493-7"><a href="#cb493-7"></a><span class="at">    </span><span class="fu">keep_md</span><span class="kw">:</span><span class="at"> </span><span class="ch">TRUE</span></span>
<span id="cb493-8"><a href="#cb493-8"></a><span class="pp">---</span></span></code></pre></div>
<p>or like <a href="https://gist.github.com/jennybc/402761e30b9be8023af9#file-yaml_frontmatter_r_keep_md-yml">this</a> for <code>.R</code>:</p>
<div class="sourceCode" id="cb494"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb494-1"><a href="#cb494-1"></a><span class="co">#&#39; ---</span></span>
<span id="cb494-2"><a href="#cb494-2"></a><span class="co">#&#39; title: &quot;Something fascinating&quot;</span></span>
<span id="cb494-3"><a href="#cb494-3"></a><span class="co">#&#39; author: &quot;Jenny Bryan&quot;</span></span>
<span id="cb494-4"><a href="#cb494-4"></a><span class="co">#&#39; date: &quot;`r format(Sys.Date())`&quot;</span></span>
<span id="cb494-5"><a href="#cb494-5"></a><span class="co">#&#39; output:</span></span>
<span id="cb494-6"><a href="#cb494-6"></a><span class="co">#&#39;   html_document:</span></span>
<span id="cb494-7"><a href="#cb494-7"></a><span class="co">#&#39;     keep_md: TRUE</span></span>
<span id="cb494-8"><a href="#cb494-8"></a><span class="co">#&#39; ---</span></span></code></pre></div>
<p>In RStudio, when editing <code>.Rmd</code>, click on the gear next to “Knit HTML” for YAML authoring help
For a quick, stand-alone document that doesn’t fit neatly into a repository or project (yet), make it a <a href="https://gist.github.com">Gist</a>.</p>
<p><strong>Example:</strong> Hadley Wickham’s <a href="https://gist.github.com/hadley/820f09ded347c62c2864">advice on what you need to do to become a data scientist</a>. Gists can contain multiple files, so you can still provide the R script or R Markdown source <strong>and</strong> the resulting Markdown, as I’ve done in this write-up of <a href="https://gist.github.com/jennybc/04b71bfaaf0f88d9d2eb">Twitter-sourced tips for cross-tabulation</a>.</p>
</div>
<div id="readme.md" class="section level3">
<h3><span class="header-section-number">44.4.4</span> <code>README.md</code></h3>
<p>You probably already know that GitHub renders <code>README.md</code> at the top-level of your repo as the <em>de facto</em> landing page. This is analogous to what happens when you point a web browser at a directory instead of a specific web page: if there is a file named <code>index.html</code>, that’s what the server will show you by default. On GitHub, files named <code>README.md</code> play exactly this role for directories in your repo.</p>
<p>Implication: for any logical group of files or mini project-within-your-project, create a sub-directory in your repository. And then create a <code>README.md</code> file to annotate these files, collect relevant links, etc. Now when you navigate to the sub-directory on GitHub the nicely rendered <code>README.md</code> will simply appear.</p>
<p>Some repositories consist solely of <code>README.md</code>. <strong>Examples:</strong> Jeff Leek’s write-ups on <a href="https://github.com/jtleek/datasharing">How to share data with a statistician</a> or <a href="https://github.com/jtleek/rpackages">Developing R packages</a>. I am becoming a bigger fan of <code>README</code>-only repos than gists because repo issues trigger notifications, whereas comments on gists do not.</p>
<p>If you’ve got a directory full of web-friendly figures, such as PNGs, you can use <a href="https://gist.github.com/jennybc/0239f65633e09df7e5f4">code like this</a> to generate a <code>README.md</code> for a quick DIY gallery, as Karl Broman has done with <a href="https://github.com/kbroman/FruitSnacks/blob/master/PhotoGallery.md">his FruitSnacks</a>. I have also used this device to share Keynote slides on GitHub (<em>mea culpa!</em>). Export them as PNGs images and throw ’em into a README gallery: slides on <a href="https://github.com/Reproducible-Science-Curriculum/rr-organization1/tree/27883c8fc4cdd4dcc6a8232f1fe5c726e96708a0/slides/organization-slides">file organization</a> and some on <a href="https://github.com/Reproducible-Science-Curriculum/rr-organization1/tree/27883c8fc4cdd4dcc6a8232f1fe5c726e96708a0/slides/naming-slides">file naming</a>.</p>
</div>
<div id="finding-stuff" class="section level3">
<h3><span class="header-section-number">44.4.5</span> Finding stuff</h3>
<p>OK these are pure GitHub tips but if you’ve made it this far, you’re obviously a keener.</p>
<ul>
<li>Press <code>t</code> to activate <a href="https://github.com/blog/793-introducing-the-file-finder">the file finder</a> whenever you’re in a repo’s file and directory view. AWESOME, especially when there are files tucked into lots of subdirectories.</li>
<li>Press <code>y</code> to <a href="https://help.github.com/articles/getting-permanent-links-to-files/">get a permanent link</a> when you’re viewing a specific file. Watch what changes in the URL. This is important if you are about to <em>link</em> to a file or <a href="http://stackoverflow.com/questions/23821235/how-to-link-to-specific-line-number-on-github">to specific lines</a>. Otherwise your links will break easily in the future. If the file is deleted or renamed or if lines get inserted or deleted, your links will no longer point to what you intended. Use <code>y</code> to get links that include a specific commit in the URL.</li>
</ul>
</div>
<div id="html" class="section level3">
<h3><span class="header-section-number">44.4.6</span> HTML</h3>
<p>If you have an HTML file in a GitHub repository, simply visiting the file shows the raw HTML. Here’s a nice ugly example:</p>
<ul>
<li><a href="https://github.com/STAT545-UBC/STAT545-UBC.github.io/blob/master/bit003_api-key-env-var.html" class="uri">https://github.com/STAT545-UBC/STAT545-UBC.github.io/blob/master/bit003_api-key-env-var.html</a></li>
</ul>
<p>No one wants to look at that. <del>You can provide this URL to <a href="http://rawgit.com">rawgit.com</a> to serve this HTML more properly and get a decent preview.</del></p>
<p><del>You can form two different types of URLs with <a href="http://rawgit.com">rawgit.com</a>:</del></p>
<ul>
<li><del>For sharing low-traffic, temporary examples or demos with small numbers of people, do this:</del>
<ul>
<li><del><a href="https://rawgit.com/STAT545-UBC/STAT545-UBC.github.io/master/bit003_api-key-env-var.html" class="uri">https://rawgit.com/STAT545-UBC/STAT545-UBC.github.io/master/bit003_api-key-env-var.html</a></del></li>
<li><del>Basically: replace <code>https://github.com/</code> with <code>https://rawgit.com/</code></del></li>
</ul></li>
<li><del>For use on production websites with any amount of traffic, do this:</del>
<ul>
<li><del><a href="https://cdn.rawgit.com/STAT545-UBC/STAT545-UBC.github.io/master/bit003_api-key-env-var.html" class="uri">https://cdn.rawgit.com/STAT545-UBC/STAT545-UBC.github.io/master/bit003_api-key-env-var.html</a></del></li>
<li><del>Basically: replace <code>https://github.com/</code> with <code>https://cdn.rawgit.com/</code></del></li>
</ul></li>
</ul>
<p><em>2018-10-09 update: RawGit <a href="https://rawgit.com/">announced</a> that it is in a sunset phase and will soon shut down. They recommended: <a href="https://www.jsdelivr.com/rawgit">jsDelivr</a>, <a href="https://pages.github.com/">GitHub Pages</a>, <a href="https://codesandbox.io/">CodeSandbox</a>, and <a href="https://unpkg.com/#/">unpkg</a> as alternatives.</em></p>
<p>You may also want to check out this <a href="https://chrome.google.com/webstore/detail/github-html-preview/cphnnfjainnhgejcpgboeeakfkgbkfek?hl=en">Chrome extension</a> or <a href="https://htmlpreview.github.io">GitHub &amp; BitBucket HTML Preview</a>.</p>
<p>This sort of enhanced link might be one of the useful things to put in a <code>README.md</code> or other Markdown file in the repo.</p>
<p>Sometimes including HTML files will cause GitHub to think that your R repository is HTML. Besides being slightly annoying, this can make it difficult for people to find your work if they are searching specifically for R repos. You can exclude these files or directories from GitHub’s language statistics by <a href="https://github.com/github/linguist#using-gitattributes">adding a .gitattributes file</a> that marks them as ‘documentation’ rather than code. <a href="https://github.com/jennybc/googlesheets/blob/master/.gitattributes">See an example here</a>.</p>
</div>
<div id="source-code" class="section level3">
<h3><span class="header-section-number">44.4.7</span> Source code</h3>
<p>You will notice that GitHub does automatic syntax highlighting for source code. For example, notice the coloring of this <a href="https://github.com/jennybc/ggplot2-tutorial/blob/master/gapminder-ggplot2-stripplot.r">R script</a>. The file’s extension is the primary determinant for if/how syntax highlighting will be applied. You can see information on recognized languages, the default extensions and more at <a href="https://github.com/github/linguist/blob/master/lib/linguist/languages.yml">github/linguist</a>. You should be doing it anyway, but let this be another reason to follow convention in your use of file extensions.</p>
<p>Note you can click on “Raw” in this context as well, to get just the plain text and nothing but the plain text.</p>
</div>
<div id="delimited-files" class="section level3">
<h3><span class="header-section-number">44.4.8</span> Delimited files</h3>
<p>GitHub will nicely render tabular data in the form of <code>.csv</code> (comma-separated) and <code>.tsv</code> (tab-separated) files. You can read more in the <a href="https://github.com/blog/1601-see-your-csvs">blog post</a> announcing this feature in August 2013 or in <a href="https://help.github.com/articles/rendering-csv-and-tsv-data">this GitHub help page</a>.</p>
<p>Advice: take advantage of this! If something in your repo can be naturally stored as delimited data, by all means, do so. Make the comma or tab your default delimiter and use the file suffixes GitHub is expecting. I have noticed that GitHub is more easily confused than R about things like quoting, so always inspect the GitHub-rendered <code>.csv</code> or <code>.tsv</code> file in the browser. You may need to do light cleaning to get the automagic rendering to work properly. Think of it as yet another way to learn about imperfections in your data.</p>
<p>Here’s an example of a tab delimited file on GitHub: <a href="https://github.com/jennybc/lotr/blob/master/lotr_clean.tsv">lotr_clean.tsv</a>, originally found <del>here</del> (nope, IBM shut down manyeyes July 2015).</p>
<p>Note you can click on “Raw” in this context as well, to get just the plain text and nothing but the plain text.</p>
</div>
<div id="pngs" class="section level3">
<h3><span class="header-section-number">44.4.9</span> PNGs</h3>
<p>PNG is the “no brainer” format in which to store figures for the web. But many of us like a vector-based format, such as PDF, for general purpose figures. Bottom line: PNGs will drive you less crazy than PDFs on GitHub. To reduce the aggravation around viewing figures in the browser, make sure to have a PNG version in the repo.</p>
<p>Examples:</p>
<ul>
<li><a href="https://github.com/jennybc/STAT545A/blob/master/hw06_scaffolds/01_justR/stripplot_wordsByRace_The_Fellowship_Of_The_Ring.png">This PNG figure</a> just shows up in the browser</li>
<li>A different figure <a href="https://github.com/jennybc/ggplot2-tutorial/blob/master/gapminder-country-colors.pdf">stored as PDF</a> <del>produces the dreaded, annoying “View Raw” speed bump. You’ll have to click through and, on my OS + browser, wait for the PDF to appear in an external PDF viewer.</del> <em>2015-06-19 update: since I first wrote this GitHub has <a href="https://github.com/blog/1974-pdf-viewing">elevated its treatment of PDFs</a> so YAY. It’s slow but it works.</em></li>
</ul>
<p>Hopefully we are moving towards a world where you can have “web friendly” and “vector” at the same time, without undue headaches. As of <a href="https://github.com/blog/1902-svg-viewing-diffing">October 2014</a>, GitHub provides enhanced viewing and diffing of SVGs. So don’t read this advice as discouraging SVGs. Make them! But consider keeping a PNG around as emergency back up for now.</p>
</div>
<div id="linking-to-a-zip-archive-of-your-repo" class="section level3">
<h3><span class="header-section-number">44.4.10</span> Linking to a ZIP archive of your repo</h3>
<p>The browsability of GitHub makes your work accessible to people who care about your content but who don’t (yet) use Git themselves. What if such a person wants all the files? Yes, there is a clickable “Download ZIP” button offered by GitHub. But what if you want a link to include in an email or other document? If you add <code>/archive/master.zip</code> <em>to the end</em> of the URL for your repo, you construct a link that will download a ZIP archive of your repository. Click here to try this out on a very small repo:</p>
<p><a href="https://github.com/jennybc/lotr/archive/master.zip" class="uri">https://github.com/jennybc/lotr/archive/master.zip</a></p>
<p>Go look in your downloads folder!</p>
</div>
<div id="links-and-embedded-figures" class="section level3">
<h3><span class="header-section-number">44.4.11</span> Links and embedded figures</h3>
<ul>
<li>To link to another page in your repo, just use a relative link:
<ul>
<li><code>[admin](courseAdmin/)</code> will link to the <code>courseAdmin/</code> directory inside the current directory.</li>
<li><code>[admin](/courseAdmin/)</code> will link to the top-level <code>courseAdmin/</code> directory from any where in the repo.</li>
</ul></li>
<li>The same idea also works for images. <code>![](image.png)</code> will include <code>image.png</code> located in the current directory.</li>
</ul>
</div>
<div id="let-people-correct-you-on-the-internet" class="section level3">
<h3><span class="header-section-number">44.4.12</span> Let people correct you on the internet</h3>
<p>They love that!</p>
<p>You can create a link that takes people directly to an editing interface in the browser. Behind the scenes, assuming the clicker is signed into GitHub but is not you, this will create a fork in their account and send you a pull request. When I click the link below, I am able to actually commit directly to <code>master</code> for this repo.</p>
<p><a href="https://github.com/rstudio-education/stat545/edit/master/39_appendix.Rmd">CLICK HERE to suggest an edit to this page!</a></p>
<p>Here’s what that link looks like in the Markdown source:</p>
<pre><code>[CLICK HERE to suggest an edit to this page!](https://github.com/rstudio-education/stat545/edit/master/39_appendix.Rmd)</code></pre>
<p>and here it is with placeholders:</p>
<pre><code>[INVITATION TO EDIT](&lt;URL to your repo&gt;/edit/master/&lt;path to your md file&gt;)</code></pre>
<p>AFAIK, to do that in a slick automatic way across an entire repo/site, you need to be using Jekyll or some other automated system. But you could easily handcode such links on a small scale.</p>
</div>
</div>
<div id="email-in-r" class="section level2">
<h2><span class="header-section-number">44.5</span> How to send a bunch of emails from R</h2>
<p><a href="https://github.com/jennybc/send-email-with-r">Workflow</a> for sending email with R and <a href="https://CRAN.R-project.org/package=gmailr"><code>gmailr</code></a>.</p>
</div>
<div id="store-api-key" class="section level2">
<h2><span class="header-section-number">44.6</span> Store an API key as an environment variable</h2>
<!--Original content: https://stat545.com/bit003_api-key-env-var.html-->
<p>This can be found <a href="https://happygitwithr.com/credential-caching.html">here</a>.</p>
<!--RStudio Links-->
<!--HappyGitWithR Links-->
<!--Package Links-->
<!--Shiny links-->
<!--Publications-->
<!--R Documentation-->
<!--Wikipedia Links-->
<!--Misc. Links-->
<!--chapter:end:039_appendix.Rmd-->
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1>References</h1>
<!--chapter:end:040_references.Rmd-->
</div>
<div id="contract-grading" class="section level1">
<h1><span class="header-section-number">45</span> Contract Grading</h1>
<p>A: 12 Portfolio Pieces</p>
<p>B: 8 portfolio pieces</p>
<p>C: 4 portfolio pieces</p>
</div>
<div id="portfolio" class="section level1">
<h1><span class="header-section-number">46</span> Portfolio</h1>
<div id="possible-assignments" class="section level2">
<h2><span class="header-section-number">46.1</span> Possible Assignments</h2>
<ul>
<li>Data Cleaning Project using Lab Data (Your portfolio can apply this to</li>
<li>Web scraping project</li>
<li>Tidy Tuesday Project</li>
<li>Handmade Assignment</li>
<li>Data Innovation</li>
<li>Recreate a classic visualization</li>
<li>Interactive Project (Rshiny)</li>
<li>Infographic</li>
<li>master’s thesis / first year project</li>
<li>Misleading Graph</li>
<li>Impossible to Read</li>
<li>Colorblind Friendly</li>
<li>Visualization that only uses X colors</li>
<li>Animated/video</li>
<li>Tutorial</li>
<li>Webscraper data</li>
<li>Digital Humanities Project</li>
<li>reproduce findings from an article in your content area</li>
<li>machine learn!</li>
<li>live dashboard</li>
<li>maps/ geospatial</li>
<li>lie to me graphic</li>
</ul>
<!--chapter:end:contractgrading.Rmd-->
<div id="refs" class="references">
<div id="ref-chang2013">
<p>Chang, W. 2013. <em>R Graphics Cookbook</em>. Oreilly and Associate Series. O’Reilly Media, Incorporated. <a href="https://books.google.com/books?id=_iVFgKTRYrQC">https://books.google.com/books?id=_iVFgKTRYrQC</a>.</p>
</div>
<div id="ref-gelman2002">
<p>Gelman, Andrew, Cristian Pasarica, and Rahul Dodhia. 2002. “Let’s Practice What We Preach: Turning Tables into Graphs.” <em>The American Statistician</em> 56 (2): 121–30. <a href="http://www.jstor.org/stable/3087382">http://www.jstor.org/stable/3087382</a>.</p>
</div>
<div id="ref-grolemund2011">
<p>Grolemund, Garrett, and Hadley Wickham. 2011. “Dates and Times Made Easy with Lubridate.” <em>Journal of Statistical Software, Articles</em> 40 (3): 1–25. <a href="https://doi.org/10.18637/jss.v040.i03">https://doi.org/10.18637/jss.v040.i03</a>.</p>
</div>
<div id="ref-mecklenburg2009">
<p>Mecklenburg, Robert. 2009. <em>Managing Projects with Gnu Make</em>. Nutshell Handbooks. O’Reilly Media. <a href="http://shop.oreilly.com/product/9780596006105.do">http://shop.oreilly.com/product/9780596006105.do</a>.</p>
</div>
<div id="ref-murrell2005">
<p>Murrell, Paul. 2005. <em>R Graphics</em>. Chapman &amp; Hall/Crc the R Series. CRC Press. <a href="https://books.google.com/books?id=Elu6zp4E9qAC">https://books.google.com/books?id=Elu6zp4E9qAC</a>.</p>
</div>
<div id="ref-robbins2012">
<p>Robbins, Naomi B. 2012. <em>Creating More Effective Graphs</em>. Wiley. <a href="https://books.google.com/books?id=2FBD01yHfpQC">https://books.google.com/books?id=2FBD01yHfpQC</a>.</p>
</div>
<div id="ref-rogowitz1996">
<p>Rogowitz, Bernice E, and Lloyd A Treinish. 1996. “Why Should Engineers and Scientists Be Worried About Color?” <em>IBM Thomas J. Watson Research Center, Yorktown Heights, NY</em>.</p>
</div>
<div id="ref-spector2008">
<p>Spector, P. 2008. <em>Data Manipulation with R</em>. Use R! Springer. <a href="https://books.google.com/books?id=grfuq1twFe4C">https://books.google.com/books?id=grfuq1twFe4C</a>.</p>
</div>
<div id="ref-white2013">
<p>White, Ethan P., Elita Baldridge, Zachary T. Brym, Kenneth J. Locey, Daniel J. McGlinn, and Sarah R. Supp. 2013. “Nine Simple Ways to Make It Easier to (Re)use Your Data.” <em>PeerJ PrePrints</em> 1 (July): e7v2. <a href="https://doi.org/10.7287/peerj.preprints.7v2">https://doi.org/10.7287/peerj.preprints.7v2</a>.</p>
</div>
<div id="ref-wickham2015a">
<p>Wickham, H. 2015. <em>Advanced R</em>. Chapman &amp; Hall/Crc the R Series. CRC Press. <a href="https://books.google.com/books?id=FfsYCwAAQBAJ">https://books.google.com/books?id=FfsYCwAAQBAJ</a>.</p>
</div>
<div id="ref-wickham2009">
<p>Wickham, Hadley. 2009. <em>Ggplot2: Elegant Graphics for Data Analysis</em>. Use R! Springer New York. <a href="https://books.google.com/books?id=bes-AAAAQBAJ">https://books.google.com/books?id=bes-AAAAQBAJ</a>.</p>
</div>
<div id="ref-wickham2010">
<p>———. 2010. “A Layered Grammar of Graphics.” <em>Journal of Computational and Graphical Statistics</em> 19 (1): 3–28. <a href="https://doi.org/10.1198/jcgs.2009.07098">https://doi.org/10.1198/jcgs.2009.07098</a>.</p>
</div>
<div id="ref-wickham2011b">
<p>———. 2011a. “Testthat: Get Started with Testing.” <em>The R Journal</em> 3 (1): 5–10.</p>
</div>
<div id="ref-wickham2011a">
<p>———. 2011b. “The Split-Apply-Combine Strategy for Data Analysis.” <em>Journal of Statistical Software, Articles</em> 40 (1): 1–29. <a href="https://doi.org/10.18637/jss.v040.i01">https://doi.org/10.18637/jss.v040.i01</a>.</p>
</div>
<div id="ref-wickham2014">
<p>———. 2014. “Tidy Data.” <em>Journal of Statistical Software, Articles</em> 59 (10): 1–23. <a href="https://doi.org/10.18637/jss.v059.i10">https://doi.org/10.18637/jss.v059.i10</a>.</p>
</div>
<div id="ref-wickham-unpub">
<p>Wickham, Hadley, and Jenny Bryan. In progress. <em>R Packages</em>. 2nd ed. <a href="https://r-pkgs.org">https://r-pkgs.org</a>.</p>
</div>
<div id="ref-wickham2016">
<p>Wickham, Hadley, and Garrett Grolemund. 2016. <em>R for Data Science: Import, Tidy, Transform, Visualize, and Model Data</em>. O’Reilly Media. <a href="https://books.google.com/books?id=vfi3DQAAQBAJ">https://books.google.com/books?id=vfi3DQAAQBAJ</a>.</p>
</div>
<div id="ref-zeileis2009">
<p>Zeileis, Achim, Kurt Hornik, and Paul Murrell. 2009. “Escaping Rgbland: Selecting Colors for Statistical Graphics.” <em>Computational Statistics &amp; Data Analysis</em> 53 (9): 3259–70. <a href="https://doi.org/10.1016/j.csda.2008.11.033">https://doi.org/10.1016/j.csda.2008.11.033</a>.</p>
</div>
</div>
</div>
</div>
<!--bookdown:body:end-->
            </section>

          </div>
        </div>
      </div>
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
    </div>
  </div>
<!--bookdown:config-->

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
