# Lab: Simulating data {#lab12}

In this lab, we will embark on a journey to Mars, simulating potential colonists' data to plan our future Mars colony. We'll learn how to create and manipulate datasets in R, simulating various attributes of our colonists, like their skills, health, and adaptability to the Martian environment.

## Learning goals {.unnumbered}

- Simulate Quantitative Variables: Learn to create simulated quantitative variables representing colonist attributes using `rnorm()`, `runif()`, and `rpois()`.

- Generate Character Variables: Use `rep()` to create categorical variables that represent different groups within the colonists, such as their professions or roles in the colony.

- Replication of Data Simulation: Utilize `replicate()` to repeat the data simulation process, representing multiple scenarios or batches of potential colonists.


## Getting started and warming up {.unnumbered}

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(
  htmltools.dir.version = FALSE, # for blogdown
  show.signif.stars = FALSE, # for regression output
  digits = 2
)
# You can add other libraries as needed
```

### Packages {.unnumbered}

In this lab, we will work with the **tidyverse**, **ggplot2**, and **PACKAGE** packages. We can install and load them with the following code:

```{r load-packages, message=FALSE}
# Install and load the tidyverse package
if (!require("tidyverse")) install.packages("tidyverse")
library(tidyverse)

if (!require("ggplot2")) install.packages("ggplot2")
library(ggplot2)

```



## Exercises {.unnumbered}

Instead of analyzing other people's data, we'll be generating our own!  You will generate basic attributes for 100 potential colonists. These attributes include age, health, and fitness levels, which are critical for survival on Mars.

### Exercise 1: Simulating Our Colonists {.unnumbered}
<!--
1. Task 1: Generating Basic Attributes
- Objective: Learn to create a dataset of n observations with specific characteristics.
  - Simulate the age distribution of 100 colonists using a normal distribution.
 - Generate health and fitness levels to ensure our colonists are fit for the challenges of Mars.
-->

We'll start by simulating the age of our colonists. Age is a crucial factor in colony planning as it impacts the skill, diversity, potential for growth, and the sustainability of the colony.


__Setting Up Your Simulation__. We'll use the `rnorm()` function, which is perfect for this task because it generates normally distributed random numbers. Let's examine the arguments for `rnorm()` using the `?rnorm` command in R.

Parameters:

- n = 100: The number of random ages we want to generate.
- mean = 30: The average age of our colonists. We're targeting a young, but experienced group of individuals.
- sd = 5: The standard deviation, representing age variability around the mean.

Here's code to generate an age distribution:

```{r}
set.seed(123)
age <- rnorm(100, mean = 30, sd = 5)
```



**1.1.** Create a dataframe to store your colonists' attributes. I've already gotten you started, but you'll need to add their ages.


```{r exercise1.1,error=TRUE}

df_colonists <- data.frame(id = 1:100, # this is our id column
                                      ) # add the age column here
```

```{r exercise1.1solution, error=TRUE,include=FALSE}

df_colonists <- data.frame(id = 1:100,  # this is our id column
                              age ) # add the age column here
```

Now, let's visualize the age distribution of our colonists using a histogram. This will help us understand the diversity within our potential Mars colony.

```{r,echo=FALSE}
set.seed(100)
age2 <- rnorm(100, mean = 30, sd = 5)

set.seed(1000)
age3 <- rnorm(100, mean = 30, sd = 5)

df <- data.frame( age = c(age, age2, age3), 
                  seed = c(rep("Seed 123", length(age)),
                           rep("Seed 100", length(age2)),
                           rep("Seed 1000", length(age3))))

library(ggplot2)

# Create a histogram to visualize the age distributions separately
ggplot(df, aes(x = age, fill = seed)) +
    geom_histogram(position = "dodge", 
                   breaks = seq(from = 5 * floor(min(age) / 5), to = 5 * ceiling(max(age) / 5), by = 5), 
                   color = "black") +
  scale_fill_viridis_d()+
  labs(title = "Histogram of Colonist Ages by Seed", x = "Age", y = "Frequency") +
  theme_minimal()
```

**1.2.** Consider the histograms of the age distribution that we've generated (as well as two more I added). What do you notice about the age distribution of our colonists? How does the seed affect the spread of the distribution?

Next, we'll simulate a categorical variable to represent the roles of our colonists. We'll create a variable, `role`, with three categories: engineer, scientist, and medic. We'll use the `rep()` function to generate this variable, ensuring an equal distribution of roles among our colonists.

```{r exercise1.3, error=TRUE}

df_colonists$role <- rep(c("engineer", "scientist", "medic"), length.out = 100)

```

```{r, pie}
ggplot(df_colonists, aes(x = "", fill = role)) +
  geom_bar(width = 1) +
  coord_polar("y") +
  labs(title = "Pie Chart of Colonist Roles", fill = "Role") +
  theme_minimal()

```

Next, we'll simulate the health and fitness levels of our colonists. Health and fitness are essential for the physical and mental well-being of our colonists, ensuring they can adapt to the harsh Martian environment.

__Setting Up Your Simulation__. We'll use the `runif()` function to generate random numbers drawn from a uniform distribution. This distribution is ideal for simulating health and fitness levels, as it ensures equal probability across the range of values. 

Examine the arguments for `runif()`, using the `?runif` command in R. Notice that although some of the arguments are the same, such as n, and parameters for the distribution are different. 

On Mars, health is measured using the MARSGAR (Martian Adult Resilience Score Gauging Astronaut Readiness; Musk, `r round(as.numeric(format(Sys.Date(), "%Y"))+1,digits=0)`) scale, which ranges from 0 to 100. Like the suspiciously-similar Apgar score for newborns, a score of 0 indicates that a colonist has no signs of life: no heartbeat, no breathing, no response to stimulation, no muscle tone, and central cyanosis/pallor. A score of 100 indicates a colonist in perfect health. Take this scoring into consideration when you simulate the health of your colonists.

**1.3.**  Add a uniformally-distributed MARSGAR variable to your colony.

```{r exercise1.3solution, error=TRUE} 
set.seed(123)

df_colonists$marsgar <- runif(100, min = 50, max = 100)
```

Now, let us examine our colonists. We will create a scatter plot to visualize the relationship between age and health. This will help us understand the health distribution of our potential Mars colony.

```{r,echo=FALSE}
library(viridis)
# Fit a linear model
model <- lm(marsgar ~ age, data = df_colonists)

# Extract coefficients
intercept <- coef(model)[1]
slope <- coef(model)[2]

# Create equation string
# Ensure the plus sign is included for positive slopes and the minus is handled by the format
equation <- sprintf("y == %.2f %+ .2f * x", intercept, slope)

# Adjusting the equation for positive/negative slope
equation <- ifelse(slope >= 0,
                   sprintf("y == %.2f + %.2f * x", intercept, slope),  # for non-negative slope
                   sprintf("y == %.2f %.2f * x", intercept, slope))  # slope is negative, sprintf includes the minus

# Viridis color for both line and text
viridis_color <- viridis(1, option = "D")[1]


ggplot(df_colonists, aes(x = age, y = marsgar)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, color = viridis_color) + 
  geom_label(x = Inf, y = Inf, label = equation, hjust = 1.1, vjust = 1.1, parse = TRUE, color = viridis_color) +  

  labs(title = "Scatter Plot of Colonist Age and Health", x = "Age", y = "MARSGAR") +
  theme_minimal()



```


What a contrived plot! It seems that there's no relationship between age and health in the data. How odd! (Or is it?) 

> Spoiler: It's not odd. We generated the data univariately, so there's no reason for there to be a relationship between age and health.



## Exercise 2: Growing Our Colonists {.unnumbered}

Next, we'll simulate the relationship among several attributes of our colonists. We'll consider technical skills, problem-solving abilities, psychological resilience, teamwork, and adaptability. These attributes are crucial for the success of our Mars colony, ensuring that our colonists can work together effectively and overcome challenges.

There are several ways to simulate variables with specific correlations. I will show two approaches: using mvrnorm, which generates data from a multivariate distribustion, and using a less coputationally efficient, but more accessible approach, using multiple steps.


### Basic method

Let's use age to simulate technical skills. We'll assume that older colonists have higher technical skills, as they have more experience and knowledge. We'll create a variable, `technical_skills` as a function of age, with some random noise added in. For the sake of simplicity, we'll assume a linear relationship between age and technical skills. For each year older a colonist is, we'll add 2 points to their technical skills, with some random noise added in. 

We'll do this by creating a regression equestion, `technical_skills = 2 * age + noise`, where the noise is normally distributed with a mean of 0 and a standard deviation of 1. 


```{r exercise2.1, error=TRUE}

# Simulate technical skills based on age

# Set the seed for reproducibility
set.seed(1235)

# Create a variable for technical skills

df_colonists$technical_skills <- 2 * df_colonists$age + rnorm(100, mean = 0, sd = 1)

```

Now, let's visualize the relationship between age and technical skills using a scatter plot.

```{r,echo=FALSE}

# Fit a linear model
model <- lm(technical_skills ~ age, data = df_colonists)

# Extract coefficients
intercept <- coef(model)[1]
slope <- coef(model)[2]

# Create equation string
# Ensure the plus sign is included for positive slopes and the minus is handled by the format
equation <- sprintf("y == %.2f %+ .2f * x", intercept, slope)

# Adjusting the equation for positive/negative slope
equation <- ifelse(slope >= 0,
                   sprintf("y == %.2f + %.2f * x", intercept, slope),  # for non-negative slope
                   sprintf("y == %.2f %.2f * x", intercept, slope))  # slope is negative, sprintf includes the minus

# Viridis color for both line and text
viridis_color <- viridis(1, option = "D")[1]


ggplot(df_colonists, aes(x = age, y = technical_skills)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, color = viridis_color) + 
  geom_label(x = Inf, y = Inf, label = equation, hjust = 1.1, vjust = 1.1, parse = TRUE, color = viridis_color) +  

  labs(title = "Scatter Plot of Colonist Age and technical_skills", x = "Age", y = "technical_skills") +
  theme_minimal()


```



Now this approach works well if you already know what you want your model to look like. But what if you want to simulate multiple variables with specific correlations? That's when the `mvrnorm` function comes in handy from the `MASS` package. This function generates multivariate normal random numbers, allowing us to specify the mean vector, covariance matrix, and number of observations.

<!--

1. Task 2: Skill Correlations
- Objective: Understand how to simulate variables with specific correlations.
  - Create variables for technical skills and problem-solving abilities, ensuring a realistic correlation between them.

-->


<!-- 
1. Task 3: Advanced Attributes Simulation
- Objective: Dive deeper into simulations by generating more complex relationships between variables.
  - Simulate a set of psychological resilience, teamwork, and adaptability scores with predefined correlations and partial correlations.
-->

To simulate correlated variables, the MASS package's mvrnorm() function from multivariate normal distribution is essential, allowing us to generate multiple interrelated variables at once.

Parameters for Simulation:

n = 100: We are simulating attributes for 100 colonists.
mu = c(50, 50): Represents the average scores for technical skills and problem-solving abilities.
Sigma = matrix(c(100, 50, 50, 100), ncol = 2): The covariance matrix, where diagonals represent variances and the off-diagonals represent the covariance between the skills.

```{r exercise1.2, error=TRUE} 
library(MASS)

# Define mean and covariance matrix
mean_skills <- c(50, 50)
cov_matrix <- matrix(c(100, 50, 50, 100), ncol = 2)

# Generate correlated data
skills_data <- mvrnorm(n = 100, mu = mean_skills, Sigma = cov_matrix, empirical = TRUE)
colnames(skills_data) <- c("TechnicalSkills", "ProblemSolving")

df_colonists <- cbind(df_colonists, skills_data)




# Fit a linear model
model <- lm(TechnicalSkills ~ ProblemSolving, data = df_colonists)

# Extract coefficients
intercept <- coef(model)[1]
slope <- coef(model)[2]

# Create equation string
# Ensure the plus sign is included for positive slopes and the minus is handled by the format
equation <- sprintf("y == %.2f %+ .2f * x", intercept, slope)

# Adjusting the equation for positive/negative slope
equation <- ifelse(slope >= 0,
                   sprintf("y == %.2f + %.2f * x", intercept, slope),  # for non-negative slope
                   sprintf("y == %.2f %.2f * x", intercept, slope))  # slope is negative, sprintf includes the minus

# Visualizing the correlation
library(ggplot2)
ggplot(df_colonists, aes(x = ProblemSolving, y = TechnicalSkills)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, color = viridis_color) + 
  geom_label(x = Inf, y = Inf, label = equation, hjust = 1.1, vjust = 1.1, parse = TRUE, color = viridis_color) +  

  labs(title = "Scatter Plot of Colonist ProblemSolving and TechnicalSkills", x = "ProblemSolving", y = "TechnicalSkills") +
  theme_minimal()

```




## Stretch Tasks (Optional) {.unnumbered}

This section offer additional optional activities for students who wish to deepen their understanding.

```{r further-analysis}
# Code for further analysis goes here
```

### Part 2: Analyzing Our Simulated Colonists

1. Task 4: Descriptive Statistics
- Objective: Learn to run descriptive statistics on our generated data and store the results.
  - Calculate and display the mean, standard deviation, and correlations for our simulated attributes.
1. Task 5: Visualization
- Objective: Visualize our data to gain insights into the distribution of skills and attributes within our potential colonists.
- Create histograms, scatter plots, and correlation plots for our simulated variables.

### Part 3: Preparing for the Unexpected

1. Task 6: Sampling and Replication
- Objective: Master the art of repeated sampling and simulation to prepare for various scenarios.
  - Simulate drawing random samples from our dataset to understand variability and ensure resilience in our colony's population.
1. Task 7: Analysis of Repeated Samples
- Objective: Analyze repeated samples to identify patterns and potential challenges.
  - Store and summarize the results of repeated sampling in a comprehensive dataframe, analyzing the resilience of our population across simulations.

## Conclusion {.unnumbered}

Summarize what has been learned in this lab and why it matters. Include any challenges faced and how they were overcome.

### Additional Resources {.unnumbered}

- [Link to resource 1](http://example.com)
- [Following is another useful resource](http://example.com)

